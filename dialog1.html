<!DOCTYPE html>
<!-- saved from url=(0071)https://chat.deepseek.com/a/chat/s/cb014142-baae-4931-9dad-448c3920ecee -->
<html lang="en" class="notranslate" translate="no"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>DeepSeek - 探索未至之境</title><meta name="viewport" content="initial-scale=1.0,maximum-scale=1,width=device-width,viewport-fit=cover"><meta name="commit-id" content="4e9b52b1"><meta name="description" content="Chat with DeepSeek AI – your intelligent assistant for coding, content creation, file reading, and more. Upload documents, engage in long-context conversations, and get expert help in AI, natural language processing, and beyond. | 深度求索（DeepSeek）助力编程代码开发、创意写作、文件处理等任务，支持文件上传及长文本对话，随时为您提供高效的AI支持。"><meta name="keywords" content="DeepSeek,DeepSeek AI,DeepSeek Chat,AI assistant,coding assistant,long-context LLM,Open Source LLM,natural language processing,AI chatbot,AI long text,AI content creation,large language model,深度求索,大语言模型,自然语言处理,AI聊天机器人,代码开发,创意写作,AI助手,长文本对话,文件处理AI,大模型公司,人工智能,AI开发助手"><meta property="og:url" content="https://chat.deepseek.com"><meta property="og:type" content="website"><meta property="og:title" content="DeepSeek"><meta property="og:description" content="Chat with DeepSeek AI."><meta property="og:image" content="https://cdn.deepseek.com/images/deepseek-chat-open-graph-image.jpeg"><meta name="twitter:card" content="summary_large_image"><meta property="twitter:domain" content="deepseek.com"><meta property="twitter:url" content="https://chat.deepseek.com"><meta name="twitter:title" content="DeepSeek"><meta name="twitter:description" content="Chat with DeepSeek AI."><meta name="twitter:image" content="https://cdn.deepseek.com/images/deepseek-chat-open-graph-image.jpeg"><meta name="google" content="notranslate"><meta name="ip" content="117.152.197.19"><meta name="region" content="CN"><link rel="preconnect" href="https://fonts.googleapis.com/"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin=""><link rel="apple-touch-icon" href="https://cdn.deepseek.com/chat/icon.png"><link href="./dialog1_files/css2" rel="stylesheet" media="all" onload="this.media=&quot;all&quot;"><link rel="icon" type="image/x-icon" href="https://chat.deepseek.com/favicon.svg"><script type="text/javascript" async="" id="_intercom_npm_loader" src="./dialog1_files/guh50jw4"></script><script>!function(n,t){if(n.LogAnalyticsObject=t,!n[t]){var c=function(){c.q.push(arguments)};c.q=c.q||[],n[t]=c}n[t].l=+new Date}(window,"collectEvent")</script><script async="" src="./dialog1_files/collect-rangers-v5.2.1.js"></script><script defer="" src="./dialog1_files/default-vendors.34de28fd85.js"></script><script defer="" src="./dialog1_files/main.c1d70ed22e.js"></script><link href="./dialog1_files/main.f704369816.css" rel="stylesheet"><style>
body.change-theme * {
  transition: none !important;
}

body.change-theme *::before {
  transition: none !important;
}

body.change-theme *::after {
  transition: none !important;
}
</style><link data-webpack="@deepseek/chat:chunk-945" rel="stylesheet" href="./dialog1_files/katex.66a418a9b7.css"><script data-smcp="true" src="./dialog1_files/smcp.min.js"></script><style>@font-face {
  font-family: 'quote-cjk-patch';
  src: local('PingFangSC-Regular');
  unicode-range: U+201C-201D, U+2018-2019;
}</style></head><body class="zh_CN dark" data-ds-dark-theme="dark" style="--app-height: 747px;"><div id="root"><div class="ds-theme" style="--ds-rgb-hover: 255 255 255 / 8%; font-size: var(--ds-font-size-m); line-height: var(--ds-line-height-m);"><div class="cb86951c"><div class="cddfb2ed"></div><div class="c3ecdb44"><div class="dc04ec1d a02af2e6"><div class="a7f3a288 f0d4f23d"><div class="ds-icon" style="font-size: 44px; width: 44px; height: 44px; cursor: pointer;"><svg viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path id="path" d="M27.501 8.46875C27.249 8.3457 27.1406 8.58008 26.9932 8.69922C26.9434 8.73828 26.9004 8.78906 26.8584 8.83398C26.4902 9.22852 26.0605 9.48633 25.5 9.45508C24.6787 9.41016 23.9785 9.66797 23.3594 10.2969C23.2275 9.52148 22.79 9.05859 22.125 8.76172C21.7764 8.60742 21.4238 8.45312 21.1807 8.11719C21.0098 7.87891 20.9639 7.61328 20.8779 7.35156C20.8242 7.19336 20.7695 7.03125 20.5879 7.00391C20.3906 6.97266 20.3135 7.13867 20.2363 7.27734C19.9258 7.84375 19.8066 8.46875 19.8174 9.10156C19.8447 10.5234 20.4453 11.6562 21.6367 12.4629C21.7725 12.5547 21.8076 12.6484 21.7646 12.7832C21.6836 13.0605 21.5869 13.3301 21.501 13.6074C21.4473 13.7852 21.3662 13.8242 21.1768 13.7461C20.5225 13.4727 19.957 13.0684 19.458 12.5781C18.6104 11.7578 17.8438 10.8516 16.8877 10.1426C16.6631 9.97656 16.4395 9.82227 16.207 9.67578C15.2314 8.72656 16.335 7.94727 16.5898 7.85547C16.8574 7.75977 16.6826 7.42773 15.8193 7.43164C14.957 7.43555 14.167 7.72461 13.1611 8.10938C13.0137 8.16797 12.8594 8.21094 12.7002 8.24414C11.7871 8.07227 10.8389 8.0332 9.84766 8.14453C7.98242 8.35352 6.49219 9.23633 5.39648 10.7441C4.08105 12.5547 3.77148 14.6133 4.15039 16.7617C4.54883 19.0234 5.70215 20.8984 7.47559 22.3633C9.31348 23.8809 11.4307 24.625 13.8457 24.4824C15.3125 24.3984 16.9463 24.2012 18.7881 22.6406C19.2529 22.8711 19.7402 22.9629 20.5498 23.0332C21.1729 23.0918 21.7725 23.002 22.2373 22.9062C22.9648 22.752 22.9141 22.0781 22.6514 21.9531C20.5186 20.959 20.9863 21.3633 20.5605 21.0371C21.6445 19.752 23.2783 18.418 23.917 14.0977C23.9668 13.7539 23.9238 13.5391 23.917 13.2598C23.9131 13.0918 23.9512 13.0254 24.1445 13.0059C24.6787 12.9453 25.1973 12.7988 25.6738 12.5352C27.0557 11.7793 27.6123 10.5391 27.7441 9.05078C27.7637 8.82422 27.7402 8.58789 27.501 8.46875ZM15.46 21.8613C13.3926 20.2344 12.3906 19.6992 11.9766 19.7227C11.5898 19.7441 11.6592 20.1875 11.7441 20.4766C11.833 20.7617 11.9492 20.959 12.1123 21.209C12.2246 21.375 12.3018 21.623 12 21.8066C11.334 22.2207 10.1768 21.668 10.1221 21.6406C8.77539 20.8477 7.64941 19.7988 6.85547 18.3652C6.08984 16.9844 5.64453 15.5039 5.57129 13.9238C5.55176 13.541 5.66406 13.4062 6.04297 13.3379C6.54199 13.2461 7.05762 13.2266 7.55664 13.2988C9.66602 13.6074 11.4619 14.5527 12.9668 16.0469C13.8262 16.9004 14.4766 17.918 15.1465 18.9121C15.8584 19.9688 16.625 20.9746 17.6006 21.7988C17.9443 22.0879 18.2197 22.3086 18.4824 22.4707C17.6895 22.5586 16.3652 22.5781 15.46 21.8613ZM16.4502 15.4805C16.4502 15.3105 16.5859 15.1758 16.7568 15.1758C16.7949 15.1758 16.8301 15.1836 16.8613 15.1953C16.9033 15.2109 16.9424 15.2344 16.9727 15.2695C17.0273 15.3223 17.0586 15.4004 17.0586 15.4805C17.0586 15.6504 16.9229 15.7852 16.7529 15.7852C16.582 15.7852 16.4502 15.6504 16.4502 15.4805ZM19.5273 17.0625C19.3301 17.1426 19.1328 17.2129 18.9434 17.2207C18.6494 17.2344 18.3281 17.1152 18.1533 16.9688C17.8828 16.7422 17.6895 16.6152 17.6074 16.2168C17.5732 16.0469 17.5928 15.7852 17.623 15.6348C17.6934 15.3105 17.6152 15.1035 17.3877 14.9141C17.2012 14.7598 16.9658 14.7188 16.7061 14.7188C16.6094 14.7188 16.5205 14.6758 16.4541 14.6406C16.3457 14.5859 16.2568 14.4512 16.3418 14.2852C16.3691 14.2324 16.501 14.1016 16.5322 14.0781C16.8838 13.877 17.29 13.9434 17.666 14.0938C18.0146 14.2363 18.2773 14.498 18.6562 14.8672C19.0439 15.3145 19.1133 15.4395 19.334 15.7734C19.5078 16.0371 19.667 16.3066 19.7754 16.6152C19.8408 16.8066 19.7559 16.9648 19.5273 17.0625Z" fill-rule="nonzero" fill="#4D6BFE"></path></svg></div><div style="margin-top: 38px; display: flex;"><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #ABB2BD; --ds-icon-button-size: 28px;"><svg viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><clippath id="clip1381_20236"><rect id="打开边栏0730" width="30.000000" height="30.000000" fill="white" fill-opacity="0"></rect></clippath></defs><rect id="打开边栏0730" width="30.000000" height="30.000000" fill="#FFFFFF" fill-opacity="0"></rect><g clip-path="url(#clip1381_20236)"><rect id="rect" x="11.572754" y="17.683594" rx="1.000947" width="5.995172" height="2.001895" transform="rotate(-42.841 11.572754 17.683594)" fill="currentColor" fill-opacity="1.000000"></rect><rect id="rect" x="16.033691" y="16.271484" rx="0.995190" width="6.002943" height="1.990380" transform="rotate(-139.147 16.033691 16.271484)" fill="currentColor" fill-opacity="1.000000"></rect><path id="path" d="M20.09 25.48L9.89 25.5C9.47 25.5 9.05 25.45 8.64 25.37C8.23 25.29 7.83 25.17 7.44 25C7.05 24.84 6.68 24.64 6.33 24.41C5.98 24.18 5.66 23.91 5.36 23.61C5.07 23.31 4.8 22.99 4.57 22.64C4.34 22.29 4.14 21.92 3.98 21.53C3.82 21.14 3.69 20.74 3.61 20.32C3.53 19.91 3.49 19.49 3.49 19.07L3.49 10.92C3.49 10.5 3.53 10.08 3.61 9.67C3.69 9.25 3.82 8.85 3.98 8.46C4.14 8.07 4.34 7.7 4.57 7.35C4.8 7 5.07 6.68 5.36 6.38C5.66 6.08 5.98 5.81 6.33 5.58C6.68 5.35 7.05 5.15 7.44 4.99C7.83 4.82 8.23 4.7 8.64 4.62C9.05 4.54 9.47 4.5 9.89 4.5L20.09 4.48C20.51 4.48 20.93 4.52 21.34 4.6C21.75 4.69 22.15 4.81 22.54 4.97C22.93 5.13 23.3 5.33 23.65 5.57C24 5.8 24.32 6.06 24.62 6.36C24.92 6.66 25.18 6.98 25.41 7.33C25.65 7.69 25.84 8.06 26.01 8.45C26.17 8.84 26.29 9.24 26.37 9.65C26.45 10.06 26.49 10.48 26.5 10.91L26.5 19.06C26.49 19.48 26.45 19.89 26.37 20.31C26.29 20.72 26.17 21.12 26.01 21.51C25.84 21.9 25.65 22.27 25.41 22.62C25.18 22.97 24.92 23.3 24.62 23.6C24.32 23.89 24 24.16 23.65 24.39C23.3 24.63 22.93 24.83 22.54 24.99C22.15 25.15 21.75 25.27 21.34 25.35C20.93 25.44 20.51 25.48 20.09 25.48ZM9.89 6.59C9.61 6.59 9.32 6.62 9.05 6.67C8.77 6.73 8.5 6.81 8.24 6.92C7.98 7.03 7.73 7.16 7.49 7.32C7.26 7.48 7.04 7.66 6.84 7.86C6.64 8.06 6.46 8.28 6.3 8.51C6.14 8.75 6.01 9 5.9 9.26C5.79 9.52 5.71 9.8 5.66 10.07C5.6 10.35 5.57 10.63 5.57 10.92L5.57 19.07C5.57 19.36 5.6 19.64 5.66 19.92C5.71 20.19 5.79 20.47 5.9 20.73C6.01 20.99 6.14 21.24 6.3 21.48C6.46 21.71 6.64 21.93 6.84 22.13C7.04 22.33 7.26 22.51 7.49 22.67C7.73 22.83 7.98 22.96 8.24 23.07C8.5 23.18 8.77 23.26 9.05 23.32C9.32 23.37 9.61 23.4 9.89 23.4L20.09 23.39C20.38 23.39 20.66 23.36 20.94 23.3C21.21 23.25 21.48 23.17 21.75 23.06C22.01 22.95 22.26 22.81 22.49 22.66C22.73 22.5 22.95 22.32 23.15 22.12C23.35 21.91 23.52 21.7 23.68 21.46C23.84 21.22 23.97 20.98 24.08 20.71C24.19 20.45 24.27 20.18 24.33 19.9C24.38 19.62 24.41 19.34 24.41 19.06L24.41 10.91C24.41 10.62 24.38 10.34 24.33 10.06C24.27 9.78 24.19 9.51 24.08 9.25C23.97 8.98 23.84 8.74 23.68 8.5C23.52 8.26 23.35 8.04 23.15 7.84C22.95 7.64 22.73 7.46 22.49 7.3C22.26 7.15 22.01 7.01 21.75 6.9C21.48 6.79 21.21 6.71 20.94 6.66C20.66 6.6 20.38 6.57 20.09 6.57L9.89 6.59Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path><path id="rect" d="M8.49 5.5L10.53 5.5L10.59 24.41L8.54 24.41L8.49 5.5Z" fill="currentColor" fill-opacity="1.000000" fill-rule="evenodd"></path></g></svg></div></div><div style="margin-top: 38px; display: flex;"><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #ABB2BD; --ds-icon-button-size: 28px;"><svg viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><clippath id="clip1325_20400"><rect id="新建会话0730" width="30.000000" height="30.000000" fill="white" fill-opacity="0"></rect></clippath></defs><g clip-path="url(#clip1325_20400)"><path id="path" d="M10.51 26.52C10.35 26.52 10.19 26.49 10.04 26.43C9.89 26.37 9.76 26.28 9.64 26.17C9.53 26.06 9.44 25.93 9.37 25.78C9.31 25.63 9.28 25.48 9.28 25.32L9.25 22.87C8.89 22.82 8.53 22.74 8.19 22.62C7.84 22.5 7.51 22.36 7.19 22.19C6.86 22.01 6.56 21.81 6.28 21.58C5.99 21.36 5.73 21.11 5.49 20.83C5.25 20.56 5.04 20.27 4.85 19.96C4.67 19.65 4.51 19.33 4.38 18.99C4.25 18.65 4.16 18.3 4.09 17.95C4.03 17.6 4 17.24 4 16.88L4 10.38C4 9.99 4.03 9.6 4.11 9.21C4.19 8.82 4.31 8.45 4.46 8.08C4.61 7.72 4.8 7.37 5.03 7.04C5.25 6.72 5.5 6.41 5.78 6.13C6.07 5.86 6.38 5.61 6.71 5.39C7.04 5.17 7.4 4.98 7.77 4.83C8.14 4.68 8.52 4.57 8.91 4.49C9.31 4.41 9.7 4.38 10.11 4.38L14.35 4.38C14.5 4.38 14.63 4.4 14.77 4.46C14.9 4.51 15.02 4.59 15.12 4.69C15.22 4.79 15.3 4.9 15.35 5.03C15.41 5.16 15.43 5.3 15.43 5.44C15.43 5.58 15.41 5.71 15.35 5.84C15.3 5.97 15.22 6.09 15.12 6.19C15.02 6.29 14.9 6.37 14.77 6.42C14.63 6.47 14.5 6.5 14.35 6.5L10.11 6.5C9.85 6.5 9.59 6.53 9.34 6.58C9.08 6.62 8.83 6.7 8.6 6.8C8.36 6.89 8.13 7.01 7.91 7.15C7.7 7.3 7.5 7.46 7.31 7.64C7.13 7.82 6.97 8.01 6.82 8.22C6.68 8.44 6.56 8.66 6.46 8.9C6.36 9.13 6.28 9.37 6.23 9.62C6.18 9.87 6.16 10.12 6.16 10.38L6.16 16.88C6.16 17.14 6.18 17.39 6.23 17.65C6.29 17.9 6.36 18.15 6.46 18.39C6.56 18.62 6.69 18.85 6.83 19.07C6.98 19.28 7.15 19.48 7.33 19.66C7.52 19.85 7.72 20.01 7.94 20.15C8.16 20.3 8.39 20.42 8.63 20.52C8.87 20.62 9.13 20.69 9.38 20.74C9.64 20.79 9.9 20.82 10.17 20.82C10.33 20.82 10.49 20.85 10.64 20.91C10.79 20.97 10.92 21.06 11.04 21.17C11.15 21.28 11.24 21.41 11.31 21.56C11.37 21.71 11.4 21.86 11.41 22.02L11.42 23.53L14.15 21.56C14.85 21.07 15.62 20.82 16.48 20.82L19.87 20.82C20.13 20.82 20.38 20.79 20.64 20.74C20.89 20.69 21.14 20.62 21.38 20.52C21.62 20.42 21.85 20.3 22.06 20.16C22.28 20.02 22.48 19.86 22.66 19.68C22.84 19.5 23.01 19.3 23.15 19.09C23.29 18.88 23.42 18.66 23.52 18.42C23.61 18.19 23.69 17.94 23.74 17.69C23.79 17.44 23.82 17.19 23.82 16.94L23.82 13.58C23.82 13.44 23.84 13.3 23.9 13.17C23.95 13.04 24.03 12.93 24.13 12.83C24.23 12.73 24.35 12.65 24.48 12.6C24.62 12.54 24.75 12.52 24.9 12.52C25.04 12.52 25.18 12.54 25.31 12.6C25.44 12.65 25.56 12.73 25.66 12.83C25.76 12.93 25.84 13.04 25.9 13.17C25.95 13.3 25.98 13.44 25.98 13.58L25.98 16.94C25.98 17.33 25.94 17.72 25.86 18.11C25.78 18.5 25.67 18.87 25.51 19.24C25.36 19.6 25.17 19.95 24.95 20.27C24.73 20.6 24.47 20.9 24.19 21.18C23.9 21.46 23.6 21.71 23.26 21.93C22.93 22.15 22.58 22.33 22.21 22.48C21.83 22.63 21.45 22.75 21.06 22.83C20.67 22.9 20.27 22.94 19.87 22.94L17.19 22.94C16.33 22.94 15.56 23.19 14.86 23.69L11.24 26.29C11.02 26.44 10.78 26.52 10.51 26.52Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path><rect id="rect" x="17.770508" y="6.396484" rx="1.062250" width="8.060087" height="2.124500" fill="currentColor" fill-opacity="1.000000"></rect><rect id="rect" x="20.718750" y="3.500000" rx="1.081197" width="2.162393" height="7.918844" fill="currentColor" fill-opacity="1.000000"></rect></g></svg></div></div><div style="flex: 1 1 0%;"></div><div class="_41b9122"><div class="ds-icon" style="font-size: 28px; width: 28px; height: 28px;"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="300" height="300"><path d="M725.333 1024H298.667a128 128 0 0 1-128-128V128a128 128 0 0 1 128-128h426.666a128 128 0 0 1 128 128v768a128 128 0 0 1-128 128zM298.667 85.333A42.667 42.667 0 0 0 256 128v768a42.667 42.667 0 0 0 42.667 42.667h426.666A42.667 42.667 0 0 0 768 896V128a42.667 42.667 0 0 0-42.667-42.667z" fill="currentColor"></path><path d="M469.33299999999997 853.333a42.667 42.667 0 1 0 85.334 0 42.667 42.667 0 1 0-85.334 0zM554.667 213.333h-85.334a42.667 42.667 0 0 1 0-85.333h85.334a42.667 42.667 0 0 1 0 85.333z" fill="currentColor"></path></svg></div></div><div class="ede5bc47"><div class="ds-icon _725f8ba" style="font-size: 32px; width: 32px; height: 32px;"><svg width="34" height="35" viewBox="0 0 34 35" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M17 34.895c9.298 0 17-7.686 17-17 0-9.299-7.702-17-17.017-17C7.685.895 0 8.596 0 17.895c0 9.314 7.702 17 17 17zm0-14.302c-3.226-.016-5.727-2.715-5.727-6.27-.016-3.357 2.518-6.155 5.727-6.155 3.193 0 5.71 2.798 5.71 6.155 0 3.555-2.5 6.303-5.71 6.27zm0 11.52c-3.686 0-7.603-1.53-10.088-4.213 1.876-2.83 5.645-4.46 10.088-4.46 4.394 0 8.18 1.597 10.072 4.46-2.485 2.683-6.386 4.213-10.072 4.213z" fill="currentColor"></path></svg></div></div></div><div class="b8812f16 a2f3d50e _70b689f"><div class="_6969ec9"><div class="a5967822"></div><div class="e066abb8"><svg viewBox="-2 0 175 32" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs></defs><path id="path" d="M75.32 25.23L72.83 25.23L72.83 21.37L75.32 21.37C76.86 21.37 78.42 20.99 79.43 19.92C80.44 18.85 80.81 17.2 80.81 15.57C80.81 13.94 80.44 12.3 79.43 11.23C78.42 10.16 76.86 9.78 75.32 9.78C73.77 9.78 72.22 10.16 71.21 11.23C70.19 12.3 69.83 13.94 69.83 15.57L69.83 31.44L65.46 31.44L65.46 5.92L69.83 5.92L69.83 7.54L70.63 7.54C70.71 7.45 70.8 7.36 70.9 7.27C71.99 6.27 73.66 5.92 75.32 5.92C77.89 5.92 80.48 6.56 82.17 8.34C83.85 10.12 84.46 12.86 84.46 15.58C84.46 18.29 83.85 21.03 82.17 22.81C80.48 24.6 77.89 25.23 75.32 25.23Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path><path id="path" d="M8.79 6.59L11.28 6.59L11.28 10.45L8.79 10.45C7.25 10.45 5.69 10.83 4.68 11.91C3.67 12.98 3.3 14.62 3.3 16.25C3.3 17.88 3.67 19.52 4.68 20.59C5.69 21.66 7.25 22.05 8.79 22.05C10.34 22.05 11.89 21.66 12.9 20.59C13.92 19.52 14.28 17.88 14.28 16.25L14.28 0.39L18.65 0.39L18.65 25.91L14.28 25.91L14.28 24.28L13.48 24.28C13.4 24.38 13.31 24.47 13.21 24.55C12.12 25.55 10.45 25.91 8.79 25.91C6.22 25.91 3.63 25.27 1.94 23.48C0.26 21.7 -0.35 18.97 -0.35 16.25C-0.35 13.53 0.26 10.8 1.94 9.01C3.63 7.23 6.22 6.59 8.79 6.59Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path><path id="path" d="M40.59 15.91L40.59 17.46L28.95 17.46L28.95 14.36L36.67 14.36C36.49 13.23 36.08 12.18 35.36 11.42C34.3 10.31 32.69 9.91 31.08 9.91C29.48 9.91 27.86 10.31 26.81 11.42C25.76 12.52 25.38 14.22 25.38 15.91C25.38 17.6 25.76 19.3 26.81 20.41C27.86 21.52 29.48 21.91 31.08 21.91C32.69 21.91 34.3 21.52 35.36 20.41C35.5 20.25 35.64 20.08 35.76 19.9L40.08 19.9C39.71 21.24 39.1 22.45 38.2 23.4C36.44 25.25 33.75 25.91 31.08 25.91C28.41 25.91 25.72 25.25 23.97 23.4C22.21 21.55 21.58 18.72 21.58 15.91C21.58 13.1 22.21 10.27 23.97 8.42C25.72 6.58 28.41 5.92 31.08 5.92C33.75 5.92 36.44 6.58 38.2 8.42C39.96 10.27 40.59 13.1 40.59 15.91Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path><path id="path" d="M62.52 15.91L62.52 17.46L50.88 17.46L50.88 14.36L58.61 14.36C58.43 13.23 58.02 12.18 57.29 11.42C56.24 10.31 54.63 9.91 53.02 9.91C51.42 9.91 49.8 10.31 48.75 11.42C47.7 12.52 47.32 14.22 47.32 15.91C47.32 17.6 47.7 19.3 48.75 20.41C49.8 21.52 51.42 21.91 53.02 21.91C54.63 21.91 56.24 21.52 57.29 20.41C57.44 20.25 57.58 20.08 57.7 19.9L62.02 19.9C61.64 21.24 61.04 22.45 60.14 23.4C58.38 25.25 55.69 25.91 53.02 25.91C50.35 25.91 47.66 25.25 45.9 23.4C44.15 21.55 43.52 18.72 43.52 15.91C43.52 13.1 44.15 10.27 45.9 8.42C47.66 6.58 50.35 5.92 53.02 5.92C55.69 5.92 58.38 6.58 60.14 8.42C61.89 10.27 62.52 13.1 62.52 15.91Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path><path id="path" d="M96.9 25.91C99.57 25.91 102.26 25.52 104.01 24.43C105.77 23.34 106.4 21.67 106.4 20.01C106.4 18.35 105.77 16.68 104.01 15.59C102.26 14.5 99.57 14.11 96.9 14.11L96.99 14.11C95.85 14.11 94.7 13.96 93.96 13.53C93.21 13.11 92.94 12.46 92.94 11.82C92.94 11.17 93.21 10.53 93.96 10.1C94.7 9.68 95.85 9.53 96.99 9.53C98.13 9.53 99.28 9.68 100.03 10.1C100.78 10.53 101.04 11.17 101.04 11.82L105.49 11.82C105.49 10.16 104.92 8.49 103.34 7.4C101.75 6.31 99.32 5.92 96.9 5.92C94.48 5.92 92.05 6.31 90.46 7.4C88.87 8.49 88.3 10.16 88.3 11.82C88.3 13.48 88.87 15.15 90.46 16.24C92.05 17.33 94.48 17.72 96.9 17.72C98.16 17.72 99.53 17.87 100.36 18.29C101.19 18.71 101.48 19.36 101.48 20.01C101.48 20.65 101.19 21.3 100.36 21.72C99.53 22.14 98.26 22.3 97 22.3C95.74 22.3 94.47 22.14 93.65 21.72C92.82 21.3 92.52 20.65 92.52 20.01L87.4 20.01C87.4 21.67 88.03 23.34 89.78 24.43C91.54 25.52 94.22 25.91 96.9 25.91Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path><path id="path" d="M128.33 15.91L128.33 17.46L116.69 17.46L116.69 14.36L124.42 14.36C124.24 13.23 123.83 12.18 123.1 11.42C122.05 10.31 120.44 9.91 118.83 9.91C117.23 9.91 115.61 10.31 114.56 11.42C113.51 12.52 113.13 14.22 113.13 15.91C113.13 17.6 113.51 19.3 114.56 20.41C115.61 21.52 117.23 21.91 118.83 21.91C120.44 21.91 122.05 21.52 123.1 20.41C123.25 20.25 123.39 20.08 123.51 19.9L127.83 19.9C127.45 21.24 126.85 22.45 125.95 23.4C124.19 25.25 121.5 25.91 118.83 25.91C116.16 25.91 113.47 25.25 111.71 23.4C109.96 21.55 109.33 18.72 109.33 15.91C109.33 13.1 109.96 10.27 111.71 8.42C113.47 6.58 116.16 5.92 118.83 5.92C121.5 5.92 124.19 6.58 125.95 8.42C127.7 10.27 128.33 13.1 128.33 15.91Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path><path id="path" d="M150.27 15.91L150.27 17.46L138.63 17.46L138.63 14.36L146.36 14.36C146.17 13.23 145.77 12.18 145.04 11.42C143.99 10.31 142.37 9.91 140.77 9.91C139.17 9.91 137.55 10.31 136.5 11.42C135.44 12.52 135.07 14.22 135.07 15.91C135.07 17.6 135.44 19.3 136.5 20.41C137.55 21.52 139.17 21.91 140.77 21.91C142.37 21.91 143.99 21.52 145.04 20.41C145.19 20.25 145.32 20.08 145.45 19.9L149.77 19.9C149.39 21.24 148.79 22.45 147.88 23.4C146.13 25.25 143.44 25.91 140.77 25.91C138.1 25.91 135.4 25.25 133.65 23.4C131.9 21.55 131.27 18.72 131.27 15.91C131.27 13.1 131.9 10.27 133.65 8.42C135.4 6.58 138.1 5.92 140.77 5.92C143.44 5.92 146.13 6.58 147.88 8.42C149.64 10.27 150.27 13.1 150.27 15.91Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path><rect id="rect" x="153.211426" y="-0.499512" width="4.371000" height="26.415646" fill="currentColor" fill-opacity="1.000000"></rect><path id="polygon" d="M165.04 15.31L172.21 25.91L166.79 25.91L159.62 15.31L166.79 6.81L172.21 6.81L165.04 15.31Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path></svg></div><div class="ds-icon _8a9564e" style="font-size: 24px; width: 24px; height: 24px;"><svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.27777 24.2888L23.7222 24.2888C24.4279 24.2888 25 23.7167 25 23.0111C25 22.3054 24.4279 21.7333 23.7222 21.7333L4.27777 21.7333C3.57208 21.7333 3 22.3054 3 23.0111C3 23.7167 3.57208 24.2888 4.27777 24.2888Z" fill="currentColor"></path><path d="M13.2407 15.4001L23.7222 15.4001C24.4279 15.4001 25 14.8281 25 14.1224C25 13.4167 24.4279 12.8446 23.7222 12.8446L13.2407 12.8446C12.535 12.8446 11.963 13.4167 11.963 14.1224C11.963 14.8281 12.535 15.4001 13.2407 15.4001Z" fill="currentColor"></path><path d="M4.27777 6.55542L23.7222 6.55542C24.4279 6.55542 25 5.98334 25 5.27765C25 4.57197 24.4279 3.99989 23.7222 3.99989L4.27777 3.99989C3.57208 3.99989 3 4.57197 3 5.27765C3 5.98334 3.57208 6.55542 4.27777 6.55542Z" fill="currentColor"></path></svg></div></div><div class="ebaea5d2"><div class="_5a8ac7a"><div class="c7dddcde"><div class="_1c42ad7"><svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.10999 27C8.92999 27 8.76001 26.96 8.60001 26.9C8.43001 26.83 8.29 26.74 8.16 26.61C8.03 26.49 7.94 26.3499 7.87 26.1899C7.79999 26.0299 7.76001 25.8599 7.76001 25.6899L7.73001 23.04C7.34001 22.98 6.95001 22.8799 6.57001 22.7599C6.19001 22.6299 5.83001 22.48 5.48001 22.29C5.13001 22.1 4.79999 21.88 4.48999 21.63C4.17999 21.39 3.89 21.1199 3.63 20.82C3.37 20.52 3.13999 20.21 2.92999 19.87C2.72999 19.53 2.56001 19.18 2.42001 18.82C2.28001 18.45 2.17001 18.07 2.10001 17.69C2.03001 17.3 2 16.92 2 16.53V9.46995C2 9.03995 2.04 8.61995 2.12 8.19995C2.21 7.77995 2.34 7.36995 2.5 6.96995C2.67 6.57995 2.88 6.19995 3.12 5.84995C3.36 5.48995 3.64001 5.15995 3.95001 4.85995C4.26001 4.55995 4.59999 4.28995 4.95999 4.04995C5.32999 3.80995 5.70999 3.60995 6.10999 3.44995C6.51999 3.27995 6.94 3.15995 7.37 3.07995C7.79999 2.98995 8.23001 2.94995 8.67001 2.94995H13.3C13.46 2.94995 13.61 2.97995 13.76 3.03995C13.9 3.09995 14.03 3.17995 14.14 3.28995C14.25 3.39995 14.33 3.51995 14.39 3.65995C14.45 3.79995 14.48 3.94995 14.48 4.09995C14.48 4.25995 14.45 4.39995 14.39 4.54995C14.33 4.68995 14.25 4.80995 14.14 4.91995C14.03 5.02995 13.9 5.10995 13.76 5.16995C13.61 5.22995 13.46 5.25995 13.3 5.25995H8.67001C8.38001 5.25995 8.09999 5.27995 7.82999 5.33995C7.54999 5.38995 7.27999 5.46995 7.01999 5.57995C6.75999 5.67995 6.50999 5.80995 6.26999 5.96995C6.03999 6.11995 5.82 6.29995 5.62 6.48995C5.42 6.68995 5.23999 6.89995 5.07999 7.12995C4.92999 7.35995 4.78999 7.59995 4.67999 7.85995C4.57999 8.10995 4.49 8.37995 4.44 8.64995C4.38 8.91995 4.35999 9.18995 4.35999 9.46995V16.53C4.35999 16.81 4.38 17.08 4.44 17.36C4.5 17.63 4.58 17.9 4.69 18.16C4.8 18.42 4.93 18.67 5.09 18.9C5.25 19.13 5.43001 19.3499 5.64001 19.5499C5.84001 19.75 6.05999 19.92 6.29999 20.08C6.53999 20.24 6.79 20.37 7.06 20.47C7.32 20.58 7.6 20.66 7.88 20.72C8.16001 20.77 8.44001 20.7999 8.73001 20.7999C8.91001 20.7999 9.08 20.83 9.25 20.9C9.41 20.97 9.55999 21.0599 9.67999 21.18C9.80999 21.3099 9.91001 21.45 9.98001 21.61C10.05 21.77 10.08 21.94 10.09 22.11L10.1 23.74L13.08 21.61C13.84 21.07 14.69 20.7999 15.63 20.7999H19.32C19.61 20.7999 19.89 20.77 20.16 20.72C20.44 20.67 20.71 20.59 20.97 20.4799C21.23 20.3699 21.48 20.24 21.72 20.09C21.95 19.94 22.17 19.76 22.37 19.57C22.57 19.3699 22.75 19.16 22.91 18.93C23.07 18.7 23.2 18.46 23.31 18.2C23.41 17.95 23.5 17.68 23.55 17.41C23.61 17.14 23.63 16.87 23.63 16.59V12.94C23.63 12.79 23.66 12.64 23.72 12.5C23.78 12.36 23.87 12.23 23.98 12.13C24.09 12.02 24.22 11.93 24.36 11.88C24.51 11.82 24.66 11.79 24.82 11.79C24.97 11.79 25.12 11.82 25.27 11.88C25.41 11.93 25.54 12.02 25.65 12.13C25.76 12.23 25.85 12.36 25.91 12.5C25.97 12.64 26 12.79 26 12.94V16.59C26 17.02 25.95 17.44 25.87 17.86C25.78 18.28 25.66 18.69 25.49 19.08C25.32 19.48 25.11 19.8499 24.87 20.2099C24.63 20.57 24.35 20.9 24.04 21.2C23.73 21.5 23.39 21.7699 23.03 22.0099C22.67 22.2499 22.28 22.45 21.88 22.61C21.47 22.77 21.06 22.9 20.63 22.9799C20.2 23.07 19.76 23.11 19.32 23.11H16.4C15.47 23.11 14.62 23.3799 13.86 23.9199L9.91 26.74C9.67 26.91 9.39999 27 9.10999 27Z" fill="currentColor"></path><path d="M24.6805 5.14453H18.1874C17.5505 5.14453 17.0342 5.66086 17.0342 6.29778C17.0342 6.9347 17.5505 7.45102 18.1874 7.45102H24.6805C25.3175 7.45102 25.8338 6.9347 25.8338 6.29778C25.8338 5.66086 25.3175 5.14453 24.6805 5.14453Z" fill="currentColor"></path><path d="M22.6137 3.1804C22.6137 2.52848 22.0852 2 21.4333 2C20.7814 2 20.2529 2.52848 20.2529 3.1804V9.4168C20.2529 10.0687 20.7814 10.5972 21.4333 10.5972C22.0852 10.5972 22.6137 10.0687 22.6137 9.4168V3.1804Z" fill="currentColor"></path></svg></div>开启新对话</div></div></div><div class="_03210fb scrollable"><div class="_77cdc67 _8a693f3"><div class="_5d4b535"><div class="_48cdfc1">今天</div><div class="_83421f9" tabindex="0"><div class="c08e6e93">游戏战斗逻辑修复与领土控制</div><div class="_2090548" tabindex="0"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a2 2 0 1 1 4 0 2 2 0 0 1-4 0m7 0a2 2 0 1 1 4 0 2 2 0 0 1-4 0m7 0a2 2 0 1 1 4 0 2 2 0 0 1-4 0" clip-rule="evenodd"></path></svg></div></div><div class="_2f87737"></div><div class="eaaaba55"></div></div><div class="b9cb4a74"></div></div><div class="_5d4b535"><div class="_48cdfc1">7 天内</div><div class="_83421f9" tabindex="0"><div class="c08e6e93">粤语备胎歌曲情感共鸣解析</div><div class="_2090548" tabindex="0"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a2 2 0 1 1 4 0 2 2 0 0 1-4 0m7 0a2 2 0 1 1 4 0 2 2 0 0 1-4 0m7 0a2 2 0 1 1 4 0 2 2 0 0 1-4 0" clip-rule="evenodd"></path></svg></div></div><div class="_2f87737"></div><div class="eaaaba55"></div></div><div class="_83421f9 b64fb9ae" tabindex="0"><div class="c08e6e93">Python编写战略游戏教程</div><div class="_2090548" tabindex="0"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a2 2 0 1 1 4 0 2 2 0 0 1-4 0m7 0a2 2 0 1 1 4 0 2 2 0 0 1-4 0m7 0a2 2 0 1 1 4 0 2 2 0 0 1-4 0" clip-rule="evenodd"></path></svg></div></div><div class="_2f87737"></div><div class="eaaaba55"></div></div><div class="b9cb4a74"></div></div><div class="_5d4b535"><div class="_48cdfc1">30 天内</div><div class="_83421f9" tabindex="0"><div class="c08e6e93">杰作价值需主体认知准备</div><div class="_2090548" tabindex="0"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a2 2 0 1 1 4 0 2 2 0 0 1-4 0m7 0a2 2 0 1 1 4 0 2 2 0 0 1-4 0m7 0a2 2 0 1 1 4 0 2 2 0 0 1-4 0" clip-rule="evenodd"></path></svg></div></div><div class="_2f87737"></div><div class="eaaaba55"></div></div><div class="_83421f9" tabindex="0"><div class="c08e6e93">美国暑假工薪资及地区差异分析</div><div class="_2090548" tabindex="0"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a2 2 0 1 1 4 0 2 2 0 0 1-4 0m7 0a2 2 0 1 1 4 0 2 2 0 0 1-4 0m7 0a2 2 0 1 1 4 0 2 2 0 0 1-4 0" clip-rule="evenodd"></path></svg></div></div><div class="_2f87737"></div><div class="eaaaba55"></div></div><div class="b9cb4a74"></div></div><div class="_5d4b535"><div class="_48cdfc1">2025-05</div><div class="_83421f9" tabindex="0"><div class="c08e6e93">如何在开关上制作一个电源指示器</div><div class="_2090548" tabindex="0"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a2 2 0 1 1 4 0 2 2 0 0 1-4 0m7 0a2 2 0 1 1 4 0 2 2 0 0 1-4 0m7 0a2 2 0 1 1 4 0 2 2 0 0 1-4 0" clip-rule="evenodd"></path></svg></div></div><div class="_2f87737"></div><div class="eaaaba55"></div></div><div class="_83421f9" tabindex="0"><div class="c08e6e93">女T含义及文化背景解析</div><div class="_2090548" tabindex="0"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a2 2 0 1 1 4 0 2 2 0 0 1-4 0m7 0a2 2 0 1 1 4 0 2 2 0 0 1-4 0m7 0a2 2 0 1 1 4 0 2 2 0 0 1-4 0" clip-rule="evenodd"></path></svg></div></div><div class="_2f87737"></div><div class="eaaaba55"></div></div><div class="b9cb4a74"></div></div></div></div><div class="c7f51894"><div class="a1e75851"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px; margin-right: 8px;"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="300" height="300"><path d="M725.333 1024H298.667a128 128 0 0 1-128-128V128a128 128 0 0 1 128-128h426.666a128 128 0 0 1 128 128v768a128 128 0 0 1-128 128zM298.667 85.333A42.667 42.667 0 0 0 256 128v768a42.667 42.667 0 0 0 42.667 42.667h426.666A42.667 42.667 0 0 0 768 896V128a42.667 42.667 0 0 0-42.667-42.667z" fill="currentColor"></path><path d="M469.33299999999997 853.333a42.667 42.667 0 1 0 85.334 0 42.667 42.667 0 1 0-85.334 0zM554.667 213.333h-85.334a42.667 42.667 0 0 1 0-85.333h85.334a42.667 42.667 0 0 1 0 85.333z" fill="currentColor"></path></svg></div>下载 App<span class="_106b9f9"><svg width="36" height="16" viewBox="0 0 36 16" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="36" height="16" rx="8" fill="url(#paint0_linear_5707_2640)" fill-opacity=".85"></rect><path d="M7.113 4.86h1.1l3.65 5.31h.04V4.86h1.09V12h-1.06l-3.69-5.37h-.04V12h-1.09V4.86zm7.285 0h5.13v.93h-4.04v2.08h3.8v.93h-3.8v2.27h4.21V12h-5.3V4.86zm5.756 0h1.23l1.39 5.56h.04l1.46-5.56h1.14l1.46 5.56h.04l1.39-5.56h1.23L27.475 12h-1.16l-1.45-5.51h-.04L23.375 12h-1.17l-2.05-7.14z" fill="#fff"></path><defs><lineargradient id="paint0_linear_5707_2640" y1="8" x2="36" y2="8" gradientUnits="userSpaceOnUse"><stop stop-color="#4D6BFE"></stop><stop offset="1" stop-color="#6948D6"></stop></lineargradient></defs></svg></span></div><div class="c6ab9234"><div class="ede5bc47"><div class="ds-icon _725f8ba" style="font-size: 32px; width: 32px; height: 32px;"><svg width="34" height="35" viewBox="0 0 34 35" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M17 34.895c9.298 0 17-7.686 17-17 0-9.299-7.702-17-17.017-17C7.685.895 0 8.596 0 17.895c0 9.314 7.702 17 17 17zm0-14.302c-3.226-.016-5.727-2.715-5.727-6.27-.016-3.357 2.518-6.155 5.727-6.155 3.193 0 5.71 2.798 5.71 6.155 0 3.555-2.5 6.303-5.71 6.27zm0 11.52c-3.686 0-7.603-1.53-10.088-4.213 1.876-2.83 5.645-4.46 10.088-4.46 4.394 0 8.18 1.597 10.072 4.46-2.485 2.683-6.386 4.213-10.072 4.213z" fill="currentColor"></path></svg></div></div><div class="_7d65532">个人信息</div></div></div></div></div><div class="_4cbcd96 _7d10bb1"></div><div class="_7780f2e"><div class="_765a5cd"><div class="_2be88ba"><div class="f8d1e4c0"><div style="flex: 1 1 0%; min-width: 0px; display: flex; place-content: center; z-index: 12;"><div class="d8ed659a" tabindex="0" style="outline: none;">Python编写战略游戏教程</div></div><div class="_62b4800"></div></div><div class="_0efe408"><div class="ds-icon d7829b2f _2e7d873" style="font-size: 24px; width: 24px; height: 24px; color: rgb(205, 212, 223);"><svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M23.7222 4H4.27776C3.57207 4 3 4.57207 3 5.27776C3 5.98345 3.57207 6.55553 4.27776 6.55553H23.7222C24.4279 6.55553 25 5.98345 25 5.27776C25 4.57207 24.4279 4 23.7222 4Z" fill="currentColor"></path><path d="M14.7593 12.8887H4.27776C3.57207 12.8887 3 13.4607 3 14.1664C3 14.8721 3.57207 15.4442 4.27776 15.4442H14.7593C15.465 15.4442 16.037 14.8721 16.037 14.1664C16.037 13.4607 15.465 12.8887 14.7593 12.8887Z" fill="currentColor"></path><path d="M23.7222 21.7334H4.27776C3.57207 21.7334 3 22.3055 3 23.0112C3 23.7169 3.57207 24.2889 4.27776 24.2889H23.7222C24.4279 24.2889 25 23.7169 25 23.0112C25 22.3055 24.4279 21.7334 23.7222 21.7334Z" fill="currentColor"></path></svg></div><div class="ds-icon d7829b2f _23ecf90" style="font-size: 24px; width: 24px; height: 24px; color: rgb(205, 212, 223);"><svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.10999 27C8.92999 27 8.76001 26.96 8.60001 26.9C8.43001 26.83 8.29 26.74 8.16 26.61C8.03 26.49 7.94 26.3499 7.87 26.1899C7.79999 26.0299 7.76001 25.8599 7.76001 25.6899L7.73001 23.04C7.34001 22.98 6.95001 22.8799 6.57001 22.7599C6.19001 22.6299 5.83001 22.48 5.48001 22.29C5.13001 22.1 4.79999 21.88 4.48999 21.63C4.17999 21.39 3.89 21.1199 3.63 20.82C3.37 20.52 3.13999 20.21 2.92999 19.87C2.72999 19.53 2.56001 19.18 2.42001 18.82C2.28001 18.45 2.17001 18.07 2.10001 17.69C2.03001 17.3 2 16.92 2 16.53V9.46995C2 9.03995 2.04 8.61995 2.12 8.19995C2.21 7.77995 2.34 7.36995 2.5 6.96995C2.67 6.57995 2.88 6.19995 3.12 5.84995C3.36 5.48995 3.64001 5.15995 3.95001 4.85995C4.26001 4.55995 4.59999 4.28995 4.95999 4.04995C5.32999 3.80995 5.70999 3.60995 6.10999 3.44995C6.51999 3.27995 6.94 3.15995 7.37 3.07995C7.79999 2.98995 8.23001 2.94995 8.67001 2.94995H13.3C13.46 2.94995 13.61 2.97995 13.76 3.03995C13.9 3.09995 14.03 3.17995 14.14 3.28995C14.25 3.39995 14.33 3.51995 14.39 3.65995C14.45 3.79995 14.48 3.94995 14.48 4.09995C14.48 4.25995 14.45 4.39995 14.39 4.54995C14.33 4.68995 14.25 4.80995 14.14 4.91995C14.03 5.02995 13.9 5.10995 13.76 5.16995C13.61 5.22995 13.46 5.25995 13.3 5.25995H8.67001C8.38001 5.25995 8.09999 5.27995 7.82999 5.33995C7.54999 5.38995 7.27999 5.46995 7.01999 5.57995C6.75999 5.67995 6.50999 5.80995 6.26999 5.96995C6.03999 6.11995 5.82 6.29995 5.62 6.48995C5.42 6.68995 5.23999 6.89995 5.07999 7.12995C4.92999 7.35995 4.78999 7.59995 4.67999 7.85995C4.57999 8.10995 4.49 8.37995 4.44 8.64995C4.38 8.91995 4.35999 9.18995 4.35999 9.46995V16.53C4.35999 16.81 4.38 17.08 4.44 17.36C4.5 17.63 4.58 17.9 4.69 18.16C4.8 18.42 4.93 18.67 5.09 18.9C5.25 19.13 5.43001 19.3499 5.64001 19.5499C5.84001 19.75 6.05999 19.92 6.29999 20.08C6.53999 20.24 6.79 20.37 7.06 20.47C7.32 20.58 7.6 20.66 7.88 20.72C8.16001 20.77 8.44001 20.7999 8.73001 20.7999C8.91001 20.7999 9.08 20.83 9.25 20.9C9.41 20.97 9.55999 21.0599 9.67999 21.18C9.80999 21.3099 9.91001 21.45 9.98001 21.61C10.05 21.77 10.08 21.94 10.09 22.11L10.1 23.74L13.08 21.61C13.84 21.07 14.69 20.7999 15.63 20.7999H19.32C19.61 20.7999 19.89 20.77 20.16 20.72C20.44 20.67 20.71 20.59 20.97 20.4799C21.23 20.3699 21.48 20.24 21.72 20.09C21.95 19.94 22.17 19.76 22.37 19.57C22.57 19.3699 22.75 19.16 22.91 18.93C23.07 18.7 23.2 18.46 23.31 18.2C23.41 17.95 23.5 17.68 23.55 17.41C23.61 17.14 23.63 16.87 23.63 16.59V12.94C23.63 12.79 23.66 12.64 23.72 12.5C23.78 12.36 23.87 12.23 23.98 12.13C24.09 12.02 24.22 11.93 24.36 11.88C24.51 11.82 24.66 11.79 24.82 11.79C24.97 11.79 25.12 11.82 25.27 11.88C25.41 11.93 25.54 12.02 25.65 12.13C25.76 12.23 25.85 12.36 25.91 12.5C25.97 12.64 26 12.79 26 12.94V16.59C26 17.02 25.95 17.44 25.87 17.86C25.78 18.28 25.66 18.69 25.49 19.08C25.32 19.48 25.11 19.8499 24.87 20.2099C24.63 20.57 24.35 20.9 24.04 21.2C23.73 21.5 23.39 21.7699 23.03 22.0099C22.67 22.2499 22.28 22.45 21.88 22.61C21.47 22.77 21.06 22.9 20.63 22.9799C20.2 23.07 19.76 23.11 19.32 23.11H16.4C15.47 23.11 14.62 23.3799 13.86 23.9199L9.91 26.74C9.67 26.91 9.39999 27 9.10999 27Z" fill="currentColor"></path><path d="M24.6805 5.14453H18.1874C17.5505 5.14453 17.0342 5.66086 17.0342 6.29778C17.0342 6.9347 17.5505 7.45102 18.1874 7.45102H24.6805C25.3175 7.45102 25.8338 6.9347 25.8338 6.29778C25.8338 5.66086 25.3175 5.14453 24.6805 5.14453Z" fill="currentColor"></path><path d="M22.6137 3.1804C22.6137 2.52848 22.0852 2 21.4333 2C20.7814 2 20.2529 2.52848 20.2529 3.1804V9.4168C20.2529 10.0687 20.7814 10.5972 21.4333 10.5972C22.0852 10.5972 22.6137 10.0687 22.6137 9.4168V3.1804Z" fill="currentColor"></path></svg></div></div></div><div class="_3919b83"><div class="_8f60047 scrollable"><div class="_0f72b0b"><div class="dad65929"><div class="_9663006"><div class="fbb737a4">帮我用python使用pygame库编写一个战略游戏，要求如下：
1.玩家控制一个属于自己的国家，而电脑控制数个国家，所有的国家之间都是敌对关系
2.战争在横纵向的网格上进行，每个国家最初只占1个方格，方格内有一组初始士兵，玩家通过鼠标选中并控制本国士兵占据周围的方格，就能归为自己的领土，每个国家领土都用不同颜色的方格显示
3.每个国家每占领3格领土，就能在自己的领土上重新生成一组士兵，不同组的士兵可以分别进行控制，且不同组士兵可以停留在同一方格上
4.若某一国家的士兵侵入已被其他任意国家标记的方格，则比较侵入的士兵组数a与该方格上的士兵组数b，计算x=a-b，若x&gt;=0则该方格被划归为入侵国领土，并具有x组入侵国士兵；若x&lt;0则该方格仍属于被入侵国领土，并具有-x组被入侵国士兵
5.电脑控制的每个国家也应具有入侵他国的能力</div><div class="e13328ad _3a26104"><div class="_425ea0b"><div class="ds-flex _78e0558" style="align-items: flex-end; gap: 0px;"><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px; margin-left: 14px; opacity: 1;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.712 2.79a1.854 1.854 0 0 1 2.623 0l1.673 1.672a1.854 1.854 0 0 1 0 2.623l-9.714 9.714a2.91 2.91 0 0 1-2.058.853H1.945a.8.8 0 0 1-.8-.8v-2.29c0-.773.307-1.513.853-2.058l9.714-9.715zm1.492 1.13c-.1-.1-.261-.1-.361 0l-1.327 1.326 2.035 2.035 1.327-1.326c.1-.1.1-.262 0-.362L13.204 3.92zm-.783 4.491l-2.035-2.034-7.258 7.257a1.31 1.31 0 0 0-.384.927v1.492h1.492c.348 0 .681-.138.927-.384l7.258-7.258z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M17.772 17.608c.35 0 .633-.283.633-.633v-.492a.633.633 0 0 0-.633-.633H9.858L8.1 17.608h9.672z" fill="currentColor"></path></svg></div></div></div></div></div></div><div class="_4f9bf79 _43c05b5"><div class="_7eb2358 _58dfa60"><svg viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path id="path" d="M27.501 8.46875C27.249 8.3457 27.1406 8.58008 26.9932 8.69922C26.9434 8.73828 26.9004 8.78906 26.8584 8.83398C26.4902 9.22852 26.0605 9.48633 25.5 9.45508C24.6787 9.41016 23.9785 9.66797 23.3594 10.2969C23.2275 9.52148 22.79 9.05859 22.125 8.76172C21.7764 8.60742 21.4238 8.45312 21.1807 8.11719C21.0098 7.87891 20.9639 7.61328 20.8779 7.35156C20.8242 7.19336 20.7695 7.03125 20.5879 7.00391C20.3906 6.97266 20.3135 7.13867 20.2363 7.27734C19.9258 7.84375 19.8066 8.46875 19.8174 9.10156C19.8447 10.5234 20.4453 11.6562 21.6367 12.4629C21.7725 12.5547 21.8076 12.6484 21.7646 12.7832C21.6836 13.0605 21.5869 13.3301 21.501 13.6074C21.4473 13.7852 21.3662 13.8242 21.1768 13.7461C20.5225 13.4727 19.957 13.0684 19.458 12.5781C18.6104 11.7578 17.8438 10.8516 16.8877 10.1426C16.6631 9.97656 16.4395 9.82227 16.207 9.67578C15.2314 8.72656 16.335 7.94727 16.5898 7.85547C16.8574 7.75977 16.6826 7.42773 15.8193 7.43164C14.957 7.43555 14.167 7.72461 13.1611 8.10938C13.0137 8.16797 12.8594 8.21094 12.7002 8.24414C11.7871 8.07227 10.8389 8.0332 9.84766 8.14453C7.98242 8.35352 6.49219 9.23633 5.39648 10.7441C4.08105 12.5547 3.77148 14.6133 4.15039 16.7617C4.54883 19.0234 5.70215 20.8984 7.47559 22.3633C9.31348 23.8809 11.4307 24.625 13.8457 24.4824C15.3125 24.3984 16.9463 24.2012 18.7881 22.6406C19.2529 22.8711 19.7402 22.9629 20.5498 23.0332C21.1729 23.0918 21.7725 23.002 22.2373 22.9062C22.9648 22.752 22.9141 22.0781 22.6514 21.9531C20.5186 20.959 20.9863 21.3633 20.5605 21.0371C21.6445 19.752 23.2783 18.418 23.917 14.0977C23.9668 13.7539 23.9238 13.5391 23.917 13.2598C23.9131 13.0918 23.9512 13.0254 24.1445 13.0059C24.6787 12.9453 25.1973 12.7988 25.6738 12.5352C27.0557 11.7793 27.6123 10.5391 27.7441 9.05078C27.7637 8.82422 27.7402 8.58789 27.501 8.46875ZM15.46 21.8613C13.3926 20.2344 12.3906 19.6992 11.9766 19.7227C11.5898 19.7441 11.6592 20.1875 11.7441 20.4766C11.833 20.7617 11.9492 20.959 12.1123 21.209C12.2246 21.375 12.3018 21.623 12 21.8066C11.334 22.2207 10.1768 21.668 10.1221 21.6406C8.77539 20.8477 7.64941 19.7988 6.85547 18.3652C6.08984 16.9844 5.64453 15.5039 5.57129 13.9238C5.55176 13.541 5.66406 13.4062 6.04297 13.3379C6.54199 13.2461 7.05762 13.2266 7.55664 13.2988C9.66602 13.6074 11.4619 14.5527 12.9668 16.0469C13.8262 16.9004 14.4766 17.918 15.1465 18.9121C15.8584 19.9688 16.625 20.9746 17.6006 21.7988C17.9443 22.0879 18.2197 22.3086 18.4824 22.4707C17.6895 22.5586 16.3652 22.5781 15.46 21.8613ZM16.4502 15.4805C16.4502 15.3105 16.5859 15.1758 16.7568 15.1758C16.7949 15.1758 16.8301 15.1836 16.8613 15.1953C16.9033 15.2109 16.9424 15.2344 16.9727 15.2695C17.0273 15.3223 17.0586 15.4004 17.0586 15.4805C17.0586 15.6504 16.9229 15.7852 16.7529 15.7852C16.582 15.7852 16.4502 15.6504 16.4502 15.4805ZM19.5273 17.0625C19.3301 17.1426 19.1328 17.2129 18.9434 17.2207C18.6494 17.2344 18.3281 17.1152 18.1533 16.9688C17.8828 16.7422 17.6895 16.6152 17.6074 16.2168C17.5732 16.0469 17.5928 15.7852 17.623 15.6348C17.6934 15.3105 17.6152 15.1035 17.3877 14.9141C17.2012 14.7598 16.9658 14.7188 16.7061 14.7188C16.6094 14.7188 16.5205 14.6758 16.4541 14.6406C16.3457 14.5859 16.2568 14.4512 16.3418 14.2852C16.3691 14.2324 16.501 14.1016 16.5322 14.0781C16.8838 13.877 17.29 13.9434 17.666 14.0938C18.0146 14.2363 18.2773 14.498 18.6562 14.8672C19.0439 15.3145 19.1133 15.4395 19.334 15.7734C19.5078 16.0371 19.667 16.3066 19.7754 16.6152C19.8408 16.8066 19.7559 16.9648 19.5273 17.0625Z" fill-rule="nonzero" fill="#4D6BFE"></path></svg></div><div class="_48edb25"><div class="_58a6d71 _19db599"><div class="ds-icon _7580acb" style="font-size: 12px; width: 12px; height: 12px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2.656 17.344c-1.016-1.015-1.15-2.75-.313-4.925.325-.825.73-1.617 1.205-2.365L3.582 10l-.033-.054c-.5-.799-.91-1.596-1.206-2.365-.836-2.175-.703-3.91.313-4.926.56-.56 1.364-.86 2.335-.86 1.425 0 3.168.636 4.957 1.756l.053.034.053-.034c1.79-1.12 3.532-1.757 4.957-1.757.972 0 1.776.3 2.335.86 1.014 1.015 1.148 2.752.312 4.926a13.892 13.892 0 0 1-1.206 2.365l-.034.054.034.053c.5.8.91 1.596 1.205 2.365.837 2.175.704 3.911-.311 4.926-.56.56-1.364.861-2.335.861-1.425 0-3.168-.637-4.957-1.757L10 16.415l-.053.033c-1.79 1.12-3.532 1.757-4.957 1.757-.972 0-1.776-.3-2.335-.86zm13.631-4.399c-.187-.488-.429-.988-.71-1.492l-.075-.132-.092.12a22.075 22.075 0 0 1-3.968 3.968l-.12.093.132.074c1.308.734 2.559 1.162 3.556 1.162.563 0 1.006-.138 1.298-.43.3-.3.436-.774.428-1.346-.008-.575-.159-1.264-.449-2.017zm-6.345 1.65l.058.042.058-.042a19.881 19.881 0 0 0 4.551-4.537l.043-.058-.043-.058a20.123 20.123 0 0 0-2.093-2.458 19.732 19.732 0 0 0-2.458-2.08L10 5.364l-.058.042A19.883 19.883 0 0 0 5.39 9.942L5.348 10l.042.059c.631.874 1.332 1.695 2.094 2.457a19.74 19.74 0 0 0 2.458 2.08zm6.366-10.902c-.293-.293-.736-.431-1.298-.431-.998 0-2.248.429-3.556 1.163l-.132.074.12.092a21.938 21.938 0 0 1 3.968 3.968l.092.12.074-.132c.282-.504.524-1.004.711-1.492.29-.753.442-1.442.45-2.017.007-.572-.129-1.045-.429-1.345zM3.712 7.055c.202.514.44 1.013.712 1.493l.074.13.092-.119a21.94 21.94 0 0 1 3.968-3.968l.12-.092-.132-.074C7.238 3.69 5.987 3.262 4.99 3.262c-.563 0-1.006.138-1.298.43-.3.301-.436.774-.428 1.346.007.575.159 1.264.448 2.017zm0 5.89c-.29.753-.44 1.442-.448 2.017-.008.572.127 1.045.428 1.345.293.293.736.431 1.298.431.997 0 2.247-.428 3.556-1.162l.131-.074-.12-.093a21.94 21.94 0 0 1-3.967-3.968l-.093-.12-.074.132a11.712 11.712 0 0 0-.71 1.492z" fill="currentColor" stroke="currentColor" stroke-width=".1"></path><path d="M10.706 11.704A1.843 1.843 0 0 1 8.155 10a1.845 1.845 0 1 1 2.551 1.704z" fill="currentColor" stroke="currentColor" stroke-width=".2"></path></svg></div>已深度思考（用时 333 秒）<div class="ds-icon _54f4262" style="font-size: 10px; width: 10px; height: 10px; transform: rotate(180deg);"><svg width="10" height="6" viewBox="0 0 10 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5.786 4.167L2.765 1.259c-.416-.4-.985-.482-1.273-.183-.287.298-.183.864.233 1.264l3.021 2.908c.416.4.986.482 1.273.184.287-.299.183-.865-.233-1.265z" fill="currentColor"></path><path d="M8.197 1.206L5.288 4.208c-.4.413-.484.982-.187 1.27.298.289.864.187 1.265-.227L9.274 2.25c.401-.414.485-.983.187-1.271-.297-.288-.863-.187-1.264.227z" fill="currentColor"></path></svg></div></div><div class="e1675d8b"><div class="_9ecc93a"></div>我们将使用Pygame创建一个简单的战略游戏。以下是游戏的基本设计：<div style="height: 6px;"></div><div style="height: 6px;"></div> 1. 游戏窗口：使用网格划分，每个格子是一个领土单位。<div style="height: 6px;"></div> 2. 国家：玩家控制一个国家（例如，绿色），电脑控制多个国家（例如，红色、蓝色等）。每个国家有一个颜色和多个士兵组。<div style="height: 6px;"></div> 3. 士兵组：用圆点表示，每组士兵占据一个格子，可以移动和战斗。<div style="height: 6px;"></div> 4. 游戏循环：处理玩家输入（鼠标选择并移动士兵），更新游戏状态（包括电脑国家的自动行动），绘制网格和士兵。<div style="height: 6px;"></div><div style="height: 6px;"></div> 规则实现：<div style="height: 6px;"></div> - 初始时，每个国家拥有一个格子，上面有一组士兵（组数初始为1）。<div style="height: 6px;"></div> - 玩家通过鼠标选择自己国家的士兵组（点击选中，再点击相邻格子移动）。注意：一组士兵只能移动到相邻格子（上下左右）。<div style="height: 6px;"></div> - 每占领3个格子（包括初始格子），就能在自己的任意一个领土上生成一组新的士兵（组数为1）。注意：这里我们简化，每3个格子增加一次，增加后计数重置，但注意是每3个格子就触发一次，所以可能是3,6,9...这样递增触发。<div style="height: 6px;"></div> - 当士兵移动到其他国家的领土时，进行战斗计算：<div style="height: 6px;"></div>        a = 入侵士兵组数（即移动到这个格子的士兵组数之和，注意：同一国家的士兵组可以叠加）<div style="height: 6px;"></div>        b = 原领土上的士兵组数（属于原国家的士兵组数）<div style="height: 6px;"></div>        x = a - b<div style="height: 6px;"></div>        如果x&gt;=0，则领土被入侵国占领，该领土上留下x组入侵国士兵（注意：如果有多组，它们会合并成一组，但这里我们简化，用组数表示力量，不分开显示多组，而是用数字表示组数）<div style="height: 6px;"></div>        如果x&lt;0，则领土不变，但原国家领土上的士兵组数变为 -x（即减少，但最小为0？注意：这里规则是变成-x组，但组数不能为负，所以实际上就是绝对值，但属于原国家）<div style="height: 6px;"></div><div style="height: 6px;"></div> 注意：一个格子上可以同时存在多个国家的士兵组吗？规则中，当发生战斗时，我们会计算同一国家士兵组的总组数。但在平时，一个格子只能属于一个国家，上面可以有多个士兵组（但属于同一个国家？）实际上，规则第4条说明，当入侵时，比较的是该方格上所有属于入侵国的组数a和所有属于原国家的组数b。因此，一个格子可能同时存在多个国家的士兵组吗？根据规则，在战斗结算后，格子只属于一个国家，且士兵组数也是该国家的。所以，我们设计为：一个格子只能属于一个国家，上面只能有一个国家的士兵组（但组数可以大于1）。<div style="height: 6px;"></div><div style="height: 6px;"></div> 然而，在移动时，我们允许多组士兵（同一国家的）在同一格子，但不同国家的士兵组不能共存（一旦进入敌对领土就触发战斗）。因此，我们这样设计：<div style="height: 6px;"></div>   - 每个格子有一个国家属性（颜色）和一个士兵组数（整数，表示该国家在此格子的士兵组数量）。<div style="height: 6px;"></div>   - 当一组士兵移动到相邻格子时：<div style="height: 6px;"></div>        - 如果目标格子是空地（无国家），则直接占领，该格子变成士兵所属国家，士兵组数等于移动的组数（通常为1，但如果是多组一起移动？注意：我们一次移动一组，但可以连续移动多组？这里我们设计一次移动一组士兵，但战斗时可能有多组士兵同时在一个格子（同国家），然后一起移动？不，我们设计为每次移动一组士兵，但移动后如果遇到同国家士兵，则合并（组数相加）。但这样会导致士兵组数越来越大？所以我们需要另一种方式。<div style="height: 6px;"></div><div style="height: 6px;"></div> 为了避免复杂，我们这样简化：<div style="height: 6px;"></div>   - 每个士兵组是独立的，用一个对象表示，它们有位置和所属国家。每个士兵组的力量（组数）都是1（或者我们可以允许合并？但规则没有说合并，而是说“组数”）。但规则第4条提到“侵入的士兵组数a”，可以理解为多个士兵组同时侵入（比如多个组一起移动到同一个格子），那么a就是这些组的总数（即组数之和）。因此，我们允许一个格子上有多个士兵组（同国家），在战斗时，这些组会联合起来。<div style="height: 6px;"></div><div style="height: 6px;"></div> 实现方案：<div style="height: 6px;"></div>   - 每个格子可以包含多个士兵组（不同国家不能共存，因为一旦有敌对国家士兵进入就会触发战斗，战斗后只剩下一个国家的士兵组）。<div style="height: 6px;"></div>   - 因此，我们设计每个格子有一个国家属性，以及一个士兵组列表（但实际上，战斗后只会剩下一个国家，所以我们可以用一个字典来记录每个国家在这个格子的士兵组数量？但这样每个格子就要记录多个国家的士兵组，直到战斗触发。<div style="height: 6px;"></div><div style="height: 6px;"></div> 为了简单，我们这样处理：<div style="height: 6px;"></div>   - 每个格子有一个当前国家（颜色），以及一个士兵组数（表示当前国家在此的士兵力量）。<div style="height: 6px;"></div>   - 当有新的士兵组进入时，如果进入的士兵组所属国家与格子当前国家相同，则士兵组数增加1（合并）。<div style="height: 6px;"></div>   - 如果进入的士兵组所属国家与格子当前国家不同，则立即触发战斗：<div style="height: 6px;"></div>        计算：a = 进入的士兵组数（1） + 该国家在这个格子上原有的士兵组数（如果有的话，但通常战斗前不会存在，因为不同国家不能共存，所以战斗前格子只有一个国家的士兵）？注意：可能同时有多个国家的士兵组进入？我们不允许，因为每次移动一组，且战斗立即触发。<div style="height: 6px;"></div><div style="height: 6px;"></div> 战斗过程：<div style="height: 6px;"></div>     假设格子原国家为B，士兵组数为b。<div style="height: 6px;"></div>     现在A国的一组士兵（组数1）进入，则a=1（A国士兵组数），b=b（B国士兵组数）。<div style="height: 6px;"></div>     计算x = a - b<div style="height: 6px;"></div>     如果x&gt;=0，则格子变为A国，士兵组数变为x（注意：x可能是0，但通常x&gt;=0时至少为0，但0表示没有士兵？所以我们可以设定如果x=0，则格子变成无主之地？但规则没有说。我们规定：如果x&gt;=0，则A国占领，士兵组数为x（如果x&gt;0，则A国留下x组士兵；如果x=0，则双方同归于尽，格子变为无主（即没有国家，士兵组数0）？但规则没有说同归于尽的情况。根据规则，x&gt;=0就归入侵国，所以即使x=0，也是归入侵国，但士兵组数为0。但士兵组数为0意味着没有士兵，那么下次别的国家进入就很容易被占领。所以我们可以这样实现。<div style="height: 6px;"></div><div style="height: 6px;"></div>     如果x&lt;0，则格子仍然属于B国，士兵组数变为 -x（即b-1，因为a=1，所以x=1-b，当b&gt;1时，x&lt;0，所以士兵组数变为b-1）。<div style="height: 6px;"></div><div style="height: 6px;"></div> 但是，这里有一个问题：可能同时有多个士兵组一起进入？我们目前设计每次移动一个士兵组（一组）。所以一次只有一组士兵进入。<div style="height: 6px;"></div><div style="height: 6px;"></div> 然而，在玩家操作时，可能连续移动多组士兵到同一个格子（比如连续移动两个自己的士兵组进入一个敌方格子），那么第一次移动触发战斗，战斗结束后格子状态改变，第二次移动进入时，可能已经变成我方格子，那么就是合并，而不是战斗了。<div style="height: 6px;"></div><div style="height: 6px;"></div> 因此，我们设计每次移动一组士兵，并立即处理战斗或合并。<div style="height: 6px;"></div><div style="height: 6px;"></div> 电脑AI：<div style="height: 6px;"></div>   - 为每个电脑国家设计简单的AI：随机选择一个自己的士兵组，然后随机选择一个相邻的格子移动（如果相邻格子是自己的领土，则合并；如果是空地，则占领；如果是敌国，则触发战斗）。<div style="height: 6px;"></div><div style="height: 6px;"></div> 游戏流程：<div style="height: 6px;"></div>   初始化：<div style="height: 6px;"></div>       创建网格（比如20x20），每个格子初始为None（无国家，士兵组数0）。<div style="height: 6px;"></div>       创建玩家国家（绿色）和几个电脑国家（红色、蓝色等）。<div style="height: 6px;"></div>       为每个国家分配一个初始位置（随机，但不要重叠）。<div style="height: 6px;"></div>       在初始位置上，每个国家有一个士兵组（士兵组数1）。<div style="height: 6px;"></div><div style="height: 6px;"></div>   游戏循环：<div style="height: 6px;"></div>       处理事件（鼠标事件：玩家选择自己的士兵组，然后选择相邻格子移动）<div style="height: 6px;"></div>       更新电脑国家：每个电脑国家轮流行动（随机移动一个士兵组）<div style="height: 6px;"></div>       绘制：绘制网格，每个格子按国家颜色填充（无国家则白色），在格子上绘制士兵组数（如果有士兵）。<div style="height: 6px;"></div><div style="height: 6px;"></div>   士兵组移动规则：<div style="height: 6px;"></div>       玩家操作：先点击一个自己的士兵组（格子），再点击一个相邻的格子（必须是相邻，且路径畅通？我们这里设计为只能相邻移动）。<div style="height: 6px;"></div>       移动后，该士兵组从原格子移除（原格子士兵组数减1，如果减到0，则原格子变成无主之地？注意：规则没有说失去士兵组就失去领土。领土一旦占领，除非被别国入侵成功，否则一直属于该国。所以，即使士兵组离开了，领土还是属于该国，只是没有士兵防守。因此，我们设计：领土的颜色一直保持为国家颜色，直到被其他国家占领。士兵组移动后，原领土仍然属于原国家，但士兵组数减少（如果减少到0，则没有士兵防守，但领土还是国家的）。<div style="height: 6px;"></div><div style="height: 6px;"></div>   注意：领土的归属和士兵组的存在是独立的。领土归属不会因为士兵组离开而改变，只有通过战斗才能改变归属。<div style="height: 6px;"></div><div style="height: 6px;"></div>   因此，每个格子需要记录：<div style="height: 6px;"></div>       国家（country）: 属于哪个国家，如果没有则为None<div style="height: 6px;"></div>       士兵组数（troops）: 属于当前国家的士兵组数量（注意：士兵组数可以为0，表示没有士兵）<div style="height: 6px;"></div><div style="height: 6px;"></div>   但是，我们还需要记录每个士兵组的位置吗？实际上，我们不需要单独记录士兵组对象，因为每个格子上的士兵组数就代表了该国家在此的军事力量。移动士兵组时，我们实际上是将一个士兵组从一个格子移动到另一个格子。<div style="height: 6px;"></div><div style="height: 6px;"></div>   然而，为了允许玩家选择一组士兵（即选择一个格子上的部分士兵组）进行移动，我们可能需要改变设计：我们之前设计一个格子上的士兵组数是合并的。但这样就不能分开移动。因此，我们需要单独记录每个士兵组。<div style="height: 6px;"></div><div style="height: 6px;"></div> 重新设计：<div style="height: 6px;"></div><div style="height: 6px;"></div>  为了能够分别控制不同的士兵组，每个士兵组应该是一个独立的对象。每个士兵组有：<div style="height: 6px;"></div>      - 国家<div style="height: 6px;"></div>      - 位置（网格坐标）<div style="height: 6px;"></div>      - 力量（组数，初始为1，但战斗后可能变化？注意：规则中战斗后士兵组数会变化，但这里我们简化，每个士兵组的力量都是1（即一组），战斗时计算的是同一个格子上的多个士兵组的总数。<div style="height: 6px;"></div><div style="height: 6px;"></div>  因此，我们这样设计：<div style="height: 6px;"></div>     每个格子可以容纳多个士兵组（来自同一个国家或不同国家？但不同国家会立即战斗）。但为了简单，我们只允许同一个国家的士兵组在一个格子上共存（不同国家的士兵组进入同一个格子会立即触发战斗，战斗后只剩下一个国家的士兵组（胜利方））。<div style="height: 6px;"></div><div style="height: 6px;"></div>  每个士兵组用一个类表示：Troop<div style="height: 6px;"></div>     属性：country, position (x, y), 但我们不存储力量，因为每个士兵组力量都是1。<div style="height: 6px;"></div><div style="height: 6px;"></div>  每个格子（Tile）的属性：<div style="height: 6px;"></div>     国家（country）: 这个格子属于哪个国家<div style="height: 6px;"></div>     士兵组列表（troops）: 这个格子上所有士兵组的列表（注意：战斗后只会有一个国家的士兵组，但可能有多个Troop对象，这些Troop对象属于同一个国家）<div style="height: 6px;"></div><div style="height: 6px;"></div>  但是，这样每个格子上的士兵组数量就是列表长度。战斗时，我们按国家统计士兵组数（即数同一个国家的Troop个数）。<div style="height: 6px;"></div><div style="height: 6px;"></div>  移动士兵组：<div style="height: 6px;"></div>       玩家选择一个Troop（通过点击其所在的格子，然后从该格子的Troop中选一个？但我们不区分，所以可以设计为：点击一个格子，然后移动该格子的一个Troop（随机选一个，或者移动全部？但规则没有说）。为了简单，我们设计：一次移动一个Troop（一组士兵）。玩家点击自己的一个格子（该格子可能有多个Troop），然后点击相邻格子，则移动一个Troop到目标格子。<div style="height: 6px;"></div><div style="height: 6px;"></div>       移动后，原格子的Troop列表移除这个Troop。<div style="height: 6px;"></div>       目标格子接收到这个Troop，然后检查：<div style="height: 6px;"></div>           如果目标格子没有国家（空地），则直接将该格子国家设置为Troop的国家，并将该Troop加入目标格子。<div style="height: 6px;"></div>           如果目标格子有国家，且与Troop国家相同，则将该Troop加入目标格子（合并）。<div style="height: 6px;"></div>           如果目标格子有国家，且与Troop国家不同，则触发战斗：<div style="height: 6px;"></div>                 将当前Troop加入目标格子（此时目标格子有不同国家的Troop）<div style="height: 6px;"></div>                 然后立即进行战斗结算：<div style="height: 6px;"></div>                      统计目标格子中每个国家的Troop数量（即组数）。<div style="height: 6px;"></div>                      假设有两个国家：A国（入侵国）和B国（原国家），那么a = A国的Troop数量，b = B国的Troop数量。<div style="height: 6px;"></div>                      计算x = a - b<div style="height: 6px;"></div>                      如果x&gt;=0，则目标格子变成A国领土，并移除所有B国的Troop，同时移除x个A国的Troop（因为战斗消耗）。注意：规则是留下x组入侵国士兵，所以如果x&gt;0，则留下x组A国士兵（即移除a-x组A国士兵）。如果x=0，则移除所有A国和B国的Troop（同归于尽，格子变为无主之地）。<div style="height: 6px;"></div>                      如果x&lt;0，则目标格子仍然是B国领土，移除所有A国的Troop，并移除(-x)个B国的Troop（即留下b-(-x)=b+x组，因为x=a-b，所以b+x = a+b - b = a? 不对，x&lt;0时，留下B国士兵组数为-x（即b-a））。因为x=a-b&lt;0，所以-x=b-a（正数），那么我们就留下b-a个B国的Troop（随机移除一些Troop，直到剩下b-a个）。<div style="height: 6px;"></div><div style="height: 6px;"></div>       战斗后，目标格子只留下一个国家的Troop（或者没有，如果同归于尽）。<div style="height: 6px;"></div><div style="height: 6px;"></div>  这个战斗结算比较复杂，而且涉及到移除特定数量的Troop（并且要随机选择移除哪些Troop）。为了简化，我们可以这样：<div style="height: 6px;"></div><div style="height: 6px;"></div>       战斗后，移除目标格子上所有士兵组（Troop），然后根据战斗结果，如果胜利方需要留下士兵组，就创建相应数量的Troop（属于胜利方国家）。这样就不用一个一个移除。<div style="height: 6px;"></div><div style="height: 6px;"></div>       步骤：<div style="height: 6px;"></div>         1. 统计目标格子中每个国家的士兵组数（a: 入侵国A的组数，b: 原国家B的组数，注意可能还有第三国？但一次移动只有两个国家？因为之前触发战斗时只有两个国家。但如果有第三国的士兵组在，那么就要同时考虑三个国家？为了避免复杂，我们不允许第三国存在：即当A国士兵组进入时，如果目标格子是C国（既不是A也不是B）怎么办？实际上，我们设计目标格子只能有一个国家（除了新进入的Troop带来的国家）。所以，目标格子原本只属于一个国家（B国），然后A国士兵进入，此时目标格子就有A和B两个国家的Troop。因此，战斗只发生在A和B之间。<div style="height: 6px;"></div><div style="height: 6px;"></div>         2. 计算x = a - b<div style="height: 6px;"></div>         3. 清除目标格子的所有Troop（全部移除）。<div style="height: 6px;"></div>         4. 如果x&gt;=0：<div style="height: 6px;"></div>                 目标格子的国家设为A国。<div style="height: 6px;"></div>                 如果x&gt;0，则在目标格子添加x个A国的Troop（每个Troop力量为1）。<div style="height: 6px;"></div>         5. 如果x&lt;0：<div style="height: 6px;"></div>                 目标格子的国家仍然为B国。<div style="height: 6px;"></div>                 在目标格子添加(-x)个B国的Troop。<div style="height: 6px;"></div><div style="height: 6px;"></div>       注意：这样处理，战斗后目标格子只有胜利方的Troop，数量为|x|（如果x==0，则没有Troop，国家变为无主？但规则x&gt;=0归入侵国，所以x=0时归入侵国（A国），但士兵组数为0。但按照上面的步骤，x=0时，我们清除所有Troop，然后将国家设为A国，但不添加Troop。所以格子上有A国，但Troop数量为0。<div style="height: 6px;"></div><div style="height: 6px;"></div>       但是，这样有一个问题：原本B国的Troop被清除了，然后我们重新添加了B国的Troop（当x&lt;0时）？这样就不是在原有Troop的基础上移除，而是全部换新。这样也可以。<div style="height: 6px;"></div><div style="height: 6px;"></div>  每占领3个格子生成新士兵组：<div style="height: 6px;"></div>       每个国家记录自己占领的格子数（即领土数量）。<div style="height: 6px;"></div>       每当领土数量达到3的倍数（3,6,9,...）时，就可以在自己任意一个领土上生成一个新的士兵组（Troop，力量为1）。注意：不是每增加3个就生成，而是累计达到3的倍数时生成（并且每个倍数只生成一次）。所以，我们需要记录每个国家已经触发过生成的次数。<div style="height: 6px;"></div><div style="height: 6px;"></div>       例如：初始1个格子，当占领到3个格子时，触发一次生成；当占领到6个时，再触发一次。注意，如果从3个格子减少到2个，然后再增加到3个，不会再次触发（因为已经触发过了3个的生成）。所以我们需要记录触发点。<div style="height: 6px;"></div><div style="height: 6px;"></div>       我们设计：每个国家有一个属性next_reward_threshold，初始为3。当领土数量达到next_reward_threshold时，就生成一个新的Troop，然后next_reward_threshold增加3（即下一次在6个时触发）。<div style="height: 6px;"></div><div style="height: 6px;"></div>       生成新Troop时，选择该国家的任意一个领土格子（随机选择一个格子），在该格子上添加一个Troop（如果该格子已经有Troop，就添加一个，这样该格子的Troop数量增加）。<div style="height: 6px;"></div><div style="height: 6px;"></div> 游戏数据结构：<div style="height: 6px;"></div>     国家（Country）类：<div style="height: 6px;"></div>         - color: 颜色<div style="height: 6px;"></div>         - territory: 领土数量（即格子数）<div style="height: 6px;"></div>         - next_reward: 下一次触发奖励的阈值（整数，初始3）<div style="height: 6px;"></div><div style="height: 6px;"></div>     格子（Tile）类：<div style="height: 6px;"></div>         - country: 所属国家（None表示无主）<div style="height: 6px;"></div>         - troops: 列表，存放Troop对象（属于这个格子的士兵组）<div style="height: 6px;"></div><div style="height: 6px;"></div>     士兵组（Troop）类：<div style="height: 6px;"></div>         - country: 所属国家<div style="height: 6px;"></div>         - position: 所在格子的坐标（也可以不存，因为格子知道）<div style="height: 6px;"></div><div style="height: 6px;"></div>     网格（Grid）: 一个二维列表，每个元素是一个Tile对象。<div style="height: 6px;"></div><div style="height: 6px;"></div> 游戏状态更新：<div style="height: 6px;"></div>     每次移动一个Troop（玩家或电脑操作）后，可能会改变格子的国家和Troop分布，同时可能改变国家的领土数量。<div style="height: 6px;"></div>     因此，移动后需要更新相关国家的领土数量（遍历所有格子，统计每个国家的领土数？这样效率低，但格子不多（20x20=400）可以接受。或者我们在移动和战斗后更新：当一个格子改变国家时，旧国家领土数减1，新国家领土数加1。<div style="height: 6px;"></div><div style="height: 6px;"></div> 注意：生成新Troop的时机：在移动操作后（可能改变了领土数量），检查每个国家的领土数是否达到next_reward阈值，如果达到，则生成一个Troop，并将该国家的next_reward增加3。<div style="height: 6px;"></div><div style="height: 6px;"></div> 实现步骤：<div style="height: 6px;"></div><div style="height: 6px;"></div>     1. 初始化pygame，设置窗口大小，网格大小（每个格子的大小）。<div style="height: 6px;"></div>     2. 创建网格（二维列表），初始化每个Tile（country=None, troops=[]）。<div style="height: 6px;"></div>     3. 创建国家列表（包括玩家国家和电脑国家），为每个国家随机分配一个初始位置（确保不重叠）。<div style="height: 6px;"></div>        - 在初始位置：设置该格子的国家为该国，并添加一个Troop（初始士兵组）。<div style="height: 6px;"></div>        - 每个国家的初始领土数为1，next_reward=3。<div style="height: 6px;"></div>     4. 主循环：<div style="height: 6px;"></div>         处理事件（退出事件，鼠标事件）<div style="height: 6px;"></div>         绘制网格（根据国家颜色填充，并在有Troop的格子上绘制Troop数量（即troops列表的长度））<div style="height: 6px;"></div>         玩家回合：通过鼠标选择移动<div style="height: 6px;"></div>             - 第一次点击：选择一个格子（该格子必须是玩家国家的，并且有Troop），记录为选中格子。<div style="height: 6px;"></div>             - 第二次点击：选择一个相邻格子（上下左右），如果相邻，则从选中格子移动一个Troop到目标格子。<div style="height: 6px;"></div>         电脑回合：遍历每个电脑国家，对该国家的每个Troop？或者每个国家随机移动一个Troop？我们设计每个电脑国家每回合移动一个Troop（随机选择一个Troop，随机选择一个方向移动）。<div style="height: 6px;"></div>         更新后，检查每个国家的领土数，如果达到next_reward，则生成一个Troop（随机放置在该国家的领土上），并更新next_reward（加3）。<div style="height: 6px;"></div><div style="height: 6px;"></div>     注意：移动Troop后，原格子可能变成没有Troop（但领土还是该国家的），目标格子可能触发战斗。<div style="height: 6px;"></div><div style="height: 6px;"></div> 由于时间关系，我们简化一些细节：<div style="height: 6px;"></div><div style="height: 6px;"></div>   - 士兵组移动时，我们只移动一个Troop（一组士兵）。<div style="height: 6px;"></div>   - 战斗结算按照上述方法（清除所有Troop，然后根据结果重新添加Troop）。<div style="height: 6px;"></div>   - 领土数量更新：在战斗后（如果格子国家改变），旧国家领土减1，新国家领土加1。同时，如果旧国家的领土减少到低于某个阈值，不会收回已经触发的奖励（因为奖励触发是一次性的）。<div style="height: 6px;"></div><div style="height: 6px;"></div> 代码结构：<div style="height: 6px;"></div><div style="height: 6px;"></div>   class Country:<div style="height: 6px;"></div>        def __init__(self, color, initial_pos):<div style="height: 6px;"></div>            self.color = color<div style="height: 6px;"></div>            self.territory = 1   # 初始1个格子<div style="height: 6px;"></div>            self.next_reward = 3  # 第一次奖励在3个领土时触发<div style="height: 6px;"></div>            # 可以给每个国家一个唯一ID或名字？<div style="height: 6px;"></div><div style="height: 6px;"></div>   class Troop:<div style="height: 6px;"></div>        def __init__(self, country):<div style="height: 6px;"></div>            self.country = country<div style="height: 6px;"></div><div style="height: 6px;"></div>   class Tile:<div style="height: 6px;"></div>        def __init__(self):<div style="height: 6px;"></div>            self.country = None   # 所属国家<div style="height: 6px;"></div>            self.troops = []      # 本格子上的Troop列表<div style="height: 6px;"></div><div style="height: 6px;"></div>        def add_troop(self, troop):<div style="height: 6px;"></div>            self.troops.append(troop)<div style="height: 6px;"></div><div style="height: 6px;"></div>        def remove_troop(self, troop):<div style="height: 6px;"></div>            if troop in self.troops:<div style="height: 6px;"></div>                self.troops.remove(troop)<div style="height: 6px;"></div><div style="height: 6px;"></div>        def remove_one_troop(self, country):<div style="height: 6px;"></div>            # 移除一个属于country的Troop（随机选一个）<div style="height: 6px;"></div>            for i, t in enumerate(self.troops):<div style="height: 6px;"></div>                if t.country == country:<div style="height: 6px;"></div>                    return self.troops.pop(i)<div style="height: 6px;"></div>            return None<div style="height: 6px;"></div><div style="height: 6px;"></div>        def count_troops_by_country(self, country):<div style="height: 6px;"></div>            count = 0<div style="height: 6px;"></div>            for t in self.troops:<div style="height: 6px;"></div>                if t.country == country:<div style="height: 6px;"></div>                    count += 1<div style="height: 6px;"></div>            return count<div style="height: 6px;"></div><div style="height: 6px;"></div>        def get_all_countries_in_tile(self):<div style="height: 6px;"></div>            # 返回本格子上有哪些国家（可能有多个，但战斗后只会有一个）<div style="height: 6px;"></div>            countries = set()<div style="height: 6px;"></div>            for t in self.troops:<div style="height: 6px;"></div>                countries.add(t.country)<div style="height: 6px;"></div>            return countries<div style="height: 6px;"></div><div style="height: 6px;"></div>   class Game:<div style="height: 6px;"></div>        def __init__(self, width, height, tile_size):<div style="height: 6px;"></div>            self.width = width   # 网格列数<div style="height: 6px;"></div>            self.height = height # 网格行数<div style="height: 6px;"></div>            self.tile_size = tile_size<div style="height: 6px;"></div>            self.grid = [[Tile() for _ in range(width)] for _ in range(height)]<div style="height: 6px;"></div>            self.countries = []<div style="height: 6px;"></div>            self.selected_tile = None  # 玩家选中的格子（坐标(x,y)）<div style="height: 6px;"></div><div style="height: 6px;"></div>        def add_country(self, country, pos):<div style="height: 6px;"></div>            x, y = pos<div style="height: 6px;"></div>            tile = self.grid[y][x]<div style="height: 6px;"></div>            tile.country = country<div style="height: 6px;"></div>            # 添加一个初始Troop<div style="height: 6px;"></div>            tile.add_troop(Troop(country))<div style="height: 6px;"></div><div style="height: 6px;"></div>        def move_troop(self, from_pos, to_pos):<div style="height: 6px;"></div>            from_x, from_y = from_pos<div style="height: 6px;"></div>            to_x, to_y = to_pos<div style="height: 6px;"></div>            from_tile = self.grid[from_y][from_x]<div style="height: 6px;"></div>            to_tile = self.grid[to_y][to_x]<div style="height: 6px;"></div><div style="height: 6px;"></div>            if len(from_tile.troops) == 0:<div style="height: 6px;"></div>                return  # 没有士兵可以移动<div style="height: 6px;"></div><div style="height: 6px;"></div>            # 移动一个Troop（从from_tile中移除一个，添加到to_tile）<div style="height: 6px;"></div>            troop = from_tile.troops.pop(0)  # 移动第一个（也可以随机）<div style="height: 6px;"></div><div style="height: 6px;"></div>            # 记录移动前to_tile的国家（用于领土更新）<div style="height: 6px;"></div>            old_country = to_tile.country<div style="height: 6px;"></div><div style="height: 6px;"></div>            # 将troop添加到目标格子<div style="height: 6px;"></div>            to_tile.add_troop(troop)<div style="height: 6px;"></div><div style="height: 6px;"></div>            # 如果目标格子没有国家，则占领（设置国家为troop的国家）<div style="height: 6px;"></div>            if to_tile.country is None:<div style="height: 6px;"></div>                to_tile.country = troop.country<div style="height: 6px;"></div>                # 新国家领土增加<div style="height: 6px;"></div>                troop.country.territory += 1<div style="height: 6px;"></div>            else:<div style="height: 6px;"></div>                # 如果目标格子国家与troop国家相同，则合并（不需要战斗）<div style="height: 6px;"></div>                if to_tile.country == troop.country:<div style="height: 6px;"></div>                    pass  # 已经添加，无需其他操作<div style="height: 6px;"></div>                else:<div style="height: 6px;"></div>                    # 不同国家，触发战斗<div style="height: 6px;"></div>                    self.resolve_combat(to_tile)<div style="height: 6px;"></div><div style="height: 6px;"></div>            # 注意：移动后，原格子可能士兵减少，但领土不变（即使减少到0，领土还是原国家的）<div style="height: 6px;"></div>            # 检查原格子：如果原格子没有士兵了，但领土还在（国家不变）<div style="height: 6px;"></div><div style="height: 6px;"></div>            # 战斗结算后，可能需要更新领土（在resolve_combat中已经处理了）<div style="height: 6px;"></div><div style="height: 6px;"></div>        def resolve_combat(self, tile):<div style="height: 6px;"></div>            # 获取格子上的所有国家<div style="height: 6px;"></div>            countries = tile.get_all_countries_in_tile()<div style="height: 6px;"></div>            # 但战斗只涉及两个国家？我们这里只考虑两个国家的情况（因为移动一个Troop进来，原本只有一个国家，所以最多两个）<div style="height: 6px;"></div>            if len(countries) != 2:<div style="height: 6px;"></div>                # 如果多于两个国家，我们只取两个最大的？或者忽略？但按照规则，移动时只会引入一个新的国家，所以应该只有两个。<div style="height: 6px;"></div>                # 我们取两个国家：原国家（tile.country）和新进入的国家（另一个国家）<div style="height: 6px;"></div>                # 但有可能原国家在战斗前已经变了？所以这里我们重新计算。<div style="height: 6px;"></div>                # 统计每个国家的士兵组数<div style="height: 6px;"></div>                country_count = {}<div style="height: 6px;"></div>                for troop in tile.troops:<div style="height: 6px;"></div>                    c = troop.country<div style="height: 6px;"></div>                    country_count[c] = country_count.get(c, 0) + 1<div style="height: 6px;"></div><div style="height: 6px;"></div>                # 取士兵组数最多的两个国家（但我们假设只有两个国家有士兵）<div style="height: 6px;"></div>                if len(country_count) &lt; 2:<div style="height: 6px;"></div>                    return  # 不可能发生<div style="height: 6px;"></div><div style="height: 6px;"></div>                # 按士兵组数排序<div style="height: 6px;"></div>                sorted_countries = sorted(country_count.items(), key=lambda x: x[1], reverse=True)<div style="height: 6px;"></div>                countryA, a = sorted_countries[0]<div style="height: 6px;"></div>                countryB, b = sorted_countries[1]<div style="height: 6px;"></div><div style="height: 6px;"></div>                # 计算x = a - b<div style="height: 6px;"></div>                x = a - b<div style="height: 6px;"></div>                # 记录旧国家（原格子国家）和将要设置的新国家<div style="height: 6px;"></div>                old_country = tile.country<div style="height: 6px;"></div><div style="height: 6px;"></div>                # 清除该格子的所有troops<div style="height: 6px;"></div>                tile.troops = []<div style="height: 6px;"></div><div style="height: 6px;"></div>                if x &gt;= 0:<div style="height: 6px;"></div>                    # 国家A胜利<div style="height: 6px;"></div>                    tile.country = countryA<div style="height: 6px;"></div>                    # 添加x个A国士兵<div style="height: 6px;"></div>                    for _ in range(x):<div style="height: 6px;"></div>                        tile.add_troop(Troop(countryA))<div style="height: 6px;"></div>                    # 更新领土：如果旧国家不是A，则A领土增加1，旧国家领土减少1<div style="height: 6px;"></div>                    if old_country != countryA:<div style="height: 6px;"></div>                        countryA.territory += 1<div style="height: 6px;"></div>                        if old_country is not None:  # 可能原本是无主之地？<div style="height: 6px;"></div>                            old_country.territory -= 1<div style="height: 6px;"></div>                    # 注意：如果旧国家就是A，那么领土不变（因为原本就是A的，现在还是A）<div style="height: 6px;"></div>                else:<div style="height: 6px;"></div>                    # 国家B胜利（实际上B是原国家，所以领土不变，但士兵减少）<div style="height: 6px;"></div>                    # 注意：我们这里B是士兵组数第二多的国家？但规则是原国家。这里我们并没有记录哪个是原国家，而是用tile.country记录。但战斗后，如果B胜利，那么领土还是B的，所以不变。<div style="height: 6px;"></div>                    # 但是，在战斗前，tile.country是原国家（可能是B，也可能是A？）实际上，在移动Troop之前，tile.country是原国家（比如B），然后我们移动了一个A国士兵进来，所以原国家是B，新国家是A。然后战斗后，如果x&lt;0，则领土还是B，所以不需要改变领土。<div style="height: 6px;"></div>                    # 添加-x个B国士兵<div style="height: 6px;"></div>                    for _ in range(-x):<div style="height: 6px;"></div>                        tile.add_troop(Troop(countryB))<div style="height: 6px;"></div>                    # 领土不变，所以不需要更新<div style="height: 6px;"></div>                    # 但是，如果原国家不是B（比如原国家是C，然后A和B在C的领土上战斗？）不可能，因为移动一个A国士兵进入，而原国家是C，那么战斗是A和C。所以这里我们假设两个国家就是原国家和新国家。<div style="height: 6px;"></div>                    # 因此，我们这里不改变领土所属（因为x&lt;0时，领土还是原国家）。但原国家在战斗过程中可能已经变了？不会，因为战斗前原国家是old_country（在移动函数中记录了），但我们在战斗函数中并没有使用old_country，而是用tile.country（在战斗前已经被设置成原国家）。在战斗过程中，我们清除了troop，然后重新添加，并设置tile.country（当A胜利时设置为A，B胜利时保持不变）。<div style="height: 6px;"></div>                    # 所以，在x&lt;0的情况下，我们不需要改变领土所属（因为tile.country原本就是B，我们保持不变），因此不需要更新领土数量。<div style="height: 6px;"></div>                    pass<div style="height: 6px;"></div><div style="height: 6px;"></div>            else:<div style="height: 6px;"></div>                # 两个国家的情况<div style="height: 6px;"></div>                # 假设两个国家：countryA（新进入的，即troop的国家）和countryB（原国家，即tile.country）<div style="height: 6px;"></div>                countryA = troop.country  # 注意：这个troop是最后添加的那个，但可能还有其他同国家的troop？所以我们要统计<div style="height: 6px;"></div>                countryB = tile.country<div style="height: 6px;"></div>                a = tile.count_troops_by_country(countryA)<div style="height: 6px;"></div>                b = tile.count_troops_by_country(countryB)<div style="height: 6px;"></div>                x = a - b<div style="height: 6px;"></div><div style="height: 6px;"></div>                # 记录旧国家（即countryB）<div style="height: 6px;"></div>                old_country = countryB<div style="height: 6px;"></div><div style="height: 6px;"></div>                # 清除所有troops<div style="height: 6px;"></div>                tile.troops = []<div style="height: 6px;"></div><div style="height: 6px;"></div>                if x &gt;= 0:<div style="height: 6px;"></div>                    tile.country = countryA<div style="height: 6px;"></div>                    # 添加x个A国士兵<div style="height: 6px;"></div>                    for _ in range(x):<div style="height: 6px;"></div>                        tile.add_troop(Troop(countryA))<div style="height: 6px;"></div>                    # 更新领土：A增加1，B减少1<div style="height: 6px;"></div>                    countryA.territory += 1<div style="height: 6px;"></div>                    old_country.territory -= 1   # 注意：old_country就是countryB<div style="height: 6px;"></div>                else:<div style="height: 6px;"></div>                    tile.country = countryB   # 保持不变<div style="height: 6px;"></div>                    # 添加-x个B国士兵<div style="height: 6px;"></div>                    for _ in range(-x):<div style="height: 6px;"></div>                        tile.add_troop(Troop(countryB))<div style="height: 6px;"></div>                    # 领土不变<div style="height: 6px;"></div>                # 注意：这里我们假设只有两个国家，所以不需要考虑其他国家。<div style="height: 6px;"></div><div style="height: 6px;"></div>        def check_reward(self):<div style="height: 6px;"></div>            for country in self.countries:<div style="height: 6px;"></div>                if country.territory &gt;= country.next_reward:<div style="height: 6px;"></div>                    # 触发奖励：生成一个新的Troop<div style="height: 6px;"></div>                    # 找到该国的一个随机领土格子<div style="height: 6px;"></div>                    candidate_tiles = []<div style="height: 6px;"></div>                    for y in range(self.height):<div style="height: 6px;"></div>                        for x in range(self.width):<div style="height: 6px;"></div>                            tile = self.grid[y][x]<div style="height: 6px;"></div>                            if tile.country == country:<div style="height: 6px;"></div>                                candidate_tiles.append((x,y))<div style="height: 6px;"></div>                    if candidate_tiles:<div style="height: 6px;"></div>                        pos = random.choice(candidate_tiles)<div style="height: 6px;"></div>                        x, y = pos<div style="height: 6px;"></div>                        tile = self.grid[y][x]<div style="height: 6px;"></div>                        tile.add_troop(Troop(country))<div style="height: 6px;"></div>                        # 更新阈值<div style="height: 6px;"></div>                        country.next_reward += 3<div style="height: 6px;"></div><div style="height: 6px;"></div>        # 还需要一个函数来绘制网格和士兵<div style="height: 6px;"></div><div style="height: 6px;"></div> 注意：上面的战斗处理中，当战斗发生时，我们清除了格子上的所有Troop，然后根据结果添加新的Troop。这样，原本格子上的Troop（无论多少）都被清除了，然后重新生成。这样做简单，但可能不直观（因为士兵组都被消灭了又重新生成）。但符合规则。<div style="height: 6px;"></div><div style="height: 6px;"></div> 由于时间有限，我们简化了士兵组的移动（每次移动一组，且移动后立即战斗或合并）。<div style="height: 6px;"></div><div style="height: 6px;"></div> 玩家操作：<div style="height: 6px;"></div>     我们使用两次点击：第一次点击选中一个格子（该格子必须是玩家国家的，并且有Troop），第二次点击一个相邻格子（检查是否相邻），然后调用move_troop(from_pos, to_pos)。<div style="height: 6px;"></div><div style="height: 6px;"></div> 电脑操作：<div style="height: 6px;"></div>     我们为每个电脑国家随机选择一个有Troop的格子，然后随机选择一个相邻格子移动。<div style="height: 6px;"></div><div style="height: 6px;"></div> 注意：移动后，原格子上的Troop减少一个，目标格子增加一个Troop（然后可能触发战斗）。<div style="height: 6px;"></div><div style="height: 6px;"></div> 现在，我们开始编写代码。由于代码较长，我们只实现基本功能，并尽量简化。<div style="height: 6px;"></div><div style="height: 6px;"></div> 注意：我们使用一个列表存储所有国家，玩家国家是列表的第一个，电脑国家是后面的。<div style="height: 6px;"></div><div style="height: 6px;"></div> 我们使用：<div style="height: 6px;"></div>    玩家国家：绿色<div style="height: 6px;"></div>    电脑国家1：红色<div style="height: 6px;"></div>    电脑国家2：蓝色<div style="height: 6px;"></div><div style="height: 6px;"></div> 网格大小：20x20，每个格子40x40像素。<div style="height: 6px;"></div><div style="height: 6px;"></div> 让我们开始写代码：</div></div><div class="ds-markdown ds-markdown--block" style="--ds-md-zoom: 1.143;"><h1>战略游戏：领土征服者</h1><p class="ds-markdown-paragraph">下面是一个使用Pygame库实现的战略游戏，玩家控制一个国家，与多个电脑控制的国家争夺领土。</p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre><span class="token keyword">import</span> pygame
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> random
<span class="token keyword">import</span> math
<span class="token keyword">from</span> pygame<span class="token punctuation">.</span><span class="token builtin">locals</span> <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token comment"># 初始化pygame</span>
pygame<span class="token punctuation">.</span>init<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 游戏常量</span>
SCREEN_WIDTH <span class="token operator">=</span> <span class="token number">1000</span>
SCREEN_HEIGHT <span class="token operator">=</span> <span class="token number">700</span>
GRID_SIZE <span class="token operator">=</span> <span class="token number">20</span>
GRID_WIDTH <span class="token operator">=</span> <span class="token number">40</span>
GRID_HEIGHT <span class="token operator">=</span> <span class="token number">30</span>
TILE_SIZE <span class="token operator">=</span> <span class="token number">20</span>
FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span>
LARGE_FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span>

<span class="token comment"># 颜色</span>
BACKGROUND <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
GRID_COLOR <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
WHITE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
BLACK <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
RED <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
GREEN <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
BLUE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
YELLOW <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
PURPLE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
CYAN <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
COLORS <span class="token operator">=</span> <span class="token punctuation">[</span>RED<span class="token punctuation">,</span> GREEN<span class="token punctuation">,</span> BLUE<span class="token punctuation">,</span> YELLOW<span class="token punctuation">,</span> PURPLE<span class="token punctuation">,</span> CYAN<span class="token punctuation">]</span>
HIGHLIGHT <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Country</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> color<span class="token punctuation">,</span> name<span class="token punctuation">,</span> is_player<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>color <span class="token operator">=</span> color
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>is_player <span class="token operator">=</span> is_player
        self<span class="token punctuation">.</span>territory <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>next_reward <span class="token operator">=</span> <span class="token number">3</span>
        self<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">add_territory</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>territory <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token comment"># 每占领3块领土获得一个新的士兵组</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>territory <span class="token operator">&gt;=</span> self<span class="token punctuation">.</span>next_reward<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>next_reward <span class="token operator">+=</span> <span class="token number">3</span>
            <span class="token comment"># 在随机领土上生成新士兵组</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                random_troop <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>self<span class="token punctuation">.</span>troops<span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>random_troop<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> random_troop<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">remove_territory</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>territory <span class="token operator">-=</span> <span class="token number">1</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>territory <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">True</span>

<span class="token keyword">class</span> <span class="token class-name">Game</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>screen <span class="token operator">=</span> pygame<span class="token punctuation">.</span>display<span class="token punctuation">.</span>set_mode<span class="token punctuation">(</span><span class="token punctuation">(</span>SCREEN_WIDTH<span class="token punctuation">,</span> SCREEN_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">)</span>
        pygame<span class="token punctuation">.</span>display<span class="token punctuation">.</span>set_caption<span class="token punctuation">(</span><span class="token string">"领土征服者"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>clock <span class="token operator">=</span> pygame<span class="token punctuation">.</span>time<span class="token punctuation">.</span>Clock<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 创建国家</span>
        self<span class="token punctuation">.</span>countries <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>player_country <span class="token operator">=</span> Country<span class="token punctuation">(</span>GREEN<span class="token punctuation">,</span> <span class="token string">"玩家"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>countries<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>player_country<span class="token punctuation">)</span>
        
        <span class="token comment"># 创建电脑国家</span>
        ai_names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"红国"</span><span class="token punctuation">,</span> <span class="token string">"蓝国"</span><span class="token punctuation">,</span> <span class="token string">"黄国"</span><span class="token punctuation">,</span> <span class="token string">"紫国"</span><span class="token punctuation">,</span> <span class="token string">"青国"</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>countries<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Country<span class="token punctuation">(</span>COLORS<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ai_names<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 初始化网格</span>
        self<span class="token punctuation">.</span>grid <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token boolean">None</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>selected_troop <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>game_over <span class="token operator">=</span> <span class="token boolean">False</span>
        self<span class="token punctuation">.</span>winner <span class="token operator">=</span> <span class="token boolean">None</span>
        
        <span class="token comment"># 初始化领土和士兵</span>
        self<span class="token punctuation">.</span>initialize_game<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">initialize_game</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 为每个国家分配初始领土</span>
        positions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>countries<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
                x <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> GRID_WIDTH <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
                y <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">not</span> <span class="token keyword">in</span> positions<span class="token punctuation">:</span>
                    positions<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
                        <span class="token string">'country'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>countries<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token string">'troops'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">]</span>  <span class="token comment"># 初始士兵组</span>
                    <span class="token punctuation">}</span>
                    self<span class="token punctuation">.</span>countries<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>territory <span class="token operator">+=</span> <span class="token number">1</span>
                    self<span class="token punctuation">.</span>countries<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">]</span>
                    <span class="token keyword">break</span>
    
    <span class="token keyword">def</span> <span class="token function">draw_grid</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 绘制网格背景</span>
        self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>fill<span class="token punctuation">(</span>BACKGROUND<span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制网格线</span>
        <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> SCREEN_WIDTH<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">:</span>
            pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>line<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> GRID_COLOR<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">:</span>
            pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>line<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> GRID_COLOR<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>SCREEN_WIDTH<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制领土和士兵</span>
        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">:</span>
                    country <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span>
                    rect <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Rect<span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span>
                    pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> country<span class="token punctuation">.</span>color<span class="token punctuation">,</span> rect<span class="token punctuation">)</span>
                    
                    <span class="token comment"># 绘制士兵组</span>
                    troop_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span> troop_count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                        pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> WHITE<span class="token punctuation">,</span> 
                                          <span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                          TILE_SIZE<span class="token operator">//</span><span class="token number">3</span><span class="token punctuation">)</span>
                        text <span class="token operator">=</span> FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>troop_count<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span>
                        self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">3</span><span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制选中的士兵组</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>selected_troop<span class="token punctuation">:</span>
            x<span class="token punctuation">,</span> y <span class="token operator">=</span> self<span class="token punctuation">.</span>selected_troop
            rect <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Rect<span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span>
            pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> HIGHLIGHT<span class="token punctuation">,</span> rect<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 绘制可移动范围</span>
            <span class="token keyword">for</span> dx<span class="token punctuation">,</span> dy <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                nx<span class="token punctuation">,</span> ny <span class="token operator">=</span> x <span class="token operator">+</span> dx<span class="token punctuation">,</span> y <span class="token operator">+</span> dy
                <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> nx <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> ny <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">:</span>
                    rect <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Rect<span class="token punctuation">(</span>nx <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> ny <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span>
                    pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rect<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制信息面板</span>
        pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> SCREEN_WIDTH<span class="token punctuation">,</span> SCREEN_HEIGHT <span class="token operator">-</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">)</span>
        pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>line<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> WHITE<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>SCREEN_WIDTH<span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制玩家信息</span>
        player_text <span class="token operator">=</span> LARGE_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"玩家领土: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>territory<span class="token punctuation">}</span></span><span class="token string">  下一奖励: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>next_reward<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> GREEN<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>player_text<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制游戏说明</span>
        instructions <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string">"游戏说明:"</span><span class="token punctuation">,</span>
            <span class="token string">"1. 点击自己的士兵组选择它"</span><span class="token punctuation">,</span>
            <span class="token string">"2. 点击相邻格子移动士兵"</span><span class="token punctuation">,</span>
            <span class="token string">"3. 每占领3块领土获得一个新士兵组"</span><span class="token punctuation">,</span>
            <span class="token string">"4. 战斗规则: 比较双方士兵组数，差值决定胜负"</span><span class="token punctuation">,</span>
            <span class="token string">"5. 目标: 消灭所有其他国家"</span>
        <span class="token punctuation">]</span>
        
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> text <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>instructions<span class="token punctuation">)</span><span class="token punctuation">:</span>
            rendered <span class="token operator">=</span> FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> WHITE<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>rendered<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> <span class="token number">70</span> <span class="token operator">+</span> i <span class="token operator">*</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制电脑国家信息</span>
        ai_info <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> country <span class="token keyword">in</span> self<span class="token punctuation">.</span>countries<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> country<span class="token punctuation">.</span>is_player <span class="token keyword">and</span> <span class="token keyword">not</span> country<span class="token punctuation">.</span>defeated<span class="token punctuation">:</span>
                ai_info<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>country<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>country<span class="token punctuation">.</span>territory<span class="token punctuation">}</span></span><span class="token string">领土"</span></span><span class="token punctuation">)</span>
        
        ai_text <span class="token operator">=</span> FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">"电脑国家: "</span> <span class="token operator">+</span> <span class="token string">", "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>ai_info<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> YELLOW<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>ai_text<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制游戏结束信息</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>game_over<span class="token punctuation">:</span>
            overlay <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Surface<span class="token punctuation">(</span><span class="token punctuation">(</span>SCREEN_WIDTH<span class="token punctuation">,</span> SCREEN_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">,</span> pygame<span class="token punctuation">.</span>SRCALPHA<span class="token punctuation">)</span>
            overlay<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>overlay<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>winner<span class="token punctuation">.</span>is_player<span class="token punctuation">:</span>
                text <span class="token operator">=</span> LARGE_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">"恭喜！你赢得了战争！"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> GREEN<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                text <span class="token operator">=</span> LARGE_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>winner<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">赢得了战争！"</span></span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>winner<span class="token punctuation">.</span>color<span class="token punctuation">)</span>
            
            restart <span class="token operator">=</span> FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">"按R键重新开始游戏"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> WHITE<span class="token punctuation">)</span>
            
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token punctuation">(</span>SCREEN_WIDTH<span class="token operator">//</span><span class="token number">2</span> <span class="token operator">-</span> text<span class="token punctuation">.</span>get_width<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> SCREEN_HEIGHT<span class="token operator">//</span><span class="token number">2</span> <span class="token operator">-</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>restart<span class="token punctuation">,</span> <span class="token punctuation">(</span>SCREEN_WIDTH<span class="token operator">//</span><span class="token number">2</span> <span class="token operator">-</span> restart<span class="token punctuation">.</span>get_width<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> SCREEN_HEIGHT<span class="token operator">//</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">handle_click</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>game_over<span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        grid_x <span class="token operator">=</span> pos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">//</span> TILE_SIZE
        grid_y <span class="token operator">=</span> pos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">//</span> TILE_SIZE
        
        <span class="token comment"># 确保点击在网格范围内</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;=</span> grid_x <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> grid_y <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        <span class="token comment"># 选择士兵组</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>selected_troop <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>grid_y<span class="token punctuation">]</span><span class="token punctuation">[</span>grid_x<span class="token punctuation">]</span> <span class="token keyword">and</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>grid_y<span class="token punctuation">]</span><span class="token punctuation">[</span>grid_x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token punctuation">[</span>grid_x<span class="token punctuation">,</span> grid_y<span class="token punctuation">]</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>selected_troop <span class="token operator">=</span> <span class="token punctuation">(</span>grid_x<span class="token punctuation">,</span> grid_y<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># 移动士兵组</span>
            selected_x<span class="token punctuation">,</span> selected_y <span class="token operator">=</span> self<span class="token punctuation">.</span>selected_troop
            
            <span class="token comment"># 检查是否相邻</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">abs</span><span class="token punctuation">(</span>grid_x <span class="token operator">-</span> selected_x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>grid_y <span class="token operator">-</span> selected_y<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>move_troop<span class="token punctuation">(</span>selected_x<span class="token punctuation">,</span> selected_y<span class="token punctuation">,</span> grid_x<span class="token punctuation">,</span> grid_y<span class="token punctuation">)</span>
            
            self<span class="token punctuation">.</span>selected_troop <span class="token operator">=</span> <span class="token boolean">None</span>
    
    <span class="token keyword">def</span> <span class="token function">move_troop</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> from_x<span class="token punctuation">,</span> from_y<span class="token punctuation">,</span> to_x<span class="token punctuation">,</span> to_y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 从原位置移除士兵组</span>
        from_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>from_y<span class="token punctuation">]</span><span class="token punctuation">[</span>from_x<span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> from_tile<span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        <span class="token comment"># 找到要移动的士兵组</span>
        troop_to_move <span class="token operator">=</span> <span class="token boolean">None</span>
        <span class="token keyword">for</span> troop <span class="token keyword">in</span> from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> troop <span class="token operator">==</span> <span class="token punctuation">[</span>from_x<span class="token punctuation">,</span> from_y<span class="token punctuation">]</span><span class="token punctuation">:</span>
                troop_to_move <span class="token operator">=</span> troop
                <span class="token keyword">break</span>
        
        <span class="token keyword">if</span> <span class="token keyword">not</span> troop_to_move<span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        <span class="token comment"># 从原位置移除</span>
        from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop_to_move<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop_to_move<span class="token punctuation">)</span>
        
        <span class="token comment"># 添加到新位置</span>
        to_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>to_y<span class="token punctuation">]</span><span class="token punctuation">[</span>to_x<span class="token punctuation">]</span>
        
        <span class="token keyword">if</span> <span class="token keyword">not</span> to_tile<span class="token punctuation">:</span>
            <span class="token comment"># 占领新领土</span>
            self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>to_y<span class="token punctuation">]</span><span class="token punctuation">[</span>to_x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'country'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">,</span>
                <span class="token string">'troops'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>troop_to_move<span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span>troop_to_move<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">:</span>
                <span class="token comment"># 合并到友方领土</span>
                to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>troop_to_move<span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span>troop_to_move<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># 与敌方发生战斗</span>
                self<span class="token punctuation">.</span>resolve_battle<span class="token punctuation">(</span>to_x<span class="token punctuation">,</span> to_y<span class="token punctuation">,</span> troop_to_move<span class="token punctuation">)</span>
        
        <span class="token comment"># 电脑回合</span>
        self<span class="token punctuation">.</span>ai_turn<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 检查游戏是否结束</span>
        self<span class="token punctuation">.</span>check_game_over<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">resolve_battle</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> attacking_troop<span class="token punctuation">)</span><span class="token punctuation">:</span>
        tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span>
        defending_country <span class="token operator">=</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span>
        defending_troops <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        attacking_troops <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment"># 每次只移动一组士兵</span>
        
        <span class="token comment"># 计算战斗结果</span>
        difference <span class="token operator">=</span> attacking_troops <span class="token operator">-</span> defending_troops
        
        <span class="token keyword">if</span> difference <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token comment"># 攻击方胜利</span>
            tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>player_country
            tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>attacking_troop<span class="token punctuation">]</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span>attacking_troop<span class="token punctuation">)</span>
            
            <span class="token comment"># 防御方失去领土</span>
            defending_country<span class="token punctuation">.</span>remove_territory<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># 防御方胜利</span>
            tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token comment"># 移除一个防御方士兵组</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token comment"># 如果防御方没有士兵了，领土变为中立</span>
                tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
                defending_country<span class="token punctuation">.</span>remove_territory<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">ai_turn</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> country <span class="token keyword">in</span> self<span class="token punctuation">.</span>countries<span class="token punctuation">:</span>
            <span class="token keyword">if</span> country<span class="token punctuation">.</span>is_player <span class="token keyword">or</span> country<span class="token punctuation">.</span>defeated<span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            
            <span class="token comment"># 每个电脑国家尝试移动一组士兵</span>
            <span class="token keyword">if</span> country<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                troop <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>country<span class="token punctuation">.</span>troops<span class="token punctuation">)</span>
                x<span class="token punctuation">,</span> y <span class="token operator">=</span> troop
                
                <span class="token comment"># 随机选择一个方向</span>
                directions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
                random<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>directions<span class="token punctuation">)</span>
                
                <span class="token keyword">for</span> dx<span class="token punctuation">,</span> dy <span class="token keyword">in</span> directions<span class="token punctuation">:</span>
                    nx<span class="token punctuation">,</span> ny <span class="token operator">=</span> x <span class="token operator">+</span> dx<span class="token punctuation">,</span> y <span class="token operator">+</span> dy
                    <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> nx <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> ny <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">:</span>
                        self<span class="token punctuation">.</span>ai_move<span class="token punctuation">(</span>country<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> nx<span class="token punctuation">,</span> ny<span class="token punctuation">)</span>
                        <span class="token keyword">break</span>
    
    <span class="token keyword">def</span> <span class="token function">ai_move</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> country<span class="token punctuation">,</span> from_x<span class="token punctuation">,</span> from_y<span class="token punctuation">,</span> to_x<span class="token punctuation">,</span> to_y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 从原位置移除士兵组</span>
        from_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>from_y<span class="token punctuation">]</span><span class="token punctuation">[</span>from_x<span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> from_tile<span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        <span class="token comment"># 找到要移动的士兵组</span>
        troop_to_move <span class="token operator">=</span> <span class="token boolean">None</span>
        <span class="token keyword">for</span> troop <span class="token keyword">in</span> from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> troop <span class="token operator">==</span> <span class="token punctuation">[</span>from_x<span class="token punctuation">,</span> from_y<span class="token punctuation">]</span><span class="token punctuation">:</span>
                troop_to_move <span class="token operator">=</span> troop
                <span class="token keyword">break</span>
        
        <span class="token keyword">if</span> <span class="token keyword">not</span> troop_to_move<span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        <span class="token comment"># 从原位置移除</span>
        from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop_to_move<span class="token punctuation">)</span>
        country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop_to_move<span class="token punctuation">)</span>
        
        <span class="token comment"># 添加到新位置</span>
        to_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>to_y<span class="token punctuation">]</span><span class="token punctuation">[</span>to_x<span class="token punctuation">]</span>
        
        <span class="token keyword">if</span> <span class="token keyword">not</span> to_tile<span class="token punctuation">:</span>
            <span class="token comment"># 占领新领土</span>
            self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>to_y<span class="token punctuation">]</span><span class="token punctuation">[</span>to_x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'country'</span><span class="token punctuation">:</span> country<span class="token punctuation">,</span>
                <span class="token string">'troops'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>troop_to_move<span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
            country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span><span class="token punctuation">)</span>
            country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span>troop_to_move<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> country<span class="token punctuation">:</span>
                <span class="token comment"># 合并到友方领土</span>
                to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>troop_to_move<span class="token punctuation">)</span>
                country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span>troop_to_move<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># 与敌方发生战斗</span>
                defending_country <span class="token operator">=</span> to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span>
                defending_troops <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                attacking_troops <span class="token operator">=</span> <span class="token number">1</span>
                
                difference <span class="token operator">=</span> attacking_troops <span class="token operator">-</span> defending_troops
                
                <span class="token keyword">if</span> difference <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    <span class="token comment"># 攻击方胜利</span>
                    to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> country
                    to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>troop_to_move<span class="token punctuation">]</span>
                    country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span>troop_to_move<span class="token punctuation">)</span>
                    
                    <span class="token comment"># 防御方失去领土</span>
                    <span class="token keyword">if</span> defending_country<span class="token punctuation">:</span>
                        defending_country<span class="token punctuation">.</span>remove_territory<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token comment"># 防御方胜利</span>
                    to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
                    <span class="token keyword">if</span> <span class="token keyword">not</span> to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                        <span class="token comment"># 如果防御方没有士兵了，领土变为中立</span>
                        to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
                        <span class="token keyword">if</span> defending_country<span class="token punctuation">:</span>
                            defending_country<span class="token punctuation">.</span>remove_territory<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">check_game_over</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        active_countries <span class="token operator">=</span> <span class="token punctuation">[</span>c <span class="token keyword">for</span> c <span class="token keyword">in</span> self<span class="token punctuation">.</span>countries <span class="token keyword">if</span> <span class="token keyword">not</span> c<span class="token punctuation">.</span>defeated<span class="token punctuation">]</span>
        
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>active_countries<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>game_over <span class="token operator">=</span> <span class="token boolean">True</span>
            self<span class="token punctuation">.</span>winner <span class="token operator">=</span> active_countries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    
    <span class="token keyword">def</span> <span class="token function">restart_game</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 重置游戏状态</span>
        self<span class="token punctuation">.</span>grid <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token boolean">None</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> country <span class="token keyword">in</span> self<span class="token punctuation">.</span>countries<span class="token punctuation">:</span>
            country<span class="token punctuation">.</span>territory <span class="token operator">=</span> <span class="token number">0</span>
            country<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            country<span class="token punctuation">.</span>next_reward <span class="token operator">=</span> <span class="token number">3</span>
            country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">False</span>
        
        self<span class="token punctuation">.</span>selected_troop <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>game_over <span class="token operator">=</span> <span class="token boolean">False</span>
        self<span class="token punctuation">.</span>winner <span class="token operator">=</span> <span class="token boolean">None</span>
        
        <span class="token comment"># 重新初始化游戏</span>
        self<span class="token punctuation">.</span>initialize_game<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> event <span class="token keyword">in</span> pygame<span class="token punctuation">.</span>event<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> event<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> QUIT<span class="token punctuation">:</span>
                    pygame<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">elif</span> event<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> MOUSEBUTTONDOWN<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> event<span class="token punctuation">.</span>button <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>  <span class="token comment"># 左键点击</span>
                        self<span class="token punctuation">.</span>handle_click<span class="token punctuation">(</span>event<span class="token punctuation">.</span>pos<span class="token punctuation">)</span>
                <span class="token keyword">elif</span> event<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> KEYDOWN<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> event<span class="token punctuation">.</span>key <span class="token operator">==</span> K_r<span class="token punctuation">:</span>  <span class="token comment"># 按R键重新开始</span>
                        self<span class="token punctuation">.</span>restart_game<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            self<span class="token punctuation">.</span>draw_grid<span class="token punctuation">(</span><span class="token punctuation">)</span>
            pygame<span class="token punctuation">.</span>display<span class="token punctuation">.</span>flip<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>clock<span class="token punctuation">.</span>tick<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    game <span class="token operator">=</span> Game<span class="token punctuation">(</span><span class="token punctuation">)</span>
    game<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></div><h2>游戏说明</h2><h3>游戏规则</h3><ol start="1"><li><p class="ds-markdown-paragraph">玩家控制绿色国家，与多个电脑控制的国家争夺领土</p></li><li><p class="ds-markdown-paragraph">每个国家初始占据一个方格，并有一组士兵</p></li><li><p class="ds-markdown-paragraph">玩家通过点击自己的士兵组，然后点击相邻格子来移动士兵</p></li><li><p class="ds-markdown-paragraph">每占领3块领土，玩家会在自己的领土上获得一个新的士兵组</p></li><li><p class="ds-markdown-paragraph">当士兵移动到敌方领土时，会发生战斗：</p><ul><li><p class="ds-markdown-paragraph">比较双方士兵组数（a = 进攻方组数，b = 防守方组数）</p></li><li><p class="ds-markdown-paragraph">如果 a &gt;= b，则进攻方获胜，占领该领土，并留下 (a-b) 组士兵</p></li><li><p class="ds-markdown-paragraph">如果 a &lt; b，则防守方获胜，领土保持不变，留下 (b-a) 组士兵</p></li></ul></li><li><p class="ds-markdown-paragraph">电脑国家也会执行相同的操作来扩张领土</p></li><li><p class="ds-markdown-paragraph">目标：消灭所有其他国家</p></li></ol><h3>操作方法</h3><ul><li><p class="ds-markdown-paragraph">鼠标左键点击自己的士兵组进行选择</p></li><li><p class="ds-markdown-paragraph">然后点击相邻的格子移动士兵</p></li><li><p class="ds-markdown-paragraph">游戏结束后按R键重新开始</p></li></ul><h3>游戏界面</h3><ul><li><p class="ds-markdown-paragraph">顶部网格区域显示游戏地图</p></li><li><p class="ds-markdown-paragraph">底部信息面板显示游戏状态和说明</p></li><li><p class="ds-markdown-paragraph">玩家领土用绿色表示，电脑国家使用其他颜色</p></li><li><p class="ds-markdown-paragraph">白色圆圈内的数字表示该位置上的士兵组数</p></li></ul><p class="ds-markdown-paragraph">游戏开始时，玩家和电脑国家随机分布在地图上。玩家需要谨慎选择移动策略，既要扩张领土，又要保护自己的领土不被敌人占领。</p><p class="ds-markdown-paragraph">祝您游戏愉快！</p></div><div class="ds-flex" style="margin-top: 12px; height: 20px; margin-bottom: 20px; align-items: center; gap: 10px;"><div class="ds-flex _965abe9" style="align-items: center; gap: 16px;"><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px; opacity: 1;"><svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><clippath id="clip1258_20811"><rect id="重新生成" width="20.000000" height="20.000000" fill="white" fill-opacity="0"></rect></clippath></defs><rect id="重新生成" width="20.000000" height="20.000000" fill="#FFFFFF" fill-opacity="0"></rect><g clip-path="url(#clip1258_20811)"><path id="path" d="M17.01 7.63L13.98 7.62C13.88 7.62 13.79 7.6 13.7 7.56C13.62 7.52 13.54 7.47 13.47 7.4C13.4 7.33 13.35 7.25 13.32 7.16C13.28 7.07 13.26 6.98 13.26 6.88C13.26 6.79 13.28 6.69 13.32 6.6C13.35 6.51 13.4 6.43 13.47 6.36C13.54 6.3 13.62 6.24 13.7 6.21C13.79 6.17 13.88 6.15 13.98 6.15L15.57 6.16C15.67 6.16 15.76 6.14 15.85 6.1C15.94 6.06 16.01 6.01 16.08 5.94C16.15 5.87 16.2 5.79 16.23 5.7C16.27 5.61 16.29 5.52 16.29 5.42L16.3 3.89C16.3 3.79 16.32 3.7 16.36 3.61C16.39 3.52 16.44 3.44 16.51 3.37C16.58 3.3 16.66 3.25 16.74 3.21C16.83 3.17 16.92 3.16 17.02 3.16C17.11 3.16 17.2 3.17 17.29 3.21C17.38 3.25 17.46 3.3 17.52 3.37C17.59 3.44 17.64 3.52 17.68 3.61C17.71 3.7 17.73 3.79 17.73 3.89L17.72 6.9C17.72 7 17.71 7.09 17.67 7.18C17.63 7.27 17.58 7.34 17.52 7.41C17.45 7.48 17.37 7.53 17.29 7.57C17.2 7.61 17.11 7.63 17.01 7.63Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path><path id="path" d="M2.31 16.29L2.32 13.3C2.32 13.21 2.34 13.11 2.37 13.02C2.41 12.93 2.46 12.85 2.53 12.78C2.6 12.71 2.67 12.66 2.76 12.62C2.85 12.58 2.94 12.56 3.03 12.56L6.07 12.57C6.16 12.57 6.25 12.59 6.34 12.63C6.43 12.67 6.51 12.72 6.57 12.79C6.64 12.86 6.69 12.94 6.73 13.03C6.76 13.12 6.78 13.22 6.78 13.32C6.78 13.41 6.76 13.51 6.73 13.6C6.69 13.69 6.64 13.77 6.57 13.84C6.51 13.91 6.43 13.96 6.34 14C6.25 14.04 6.16 14.06 6.07 14.06L4.47 14.05C4.38 14.05 4.29 14.07 4.2 14.11C4.11 14.15 4.03 14.2 3.97 14.27C3.9 14.34 3.85 14.42 3.81 14.51C3.78 14.6 3.76 14.7 3.76 14.8L3.75 16.29C3.75 16.39 3.73 16.48 3.69 16.58C3.65 16.67 3.6 16.75 3.54 16.82C3.47 16.89 3.39 16.94 3.3 16.98C3.22 17.01 3.13 17.03 3.03 17.03C2.94 17.03 2.85 17.02 2.76 16.98C2.67 16.94 2.59 16.89 2.52 16.82C2.46 16.75 2.4 16.67 2.37 16.58C2.33 16.49 2.31 16.39 2.31 16.29Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path><path id="path" d="M9.88 18.01C9.51 18.01 9.15 17.99 8.79 17.94C8.42 17.89 8.07 17.82 7.71 17.73C7.36 17.63 7.02 17.51 6.68 17.37C6.34 17.23 6.02 17.07 5.7 16.89C5.39 16.7 5.09 16.5 4.8 16.28C4.52 16.05 4.25 15.81 3.99 15.55C3.74 15.29 3.5 15.02 3.29 14.73C3.07 14.44 2.88 14.13 2.7 13.82L4.15 13.05C4.32 13.35 4.51 13.64 4.72 13.91C4.93 14.18 5.17 14.43 5.42 14.66C5.67 14.9 5.94 15.11 6.23 15.3C6.52 15.49 6.83 15.66 7.14 15.81C7.46 15.95 7.78 16.07 8.12 16.16C8.45 16.25 8.8 16.32 9.14 16.36C9.49 16.39 9.83 16.4 10.18 16.39C10.53 16.37 10.87 16.33 11.22 16.26C11.56 16.19 11.89 16.09 12.21 15.97C12.54 15.84 12.85 15.7 13.15 15.53C13.45 15.35 13.74 15.16 14.01 14.94C14.28 14.72 14.53 14.49 14.76 14.23C14.99 13.97 15.2 13.7 15.38 13.41C15.57 13.12 15.73 12.82 15.87 12.5C16 12.19 16.11 11.87 16.2 11.53C16.28 11.2 16.34 10.87 16.36 10.52C16.37 10.42 16.4 10.33 16.44 10.24C16.48 10.15 16.54 10.07 16.61 10C16.69 9.93 16.77 9.87 16.86 9.84C16.96 9.8 17.05 9.77 17.16 9.77C17.27 9.77 17.38 9.79 17.49 9.83C17.6 9.87 17.7 9.94 17.78 10.02C17.86 10.1 17.92 10.2 17.96 10.3C18 10.41 18.01 10.52 18 10.64C17.98 10.89 17.95 11.13 17.91 11.38C17.86 11.62 17.81 11.87 17.74 12.11C17.68 12.35 17.6 12.58 17.51 12.82C17.42 13.05 17.32 13.28 17.21 13.5C17.1 13.73 16.98 13.95 16.85 14.16C16.71 14.37 16.57 14.58 16.42 14.78C16.27 14.98 16.11 15.17 15.94 15.36C15.77 15.54 15.59 15.72 15.41 15.89C15.22 16.06 15.03 16.22 14.83 16.37C14.63 16.52 14.42 16.66 14.2 16.79C13.99 16.93 13.77 17.05 13.54 17.16C13.31 17.27 13.08 17.37 12.85 17.46C12.61 17.55 12.37 17.63 12.13 17.7C11.88 17.77 11.64 17.83 11.39 17.87C11.14 17.92 10.89 17.96 10.63 17.98C10.38 18 10.13 18.01 9.88 18.01Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path><path id="path" d="M2.85 10.27C2.73 10.28 2.62 10.26 2.51 10.22C2.4 10.17 2.31 10.11 2.23 10.03C2.14 9.95 2.08 9.85 2.04 9.74C2 9.63 1.99 9.52 2 9.41C2.03 8.98 2.1 8.56 2.2 8.15C2.3 7.73 2.43 7.33 2.6 6.94C2.76 6.54 2.96 6.16 3.19 5.8C3.41 5.44 3.67 5.1 3.95 4.77C4.24 4.45 4.54 4.15 4.88 3.88C5.21 3.6 5.56 3.35 5.93 3.13C6.3 2.91 6.69 2.73 7.09 2.57C7.5 2.41 7.91 2.28 8.33 2.19C8.75 2.09 9.18 2.03 9.62 2.01C10.05 1.98 10.48 1.99 10.91 2.03C11.35 2.07 11.77 2.14 12.19 2.25C12.61 2.36 13.02 2.5 13.42 2.67C13.81 2.84 14.19 3.04 14.56 3.28C14.92 3.51 15.27 3.77 15.59 4.05C15.91 4.34 16.21 4.64 16.48 4.98C16.75 5.31 17 5.66 17.21 6.03L15.78 6.83C15.61 6.54 15.42 6.25 15.2 5.99C14.98 5.73 14.74 5.48 14.49 5.25C14.23 5.02 13.96 4.82 13.66 4.63C13.37 4.45 13.07 4.29 12.75 4.15C12.44 4.01 12.11 3.9 11.77 3.82C11.44 3.73 11.1 3.67 10.76 3.64C10.41 3.61 10.07 3.6 9.72 3.62C9.37 3.64 9.03 3.69 8.69 3.77C8.36 3.84 8.03 3.94 7.71 4.07C7.38 4.2 7.08 4.35 6.78 4.52C6.48 4.7 6.2 4.89 5.94 5.11C5.67 5.33 5.43 5.57 5.2 5.83C4.97 6.08 4.77 6.36 4.59 6.65C4.41 6.94 4.25 7.24 4.12 7.55C3.98 7.87 3.88 8.19 3.8 8.52C3.72 8.85 3.66 9.19 3.64 9.53C3.63 9.62 3.6 9.72 3.56 9.81C3.52 9.9 3.46 9.98 3.39 10.05C3.32 10.12 3.23 10.17 3.14 10.21C3.05 10.25 2.95 10.27 2.85 10.27Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path></g></svg></div></div><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M18.14 9.428l-.003.019L17.114 15a3.774 3.774 0 0 1-1.313 2.27 3.673 3.673 0 0 1-2.438.894H3.895c-.57 0-1.055-.205-1.458-.614a2.033 2.033 0 0 1-.604-1.48v-5.438c0-.578.201-1.071.604-1.48.402-.41.888-.614 1.458-.614h1.932l2.317-5.293c.24-.548.6-.948 1.083-1.2.599-.312 1.156-.278 1.672.103.782.577 1.172 1.355 1.172 2.334V6.997h3.994c.638-.007 1.167.235 1.588.726.421.492.584 1.06.488 1.705zm-2.076-2.6c.686-.007 1.262.256 1.714.785.453.529.63 1.146.527 1.84v.004l-.005.02v.003l-1.022 5.552a3.943 3.943 0 0 1-1.37 2.368 3.838 3.838 0 0 1-2.545.933H3.895a2.137 2.137 0 0 1-1.576-.663 2.203 2.203 0 0 1-.652-1.6v-5.437c0-.622.218-1.159.652-1.6.434-.44.962-.663 1.576-.663H5.72l2.273-5.192c.254-.58.64-1.01 1.159-1.282.32-.167.64-.246.953-.227.315.02.613.137.893.344.824.608 1.24 1.437 1.24 2.47v2.345h3.827zM9.741 3.063c-.247.128-.437.344-.57.647L6.708 9.34v7.683h6.655a2.59 2.59 0 0 0 1.72-.63c.498-.42.807-.955.926-1.601l1.02-5.544a.936.936 0 0 0-.225-.773.917.917 0 0 0-.739-.335h-4.557a.567.567 0 0 1-.562-.571V4.483c0-.591-.236-1.061-.708-1.41-.143-.105-.309-.109-.497-.01zm7.124 6.157a.766.766 0 0 0-.186-.636.753.753 0 0 0-.612-.276h-4.559a.734.734 0 0 1-.728-.74V4.483c0-.537-.21-.956-.64-1.273a.233.233 0 0 0-.137-.05.387.387 0 0 0-.185.053c-.208.108-.374.291-.495.566m0 0L6.874 9.375v7.479h6.489c.609 0 1.145-.197 1.614-.592.468-.396.757-.894.869-1.502l1.02-5.54M3.35 16.623c.152.155.33.23.545.23h1.522V9.85H3.895a.732.732 0 0 0-.545.23.755.755 0 0 0-.226.553v5.437c0 .218.074.4.226.553zm.545-6.941a.897.897 0 0 0-.663.278.924.924 0 0 0-.274.673v5.437c0 .263.091.487.274.673.183.186.404.28.663.28h1.688V9.681H3.895z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M18.137 9.447l.004-.02a2.044 2.044 0 0 0-.488-1.704c-.421-.491-.95-.733-1.588-.726h-2.282l1.584 1.142h.698a.917.917 0 0 1 .739.335.936.936 0 0 1 .225.773l-1.02 5.543a2.663 2.663 0 0 1-.926 1.602 2.59 2.59 0 0 1-1.72.63H6.708V9.34L9.171 3.71c.133-.303.323-.519.57-.647.188-.099.354-.095.497.01.472.349.708.819.708 1.41v.467l1.125.811V4.483c0-.98-.39-1.757-1.171-2.334-.517-.38-1.074-.415-1.673-.103-.482.252-.843.652-1.083 1.2L5.827 8.54H3.895c-.57 0-1.056.205-1.458.614a2.033 2.033 0 0 0-.604 1.48v5.437c0 .578.201 1.072.604 1.48.403.41.889.615 1.458.615h9.468c.918 0 1.731-.299 2.438-.895A3.774 3.774 0 0 0 17.114 15l1.023-5.553zm-14.242.235a.897.897 0 0 0-.663.278.924.924 0 0 0-.274.673v5.437c0 .263.091.487.274.673.183.186.404.28.663.28h1.688V9.681H3.895z" fill="currentColor"></path><path d="M10.946 7.568c0 .316.252.571.563.571h3.858l-1.584-1.142h-1.712V5.76l-1.125-.811v2.618z" fill="currentColor"></path></svg></div></div><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M18.304 10.543v.004a2.214 2.214 0 0 1-.526 1.84c-.452.528-1.028.792-1.714.784h-3.827v2.345c0 1.034-.416 1.863-1.24 2.471-.28.207-.578.324-.893.343-.314.02-.632-.06-.953-.226-.519-.271-.905-.702-1.159-1.282l-2.273-5.193H3.895a2.136 2.136 0 0 1-1.576-.663 2.203 2.203 0 0 1-.652-1.6V3.93c0-.623.218-1.16.652-1.6.434-.441.963-.663 1.576-.663h9.468c.957 0 1.807.311 2.544.933a3.943 3.943 0 0 1 1.37 2.368L18.3 10.52v.002l.004.02zm-1.19-5.544a3.774 3.774 0 0 0-1.313-2.27 3.673 3.673 0 0 0-2.438-.894H3.895c-.57 0-1.055.205-1.458.614a2.033 2.033 0 0 0-.604 1.48v5.437c0 .578.201 1.072.604 1.48.402.41.888.615 1.458.615h1.932l2.317 5.292c.24.549.6.949 1.083 1.2.599.313 1.156.279 1.672-.102.782-.577 1.172-1.355 1.172-2.335v-2.513h3.994c.638.007 1.167-.235 1.588-.727.421-.491.584-1.06.488-1.704l-.004-.02L17.114 5zM9.819 16.787c.076.04.137.053.185.052a.233.233 0 0 0 .137-.05c.43-.316.64-.735.64-1.273v-3.084c0-.41.327-.74.729-.74h4.558a.752.752 0 0 0 .612-.277.766.766 0 0 0 .186-.635l-1.02-5.54a2.495 2.495 0 0 0-.869-1.502 2.426 2.426 0 0 0-1.613-.592H6.874v7.48l2.449 5.595m-2.615-5.56V2.978h6.655c.648 0 1.221.21 1.72.63.498.42.807.954.926 1.601l1.02 5.543a.936.936 0 0 1-.225.774.917.917 0 0 1-.739.335h-4.557a.567.567 0 0 0-.562.57v3.085c0 .592-.236 1.062-.708 1.41-.143.106-.309.11-.497.01-.247-.128-.437-.343-.57-.647l-2.463-5.628zM3.35 3.376a.754.754 0 0 0-.226.554v5.436c0 .218.074.4.226.554.152.154.33.23.545.23h1.522V3.146H3.895a.731.731 0 0 0-.545.23zm2.233-.398v7.34H3.895a.897.897 0 0 1-.663-.279.925.925 0 0 1-.274-.673V3.93c0-.263.091-.487.274-.673a.895.895 0 0 1 .663-.28h1.688zm4.235 13.809c-.208-.108-.375-.292-.495-.566l.495.566z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M15.801 2.73a3.774 3.774 0 0 1 1.313 2.269l1.023 5.554.004.019a2.044 2.044 0 0 1-.488 1.704c-.421.492-.95.734-1.588.727h-3.994v2.513c0 .98-.39 1.758-1.171 2.335-.517.38-1.074.415-1.673.102-.482-.251-.843-.651-1.083-1.2l-2.317-5.292H3.895c-.57 0-1.056-.205-1.458-.614a2.033 2.033 0 0 1-.604-1.48V3.93c0-.579.201-1.072.604-1.481.403-.41.889-.614 1.458-.614h9.468c.918 0 1.731.298 2.438.894zm-2.438.248c.648 0 1.221.21 1.72.63.498.42.807.954.926 1.601l1.02 5.543a.936.936 0 0 1-.225.774.917.917 0 0 1-.739.335h-4.557a.567.567 0 0 0-.562.57v3.085c0 .592-.236 1.062-.708 1.41-.143.106-.309.11-.497.01-.247-.128-.437-.343-.57-.647l-2.463-5.628V2.978h6.655zm-9.468 7.34a.897.897 0 0 1-.663-.279.925.925 0 0 1-.274-.673V3.93c0-.263.091-.487.274-.673a.895.895 0 0 1 .663-.28h1.688v7.341H3.895z" fill="currentColor"></path></svg></div></div></div><div style="flex: 1 1 0%;"></div></div></div><div class="_9663006"><div class="fbb737a4">请你检查一下程序，我在试玩过后发现如下问题：
1.不同国家出现同样颜色的方格
2.在第一次士兵组移动过后，士兵组就无法被选中并移动</div><div class="e13328ad _3a26104"><div class="_425ea0b"><div class="ds-flex _78e0558" style="align-items: flex-end; gap: 0px;"><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px; margin-left: 14px; opacity: 1;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.712 2.79a1.854 1.854 0 0 1 2.623 0l1.673 1.672a1.854 1.854 0 0 1 0 2.623l-9.714 9.714a2.91 2.91 0 0 1-2.058.853H1.945a.8.8 0 0 1-.8-.8v-2.29c0-.773.307-1.513.853-2.058l9.714-9.715zm1.492 1.13c-.1-.1-.261-.1-.361 0l-1.327 1.326 2.035 2.035 1.327-1.326c.1-.1.1-.262 0-.362L13.204 3.92zm-.783 4.491l-2.035-2.034-7.258 7.257a1.31 1.31 0 0 0-.384.927v1.492h1.492c.348 0 .681-.138.927-.384l7.258-7.258z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M17.772 17.608c.35 0 .633-.283.633-.633v-.492a.633.633 0 0 0-.633-.633H9.858L8.1 17.608h9.672z" fill="currentColor"></path></svg></div></div></div></div></div></div><div class="_4f9bf79 _43c05b5"><div class="_7eb2358 _58dfa60"><svg viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path id="path" d="M27.501 8.46875C27.249 8.3457 27.1406 8.58008 26.9932 8.69922C26.9434 8.73828 26.9004 8.78906 26.8584 8.83398C26.4902 9.22852 26.0605 9.48633 25.5 9.45508C24.6787 9.41016 23.9785 9.66797 23.3594 10.2969C23.2275 9.52148 22.79 9.05859 22.125 8.76172C21.7764 8.60742 21.4238 8.45312 21.1807 8.11719C21.0098 7.87891 20.9639 7.61328 20.8779 7.35156C20.8242 7.19336 20.7695 7.03125 20.5879 7.00391C20.3906 6.97266 20.3135 7.13867 20.2363 7.27734C19.9258 7.84375 19.8066 8.46875 19.8174 9.10156C19.8447 10.5234 20.4453 11.6562 21.6367 12.4629C21.7725 12.5547 21.8076 12.6484 21.7646 12.7832C21.6836 13.0605 21.5869 13.3301 21.501 13.6074C21.4473 13.7852 21.3662 13.8242 21.1768 13.7461C20.5225 13.4727 19.957 13.0684 19.458 12.5781C18.6104 11.7578 17.8438 10.8516 16.8877 10.1426C16.6631 9.97656 16.4395 9.82227 16.207 9.67578C15.2314 8.72656 16.335 7.94727 16.5898 7.85547C16.8574 7.75977 16.6826 7.42773 15.8193 7.43164C14.957 7.43555 14.167 7.72461 13.1611 8.10938C13.0137 8.16797 12.8594 8.21094 12.7002 8.24414C11.7871 8.07227 10.8389 8.0332 9.84766 8.14453C7.98242 8.35352 6.49219 9.23633 5.39648 10.7441C4.08105 12.5547 3.77148 14.6133 4.15039 16.7617C4.54883 19.0234 5.70215 20.8984 7.47559 22.3633C9.31348 23.8809 11.4307 24.625 13.8457 24.4824C15.3125 24.3984 16.9463 24.2012 18.7881 22.6406C19.2529 22.8711 19.7402 22.9629 20.5498 23.0332C21.1729 23.0918 21.7725 23.002 22.2373 22.9062C22.9648 22.752 22.9141 22.0781 22.6514 21.9531C20.5186 20.959 20.9863 21.3633 20.5605 21.0371C21.6445 19.752 23.2783 18.418 23.917 14.0977C23.9668 13.7539 23.9238 13.5391 23.917 13.2598C23.9131 13.0918 23.9512 13.0254 24.1445 13.0059C24.6787 12.9453 25.1973 12.7988 25.6738 12.5352C27.0557 11.7793 27.6123 10.5391 27.7441 9.05078C27.7637 8.82422 27.7402 8.58789 27.501 8.46875ZM15.46 21.8613C13.3926 20.2344 12.3906 19.6992 11.9766 19.7227C11.5898 19.7441 11.6592 20.1875 11.7441 20.4766C11.833 20.7617 11.9492 20.959 12.1123 21.209C12.2246 21.375 12.3018 21.623 12 21.8066C11.334 22.2207 10.1768 21.668 10.1221 21.6406C8.77539 20.8477 7.64941 19.7988 6.85547 18.3652C6.08984 16.9844 5.64453 15.5039 5.57129 13.9238C5.55176 13.541 5.66406 13.4062 6.04297 13.3379C6.54199 13.2461 7.05762 13.2266 7.55664 13.2988C9.66602 13.6074 11.4619 14.5527 12.9668 16.0469C13.8262 16.9004 14.4766 17.918 15.1465 18.9121C15.8584 19.9688 16.625 20.9746 17.6006 21.7988C17.9443 22.0879 18.2197 22.3086 18.4824 22.4707C17.6895 22.5586 16.3652 22.5781 15.46 21.8613ZM16.4502 15.4805C16.4502 15.3105 16.5859 15.1758 16.7568 15.1758C16.7949 15.1758 16.8301 15.1836 16.8613 15.1953C16.9033 15.2109 16.9424 15.2344 16.9727 15.2695C17.0273 15.3223 17.0586 15.4004 17.0586 15.4805C17.0586 15.6504 16.9229 15.7852 16.7529 15.7852C16.582 15.7852 16.4502 15.6504 16.4502 15.4805ZM19.5273 17.0625C19.3301 17.1426 19.1328 17.2129 18.9434 17.2207C18.6494 17.2344 18.3281 17.1152 18.1533 16.9688C17.8828 16.7422 17.6895 16.6152 17.6074 16.2168C17.5732 16.0469 17.5928 15.7852 17.623 15.6348C17.6934 15.3105 17.6152 15.1035 17.3877 14.9141C17.2012 14.7598 16.9658 14.7188 16.7061 14.7188C16.6094 14.7188 16.5205 14.6758 16.4541 14.6406C16.3457 14.5859 16.2568 14.4512 16.3418 14.2852C16.3691 14.2324 16.501 14.1016 16.5322 14.0781C16.8838 13.877 17.29 13.9434 17.666 14.0938C18.0146 14.2363 18.2773 14.498 18.6562 14.8672C19.0439 15.3145 19.1133 15.4395 19.334 15.7734C19.5078 16.0371 19.667 16.3066 19.7754 16.6152C19.8408 16.8066 19.7559 16.9648 19.5273 17.0625Z" fill-rule="nonzero" fill="#4D6BFE"></path></svg></div><div class="_48edb25"><div class="_58a6d71 _19db599"><div class="ds-icon _7580acb" style="font-size: 12px; width: 12px; height: 12px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2.656 17.344c-1.016-1.015-1.15-2.75-.313-4.925.325-.825.73-1.617 1.205-2.365L3.582 10l-.033-.054c-.5-.799-.91-1.596-1.206-2.365-.836-2.175-.703-3.91.313-4.926.56-.56 1.364-.86 2.335-.86 1.425 0 3.168.636 4.957 1.756l.053.034.053-.034c1.79-1.12 3.532-1.757 4.957-1.757.972 0 1.776.3 2.335.86 1.014 1.015 1.148 2.752.312 4.926a13.892 13.892 0 0 1-1.206 2.365l-.034.054.034.053c.5.8.91 1.596 1.205 2.365.837 2.175.704 3.911-.311 4.926-.56.56-1.364.861-2.335.861-1.425 0-3.168-.637-4.957-1.757L10 16.415l-.053.033c-1.79 1.12-3.532 1.757-4.957 1.757-.972 0-1.776-.3-2.335-.86zm13.631-4.399c-.187-.488-.429-.988-.71-1.492l-.075-.132-.092.12a22.075 22.075 0 0 1-3.968 3.968l-.12.093.132.074c1.308.734 2.559 1.162 3.556 1.162.563 0 1.006-.138 1.298-.43.3-.3.436-.774.428-1.346-.008-.575-.159-1.264-.449-2.017zm-6.345 1.65l.058.042.058-.042a19.881 19.881 0 0 0 4.551-4.537l.043-.058-.043-.058a20.123 20.123 0 0 0-2.093-2.458 19.732 19.732 0 0 0-2.458-2.08L10 5.364l-.058.042A19.883 19.883 0 0 0 5.39 9.942L5.348 10l.042.059c.631.874 1.332 1.695 2.094 2.457a19.74 19.74 0 0 0 2.458 2.08zm6.366-10.902c-.293-.293-.736-.431-1.298-.431-.998 0-2.248.429-3.556 1.163l-.132.074.12.092a21.938 21.938 0 0 1 3.968 3.968l.092.12.074-.132c.282-.504.524-1.004.711-1.492.29-.753.442-1.442.45-2.017.007-.572-.129-1.045-.429-1.345zM3.712 7.055c.202.514.44 1.013.712 1.493l.074.13.092-.119a21.94 21.94 0 0 1 3.968-3.968l.12-.092-.132-.074C7.238 3.69 5.987 3.262 4.99 3.262c-.563 0-1.006.138-1.298.43-.3.301-.436.774-.428 1.346.007.575.159 1.264.448 2.017zm0 5.89c-.29.753-.44 1.442-.448 2.017-.008.572.127 1.045.428 1.345.293.293.736.431 1.298.431.997 0 2.247-.428 3.556-1.162l.131-.074-.12-.093a21.94 21.94 0 0 1-3.967-3.968l-.093-.12-.074.132a11.712 11.712 0 0 0-.71 1.492z" fill="currentColor" stroke="currentColor" stroke-width=".1"></path><path d="M10.706 11.704A1.843 1.843 0 0 1 8.155 10a1.845 1.845 0 1 1 2.551 1.704z" fill="currentColor" stroke="currentColor" stroke-width=".2"></path></svg></div>已深度思考（用时 73 秒）<div class="ds-icon _54f4262" style="font-size: 10px; width: 10px; height: 10px; transform: rotate(180deg);"><svg width="10" height="6" viewBox="0 0 10 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5.786 4.167L2.765 1.259c-.416-.4-.985-.482-1.273-.183-.287.298-.183.864.233 1.264l3.021 2.908c.416.4.986.482 1.273.184.287-.299.183-.865-.233-1.265z" fill="currentColor"></path><path d="M8.197 1.206L5.288 4.208c-.4.413-.484.982-.187 1.27.298.289.864.187 1.265-.227L9.274 2.25c.401-.414.485-.983.187-1.271-.297-.288-.863-.187-1.264.227z" fill="currentColor"></path></svg></div></div><div class="e1675d8b"><div class="_9ecc93a"></div>我们发现了两个问题：<div style="height: 6px;"></div>1. 不同国家出现同样颜色的方格：这是因为我们在为电脑国家选择颜色时，使用了COLORS[i+1]，但是COLORS只有6种颜色，而我们有5个电脑国家，加上玩家一共6个国家，所以颜色是足够的。但是问题可能在于颜色列表索引错误，或者国家初始化时颜色分配重复。<div style="height: 6px;"></div>   实际上，我们的COLORS列表有6种颜色（索引0-5），玩家使用了GREEN（即COLORS[1]？），然后电脑国家从COLORS[1]开始取，这样就会跳过第一个红色，并且可能重复。<div style="height: 6px;"></div>   修改：我们让玩家使用COLORS[0]（绿色），然后电脑国家从COLORS[1]到COLORS[5]取，这样就不会重复。<div style="height: 6px;"></div><div style="height: 6px;"></div>2. 在第一次士兵组移动过后，士兵组就无法被选中并移动：原因在于移动士兵组后，士兵组的位置发生了变化，但是我们在选择士兵组时，是根据点击的网格位置上的士兵组是否属于玩家，并且该位置是否有一个士兵组（其坐标等于该网格位置）。但是移动后，士兵组的坐标已经更新到新的位置，而原来的位置可能还有士兵组（如果原来位置有多个士兵组）或者没有了。而且，我们在移动士兵组时，将士兵组从原位置移除并添加到新位置，同时更新了玩家国家的troops列表（从troops列表中移除旧位置，添加新位置）。但是在选择士兵组时，我们检查的是当前点击的网格位置是否有一个士兵组，其坐标等于这个网格位置。但是，当士兵组移动后，原位置可能还有其他的士兵组（因为一个格子可以有多个士兵组），所以原位置可能仍然有士兵组，但移动的那个士兵组已经不在那里了。<div style="height: 6px;"></div><div style="height: 6px;"></div>   具体问题出现在选择士兵组的条件：<div style="height: 6px;"></div>   if self.grid[grid_y][grid_x] and self.grid[grid_y][grid_x]['country'] == self.player_country:<div style="height: 6px;"></div>        if [grid_x, grid_y] in self.player_country.troops:   &lt;--- 这里检查的是这个坐标是否在troops列表中<div style="height: 6px;"></div><div style="height: 6px;"></div>   但是，当我们移动一个士兵组后，这个士兵组的坐标已经更新到新的位置，所以旧位置不再在troops列表中（除非那里还有其他的士兵组）。而新位置上的士兵组，其坐标是新的，所以我们可以通过点击新位置来选中它。<div style="height: 6px;"></div><div style="height: 6px;"></div>   然而，问题在于：当我们移动一个士兵组后，它到达了一个新的格子，这个格子可能原本就有多个士兵组（比如合并的情况），那么新格子上就有多个士兵组，但是我们的troops列表里每个士兵组都是以其所在位置存储的。所以，当我们点击这个新格子时，我们检查的是这个格子上所有士兵组中，有没有一个士兵组的坐标等于当前格子的坐标？注意，每个士兵组的坐标都是它当前所在的位置，所以新格子上的每个士兵组的坐标都是这个新位置。因此，我们可以选中这个新格子上的任意一个士兵组（实际上，我们无法区分同一个格子上的不同士兵组，因为它们在同一个格子上，坐标相同）。<div style="height: 6px;"></div><div style="height: 6px;"></div>   但是，为什么第一次移动后，士兵组就无法被选中？可能的原因是在移动后，我们并没有正确更新士兵组的位置。让我们检查移动士兵组的代码：<div style="height: 6px;"></div><div style="height: 6px;"></div>   在移动士兵组时，我们做了：<div style="height: 6px;"></div>   - 从原位置的troops列表中移除这个士兵组（troop_to_move，即[from_x, from_y]）<div style="height: 6px;"></div>   - 从玩家国家的troops列表中移除这个士兵组（troop_to_move，即[from_x, from_y]）<div style="height: 6px;"></div>   - 然后，我们将这个士兵组的坐标更新了吗？注意，troop_to_move是一个列表，我们直接修改了它的内容了吗？<div style="height: 6px;"></div><div style="height: 6px;"></div>   实际上，我们并没有修改troop_to_move的坐标。我们只是将它从原位置移除，然后添加到新位置。但是，troop_to_move这个列表还是[from_x, from_y]（即旧坐标）。然后我们把它添加到新位置的troops列表和玩家国家的troops列表时，它仍然是旧坐标。这显然是不对的。<div style="height: 6px;"></div><div style="height: 6px;"></div>   所以，我们需要在移动士兵组时，更新士兵组的坐标为新的位置。<div style="height: 6px;"></div><div style="height: 6px;"></div>   修改：<div style="height: 6px;"></div>        troop_to_move[0] = to_x<div style="height: 6px;"></div>        troop_to_move[1] = to_y<div style="height: 6px;"></div><div style="height: 6px;"></div>   这样，士兵组的坐标就更新了。<div style="height: 6px;"></div><div style="height: 6px;"></div>   另外，在移动士兵组时，我们添加到新位置和玩家国家troops列表的士兵组应该是更新坐标后的。<div style="height: 6px;"></div><div style="height: 6px;"></div>   因此，在移动函数中，在确定移动后，我们应该更新士兵组的坐标。<div style="height: 6px;"></div><div style="height: 6px;"></div>   同时注意：在移动士兵组时，我们可能犯了一个错误：在移动士兵组到新位置时，我们只是简单地将士兵组（旧坐标）添加到新位置。但是新位置上的士兵组应该用新的坐标表示。所以，在移动士兵组后，我们必须更新这个士兵组的坐标。<div style="height: 6px;"></div><div style="height: 6px;"></div>   修改步骤：<div style="height: 6px;"></div>       在移动士兵组的函数move_troop中，在从原位置移除士兵组后，我们更新士兵组的坐标为(to_x, to_y)，然后再添加到新位置和玩家国家的troops列表。<div style="height: 6px;"></div><div style="height: 6px;"></div>   但是注意：在战斗解决函数resolve_battle中，我们也有类似的移动操作，同样需要更新士兵组的坐标。<div style="height: 6px;"></div><div style="height: 6px;"></div>   因此，我们在move_troop函数中，在移除士兵组后，添加：<div style="height: 6px;"></div>        troop_to_move[0] = to_x<div style="height: 6px;"></div>        troop_to_move[1] = to_y<div style="height: 6px;"></div><div style="height: 6px;"></div>   这样，士兵组的位置就更新了。<div style="height: 6px;"></div><div style="height: 6px;"></div>   同时，在ai_move函数中，同样需要更新士兵组的坐标。<div style="height: 6px;"></div><div style="height: 6px;"></div>   我们修改ai_move函数，在从原位置移除士兵组后，添加：<div style="height: 6px;"></div>        troop_to_move[0] = to_x<div style="height: 6px;"></div>        troop_to_move[1] = to_y<div style="height: 6px;"></div><div style="height: 6px;"></div>   这样，电脑移动士兵组后，士兵组的坐标也会更新。<div style="height: 6px;"></div><div style="height: 6px;"></div>   这样，当我们点击士兵组的新位置时，就可以选中它了。<div style="height: 6px;"></div><div style="height: 6px;"></div>总结修改：<div style="height: 6px;"></div>1. 颜色问题：调整国家颜色分配，确保每个国家颜色唯一。<div style="height: 6px;"></div>   - 玩家国家使用COLORS[0]（绿色），然后电脑国家依次使用COLORS[1]到COLORS[5]<div style="height: 6px;"></div>   - 注意，我们之前创建玩家国家时是直接使用GREEN（即(80,255,80)），而COLORS[0]是RED。所以我们需要统一使用COLORS列表。<div style="height: 6px;"></div><div style="height: 6px;"></div>   修改：将玩家国家的颜色改为COLORS[0]（我们定义COLORS[0]为绿色？）但是我们的COLORS列表第一个是红色。所以调整COLORS列表，让第一个颜色是绿色。<div style="height: 6px;"></div><div style="height: 6px;"></div>   或者，我们重新定义COLORS，把绿色放在第一个？但是为了保持玩家是绿色，我们可以将COLORS的第一个设为绿色。<div style="height: 6px;"></div><div style="height: 6px;"></div>   修改COLORS列表：<div style="height: 6px;"></div>        COLORS = [GREEN, RED, BLUE, YELLOW, PURPLE, CYAN]<div style="height: 6px;"></div><div style="height: 6px;"></div>   这样，玩家国家使用COLORS[0]（绿色），电脑国家使用COLORS[1]到COLORS[5]。<div style="height: 6px;"></div><div style="height: 6px;"></div>2. 士兵组移动后无法选中的问题：在移动士兵组时，更新士兵组的坐标为新的位置。<div style="height: 6px;"></div><div style="height: 6px;"></div>   在move_troop函数中，在从原位置和玩家国家troops列表中移除士兵组后，添加：<div style="height: 6px;"></div>        troop_to_move[0] = to_x<div style="height: 6px;"></div>        troop_to_move[1] = to_y<div style="height: 6px;"></div><div style="height: 6px;"></div>   同样，在ai_move函数中，在从原位置和电脑国家troops列表中移除士兵组后，添加：<div style="height: 6px;"></div>        troop_to_move[0] = to_x<div style="height: 6px;"></div>        troop_to_move[1] = to_y<div style="height: 6px;"></div><div style="height: 6px;"></div>   这样，士兵组的位置就更新了，然后我们再将这个士兵组添加到新位置和国家的troops列表（此时坐标已经是新的了）。<div style="height: 6px;"></div><div style="height: 6px;"></div>   注意：在移动士兵组时，我们可能会将士兵组移动到一个已经有士兵组的格子（合并），这时我们只是将士兵组添加到该格子的士兵组列表中，并且更新坐标，这样这个士兵组就会显示在新的位置。<div style="height: 6px;"></div><div style="height: 6px;"></div>   另外，在战斗解决后，我们也要注意士兵组的位置更新（在resolve_battle和ai_move的战斗部分，我们已经通过移动函数更新了）。<div style="height: 6px;"></div><div style="height: 6px;"></div>   因此，我们主要修改两点：颜色分配和士兵组坐标更新。<div style="height: 6px;"></div><div style="height: 6px;"></div>下面我们修改代码：</div></div><div class="ds-markdown ds-markdown--block" style="--ds-md-zoom: 1.143;"><p class="ds-markdown-paragraph">我检查了程序并发现了两个主要问题。让我修复这些问题并提供一个改进版本：</p><h3>问题1：不同国家出现相同颜色</h3><ul><li><p class="ds-markdown-paragraph">原因：颜色列表索引错误，导致多个国家共享相同颜色</p></li><li><p class="ds-markdown-paragraph">修复：正确分配颜色索引，确保每个国家有唯一颜色</p></li></ul><h3>问题2：士兵组移动后无法选中</h3><ul><li><p class="ds-markdown-paragraph">原因：移动士兵组后未更新其坐标位置</p></li><li><p class="ds-markdown-paragraph">修复：在移动士兵组时更新其坐标位置</p></li></ul><p class="ds-markdown-paragraph">以下是修复后的完整代码：</p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre><span class="token keyword">import</span> pygame
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> random
<span class="token keyword">import</span> math
<span class="token keyword">from</span> pygame<span class="token punctuation">.</span><span class="token builtin">locals</span> <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token comment"># 初始化pygame</span>
pygame<span class="token punctuation">.</span>init<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 游戏常量</span>
SCREEN_WIDTH <span class="token operator">=</span> <span class="token number">1000</span>
SCREEN_HEIGHT <span class="token operator">=</span> <span class="token number">700</span>
GRID_SIZE <span class="token operator">=</span> <span class="token number">20</span>
GRID_WIDTH <span class="token operator">=</span> <span class="token number">40</span>
GRID_HEIGHT <span class="token operator">=</span> <span class="token number">30</span>
TILE_SIZE <span class="token operator">=</span> <span class="token number">20</span>
FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span>
LARGE_FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span>

<span class="token comment"># 颜色</span>
BACKGROUND <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
GRID_COLOR <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
WHITE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
BLACK <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
RED <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
GREEN <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
BLUE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
YELLOW <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
PURPLE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
CYAN <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
ORANGE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">165</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
PINK <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span>
COLORS <span class="token operator">=</span> <span class="token punctuation">[</span>RED<span class="token punctuation">,</span> BLUE<span class="token punctuation">,</span> YELLOW<span class="token punctuation">,</span> PURPLE<span class="token punctuation">,</span> CYAN<span class="token punctuation">,</span> ORANGE<span class="token punctuation">,</span> PINK<span class="token punctuation">]</span>  <span class="token comment"># 增加更多颜色</span>
HIGHLIGHT <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Country</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> color<span class="token punctuation">,</span> name<span class="token punctuation">,</span> is_player<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>color <span class="token operator">=</span> color
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>is_player <span class="token operator">=</span> is_player
        self<span class="token punctuation">.</span>territory <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># 存储士兵组的位置坐标</span>
        self<span class="token punctuation">.</span>next_reward <span class="token operator">=</span> <span class="token number">3</span>
        self<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">add_territory</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>territory <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token comment"># 每占领3块领土获得一个新的士兵组</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>territory <span class="token operator">&gt;=</span> self<span class="token punctuation">.</span>next_reward<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>next_reward <span class="token operator">+=</span> <span class="token number">3</span>
            <span class="token comment"># 在随机领土上生成新士兵组</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                <span class="token comment"># 从现有领土中随机选择一个位置</span>
                valid_positions <span class="token operator">=</span> <span class="token punctuation">[</span>pos <span class="token keyword">for</span> pos <span class="token keyword">in</span> self<span class="token punctuation">.</span>troops <span class="token keyword">if</span> self<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>count<span class="token punctuation">(</span>pos<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">]</span>
                <span class="token keyword">if</span> valid_positions<span class="token punctuation">:</span>
                    random_troop <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>valid_positions<span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>random_troop<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> random_troop<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">remove_territory</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>territory <span class="token operator">-=</span> <span class="token number">1</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>territory <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">True</span>

<span class="token keyword">class</span> <span class="token class-name">Game</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>screen <span class="token operator">=</span> pygame<span class="token punctuation">.</span>display<span class="token punctuation">.</span>set_mode<span class="token punctuation">(</span><span class="token punctuation">(</span>SCREEN_WIDTH<span class="token punctuation">,</span> SCREEN_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">)</span>
        pygame<span class="token punctuation">.</span>display<span class="token punctuation">.</span>set_caption<span class="token punctuation">(</span><span class="token string">"领土征服者"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>clock <span class="token operator">=</span> pygame<span class="token punctuation">.</span>time<span class="token punctuation">.</span>Clock<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 创建国家</span>
        self<span class="token punctuation">.</span>countries <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>player_country <span class="token operator">=</span> Country<span class="token punctuation">(</span>GREEN<span class="token punctuation">,</span> <span class="token string">"玩家"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>countries<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>player_country<span class="token punctuation">)</span>
        
        <span class="token comment"># 创建电脑国家 (使用不同颜色)</span>
        ai_names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"红国"</span><span class="token punctuation">,</span> <span class="token string">"蓝国"</span><span class="token punctuation">,</span> <span class="token string">"黄国"</span><span class="token punctuation">,</span> <span class="token string">"紫国"</span><span class="token punctuation">,</span> <span class="token string">"青国"</span><span class="token punctuation">,</span> <span class="token string">"橙国"</span><span class="token punctuation">,</span> <span class="token string">"粉国"</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 创建5个电脑国家</span>
            color_idx <span class="token operator">=</span> i <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>COLORS<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>countries<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Country<span class="token punctuation">(</span>COLORS<span class="token punctuation">[</span>color_idx<span class="token punctuation">]</span><span class="token punctuation">,</span> ai_names<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 初始化网格</span>
        self<span class="token punctuation">.</span>grid <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token boolean">None</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>selected_troop <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>game_over <span class="token operator">=</span> <span class="token boolean">False</span>
        self<span class="token punctuation">.</span>winner <span class="token operator">=</span> <span class="token boolean">None</span>
        
        <span class="token comment"># 初始化领土和士兵</span>
        self<span class="token punctuation">.</span>initialize_game<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">initialize_game</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 为每个国家分配初始领土</span>
        positions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>countries<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
                x <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> GRID_WIDTH <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
                y <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token comment"># 确保初始位置不重叠且有一定间距</span>
                too_close <span class="token operator">=</span> <span class="token boolean">False</span>
                <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> positions<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>px <span class="token operator">-</span> x<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">5</span> <span class="token keyword">and</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>py <span class="token operator">-</span> y<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">:</span>
                        too_close <span class="token operator">=</span> <span class="token boolean">True</span>
                        <span class="token keyword">break</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> too_close <span class="token keyword">and</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">not</span> <span class="token keyword">in</span> positions<span class="token punctuation">:</span>
                    positions<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
                        <span class="token string">'country'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>countries<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token string">'troops'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">]</span>  <span class="token comment"># 初始士兵组</span>
                    <span class="token punctuation">}</span>
                    self<span class="token punctuation">.</span>countries<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>territory <span class="token operator">+=</span> <span class="token number">1</span>
                    self<span class="token punctuation">.</span>countries<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">]</span>
                    <span class="token keyword">break</span>
    
    <span class="token keyword">def</span> <span class="token function">draw_grid</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 绘制网格背景</span>
        self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>fill<span class="token punctuation">(</span>BACKGROUND<span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制网格线</span>
        <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> SCREEN_WIDTH<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">:</span>
            pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>line<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> GRID_COLOR<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">:</span>
            pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>line<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> GRID_COLOR<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>SCREEN_WIDTH<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制领土和士兵</span>
        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">:</span>
                    country <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span>
                    rect <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Rect<span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span>
                    pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> country<span class="token punctuation">.</span>color<span class="token punctuation">,</span> rect<span class="token punctuation">)</span>
                    
                    <span class="token comment"># 绘制士兵组</span>
                    troop_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span> troop_count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                        pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> WHITE<span class="token punctuation">,</span> 
                                          <span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                          TILE_SIZE<span class="token operator">//</span><span class="token number">3</span><span class="token punctuation">)</span>
                        text <span class="token operator">=</span> FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>troop_count<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span>
                        self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">3</span> <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制选中的士兵组</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>selected_troop<span class="token punctuation">:</span>
            x<span class="token punctuation">,</span> y <span class="token operator">=</span> self<span class="token punctuation">.</span>selected_troop
            rect <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Rect<span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span>
            pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> HIGHLIGHT<span class="token punctuation">,</span> rect<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 绘制可移动范围</span>
            <span class="token keyword">for</span> dx<span class="token punctuation">,</span> dy <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                nx<span class="token punctuation">,</span> ny <span class="token operator">=</span> x <span class="token operator">+</span> dx<span class="token punctuation">,</span> y <span class="token operator">+</span> dy
                <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> nx <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> ny <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">:</span>
                    rect <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Rect<span class="token punctuation">(</span>nx <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> ny <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span>
                    pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rect<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制信息面板</span>
        pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> SCREEN_WIDTH<span class="token punctuation">,</span> SCREEN_HEIGHT <span class="token operator">-</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">)</span>
        pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>line<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> WHITE<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>SCREEN_WIDTH<span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制玩家信息</span>
        player_text <span class="token operator">=</span> LARGE_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"玩家领土: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>territory<span class="token punctuation">}</span></span><span class="token string">  下一奖励: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>next_reward<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> GREEN<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>player_text<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制游戏说明</span>
        instructions <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string">"游戏说明:"</span><span class="token punctuation">,</span>
            <span class="token string">"1. 点击自己的士兵组选择它"</span><span class="token punctuation">,</span>
            <span class="token string">"2. 点击相邻格子移动士兵"</span><span class="token punctuation">,</span>
            <span class="token string">"3. 每占领3块领土获得一个新士兵组"</span><span class="token punctuation">,</span>
            <span class="token string">"4. 战斗规则: 比较双方士兵组数，差值决定胜负"</span><span class="token punctuation">,</span>
            <span class="token string">"5. 目标: 消灭所有其他国家"</span>
        <span class="token punctuation">]</span>
        
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> text <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>instructions<span class="token punctuation">)</span><span class="token punctuation">:</span>
            rendered <span class="token operator">=</span> FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> WHITE<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>rendered<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> <span class="token number">70</span> <span class="token operator">+</span> i <span class="token operator">*</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制电脑国家信息</span>
        ai_info <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> country <span class="token keyword">in</span> self<span class="token punctuation">.</span>countries<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> country<span class="token punctuation">.</span>is_player <span class="token keyword">and</span> <span class="token keyword">not</span> country<span class="token punctuation">.</span>defeated<span class="token punctuation">:</span>
                ai_info<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>country<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>country<span class="token punctuation">.</span>territory<span class="token punctuation">}</span></span><span class="token string">领土"</span></span><span class="token punctuation">)</span>
        
        ai_text <span class="token operator">=</span> FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">"电脑国家: "</span> <span class="token operator">+</span> <span class="token string">", "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>ai_info<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> YELLOW<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>ai_text<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制游戏结束信息</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>game_over<span class="token punctuation">:</span>
            overlay <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Surface<span class="token punctuation">(</span><span class="token punctuation">(</span>SCREEN_WIDTH<span class="token punctuation">,</span> SCREEN_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">,</span> pygame<span class="token punctuation">.</span>SRCALPHA<span class="token punctuation">)</span>
            overlay<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>overlay<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>winner<span class="token punctuation">.</span>is_player<span class="token punctuation">:</span>
                text <span class="token operator">=</span> LARGE_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">"恭喜！你赢得了战争！"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> GREEN<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                text <span class="token operator">=</span> LARGE_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>winner<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">赢得了战争！"</span></span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>winner<span class="token punctuation">.</span>color<span class="token punctuation">)</span>
            
            restart <span class="token operator">=</span> FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">"按R键重新开始游戏"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> WHITE<span class="token punctuation">)</span>
            
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token punctuation">(</span>SCREEN_WIDTH<span class="token operator">//</span><span class="token number">2</span> <span class="token operator">-</span> text<span class="token punctuation">.</span>get_width<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> SCREEN_HEIGHT<span class="token operator">//</span><span class="token number">2</span> <span class="token operator">-</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>restart<span class="token punctuation">,</span> <span class="token punctuation">(</span>SCREEN_WIDTH<span class="token operator">//</span><span class="token number">2</span> <span class="token operator">-</span> restart<span class="token punctuation">.</span>get_width<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> SCREEN_HEIGHT<span class="token operator">//</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">handle_click</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>game_over<span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        grid_x <span class="token operator">=</span> pos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">//</span> TILE_SIZE
        grid_y <span class="token operator">=</span> pos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">//</span> TILE_SIZE
        
        <span class="token comment"># 确保点击在网格范围内</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;=</span> grid_x <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> grid_y <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        <span class="token comment"># 选择士兵组</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>selected_troop <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>grid_y<span class="token punctuation">]</span><span class="token punctuation">[</span>grid_x<span class="token punctuation">]</span> <span class="token keyword">and</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>grid_y<span class="token punctuation">]</span><span class="token punctuation">[</span>grid_x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">:</span>
                <span class="token comment"># 检查该位置是否有玩家士兵组</span>
                <span class="token keyword">if</span> <span class="token punctuation">[</span>grid_x<span class="token punctuation">,</span> grid_y<span class="token punctuation">]</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>selected_troop <span class="token operator">=</span> <span class="token punctuation">(</span>grid_x<span class="token punctuation">,</span> grid_y<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># 移动士兵组</span>
            selected_x<span class="token punctuation">,</span> selected_y <span class="token operator">=</span> self<span class="token punctuation">.</span>selected_troop
            
            <span class="token comment"># 检查是否相邻</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">abs</span><span class="token punctuation">(</span>grid_x <span class="token operator">-</span> selected_x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>grid_y <span class="token operator">-</span> selected_y<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>move_troop<span class="token punctuation">(</span>selected_x<span class="token punctuation">,</span> selected_y<span class="token punctuation">,</span> grid_x<span class="token punctuation">,</span> grid_y<span class="token punctuation">)</span>
            
            self<span class="token punctuation">.</span>selected_troop <span class="token operator">=</span> <span class="token boolean">None</span>
    
    <span class="token keyword">def</span> <span class="token function">move_troop</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> from_x<span class="token punctuation">,</span> from_y<span class="token punctuation">,</span> to_x<span class="token punctuation">,</span> to_y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 从原位置移除士兵组</span>
        from_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>from_y<span class="token punctuation">]</span><span class="token punctuation">[</span>from_x<span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> from_tile<span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        <span class="token comment"># 找到要移动的士兵组</span>
        troop_to_move <span class="token operator">=</span> <span class="token boolean">None</span>
        <span class="token keyword">for</span> troop <span class="token keyword">in</span> from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> troop <span class="token operator">==</span> <span class="token punctuation">[</span>from_x<span class="token punctuation">,</span> from_y<span class="token punctuation">]</span><span class="token punctuation">:</span>
                troop_to_move <span class="token operator">=</span> troop
                <span class="token keyword">break</span>
        
        <span class="token keyword">if</span> <span class="token keyword">not</span> troop_to_move<span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        <span class="token comment"># 从原位置移除</span>
        from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop_to_move<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop_to_move<span class="token punctuation">)</span>
        
        <span class="token comment"># 更新士兵组位置 (修复问题2的关键)</span>
        troop_to_move<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_x
        troop_to_move<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_y
        
        <span class="token comment"># 添加到新位置</span>
        to_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>to_y<span class="token punctuation">]</span><span class="token punctuation">[</span>to_x<span class="token punctuation">]</span>
        
        <span class="token keyword">if</span> <span class="token keyword">not</span> to_tile<span class="token punctuation">:</span>
            <span class="token comment"># 占领新领土</span>
            self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>to_y<span class="token punctuation">]</span><span class="token punctuation">[</span>to_x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'country'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">,</span>
                <span class="token string">'troops'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>troop_to_move<span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span>troop_to_move<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">:</span>
                <span class="token comment"># 合并到友方领土</span>
                to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>troop_to_move<span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span>troop_to_move<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># 与敌方发生战斗</span>
                self<span class="token punctuation">.</span>resolve_battle<span class="token punctuation">(</span>to_x<span class="token punctuation">,</span> to_y<span class="token punctuation">,</span> troop_to_move<span class="token punctuation">)</span>
        
        <span class="token comment"># 电脑回合</span>
        self<span class="token punctuation">.</span>ai_turn<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 检查游戏是否结束</span>
        self<span class="token punctuation">.</span>check_game_over<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">resolve_battle</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> attacking_troop<span class="token punctuation">)</span><span class="token punctuation">:</span>
        tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span>
        defending_country <span class="token operator">=</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span>
        defending_troops <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        attacking_troops <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment"># 每次只移动一组士兵</span>
        
        <span class="token comment"># 计算战斗结果</span>
        difference <span class="token operator">=</span> attacking_troops <span class="token operator">-</span> defending_troops
        
        <span class="token keyword">if</span> difference <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token comment"># 攻击方胜利</span>
            tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>player_country
            tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>attacking_troop<span class="token punctuation">]</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span>attacking_troop<span class="token punctuation">)</span>
            
            <span class="token comment"># 防御方失去领土</span>
            defending_country<span class="token punctuation">.</span>remove_territory<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># 防御方胜利</span>
            <span class="token comment"># 移除一个防御方士兵组</span>
            <span class="token keyword">if</span> tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token comment"># 随机移除一个防御方士兵组</span>
                removed_troop <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>remove<span class="token punctuation">(</span>removed_troop<span class="token punctuation">)</span>
                defending_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>removed_troop<span class="token punctuation">)</span>
                
                <span class="token keyword">if</span> <span class="token keyword">not</span> tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                    <span class="token comment"># 如果防御方没有士兵了，领土变为中立</span>
                    tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
                    defending_country<span class="token punctuation">.</span>remove_territory<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">ai_turn</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> country <span class="token keyword">in</span> self<span class="token punctuation">.</span>countries<span class="token punctuation">:</span>
            <span class="token keyword">if</span> country<span class="token punctuation">.</span>is_player <span class="token keyword">or</span> country<span class="token punctuation">.</span>defeated<span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            
            <span class="token comment"># 每个电脑国家尝试移动一组士兵</span>
            <span class="token keyword">if</span> country<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                <span class="token comment"># 随机选择一个士兵组</span>
                troop <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>country<span class="token punctuation">.</span>troops<span class="token punctuation">)</span>
                x<span class="token punctuation">,</span> y <span class="token operator">=</span> troop
                
                <span class="token comment"># 随机选择一个方向</span>
                directions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
                random<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>directions<span class="token punctuation">)</span>
                
                <span class="token keyword">for</span> dx<span class="token punctuation">,</span> dy <span class="token keyword">in</span> directions<span class="token punctuation">:</span>
                    nx<span class="token punctuation">,</span> ny <span class="token operator">=</span> x <span class="token operator">+</span> dx<span class="token punctuation">,</span> y <span class="token operator">+</span> dy
                    <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> nx <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> ny <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">:</span>
                        self<span class="token punctuation">.</span>ai_move<span class="token punctuation">(</span>country<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> nx<span class="token punctuation">,</span> ny<span class="token punctuation">)</span>
                        <span class="token keyword">break</span>
    
    <span class="token keyword">def</span> <span class="token function">ai_move</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> country<span class="token punctuation">,</span> from_x<span class="token punctuation">,</span> from_y<span class="token punctuation">,</span> to_x<span class="token punctuation">,</span> to_y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 从原位置移除士兵组</span>
        from_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>from_y<span class="token punctuation">]</span><span class="token punctuation">[</span>from_x<span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> from_tile<span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        <span class="token comment"># 找到要移动的士兵组</span>
        troop_to_move <span class="token operator">=</span> <span class="token boolean">None</span>
        <span class="token keyword">for</span> troop <span class="token keyword">in</span> from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> troop <span class="token operator">==</span> <span class="token punctuation">[</span>from_x<span class="token punctuation">,</span> from_y<span class="token punctuation">]</span><span class="token punctuation">:</span>
                troop_to_move <span class="token operator">=</span> troop
                <span class="token keyword">break</span>
        
        <span class="token keyword">if</span> <span class="token keyword">not</span> troop_to_move<span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        <span class="token comment"># 从原位置移除</span>
        from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop_to_move<span class="token punctuation">)</span>
        country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop_to_move<span class="token punctuation">)</span>
        
        <span class="token comment"># 更新士兵组位置 (修复问题2的关键)</span>
        troop_to_move<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_x
        troop_to_move<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_y
        
        <span class="token comment"># 添加到新位置</span>
        to_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>to_y<span class="token punctuation">]</span><span class="token punctuation">[</span>to_x<span class="token punctuation">]</span>
        
        <span class="token keyword">if</span> <span class="token keyword">not</span> to_tile<span class="token punctuation">:</span>
            <span class="token comment"># 占领新领土</span>
            self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>to_y<span class="token punctuation">]</span><span class="token punctuation">[</span>to_x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'country'</span><span class="token punctuation">:</span> country<span class="token punctuation">,</span>
                <span class="token string">'troops'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>troop_to_move<span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
            country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span><span class="token punctuation">)</span>
            country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span>troop_to_move<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> country<span class="token punctuation">:</span>
                <span class="token comment"># 合并到友方领土</span>
                to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>troop_to_move<span class="token punctuation">)</span>
                country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span>troop_to_move<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># 与敌方发生战斗</span>
                defending_country <span class="token operator">=</span> to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span>
                defending_troops <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                attacking_troops <span class="token operator">=</span> <span class="token number">1</span>
                
                difference <span class="token operator">=</span> attacking_troops <span class="token operator">-</span> defending_troops
                
                <span class="token keyword">if</span> difference <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    <span class="token comment"># 攻击方胜利</span>
                    to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> country
                    to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>troop_to_move<span class="token punctuation">]</span>
                    country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span>troop_to_move<span class="token punctuation">)</span>
                    
                    <span class="token comment"># 防御方失去领土</span>
                    <span class="token keyword">if</span> defending_country<span class="token punctuation">:</span>
                        defending_country<span class="token punctuation">.</span>remove_territory<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token comment"># 防御方胜利</span>
                    <span class="token comment"># 移除一个防御方士兵组</span>
                    <span class="token keyword">if</span> to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                        removed_troop <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                        to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>remove<span class="token punctuation">(</span>removed_troop<span class="token punctuation">)</span>
                        <span class="token keyword">if</span> defending_country<span class="token punctuation">:</span>
                            defending_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>removed_troop<span class="token punctuation">)</span>
                        
                        <span class="token keyword">if</span> <span class="token keyword">not</span> to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                            <span class="token comment"># 如果防御方没有士兵了，领土变为中立</span>
                            to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
                            <span class="token keyword">if</span> defending_country<span class="token punctuation">:</span>
                                defending_country<span class="token punctuation">.</span>remove_territory<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">check_game_over</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        active_countries <span class="token operator">=</span> <span class="token punctuation">[</span>c <span class="token keyword">for</span> c <span class="token keyword">in</span> self<span class="token punctuation">.</span>countries <span class="token keyword">if</span> <span class="token keyword">not</span> c<span class="token punctuation">.</span>defeated<span class="token punctuation">]</span>
        
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>active_countries<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>game_over <span class="token operator">=</span> <span class="token boolean">True</span>
            self<span class="token punctuation">.</span>winner <span class="token operator">=</span> active_countries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    
    <span class="token keyword">def</span> <span class="token function">restart_game</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 重置游戏状态</span>
        self<span class="token punctuation">.</span>grid <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token boolean">None</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> country <span class="token keyword">in</span> self<span class="token punctuation">.</span>countries<span class="token punctuation">:</span>
            country<span class="token punctuation">.</span>territory <span class="token operator">=</span> <span class="token number">0</span>
            country<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            country<span class="token punctuation">.</span>next_reward <span class="token operator">=</span> <span class="token number">3</span>
            country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">False</span>
        
        self<span class="token punctuation">.</span>selected_troop <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>game_over <span class="token operator">=</span> <span class="token boolean">False</span>
        self<span class="token punctuation">.</span>winner <span class="token operator">=</span> <span class="token boolean">None</span>
        
        <span class="token comment"># 重新初始化游戏</span>
        self<span class="token punctuation">.</span>initialize_game<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> event <span class="token keyword">in</span> pygame<span class="token punctuation">.</span>event<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> event<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> QUIT<span class="token punctuation">:</span>
                    pygame<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">elif</span> event<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> MOUSEBUTTONDOWN<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> event<span class="token punctuation">.</span>button <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>  <span class="token comment"># 左键点击</span>
                        self<span class="token punctuation">.</span>handle_click<span class="token punctuation">(</span>event<span class="token punctuation">.</span>pos<span class="token punctuation">)</span>
                <span class="token keyword">elif</span> event<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> KEYDOWN<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> event<span class="token punctuation">.</span>key <span class="token operator">==</span> K_r<span class="token punctuation">:</span>  <span class="token comment"># 按R键重新开始</span>
                        self<span class="token punctuation">.</span>restart_game<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            self<span class="token punctuation">.</span>draw_grid<span class="token punctuation">(</span><span class="token punctuation">)</span>
            pygame<span class="token punctuation">.</span>display<span class="token punctuation">.</span>flip<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>clock<span class="token punctuation">.</span>tick<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    game <span class="token operator">=</span> Game<span class="token punctuation">(</span><span class="token punctuation">)</span>
    game<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></div><h3>主要修复内容：</h3><ol start="1"><li><p class="ds-markdown-paragraph"><strong>颜色分配问题</strong>：</p><ul><li><p class="ds-markdown-paragraph">增加了更多颜色选项（橙色、粉色等）</p></li><li><p class="ds-markdown-paragraph">使用模运算确保每个国家获得唯一颜色：<code>color_idx = i % len(COLORS)</code></p></li><li><p class="ds-markdown-paragraph">初始位置生成时增加间距检查，防止国家靠得太近</p></li></ul></li><li><p class="ds-markdown-paragraph"><strong>士兵组移动后无法选中</strong>：</p><ul><li><p class="ds-markdown-paragraph">在移动士兵组后更新其坐标位置：</p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre>troop_to_move<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_x
troop_to_move<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_y</pre></div></li><li><p class="ds-markdown-paragraph">这个修复同时应用于玩家移动(<code>move_troop</code>)和AI移动(<code>ai_move</code>)</p></li></ul></li><li><p class="ds-markdown-paragraph"><strong>其他改进</strong>：</p><ul><li><p class="ds-markdown-paragraph">士兵组生成逻辑优化：只从只有一个士兵组的领土生成新士兵组，防止过多士兵叠加</p></li><li><p class="ds-markdown-paragraph">战斗逻辑优化：防御方胜利时随机移除一个士兵组，而不是固定移除最后一个</p></li><li><p class="ds-markdown-paragraph">界面美化：调整士兵组数字显示位置，使其更居中</p></li></ul></li></ol><h3>游戏特点：</h3><ol start="1"><li><p class="ds-markdown-paragraph">玩家控制绿色国家，与5个不同颜色的电脑国家对抗</p></li><li><p class="ds-markdown-paragraph">每个国家初始占据一个随机位置</p></li><li><p class="ds-markdown-paragraph">玩家通过点击自己的士兵组，然后点击相邻格子来移动</p></li><li><p class="ds-markdown-paragraph">每占领3块领土会获得一个新士兵组</p></li><li><p class="ds-markdown-paragraph">战斗基于士兵组数量差决定胜负</p></li><li><p class="ds-markdown-paragraph">电脑国家会随机扩张领土</p></li></ol><p class="ds-markdown-paragraph">游戏现在应该能正常运行了，玩家可以持续移动士兵组，每个国家都有独特的颜色。享受游戏吧！</p></div><div class="ds-flex" style="margin-top: 12px; height: 20px; margin-bottom: 20px; align-items: center; gap: 10px;"><div class="ds-flex _965abe9" style="align-items: center; gap: 16px;"><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px; opacity: 1;"><svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><clippath id="clip1258_20811"><rect id="重新生成" width="20.000000" height="20.000000" fill="white" fill-opacity="0"></rect></clippath></defs><rect id="重新生成" width="20.000000" height="20.000000" fill="#FFFFFF" fill-opacity="0"></rect><g clip-path="url(#clip1258_20811)"><path id="path" d="M17.01 7.63L13.98 7.62C13.88 7.62 13.79 7.6 13.7 7.56C13.62 7.52 13.54 7.47 13.47 7.4C13.4 7.33 13.35 7.25 13.32 7.16C13.28 7.07 13.26 6.98 13.26 6.88C13.26 6.79 13.28 6.69 13.32 6.6C13.35 6.51 13.4 6.43 13.47 6.36C13.54 6.3 13.62 6.24 13.7 6.21C13.79 6.17 13.88 6.15 13.98 6.15L15.57 6.16C15.67 6.16 15.76 6.14 15.85 6.1C15.94 6.06 16.01 6.01 16.08 5.94C16.15 5.87 16.2 5.79 16.23 5.7C16.27 5.61 16.29 5.52 16.29 5.42L16.3 3.89C16.3 3.79 16.32 3.7 16.36 3.61C16.39 3.52 16.44 3.44 16.51 3.37C16.58 3.3 16.66 3.25 16.74 3.21C16.83 3.17 16.92 3.16 17.02 3.16C17.11 3.16 17.2 3.17 17.29 3.21C17.38 3.25 17.46 3.3 17.52 3.37C17.59 3.44 17.64 3.52 17.68 3.61C17.71 3.7 17.73 3.79 17.73 3.89L17.72 6.9C17.72 7 17.71 7.09 17.67 7.18C17.63 7.27 17.58 7.34 17.52 7.41C17.45 7.48 17.37 7.53 17.29 7.57C17.2 7.61 17.11 7.63 17.01 7.63Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path><path id="path" d="M2.31 16.29L2.32 13.3C2.32 13.21 2.34 13.11 2.37 13.02C2.41 12.93 2.46 12.85 2.53 12.78C2.6 12.71 2.67 12.66 2.76 12.62C2.85 12.58 2.94 12.56 3.03 12.56L6.07 12.57C6.16 12.57 6.25 12.59 6.34 12.63C6.43 12.67 6.51 12.72 6.57 12.79C6.64 12.86 6.69 12.94 6.73 13.03C6.76 13.12 6.78 13.22 6.78 13.32C6.78 13.41 6.76 13.51 6.73 13.6C6.69 13.69 6.64 13.77 6.57 13.84C6.51 13.91 6.43 13.96 6.34 14C6.25 14.04 6.16 14.06 6.07 14.06L4.47 14.05C4.38 14.05 4.29 14.07 4.2 14.11C4.11 14.15 4.03 14.2 3.97 14.27C3.9 14.34 3.85 14.42 3.81 14.51C3.78 14.6 3.76 14.7 3.76 14.8L3.75 16.29C3.75 16.39 3.73 16.48 3.69 16.58C3.65 16.67 3.6 16.75 3.54 16.82C3.47 16.89 3.39 16.94 3.3 16.98C3.22 17.01 3.13 17.03 3.03 17.03C2.94 17.03 2.85 17.02 2.76 16.98C2.67 16.94 2.59 16.89 2.52 16.82C2.46 16.75 2.4 16.67 2.37 16.58C2.33 16.49 2.31 16.39 2.31 16.29Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path><path id="path" d="M9.88 18.01C9.51 18.01 9.15 17.99 8.79 17.94C8.42 17.89 8.07 17.82 7.71 17.73C7.36 17.63 7.02 17.51 6.68 17.37C6.34 17.23 6.02 17.07 5.7 16.89C5.39 16.7 5.09 16.5 4.8 16.28C4.52 16.05 4.25 15.81 3.99 15.55C3.74 15.29 3.5 15.02 3.29 14.73C3.07 14.44 2.88 14.13 2.7 13.82L4.15 13.05C4.32 13.35 4.51 13.64 4.72 13.91C4.93 14.18 5.17 14.43 5.42 14.66C5.67 14.9 5.94 15.11 6.23 15.3C6.52 15.49 6.83 15.66 7.14 15.81C7.46 15.95 7.78 16.07 8.12 16.16C8.45 16.25 8.8 16.32 9.14 16.36C9.49 16.39 9.83 16.4 10.18 16.39C10.53 16.37 10.87 16.33 11.22 16.26C11.56 16.19 11.89 16.09 12.21 15.97C12.54 15.84 12.85 15.7 13.15 15.53C13.45 15.35 13.74 15.16 14.01 14.94C14.28 14.72 14.53 14.49 14.76 14.23C14.99 13.97 15.2 13.7 15.38 13.41C15.57 13.12 15.73 12.82 15.87 12.5C16 12.19 16.11 11.87 16.2 11.53C16.28 11.2 16.34 10.87 16.36 10.52C16.37 10.42 16.4 10.33 16.44 10.24C16.48 10.15 16.54 10.07 16.61 10C16.69 9.93 16.77 9.87 16.86 9.84C16.96 9.8 17.05 9.77 17.16 9.77C17.27 9.77 17.38 9.79 17.49 9.83C17.6 9.87 17.7 9.94 17.78 10.02C17.86 10.1 17.92 10.2 17.96 10.3C18 10.41 18.01 10.52 18 10.64C17.98 10.89 17.95 11.13 17.91 11.38C17.86 11.62 17.81 11.87 17.74 12.11C17.68 12.35 17.6 12.58 17.51 12.82C17.42 13.05 17.32 13.28 17.21 13.5C17.1 13.73 16.98 13.95 16.85 14.16C16.71 14.37 16.57 14.58 16.42 14.78C16.27 14.98 16.11 15.17 15.94 15.36C15.77 15.54 15.59 15.72 15.41 15.89C15.22 16.06 15.03 16.22 14.83 16.37C14.63 16.52 14.42 16.66 14.2 16.79C13.99 16.93 13.77 17.05 13.54 17.16C13.31 17.27 13.08 17.37 12.85 17.46C12.61 17.55 12.37 17.63 12.13 17.7C11.88 17.77 11.64 17.83 11.39 17.87C11.14 17.92 10.89 17.96 10.63 17.98C10.38 18 10.13 18.01 9.88 18.01Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path><path id="path" d="M2.85 10.27C2.73 10.28 2.62 10.26 2.51 10.22C2.4 10.17 2.31 10.11 2.23 10.03C2.14 9.95 2.08 9.85 2.04 9.74C2 9.63 1.99 9.52 2 9.41C2.03 8.98 2.1 8.56 2.2 8.15C2.3 7.73 2.43 7.33 2.6 6.94C2.76 6.54 2.96 6.16 3.19 5.8C3.41 5.44 3.67 5.1 3.95 4.77C4.24 4.45 4.54 4.15 4.88 3.88C5.21 3.6 5.56 3.35 5.93 3.13C6.3 2.91 6.69 2.73 7.09 2.57C7.5 2.41 7.91 2.28 8.33 2.19C8.75 2.09 9.18 2.03 9.62 2.01C10.05 1.98 10.48 1.99 10.91 2.03C11.35 2.07 11.77 2.14 12.19 2.25C12.61 2.36 13.02 2.5 13.42 2.67C13.81 2.84 14.19 3.04 14.56 3.28C14.92 3.51 15.27 3.77 15.59 4.05C15.91 4.34 16.21 4.64 16.48 4.98C16.75 5.31 17 5.66 17.21 6.03L15.78 6.83C15.61 6.54 15.42 6.25 15.2 5.99C14.98 5.73 14.74 5.48 14.49 5.25C14.23 5.02 13.96 4.82 13.66 4.63C13.37 4.45 13.07 4.29 12.75 4.15C12.44 4.01 12.11 3.9 11.77 3.82C11.44 3.73 11.1 3.67 10.76 3.64C10.41 3.61 10.07 3.6 9.72 3.62C9.37 3.64 9.03 3.69 8.69 3.77C8.36 3.84 8.03 3.94 7.71 4.07C7.38 4.2 7.08 4.35 6.78 4.52C6.48 4.7 6.2 4.89 5.94 5.11C5.67 5.33 5.43 5.57 5.2 5.83C4.97 6.08 4.77 6.36 4.59 6.65C4.41 6.94 4.25 7.24 4.12 7.55C3.98 7.87 3.88 8.19 3.8 8.52C3.72 8.85 3.66 9.19 3.64 9.53C3.63 9.62 3.6 9.72 3.56 9.81C3.52 9.9 3.46 9.98 3.39 10.05C3.32 10.12 3.23 10.17 3.14 10.21C3.05 10.25 2.95 10.27 2.85 10.27Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path></g></svg></div></div><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M18.14 9.428l-.003.019L17.114 15a3.774 3.774 0 0 1-1.313 2.27 3.673 3.673 0 0 1-2.438.894H3.895c-.57 0-1.055-.205-1.458-.614a2.033 2.033 0 0 1-.604-1.48v-5.438c0-.578.201-1.071.604-1.48.402-.41.888-.614 1.458-.614h1.932l2.317-5.293c.24-.548.6-.948 1.083-1.2.599-.312 1.156-.278 1.672.103.782.577 1.172 1.355 1.172 2.334V6.997h3.994c.638-.007 1.167.235 1.588.726.421.492.584 1.06.488 1.705zm-2.076-2.6c.686-.007 1.262.256 1.714.785.453.529.63 1.146.527 1.84v.004l-.005.02v.003l-1.022 5.552a3.943 3.943 0 0 1-1.37 2.368 3.838 3.838 0 0 1-2.545.933H3.895a2.137 2.137 0 0 1-1.576-.663 2.203 2.203 0 0 1-.652-1.6v-5.437c0-.622.218-1.159.652-1.6.434-.44.962-.663 1.576-.663H5.72l2.273-5.192c.254-.58.64-1.01 1.159-1.282.32-.167.64-.246.953-.227.315.02.613.137.893.344.824.608 1.24 1.437 1.24 2.47v2.345h3.827zM9.741 3.063c-.247.128-.437.344-.57.647L6.708 9.34v7.683h6.655a2.59 2.59 0 0 0 1.72-.63c.498-.42.807-.955.926-1.601l1.02-5.544a.936.936 0 0 0-.225-.773.917.917 0 0 0-.739-.335h-4.557a.567.567 0 0 1-.562-.571V4.483c0-.591-.236-1.061-.708-1.41-.143-.105-.309-.109-.497-.01zm7.124 6.157a.766.766 0 0 0-.186-.636.753.753 0 0 0-.612-.276h-4.559a.734.734 0 0 1-.728-.74V4.483c0-.537-.21-.956-.64-1.273a.233.233 0 0 0-.137-.05.387.387 0 0 0-.185.053c-.208.108-.374.291-.495.566m0 0L6.874 9.375v7.479h6.489c.609 0 1.145-.197 1.614-.592.468-.396.757-.894.869-1.502l1.02-5.54M3.35 16.623c.152.155.33.23.545.23h1.522V9.85H3.895a.732.732 0 0 0-.545.23.755.755 0 0 0-.226.553v5.437c0 .218.074.4.226.553zm.545-6.941a.897.897 0 0 0-.663.278.924.924 0 0 0-.274.673v5.437c0 .263.091.487.274.673.183.186.404.28.663.28h1.688V9.681H3.895z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M18.137 9.447l.004-.02a2.044 2.044 0 0 0-.488-1.704c-.421-.491-.95-.733-1.588-.726h-2.282l1.584 1.142h.698a.917.917 0 0 1 .739.335.936.936 0 0 1 .225.773l-1.02 5.543a2.663 2.663 0 0 1-.926 1.602 2.59 2.59 0 0 1-1.72.63H6.708V9.34L9.171 3.71c.133-.303.323-.519.57-.647.188-.099.354-.095.497.01.472.349.708.819.708 1.41v.467l1.125.811V4.483c0-.98-.39-1.757-1.171-2.334-.517-.38-1.074-.415-1.673-.103-.482.252-.843.652-1.083 1.2L5.827 8.54H3.895c-.57 0-1.056.205-1.458.614a2.033 2.033 0 0 0-.604 1.48v5.437c0 .578.201 1.072.604 1.48.403.41.889.615 1.458.615h9.468c.918 0 1.731-.299 2.438-.895A3.774 3.774 0 0 0 17.114 15l1.023-5.553zm-14.242.235a.897.897 0 0 0-.663.278.924.924 0 0 0-.274.673v5.437c0 .263.091.487.274.673.183.186.404.28.663.28h1.688V9.681H3.895z" fill="currentColor"></path><path d="M10.946 7.568c0 .316.252.571.563.571h3.858l-1.584-1.142h-1.712V5.76l-1.125-.811v2.618z" fill="currentColor"></path></svg></div></div><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M18.304 10.543v.004a2.214 2.214 0 0 1-.526 1.84c-.452.528-1.028.792-1.714.784h-3.827v2.345c0 1.034-.416 1.863-1.24 2.471-.28.207-.578.324-.893.343-.314.02-.632-.06-.953-.226-.519-.271-.905-.702-1.159-1.282l-2.273-5.193H3.895a2.136 2.136 0 0 1-1.576-.663 2.203 2.203 0 0 1-.652-1.6V3.93c0-.623.218-1.16.652-1.6.434-.441.963-.663 1.576-.663h9.468c.957 0 1.807.311 2.544.933a3.943 3.943 0 0 1 1.37 2.368L18.3 10.52v.002l.004.02zm-1.19-5.544a3.774 3.774 0 0 0-1.313-2.27 3.673 3.673 0 0 0-2.438-.894H3.895c-.57 0-1.055.205-1.458.614a2.033 2.033 0 0 0-.604 1.48v5.437c0 .578.201 1.072.604 1.48.402.41.888.615 1.458.615h1.932l2.317 5.292c.24.549.6.949 1.083 1.2.599.313 1.156.279 1.672-.102.782-.577 1.172-1.355 1.172-2.335v-2.513h3.994c.638.007 1.167-.235 1.588-.727.421-.491.584-1.06.488-1.704l-.004-.02L17.114 5zM9.819 16.787c.076.04.137.053.185.052a.233.233 0 0 0 .137-.05c.43-.316.64-.735.64-1.273v-3.084c0-.41.327-.74.729-.74h4.558a.752.752 0 0 0 .612-.277.766.766 0 0 0 .186-.635l-1.02-5.54a2.495 2.495 0 0 0-.869-1.502 2.426 2.426 0 0 0-1.613-.592H6.874v7.48l2.449 5.595m-2.615-5.56V2.978h6.655c.648 0 1.221.21 1.72.63.498.42.807.954.926 1.601l1.02 5.543a.936.936 0 0 1-.225.774.917.917 0 0 1-.739.335h-4.557a.567.567 0 0 0-.562.57v3.085c0 .592-.236 1.062-.708 1.41-.143.106-.309.11-.497.01-.247-.128-.437-.343-.57-.647l-2.463-5.628zM3.35 3.376a.754.754 0 0 0-.226.554v5.436c0 .218.074.4.226.554.152.154.33.23.545.23h1.522V3.146H3.895a.731.731 0 0 0-.545.23zm2.233-.398v7.34H3.895a.897.897 0 0 1-.663-.279.925.925 0 0 1-.274-.673V3.93c0-.263.091-.487.274-.673a.895.895 0 0 1 .663-.28h1.688zm4.235 13.809c-.208-.108-.375-.292-.495-.566l.495.566z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M15.801 2.73a3.774 3.774 0 0 1 1.313 2.269l1.023 5.554.004.019a2.044 2.044 0 0 1-.488 1.704c-.421.492-.95.734-1.588.727h-3.994v2.513c0 .98-.39 1.758-1.171 2.335-.517.38-1.074.415-1.673.102-.482-.251-.843-.651-1.083-1.2l-2.317-5.292H3.895c-.57 0-1.056-.205-1.458-.614a2.033 2.033 0 0 1-.604-1.48V3.93c0-.579.201-1.072.604-1.481.403-.41.889-.614 1.458-.614h9.468c.918 0 1.731.298 2.438.894zm-2.438.248c.648 0 1.221.21 1.72.63.498.42.807.954.926 1.601l1.02 5.543a.936.936 0 0 1-.225.774.917.917 0 0 1-.739.335h-4.557a.567.567 0 0 0-.562.57v3.085c0 .592-.236 1.062-.708 1.41-.143.106-.309.11-.497.01-.247-.128-.437-.343-.57-.647l-2.463-5.628V2.978h6.655zm-9.468 7.34a.897.897 0 0 1-.663-.279.925.925 0 0 1-.274-.673V3.93c0-.263.091-.487.274-.673a.895.895 0 0 1 .663-.28h1.688v7.341H3.895z" fill="currentColor"></path></svg></div></div></div><div style="flex: 1 1 0%;"></div></div></div><div class="_9663006"><div class="fbb737a4">我发现了新的问题：
1.我在规则中提到每占领3个方格，国家就能增加一组士兵，但实际游玩过程中这一功能似乎并没有被实现
2.游戏的ui界面出现无法显示的字符，全部都变成了方格，影响观感</div><div class="e13328ad _3a26104"><div class="_425ea0b"><div class="ds-flex _78e0558" style="align-items: flex-end; gap: 0px;"><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px; margin-left: 14px; opacity: 1;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.712 2.79a1.854 1.854 0 0 1 2.623 0l1.673 1.672a1.854 1.854 0 0 1 0 2.623l-9.714 9.714a2.91 2.91 0 0 1-2.058.853H1.945a.8.8 0 0 1-.8-.8v-2.29c0-.773.307-1.513.853-2.058l9.714-9.715zm1.492 1.13c-.1-.1-.261-.1-.361 0l-1.327 1.326 2.035 2.035 1.327-1.326c.1-.1.1-.262 0-.362L13.204 3.92zm-.783 4.491l-2.035-2.034-7.258 7.257a1.31 1.31 0 0 0-.384.927v1.492h1.492c.348 0 .681-.138.927-.384l7.258-7.258z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M17.772 17.608c.35 0 .633-.283.633-.633v-.492a.633.633 0 0 0-.633-.633H9.858L8.1 17.608h9.672z" fill="currentColor"></path></svg></div></div></div></div></div></div><div class="_4f9bf79 _43c05b5"><div class="_7eb2358 _58dfa60"><svg viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path id="path" d="M27.501 8.46875C27.249 8.3457 27.1406 8.58008 26.9932 8.69922C26.9434 8.73828 26.9004 8.78906 26.8584 8.83398C26.4902 9.22852 26.0605 9.48633 25.5 9.45508C24.6787 9.41016 23.9785 9.66797 23.3594 10.2969C23.2275 9.52148 22.79 9.05859 22.125 8.76172C21.7764 8.60742 21.4238 8.45312 21.1807 8.11719C21.0098 7.87891 20.9639 7.61328 20.8779 7.35156C20.8242 7.19336 20.7695 7.03125 20.5879 7.00391C20.3906 6.97266 20.3135 7.13867 20.2363 7.27734C19.9258 7.84375 19.8066 8.46875 19.8174 9.10156C19.8447 10.5234 20.4453 11.6562 21.6367 12.4629C21.7725 12.5547 21.8076 12.6484 21.7646 12.7832C21.6836 13.0605 21.5869 13.3301 21.501 13.6074C21.4473 13.7852 21.3662 13.8242 21.1768 13.7461C20.5225 13.4727 19.957 13.0684 19.458 12.5781C18.6104 11.7578 17.8438 10.8516 16.8877 10.1426C16.6631 9.97656 16.4395 9.82227 16.207 9.67578C15.2314 8.72656 16.335 7.94727 16.5898 7.85547C16.8574 7.75977 16.6826 7.42773 15.8193 7.43164C14.957 7.43555 14.167 7.72461 13.1611 8.10938C13.0137 8.16797 12.8594 8.21094 12.7002 8.24414C11.7871 8.07227 10.8389 8.0332 9.84766 8.14453C7.98242 8.35352 6.49219 9.23633 5.39648 10.7441C4.08105 12.5547 3.77148 14.6133 4.15039 16.7617C4.54883 19.0234 5.70215 20.8984 7.47559 22.3633C9.31348 23.8809 11.4307 24.625 13.8457 24.4824C15.3125 24.3984 16.9463 24.2012 18.7881 22.6406C19.2529 22.8711 19.7402 22.9629 20.5498 23.0332C21.1729 23.0918 21.7725 23.002 22.2373 22.9062C22.9648 22.752 22.9141 22.0781 22.6514 21.9531C20.5186 20.959 20.9863 21.3633 20.5605 21.0371C21.6445 19.752 23.2783 18.418 23.917 14.0977C23.9668 13.7539 23.9238 13.5391 23.917 13.2598C23.9131 13.0918 23.9512 13.0254 24.1445 13.0059C24.6787 12.9453 25.1973 12.7988 25.6738 12.5352C27.0557 11.7793 27.6123 10.5391 27.7441 9.05078C27.7637 8.82422 27.7402 8.58789 27.501 8.46875ZM15.46 21.8613C13.3926 20.2344 12.3906 19.6992 11.9766 19.7227C11.5898 19.7441 11.6592 20.1875 11.7441 20.4766C11.833 20.7617 11.9492 20.959 12.1123 21.209C12.2246 21.375 12.3018 21.623 12 21.8066C11.334 22.2207 10.1768 21.668 10.1221 21.6406C8.77539 20.8477 7.64941 19.7988 6.85547 18.3652C6.08984 16.9844 5.64453 15.5039 5.57129 13.9238C5.55176 13.541 5.66406 13.4062 6.04297 13.3379C6.54199 13.2461 7.05762 13.2266 7.55664 13.2988C9.66602 13.6074 11.4619 14.5527 12.9668 16.0469C13.8262 16.9004 14.4766 17.918 15.1465 18.9121C15.8584 19.9688 16.625 20.9746 17.6006 21.7988C17.9443 22.0879 18.2197 22.3086 18.4824 22.4707C17.6895 22.5586 16.3652 22.5781 15.46 21.8613ZM16.4502 15.4805C16.4502 15.3105 16.5859 15.1758 16.7568 15.1758C16.7949 15.1758 16.8301 15.1836 16.8613 15.1953C16.9033 15.2109 16.9424 15.2344 16.9727 15.2695C17.0273 15.3223 17.0586 15.4004 17.0586 15.4805C17.0586 15.6504 16.9229 15.7852 16.7529 15.7852C16.582 15.7852 16.4502 15.6504 16.4502 15.4805ZM19.5273 17.0625C19.3301 17.1426 19.1328 17.2129 18.9434 17.2207C18.6494 17.2344 18.3281 17.1152 18.1533 16.9688C17.8828 16.7422 17.6895 16.6152 17.6074 16.2168C17.5732 16.0469 17.5928 15.7852 17.623 15.6348C17.6934 15.3105 17.6152 15.1035 17.3877 14.9141C17.2012 14.7598 16.9658 14.7188 16.7061 14.7188C16.6094 14.7188 16.5205 14.6758 16.4541 14.6406C16.3457 14.5859 16.2568 14.4512 16.3418 14.2852C16.3691 14.2324 16.501 14.1016 16.5322 14.0781C16.8838 13.877 17.29 13.9434 17.666 14.0938C18.0146 14.2363 18.2773 14.498 18.6562 14.8672C19.0439 15.3145 19.1133 15.4395 19.334 15.7734C19.5078 16.0371 19.667 16.3066 19.7754 16.6152C19.8408 16.8066 19.7559 16.9648 19.5273 17.0625Z" fill-rule="nonzero" fill="#4D6BFE"></path></svg></div><div class="_48edb25"><div class="_58a6d71 _19db599"><div class="ds-icon _7580acb" style="font-size: 12px; width: 12px; height: 12px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2.656 17.344c-1.016-1.015-1.15-2.75-.313-4.925.325-.825.73-1.617 1.205-2.365L3.582 10l-.033-.054c-.5-.799-.91-1.596-1.206-2.365-.836-2.175-.703-3.91.313-4.926.56-.56 1.364-.86 2.335-.86 1.425 0 3.168.636 4.957 1.756l.053.034.053-.034c1.79-1.12 3.532-1.757 4.957-1.757.972 0 1.776.3 2.335.86 1.014 1.015 1.148 2.752.312 4.926a13.892 13.892 0 0 1-1.206 2.365l-.034.054.034.053c.5.8.91 1.596 1.205 2.365.837 2.175.704 3.911-.311 4.926-.56.56-1.364.861-2.335.861-1.425 0-3.168-.637-4.957-1.757L10 16.415l-.053.033c-1.79 1.12-3.532 1.757-4.957 1.757-.972 0-1.776-.3-2.335-.86zm13.631-4.399c-.187-.488-.429-.988-.71-1.492l-.075-.132-.092.12a22.075 22.075 0 0 1-3.968 3.968l-.12.093.132.074c1.308.734 2.559 1.162 3.556 1.162.563 0 1.006-.138 1.298-.43.3-.3.436-.774.428-1.346-.008-.575-.159-1.264-.449-2.017zm-6.345 1.65l.058.042.058-.042a19.881 19.881 0 0 0 4.551-4.537l.043-.058-.043-.058a20.123 20.123 0 0 0-2.093-2.458 19.732 19.732 0 0 0-2.458-2.08L10 5.364l-.058.042A19.883 19.883 0 0 0 5.39 9.942L5.348 10l.042.059c.631.874 1.332 1.695 2.094 2.457a19.74 19.74 0 0 0 2.458 2.08zm6.366-10.902c-.293-.293-.736-.431-1.298-.431-.998 0-2.248.429-3.556 1.163l-.132.074.12.092a21.938 21.938 0 0 1 3.968 3.968l.092.12.074-.132c.282-.504.524-1.004.711-1.492.29-.753.442-1.442.45-2.017.007-.572-.129-1.045-.429-1.345zM3.712 7.055c.202.514.44 1.013.712 1.493l.074.13.092-.119a21.94 21.94 0 0 1 3.968-3.968l.12-.092-.132-.074C7.238 3.69 5.987 3.262 4.99 3.262c-.563 0-1.006.138-1.298.43-.3.301-.436.774-.428 1.346.007.575.159 1.264.448 2.017zm0 5.89c-.29.753-.44 1.442-.448 2.017-.008.572.127 1.045.428 1.345.293.293.736.431 1.298.431.997 0 2.247-.428 3.556-1.162l.131-.074-.12-.093a21.94 21.94 0 0 1-3.967-3.968l-.093-.12-.074.132a11.712 11.712 0 0 0-.71 1.492z" fill="currentColor" stroke="currentColor" stroke-width=".1"></path><path d="M10.706 11.704A1.843 1.843 0 0 1 8.155 10a1.845 1.845 0 1 1 2.551 1.704z" fill="currentColor" stroke="currentColor" stroke-width=".2"></path></svg></div>已深度思考（用时 73 秒）<div class="ds-icon _54f4262" style="font-size: 10px; width: 10px; height: 10px; transform: rotate(180deg);"><svg width="10" height="6" viewBox="0 0 10 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5.786 4.167L2.765 1.259c-.416-.4-.985-.482-1.273-.183-.287.298-.183.864.233 1.264l3.021 2.908c.416.4.986.482 1.273.184.287-.299.183-.865-.233-1.265z" fill="currentColor"></path><path d="M8.197 1.206L5.288 4.208c-.4.413-.484.982-.187 1.27.298.289.864.187 1.265-.227L9.274 2.25c.401-.414.485-.983.187-1.271-.297-.288-.863-.187-1.264.227z" fill="currentColor"></path></svg></div></div><div class="e1675d8b"><div class="_9ecc93a"></div>我们发现了两个新问题：<div style="height: 6px;"></div> 1. 每占领3个领土增加一组士兵的功能未实现。<div style="height: 6px;"></div>    原因：在`add_territory`方法中，我们增加了领土数量，并检查是否达到奖励条件。但是，新士兵组生成后，我们只是将其添加到国家的troops列表，并没有在对应的网格上添加士兵组。<div style="height: 6px;"></div>    修复：在生成新士兵组时，需要找到该士兵组所在的位置（随机一个领土），然后在该网格的troops列表中也添加这个士兵组。<div style="height: 6px;"></div><div style="height: 6px;"></div> 2. 游戏UI出现乱码（方框）问题。<div style="height: 6px;"></div>    原因：这通常是因为字体不支持某些字符（比如中文字符）。我们之前使用了默认字体，可能不支持中文。<div style="height: 6px;"></div>    修复：使用支持中文的字体，或者指定一个系统存在的中文字体。<div style="height: 6px;"></div><div style="height: 6px;"></div> 此外，我们还注意到在生成新士兵组时，我们只是从troops列表中随机选择了一个位置，但有可能这个位置已经有多组士兵了，所以新生成的士兵组应该放在该国家的某个领土上，并且这个领土可能已经有多组士兵。<div style="height: 6px;"></div><div style="height: 6px;"></div> 具体修复步骤：<div style="height: 6px;"></div><div style="height: 6px;"></div> 问题1：在生成新士兵组时，我们不仅要在国家的troops列表中添加，还要在对应网格的troops列表中添加。<div style="height: 6px;"></div><div style="height: 6px;"></div> 问题2：将字体设置为支持中文的字体。例如，在Windows上可以使用"SimHei"，在Mac上可以使用"PingFang SC"等。我们可以尝试使用一个通用字体，或者使用多个备选字体。<div style="height: 6px;"></div><div style="height: 6px;"></div> 另外，我们还需要注意：当新士兵组生成时，它应该放在一个已经有领土的网格上（也就是该国家的任意一个领土网格）。但是，我们之前是随机选择一个士兵组的位置，然后在这个位置创建新士兵组。但是，这个位置可能已经有多组士兵了，所以我们需要在网格上添加新士兵组。<div style="height: 6px;"></div><div style="height: 6px;"></div> 修改`Country`类的`add_territory`方法：<div style="height: 6px;"></div><div style="height: 6px;"></div> 原代码：<div style="height: 6px;"></div>        if self.territory &gt;= self.next_reward:<div style="height: 6px;"></div>            self.next_reward += 3<div style="height: 6px;"></div>            # 在随机领土上生成新士兵组<div style="height: 6px;"></div>            if self.troops:<div style="height: 6px;"></div>                # 从现有领土中随机选择一个位置<div style="height: 6px;"></div>                valid_positions = [pos for pos in self.troops if self.troops.count(pos) == 1]<div style="height: 6px;"></div>                if valid_positions:<div style="height: 6px;"></div>                    random_troop = random.choice(valid_positions)<div style="height: 6px;"></div>                    self.troops.append([random_troop[0], random_troop[1]])<div style="height: 6px;"></div><div style="height: 6px;"></div> 这里有两个问题：<div style="height: 6px;"></div>  1. 我们只从只有一个士兵组的领土中选择（因为条件`self.troops.count(pos)==1`），这可能导致没有符合条件的领土而无法生成。<div style="height: 6px;"></div>  2. 我们只在国家的troops列表中添加了新士兵组，但没有在网格的troops列表中添加。<div style="height: 6px;"></div><div style="height: 6px;"></div> 修改思路：<div style="height: 6px;"></div>  1. 新士兵组可以生成在该国家的任意一个领土上（无论该领土上已有多少士兵组）。<div style="height: 6px;"></div>  2. 需要同时更新网格数据。<div style="height: 6px;"></div><div style="height: 6px;"></div> 但是，在`Country`类中并没有保存网格的引用，所以我们需要在生成新士兵组时，通过游戏网格对象来更新。这需要将网格对象传递给`add_territory`方法？或者我们在游戏主循环中处理？这样会破坏当前结构。<div style="height: 6px;"></div><div style="height: 6px;"></div> 因此，我们调整策略：在`Game`类中检查每个国家的领土是否达到奖励条件，并在`Game`类中生成新士兵组，因为`Game`类有网格的引用。<div style="height: 6px;"></div><div style="height: 6px;"></div> 由于时间关系，我们改变实现方式：将生成新士兵组的逻辑移到`Game`类中，在每次玩家行动和AI行动后，检查所有国家（包括玩家）是否达到奖励条件，如果达到，则生成新士兵组。<div style="height: 6px;"></div><div style="height: 6px;"></div> 但是，这样可能会在同一个回合多次生成，因此我们可以在每次领土增加时检查（即仍然在`add_territory`中触发），但需要将网格引用传递给国家？或者我们换一种方式：<div style="height: 6px;"></div><div style="height: 6px;"></div> 我们不在`Country.add_territory`中生成士兵组，而是在每次移动后（玩家移动和AI移动后），遍历所有国家，检查其领土数是否达到`next_reward`，如果达到则生成新士兵组，并更新`next_reward`。<div style="height: 6px;"></div><div style="height: 6px;"></div> 为了简化，我们采用以下步骤：<div style="height: 6px;"></div><div style="height: 6px;"></div> 在`Game`类中，在玩家移动和AI移动后（即整个回合结束后），调用一个方法`check_rewards`，为每个国家检查领土奖励。<div style="height: 6px;"></div><div style="height: 6px;"></div> 但是，注意：在同一个回合内，一个国家可能增加多块领土，但只应该触发一次奖励（因为奖励是每3块领土一次）。所以我们在`check_rewards`中，如果国家领土数达到或超过`next_reward`，就生成一组新士兵，并设置`next_reward += 3`。<div style="height: 6px;"></div><div style="height: 6px;"></div> 具体步骤：<div style="height: 6px;"></div><div style="height: 6px;"></div> 1. 在`Game`类中添加方法`check_rewards`：<div style="height: 6px;"></div>    def check_rewards(self):<div style="height: 6px;"></div>        for country in self.countries:<div style="height: 6px;"></div>            if country.defeated:<div style="height: 6px;"></div>                continue<div style="height: 6px;"></div>            if country.territory &gt;= country.next_reward:<div style="height: 6px;"></div>                # 生成一组新士兵<div style="height: 6px;"></div>                # 从该国家的领土中随机选择一个位置（网格）<div style="height: 6px;"></div>                # 注意：领土是指country的网格，但一个网格可能有多个士兵组<div style="height: 6px;"></div>                # 我们想要的是该国家的所有领土网格，但注意：一个网格可能有多个士兵组，但领土网格是指grid中country为该国家的所有网格<div style="height: 6px;"></div>                # 所以我们需要收集所有属于该国家的网格位置<div style="height: 6px;"></div>                positions = []<div style="height: 6px;"></div>                for y in range(GRID_HEIGHT):<div style="height: 6px;"></div>                    for x in range(GRID_WIDTH):<div style="height: 6px;"></div>                        if self.grid[y][x] and self.grid[y][x]['country'] == country:<div style="height: 6px;"></div>                            positions.append((x, y))<div style="height: 6px;"></div>                if positions:<div style="height: 6px;"></div>                    # 随机选择一个领土网格<div style="height: 6px;"></div>                    x, y = random.choice(positions)<div style="height: 6px;"></div>                    # 在该网格上创建一组新士兵，位置就是这个网格<div style="height: 6px;"></div>                    new_troop = [x, y]<div style="height: 6px;"></div>                    # 在网格上添加<div style="height: 6px;"></div>                    self.grid[y][x]['troops'].append(new_troop)<div style="height: 6px;"></div>                    country.troops.append(new_troop)<div style="height: 6px;"></div>                    # 更新奖励阈值<div style="height: 6px;"></div>                    country.next_reward += 3<div style="height: 6px;"></div><div style="height: 6px;"></div> 2. 在玩家移动和AI移动后（即一个完整的回合后）调用`check_rewards`。注意，在`move_troop`方法的最后，我们已经调用了`ai_turn`（电脑行动）和`check_game_over`，我们在这些之后调用`check_rewards`。<div style="height: 6px;"></div><div style="height: 6px;"></div> 3. 同时，移除`Country`类中`add_territory`方法里生成士兵组的代码。<div style="height: 6px;"></div><div style="height: 6px;"></div> 但是，这样修改会改变原有逻辑：原有逻辑是每占领3块领土（即领土数达到3,6,9,...）时立即生成。现在改为在回合结束后统一检查。这样是合理的，因为一个回合可能增加多块领土。<div style="height: 6px;"></div><div style="height: 6px;"></div> 问题2：字体问题。<div style="height: 6px;"></div><div style="height: 6px;"></div> 我们将字体初始化改为使用中文字体，并设置一个回退机制。<div style="height: 6px;"></div><div style="height: 6px;"></div> 修改字体定义：<div style="height: 6px;"></div>    try:<div style="height: 6px;"></div>        FONT = pygame.font.SysFont("SimHei", 24)<div style="height: 6px;"></div>        LARGE_FONT = pygame.font.SysFont("SimHei", 36)<div style="height: 6px;"></div>    except:<div style="height: 6px;"></div>        FONT = pygame.font.SysFont(None, 24)<div style="height: 6px;"></div>        LARGE_FONT = pygame.font.SysFont(None, 36)<div style="height: 6px;"></div><div style="height: 6px;"></div> 或者使用其他中文字体，如"Microsoft YaHei", "KaiTi", "SimSun", "PingFang SC", "Heiti SC"等，根据系统选择。<div style="height: 6px;"></div><div style="height: 6px;"></div> 由于我们无法确定所有系统，我们可以尝试多个字体，或者使用默认字体（但可能不支持中文），或者使用一个字体文件。<div style="height: 6px;"></div><div style="height: 6px;"></div> 考虑到简单性，我们使用多个备选字体。<div style="height: 6px;"></div><div style="height: 6px;"></div> 修改如下：<div style="height: 6px;"></div><div style="height: 6px;"></div>    # 尝试加载中文字体<div style="height: 6px;"></div>    font_list = ["SimHei", "Microsoft YaHei", "KaiTi", "SimSun", "PingFang SC", "Heiti SC", "WenQuanYi Micro Hei"]<div style="height: 6px;"></div>    FONT = None<div style="height: 6px;"></div>    LARGE_FONT = None<div style="height: 6px;"></div>    for font_name in font_list:<div style="height: 6px;"></div>        try:<div style="height: 6px;"></div>            FONT = pygame.font.SysFont(font_name, 24)<div style="height: 6px;"></div>            LARGE_FONT = pygame.font.SysFont(font_name, 36)<div style="height: 6px;"></div>            break<div style="height: 6px;"></div>        except:<div style="height: 6px;"></div>            pass<div style="height: 6px;"></div>    if FONT is None:<div style="height: 6px;"></div>        FONT = pygame.font.SysFont(None, 24)<div style="height: 6px;"></div>        LARGE_FONT = pygame.font.SysFont(None, 36)<div style="height: 6px;"></div><div style="height: 6px;"></div> 这样，我们尝试多个字体，直到成功加载一个。<div style="height: 6px;"></div><div style="height: 6px;"></div> 由于改动较大，我们将提供完整的修改后代码。<div style="height: 6px;"></div><div style="height: 6px;"></div> 注意：由于时间关系，我们可能还需要测试新士兵组生成是否正常。<div style="height: 6px;"></div><div style="height: 6px;"></div> 以下是修改后的完整代码：</div></div><div class="ds-markdown ds-markdown--block" style="--ds-md-zoom: 1.143;"><p class="ds-markdown-paragraph">我发现了这些问题，让我们修复它们：</p><h3>问题分析</h3><ol start="1"><li><p class="ds-markdown-paragraph"><strong>士兵组生成未实现</strong>：</p><ul><li><p class="ds-markdown-paragraph">问题在于领土增加时士兵组生成逻辑有缺陷</p></li><li><p class="ds-markdown-paragraph">我们需要在增加领土后检查是否达到奖励阈值</p></li><li><p class="ds-markdown-paragraph">新士兵组需要添加到网格和国家士兵列表中</p></li></ul></li><li><p class="ds-markdown-paragraph"><strong>UI字体显示问题</strong>：</p><ul><li><p class="ds-markdown-paragraph">这是字体不支持中文字符导致的</p></li><li><p class="ds-markdown-paragraph">我们需要明确指定支持中文的字体</p></li></ul></li></ol><h3>修复后的完整代码</h3><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre><span class="token keyword">import</span> pygame
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> random
<span class="token keyword">import</span> math
<span class="token keyword">from</span> pygame<span class="token punctuation">.</span><span class="token builtin">locals</span> <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token comment"># 初始化pygame</span>
pygame<span class="token punctuation">.</span>init<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 游戏常量</span>
SCREEN_WIDTH <span class="token operator">=</span> <span class="token number">1000</span>
SCREEN_HEIGHT <span class="token operator">=</span> <span class="token number">700</span>
GRID_SIZE <span class="token operator">=</span> <span class="token number">20</span>
GRID_WIDTH <span class="token operator">=</span> <span class="token number">40</span>
GRID_HEIGHT <span class="token operator">=</span> <span class="token number">30</span>
TILE_SIZE <span class="token operator">=</span> <span class="token number">20</span>

<span class="token comment"># 尝试加载中文字体</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token comment"># 尝试常见的中文字体</span>
    FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token string">"SimHei"</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span>
    LARGE_FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token string">"SimHei"</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span>
<span class="token keyword">except</span><span class="token punctuation">:</span>
    <span class="token comment"># 回退到默认字体</span>
    FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span>
    LARGE_FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span>

<span class="token comment"># 颜色</span>
BACKGROUND <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
GRID_COLOR <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
WHITE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
BLACK <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
RED <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
GREEN <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
BLUE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
YELLOW <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
PURPLE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
CYAN <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
ORANGE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">165</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
PINK <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span>
COLORS <span class="token operator">=</span> <span class="token punctuation">[</span>RED<span class="token punctuation">,</span> BLUE<span class="token punctuation">,</span> YELLOW<span class="token punctuation">,</span> PURPLE<span class="token punctuation">,</span> CYAN<span class="token punctuation">,</span> ORANGE<span class="token punctuation">,</span> PINK<span class="token punctuation">]</span>  <span class="token comment"># 增加更多颜色</span>
HIGHLIGHT <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Country</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> color<span class="token punctuation">,</span> name<span class="token punctuation">,</span> is_player<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>color <span class="token operator">=</span> color
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>is_player <span class="token operator">=</span> is_player
        self<span class="token punctuation">.</span>territory <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># 存储士兵组的位置坐标</span>
        self<span class="token punctuation">.</span>next_reward <span class="token operator">=</span> <span class="token number">3</span>
        self<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">add_territory</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> game<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""增加领土并检查是否应生成新士兵组"""</span>
        self<span class="token punctuation">.</span>territory <span class="token operator">+=</span> <span class="token number">1</span>
        
        <span class="token comment"># 每占领3块领土获得一个新的士兵组</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>territory <span class="token operator">&gt;=</span> self<span class="token punctuation">.</span>next_reward<span class="token punctuation">:</span>
            <span class="token comment"># 更新奖励阈值</span>
            self<span class="token punctuation">.</span>next_reward <span class="token operator">+=</span> <span class="token number">3</span>
            
            <span class="token comment"># 在随机领土上生成新士兵组</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                <span class="token comment"># 收集所有领土位置</span>
                territory_positions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">if</span> game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token keyword">and</span> game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> self<span class="token punctuation">:</span>
                            territory_positions<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
                
                <span class="token keyword">if</span> territory_positions<span class="token punctuation">:</span>
                    <span class="token comment"># 随机选择一个领土位置</span>
                    x<span class="token punctuation">,</span> y <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>territory_positions<span class="token punctuation">)</span>
                    
                    <span class="token comment"># 创建新士兵组</span>
                    new_troop <span class="token operator">=</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span>
                    
                    <span class="token comment"># 添加到国家士兵列表</span>
                    self<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_troop<span class="token punctuation">)</span>
                    
                    <span class="token comment"># 添加到网格</span>
                    game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_troop<span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">remove_territory</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>territory <span class="token operator">-=</span> <span class="token number">1</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>territory <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">True</span>

<span class="token keyword">class</span> <span class="token class-name">Game</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>screen <span class="token operator">=</span> pygame<span class="token punctuation">.</span>display<span class="token punctuation">.</span>set_mode<span class="token punctuation">(</span><span class="token punctuation">(</span>SCREEN_WIDTH<span class="token punctuation">,</span> SCREEN_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">)</span>
        pygame<span class="token punctuation">.</span>display<span class="token punctuation">.</span>set_caption<span class="token punctuation">(</span><span class="token string">"领土征服者"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>clock <span class="token operator">=</span> pygame<span class="token punctuation">.</span>time<span class="token punctuation">.</span>Clock<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 创建国家</span>
        self<span class="token punctuation">.</span>countries <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>player_country <span class="token operator">=</span> Country<span class="token punctuation">(</span>GREEN<span class="token punctuation">,</span> <span class="token string">"玩家"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>countries<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>player_country<span class="token punctuation">)</span>
        
        <span class="token comment"># 创建电脑国家 (使用不同颜色)</span>
        ai_names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"红国"</span><span class="token punctuation">,</span> <span class="token string">"蓝国"</span><span class="token punctuation">,</span> <span class="token string">"黄国"</span><span class="token punctuation">,</span> <span class="token string">"紫国"</span><span class="token punctuation">,</span> <span class="token string">"青国"</span><span class="token punctuation">,</span> <span class="token string">"橙国"</span><span class="token punctuation">,</span> <span class="token string">"粉国"</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 创建5个电脑国家</span>
            color_idx <span class="token operator">=</span> i <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>COLORS<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>countries<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Country<span class="token punctuation">(</span>COLORS<span class="token punctuation">[</span>color_idx<span class="token punctuation">]</span><span class="token punctuation">,</span> ai_names<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 初始化网格</span>
        self<span class="token punctuation">.</span>grid <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token boolean">None</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>selected_troop <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>game_over <span class="token operator">=</span> <span class="token boolean">False</span>
        self<span class="token punctuation">.</span>winner <span class="token operator">=</span> <span class="token boolean">None</span>
        
        <span class="token comment"># 初始化领土和士兵</span>
        self<span class="token punctuation">.</span>initialize_game<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">initialize_game</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 为每个国家分配初始领土</span>
        positions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>countries<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
                x <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> GRID_WIDTH <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
                y <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token comment"># 确保初始位置不重叠且有一定间距</span>
                too_close <span class="token operator">=</span> <span class="token boolean">False</span>
                <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> positions<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>px <span class="token operator">-</span> x<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">5</span> <span class="token keyword">and</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>py <span class="token operator">-</span> y<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">:</span>
                        too_close <span class="token operator">=</span> <span class="token boolean">True</span>
                        <span class="token keyword">break</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> too_close <span class="token keyword">and</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">not</span> <span class="token keyword">in</span> positions<span class="token punctuation">:</span>
                    positions<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
                        <span class="token string">'country'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>countries<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token string">'troops'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">]</span>  <span class="token comment"># 初始士兵组</span>
                    <span class="token punctuation">}</span>
                    self<span class="token punctuation">.</span>countries<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>territory <span class="token operator">+=</span> <span class="token number">1</span>
                    self<span class="token punctuation">.</span>countries<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">]</span>
                    <span class="token keyword">break</span>
    
    <span class="token keyword">def</span> <span class="token function">draw_grid</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 绘制网格背景</span>
        self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>fill<span class="token punctuation">(</span>BACKGROUND<span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制网格线</span>
        <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> SCREEN_WIDTH<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">:</span>
            pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>line<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> GRID_COLOR<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">:</span>
            pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>line<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> GRID_COLOR<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>SCREEN_WIDTH<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制领土和士兵</span>
        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">:</span>
                    country <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span>
                    rect <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Rect<span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span>
                    pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> country<span class="token punctuation">.</span>color<span class="token punctuation">,</span> rect<span class="token punctuation">)</span>
                    
                    <span class="token comment"># 绘制士兵组</span>
                    troop_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span> troop_count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                        pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> WHITE<span class="token punctuation">,</span> 
                                          <span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                          TILE_SIZE<span class="token operator">//</span><span class="token number">3</span><span class="token punctuation">)</span>
                        text <span class="token operator">=</span> FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>troop_count<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span>
                        text_rect <span class="token operator">=</span> text<span class="token punctuation">.</span>get_rect<span class="token punctuation">(</span>center<span class="token operator">=</span><span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>text<span class="token punctuation">,</span> text_rect<span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制选中的士兵组</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>selected_troop<span class="token punctuation">:</span>
            x<span class="token punctuation">,</span> y <span class="token operator">=</span> self<span class="token punctuation">.</span>selected_troop
            rect <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Rect<span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span>
            pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> HIGHLIGHT<span class="token punctuation">,</span> rect<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 绘制可移动范围</span>
            <span class="token keyword">for</span> dx<span class="token punctuation">,</span> dy <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                nx<span class="token punctuation">,</span> ny <span class="token operator">=</span> x <span class="token operator">+</span> dx<span class="token punctuation">,</span> y <span class="token operator">+</span> dy
                <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> nx <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> ny <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">:</span>
                    rect <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Rect<span class="token punctuation">(</span>nx <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> ny <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span>
                    pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rect<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制信息面板</span>
        pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> SCREEN_WIDTH<span class="token punctuation">,</span> SCREEN_HEIGHT <span class="token operator">-</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">)</span>
        pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>line<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> WHITE<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>SCREEN_WIDTH<span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制玩家信息</span>
        player_text <span class="token operator">=</span> LARGE_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"玩家领土: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>territory<span class="token punctuation">}</span></span><span class="token string">  下一奖励: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>next_reward<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> GREEN<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>player_text<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制游戏说明</span>
        instructions <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string">"游戏说明:"</span><span class="token punctuation">,</span>
            <span class="token string">"1. 点击自己的士兵组选择它"</span><span class="token punctuation">,</span>
            <span class="token string">"2. 点击相邻格子移动士兵"</span><span class="token punctuation">,</span>
            <span class="token string">"3. 每占领3块领土获得一个新士兵组"</span><span class="token punctuation">,</span>
            <span class="token string">"4. 战斗规则: 比较双方士兵组数，差值决定胜负"</span><span class="token punctuation">,</span>
            <span class="token string">"5. 目标: 消灭所有其他国家"</span>
        <span class="token punctuation">]</span>
        
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> text <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>instructions<span class="token punctuation">)</span><span class="token punctuation">:</span>
            rendered <span class="token operator">=</span> FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> WHITE<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>rendered<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> <span class="token number">70</span> <span class="token operator">+</span> i <span class="token operator">*</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制电脑国家信息</span>
        ai_info <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> country <span class="token keyword">in</span> self<span class="token punctuation">.</span>countries<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> country<span class="token punctuation">.</span>is_player <span class="token keyword">and</span> <span class="token keyword">not</span> country<span class="token punctuation">.</span>defeated<span class="token punctuation">:</span>
                ai_info<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>country<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>country<span class="token punctuation">.</span>territory<span class="token punctuation">}</span></span><span class="token string">领土"</span></span><span class="token punctuation">)</span>
        
        <span class="token keyword">if</span> ai_info<span class="token punctuation">:</span>
            ai_text <span class="token operator">=</span> FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">"电脑国家: "</span> <span class="token operator">+</span> <span class="token string">", "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>ai_info<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> YELLOW<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>ai_text<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制游戏结束信息</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>game_over<span class="token punctuation">:</span>
            overlay <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Surface<span class="token punctuation">(</span><span class="token punctuation">(</span>SCREEN_WIDTH<span class="token punctuation">,</span> SCREEN_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">,</span> pygame<span class="token punctuation">.</span>SRCALPHA<span class="token punctuation">)</span>
            overlay<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>overlay<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>winner<span class="token punctuation">.</span>is_player<span class="token punctuation">:</span>
                text <span class="token operator">=</span> LARGE_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">"恭喜！你赢得了战争！"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> GREEN<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                text <span class="token operator">=</span> LARGE_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>winner<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">赢得了战争！"</span></span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>winner<span class="token punctuation">.</span>color<span class="token punctuation">)</span>
            
            restart <span class="token operator">=</span> FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">"按R键重新开始游戏"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> WHITE<span class="token punctuation">)</span>
            
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token punctuation">(</span>SCREEN_WIDTH<span class="token operator">//</span><span class="token number">2</span> <span class="token operator">-</span> text<span class="token punctuation">.</span>get_width<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> SCREEN_HEIGHT<span class="token operator">//</span><span class="token number">2</span> <span class="token operator">-</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>restart<span class="token punctuation">,</span> <span class="token punctuation">(</span>SCREEN_WIDTH<span class="token operator">//</span><span class="token number">2</span> <span class="token operator">-</span> restart<span class="token punctuation">.</span>get_width<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> SCREEN_HEIGHT<span class="token operator">//</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">handle_click</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>game_over<span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        grid_x <span class="token operator">=</span> pos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">//</span> TILE_SIZE
        grid_y <span class="token operator">=</span> pos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">//</span> TILE_SIZE
        
        <span class="token comment"># 确保点击在网格范围内</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;=</span> grid_x <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> grid_y <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        <span class="token comment"># 选择士兵组</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>selected_troop <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>grid_y<span class="token punctuation">]</span><span class="token punctuation">[</span>grid_x<span class="token punctuation">]</span> <span class="token keyword">and</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>grid_y<span class="token punctuation">]</span><span class="token punctuation">[</span>grid_x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">:</span>
                <span class="token comment"># 检查该位置是否有玩家士兵组</span>
                <span class="token keyword">if</span> <span class="token punctuation">[</span>grid_x<span class="token punctuation">,</span> grid_y<span class="token punctuation">]</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>selected_troop <span class="token operator">=</span> <span class="token punctuation">(</span>grid_x<span class="token punctuation">,</span> grid_y<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># 移动士兵组</span>
            selected_x<span class="token punctuation">,</span> selected_y <span class="token operator">=</span> self<span class="token punctuation">.</span>selected_troop
            
            <span class="token comment"># 检查是否相邻</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">abs</span><span class="token punctuation">(</span>grid_x <span class="token operator">-</span> selected_x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>grid_y <span class="token operator">-</span> selected_y<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>move_troop<span class="token punctuation">(</span>selected_x<span class="token punctuation">,</span> selected_y<span class="token punctuation">,</span> grid_x<span class="token punctuation">,</span> grid_y<span class="token punctuation">)</span>
            
            self<span class="token punctuation">.</span>selected_troop <span class="token operator">=</span> <span class="token boolean">None</span>
    
    <span class="token keyword">def</span> <span class="token function">move_troop</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> from_x<span class="token punctuation">,</span> from_y<span class="token punctuation">,</span> to_x<span class="token punctuation">,</span> to_y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 从原位置移除士兵组</span>
        from_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>from_y<span class="token punctuation">]</span><span class="token punctuation">[</span>from_x<span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> from_tile<span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        <span class="token comment"># 找到要移动的士兵组</span>
        troop_to_move <span class="token operator">=</span> <span class="token boolean">None</span>
        <span class="token keyword">for</span> troop <span class="token keyword">in</span> from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> troop <span class="token operator">==</span> <span class="token punctuation">[</span>from_x<span class="token punctuation">,</span> from_y<span class="token punctuation">]</span><span class="token punctuation">:</span>
                troop_to_move <span class="token operator">=</span> troop
                <span class="token keyword">break</span>
        
        <span class="token keyword">if</span> <span class="token keyword">not</span> troop_to_move<span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        <span class="token comment"># 从原位置移除</span>
        from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop_to_move<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop_to_move<span class="token punctuation">)</span>
        
        <span class="token comment"># 更新士兵组位置 (修复问题2的关键)</span>
        troop_to_move<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_x
        troop_to_move<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_y
        
        <span class="token comment"># 添加到新位置</span>
        to_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>to_y<span class="token punctuation">]</span><span class="token punctuation">[</span>to_x<span class="token punctuation">]</span>
        
        <span class="token keyword">if</span> <span class="token keyword">not</span> to_tile<span class="token punctuation">:</span>
            <span class="token comment"># 占领新领土</span>
            self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>to_y<span class="token punctuation">]</span><span class="token punctuation">[</span>to_x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'country'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">,</span>
                <span class="token string">'troops'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>troop_to_move<span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>territory <span class="token operator">+=</span> <span class="token number">1</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span>troop_to_move<span class="token punctuation">)</span>
            <span class="token comment"># 检查是否应获得新士兵组</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">:</span>
                <span class="token comment"># 合并到友方领土</span>
                to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>troop_to_move<span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span>troop_to_move<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># 与敌方发生战斗</span>
                self<span class="token punctuation">.</span>resolve_battle<span class="token punctuation">(</span>to_x<span class="token punctuation">,</span> to_y<span class="token punctuation">,</span> troop_to_move<span class="token punctuation">)</span>
        
        <span class="token comment"># 电脑回合</span>
        self<span class="token punctuation">.</span>ai_turn<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 检查游戏是否结束</span>
        self<span class="token punctuation">.</span>check_game_over<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">resolve_battle</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> attacking_troop<span class="token punctuation">)</span><span class="token punctuation">:</span>
        tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span>
        defending_country <span class="token operator">=</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span>
        defending_troops <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        attacking_troops <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment"># 每次只移动一组士兵</span>
        
        <span class="token comment"># 计算战斗结果</span>
        difference <span class="token operator">=</span> attacking_troops <span class="token operator">-</span> defending_troops
        
        <span class="token keyword">if</span> difference <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token comment"># 攻击方胜利</span>
            tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>player_country
            tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>attacking_troop<span class="token punctuation">]</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>territory <span class="token operator">+=</span> <span class="token number">1</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span>attacking_troop<span class="token punctuation">)</span>
            <span class="token comment"># 检查是否应获得新士兵组</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
            
            <span class="token comment"># 防御方失去领土</span>
            defending_country<span class="token punctuation">.</span>territory <span class="token operator">-=</span> <span class="token number">1</span>
            <span class="token keyword">if</span> defending_country<span class="token punctuation">.</span>territory <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                defending_country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">True</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># 防御方胜利</span>
            <span class="token comment"># 移除一个防御方士兵组</span>
            <span class="token keyword">if</span> tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token comment"># 随机移除一个防御方士兵组</span>
                removed_troop <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>remove<span class="token punctuation">(</span>removed_troop<span class="token punctuation">)</span>
                defending_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>removed_troop<span class="token punctuation">)</span>
                
                <span class="token keyword">if</span> <span class="token keyword">not</span> tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                    <span class="token comment"># 如果防御方没有士兵了，领土变为中立</span>
                    tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
                    defending_country<span class="token punctuation">.</span>territory <span class="token operator">-=</span> <span class="token number">1</span>
                    <span class="token keyword">if</span> defending_country<span class="token punctuation">.</span>territory <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                        defending_country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">True</span>
    
    <span class="token keyword">def</span> <span class="token function">ai_turn</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> country <span class="token keyword">in</span> self<span class="token punctuation">.</span>countries<span class="token punctuation">:</span>
            <span class="token keyword">if</span> country<span class="token punctuation">.</span>is_player <span class="token keyword">or</span> country<span class="token punctuation">.</span>defeated<span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            
            <span class="token comment"># 每个电脑国家尝试移动一组士兵</span>
            <span class="token keyword">if</span> country<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                <span class="token comment"># 随机选择一个士兵组</span>
                troop <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>country<span class="token punctuation">.</span>troops<span class="token punctuation">)</span>
                x<span class="token punctuation">,</span> y <span class="token operator">=</span> troop
                
                <span class="token comment"># 随机选择一个方向</span>
                directions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
                random<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>directions<span class="token punctuation">)</span>
                
                <span class="token keyword">for</span> dx<span class="token punctuation">,</span> dy <span class="token keyword">in</span> directions<span class="token punctuation">:</span>
                    nx<span class="token punctuation">,</span> ny <span class="token operator">=</span> x <span class="token operator">+</span> dx<span class="token punctuation">,</span> y <span class="token operator">+</span> dy
                    <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> nx <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> ny <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">:</span>
                        self<span class="token punctuation">.</span>ai_move<span class="token punctuation">(</span>country<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> nx<span class="token punctuation">,</span> ny<span class="token punctuation">)</span>
                        <span class="token keyword">break</span>
    
    <span class="token keyword">def</span> <span class="token function">ai_move</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> country<span class="token punctuation">,</span> from_x<span class="token punctuation">,</span> from_y<span class="token punctuation">,</span> to_x<span class="token punctuation">,</span> to_y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 从原位置移除士兵组</span>
        from_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>from_y<span class="token punctuation">]</span><span class="token punctuation">[</span>from_x<span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> from_tile<span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        <span class="token comment"># 找到要移动的士兵组</span>
        troop_to_move <span class="token operator">=</span> <span class="token boolean">None</span>
        <span class="token keyword">for</span> troop <span class="token keyword">in</span> from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> troop <span class="token operator">==</span> <span class="token punctuation">[</span>from_x<span class="token punctuation">,</span> from_y<span class="token punctuation">]</span><span class="token punctuation">:</span>
                troop_to_move <span class="token operator">=</span> troop
                <span class="token keyword">break</span>
        
        <span class="token keyword">if</span> <span class="token keyword">not</span> troop_to_move<span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        <span class="token comment"># 从原位置移除</span>
        from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop_to_move<span class="token punctuation">)</span>
        country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop_to_move<span class="token punctuation">)</span>
        
        <span class="token comment"># 更新士兵组位置 (修复问题2的关键)</span>
        troop_to_move<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_x
        troop_to_move<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_y
        
        <span class="token comment"># 添加到新位置</span>
        to_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>to_y<span class="token punctuation">]</span><span class="token punctuation">[</span>to_x<span class="token punctuation">]</span>
        
        <span class="token keyword">if</span> <span class="token keyword">not</span> to_tile<span class="token punctuation">:</span>
            <span class="token comment"># 占领新领土</span>
            self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>to_y<span class="token punctuation">]</span><span class="token punctuation">[</span>to_x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'country'</span><span class="token punctuation">:</span> country<span class="token punctuation">,</span>
                <span class="token string">'troops'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>troop_to_move<span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
            country<span class="token punctuation">.</span>territory <span class="token operator">+=</span> <span class="token number">1</span>
            country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span>troop_to_move<span class="token punctuation">)</span>
            <span class="token comment"># 检查是否应获得新士兵组</span>
            country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> country<span class="token punctuation">:</span>
                <span class="token comment"># 合并到友方领土</span>
                to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>troop_to_move<span class="token punctuation">)</span>
                country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span>troop_to_move<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># 与敌方发生战斗</span>
                defending_country <span class="token operator">=</span> to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span>
                defending_troops <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                attacking_troops <span class="token operator">=</span> <span class="token number">1</span>
                
                difference <span class="token operator">=</span> attacking_troops <span class="token operator">-</span> defending_troops
                
                <span class="token keyword">if</span> difference <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    <span class="token comment"># 攻击方胜利</span>
                    to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> country
                    to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>troop_to_move<span class="token punctuation">]</span>
                    country<span class="token punctuation">.</span>territory <span class="token operator">+=</span> <span class="token number">1</span>
                    country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span>troop_to_move<span class="token punctuation">)</span>
                    <span class="token comment"># 检查是否应获得新士兵组</span>
                    country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
                    
                    <span class="token comment"># 防御方失去领土</span>
                    <span class="token keyword">if</span> defending_country<span class="token punctuation">:</span>
                        defending_country<span class="token punctuation">.</span>territory <span class="token operator">-=</span> <span class="token number">1</span>
                        <span class="token keyword">if</span> defending_country<span class="token punctuation">.</span>territory <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                            defending_country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">True</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token comment"># 防御方胜利</span>
                    <span class="token comment"># 移除一个防御方士兵组</span>
                    <span class="token keyword">if</span> to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                        removed_troop <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                        to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>remove<span class="token punctuation">(</span>removed_troop<span class="token punctuation">)</span>
                        <span class="token keyword">if</span> defending_country<span class="token punctuation">:</span>
                            defending_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>removed_troop<span class="token punctuation">)</span>
                        
                        <span class="token keyword">if</span> <span class="token keyword">not</span> to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                            <span class="token comment"># 如果防御方没有士兵了，领土变为中立</span>
                            to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
                            <span class="token keyword">if</span> defending_country<span class="token punctuation">:</span>
                                defending_country<span class="token punctuation">.</span>territory <span class="token operator">-=</span> <span class="token number">1</span>
                                <span class="token keyword">if</span> defending_country<span class="token punctuation">.</span>territory <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                                    defending_country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">True</span>
    
    <span class="token keyword">def</span> <span class="token function">check_game_over</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        active_countries <span class="token operator">=</span> <span class="token punctuation">[</span>c <span class="token keyword">for</span> c <span class="token keyword">in</span> self<span class="token punctuation">.</span>countries <span class="token keyword">if</span> <span class="token keyword">not</span> c<span class="token punctuation">.</span>defeated<span class="token punctuation">]</span>
        
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>active_countries<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>game_over <span class="token operator">=</span> <span class="token boolean">True</span>
            self<span class="token punctuation">.</span>winner <span class="token operator">=</span> active_countries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    
    <span class="token keyword">def</span> <span class="token function">restart_game</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 重置游戏状态</span>
        self<span class="token punctuation">.</span>grid <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token boolean">None</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> country <span class="token keyword">in</span> self<span class="token punctuation">.</span>countries<span class="token punctuation">:</span>
            country<span class="token punctuation">.</span>territory <span class="token operator">=</span> <span class="token number">0</span>
            country<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            country<span class="token punctuation">.</span>next_reward <span class="token operator">=</span> <span class="token number">3</span>
            country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">False</span>
        
        self<span class="token punctuation">.</span>selected_troop <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>game_over <span class="token operator">=</span> <span class="token boolean">False</span>
        self<span class="token punctuation">.</span>winner <span class="token operator">=</span> <span class="token boolean">None</span>
        
        <span class="token comment"># 重新初始化游戏</span>
        self<span class="token punctuation">.</span>initialize_game<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> event <span class="token keyword">in</span> pygame<span class="token punctuation">.</span>event<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> event<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> QUIT<span class="token punctuation">:</span>
                    pygame<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">elif</span> event<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> MOUSEBUTTONDOWN<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> event<span class="token punctuation">.</span>button <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>  <span class="token comment"># 左键点击</span>
                        self<span class="token punctuation">.</span>handle_click<span class="token punctuation">(</span>event<span class="token punctuation">.</span>pos<span class="token punctuation">)</span>
                <span class="token keyword">elif</span> event<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> KEYDOWN<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> event<span class="token punctuation">.</span>key <span class="token operator">==</span> K_r<span class="token punctuation">:</span>  <span class="token comment"># 按R键重新开始</span>
                        self<span class="token punctuation">.</span>restart_game<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            self<span class="token punctuation">.</span>draw_grid<span class="token punctuation">(</span><span class="token punctuation">)</span>
            pygame<span class="token punctuation">.</span>display<span class="token punctuation">.</span>flip<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>clock<span class="token punctuation">.</span>tick<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    game <span class="token operator">=</span> Game<span class="token punctuation">(</span><span class="token punctuation">)</span>
    game<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></div><h3>主要修复内容：</h3><h4>1. 修复士兵组生成问题</h4><ul><li><p class="ds-markdown-paragraph"><strong>重构了<code>add_territory</code>方法</strong>：</p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre><span class="token keyword">def</span> <span class="token function">add_territory</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> game<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""增加领土并检查是否应生成新士兵组"""</span>
    self<span class="token punctuation">.</span>territory <span class="token operator">+=</span> <span class="token number">1</span>
    
    <span class="token comment"># 每占领3块领土获得一个新的士兵组</span>
    <span class="token keyword">if</span> self<span class="token punctuation">.</span>territory <span class="token operator">&gt;=</span> self<span class="token punctuation">.</span>next_reward<span class="token punctuation">:</span>
        <span class="token comment"># 更新奖励阈值</span>
        self<span class="token punctuation">.</span>next_reward <span class="token operator">+=</span> <span class="token number">3</span>
        
        <span class="token comment"># 在随机领土上生成新士兵组</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
            <span class="token comment"># 收集所有领土位置</span>
            territory_positions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">if</span> game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token keyword">and</span> game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> self<span class="token punctuation">:</span>
                        territory_positions<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> territory_positions<span class="token punctuation">:</span>
                <span class="token comment"># 随机选择一个领土位置</span>
                x<span class="token punctuation">,</span> y <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>territory_positions<span class="token punctuation">)</span>
                
                <span class="token comment"># 创建新士兵组</span>
                new_troop <span class="token operator">=</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span>
                
                <span class="token comment"># 添加到国家士兵列表</span>
                self<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_troop<span class="token punctuation">)</span>
                
                <span class="token comment"># 添加到网格</span>
                game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_troop<span class="token punctuation">)</span></pre></div></li><li><p class="ds-markdown-paragraph"><strong>在占领新领土后调用此方法</strong>：</p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre><span class="token comment"># 在玩家移动中</span>
self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>territory <span class="token operator">+=</span> <span class="token number">1</span>
self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span>self<span class="token punctuation">)</span>

<span class="token comment"># 在AI移动中</span>
country<span class="token punctuation">.</span>territory <span class="token operator">+=</span> <span class="token number">1</span>
country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span>self<span class="token punctuation">)</span></pre></div></li></ul><h4>2. 修复字体显示问题</h4><ul><li><p class="ds-markdown-paragraph"><strong>添加字体回退机制</strong>：</p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre><span class="token comment"># 尝试加载中文字体</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token comment"># 尝试常见的中文字体</span>
    FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token string">"SimHei"</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span>
    LARGE_FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token string">"SimHei"</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span>
<span class="token keyword">except</span><span class="token punctuation">:</span>
    <span class="token comment"># 回退到默认字体</span>
    FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span>
    LARGE_FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span></pre></div></li></ul><h4>3. 其他改进</h4><ul><li><p class="ds-markdown-paragraph"><strong>士兵组数字显示居中</strong>：</p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre>text_rect <span class="token operator">=</span> text<span class="token punctuation">.</span>get_rect<span class="token punctuation">(</span>center<span class="token operator">=</span><span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>text<span class="token punctuation">,</span> text_rect<span class="token punctuation">)</span></pre></div></li><li><p class="ds-markdown-paragraph"><strong>领土管理逻辑优化</strong>：</p><ul><li><p class="ds-markdown-paragraph">直接在移动操作中增加/减少领土计数</p></li><li><p class="ds-markdown-paragraph">简化了国家被击败的判断逻辑</p></li></ul></li><li><p class="ds-markdown-paragraph"><strong>错误处理</strong>：</p><ul><li><p class="ds-markdown-paragraph">添加了对空列表的检查</p></li><li><p class="ds-markdown-paragraph">优化了游戏结束条件判断</p></li></ul></li></ul><h3>游戏特点：</h3><ol start="1"><li><p class="ds-markdown-paragraph"><strong>每占领3块领土获得新士兵组</strong>：</p><ul><li><p class="ds-markdown-paragraph">现在当国家领土达到3、6、9等时，会在随机领土上生成新士兵组</p></li><li><p class="ds-markdown-paragraph">新士兵组会添加到网格和国家士兵列表中</p></li></ul></li><li><p class="ds-markdown-paragraph"><strong>支持中文显示</strong>：</p><ul><li><p class="ds-markdown-paragraph">使用"SimHei"字体作为首选</p></li><li><p class="ds-markdown-paragraph">提供回退机制到默认字体</p></li></ul></li><li><p class="ds-markdown-paragraph"><strong>更清晰的士兵组显示</strong>：</p><ul><li><p class="ds-markdown-paragraph">士兵组数字现在居中显示</p></li><li><p class="ds-markdown-paragraph">士兵组选择高亮效果更明显</p></li></ul></li><li><p class="ds-markdown-paragraph"><strong>优化游戏流程</strong>：</p><ul><li><p class="ds-markdown-paragraph">简化了领土管理逻辑</p></li><li><p class="ds-markdown-paragraph">修复了国家被击败的判断</p></li></ul></li></ol><p class="ds-markdown-paragraph">现在游戏应该能正确生成新士兵组，并且中文显示应该正常。请尝试运行这个修复后的版本！</p></div><div class="ds-flex" style="margin-top: 12px; height: 20px; margin-bottom: 20px; align-items: center; gap: 10px;"><div class="ds-flex _965abe9" style="align-items: center; gap: 16px;"><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px; opacity: 1;"><svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><clippath id="clip1258_20811"><rect id="重新生成" width="20.000000" height="20.000000" fill="white" fill-opacity="0"></rect></clippath></defs><rect id="重新生成" width="20.000000" height="20.000000" fill="#FFFFFF" fill-opacity="0"></rect><g clip-path="url(#clip1258_20811)"><path id="path" d="M17.01 7.63L13.98 7.62C13.88 7.62 13.79 7.6 13.7 7.56C13.62 7.52 13.54 7.47 13.47 7.4C13.4 7.33 13.35 7.25 13.32 7.16C13.28 7.07 13.26 6.98 13.26 6.88C13.26 6.79 13.28 6.69 13.32 6.6C13.35 6.51 13.4 6.43 13.47 6.36C13.54 6.3 13.62 6.24 13.7 6.21C13.79 6.17 13.88 6.15 13.98 6.15L15.57 6.16C15.67 6.16 15.76 6.14 15.85 6.1C15.94 6.06 16.01 6.01 16.08 5.94C16.15 5.87 16.2 5.79 16.23 5.7C16.27 5.61 16.29 5.52 16.29 5.42L16.3 3.89C16.3 3.79 16.32 3.7 16.36 3.61C16.39 3.52 16.44 3.44 16.51 3.37C16.58 3.3 16.66 3.25 16.74 3.21C16.83 3.17 16.92 3.16 17.02 3.16C17.11 3.16 17.2 3.17 17.29 3.21C17.38 3.25 17.46 3.3 17.52 3.37C17.59 3.44 17.64 3.52 17.68 3.61C17.71 3.7 17.73 3.79 17.73 3.89L17.72 6.9C17.72 7 17.71 7.09 17.67 7.18C17.63 7.27 17.58 7.34 17.52 7.41C17.45 7.48 17.37 7.53 17.29 7.57C17.2 7.61 17.11 7.63 17.01 7.63Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path><path id="path" d="M2.31 16.29L2.32 13.3C2.32 13.21 2.34 13.11 2.37 13.02C2.41 12.93 2.46 12.85 2.53 12.78C2.6 12.71 2.67 12.66 2.76 12.62C2.85 12.58 2.94 12.56 3.03 12.56L6.07 12.57C6.16 12.57 6.25 12.59 6.34 12.63C6.43 12.67 6.51 12.72 6.57 12.79C6.64 12.86 6.69 12.94 6.73 13.03C6.76 13.12 6.78 13.22 6.78 13.32C6.78 13.41 6.76 13.51 6.73 13.6C6.69 13.69 6.64 13.77 6.57 13.84C6.51 13.91 6.43 13.96 6.34 14C6.25 14.04 6.16 14.06 6.07 14.06L4.47 14.05C4.38 14.05 4.29 14.07 4.2 14.11C4.11 14.15 4.03 14.2 3.97 14.27C3.9 14.34 3.85 14.42 3.81 14.51C3.78 14.6 3.76 14.7 3.76 14.8L3.75 16.29C3.75 16.39 3.73 16.48 3.69 16.58C3.65 16.67 3.6 16.75 3.54 16.82C3.47 16.89 3.39 16.94 3.3 16.98C3.22 17.01 3.13 17.03 3.03 17.03C2.94 17.03 2.85 17.02 2.76 16.98C2.67 16.94 2.59 16.89 2.52 16.82C2.46 16.75 2.4 16.67 2.37 16.58C2.33 16.49 2.31 16.39 2.31 16.29Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path><path id="path" d="M9.88 18.01C9.51 18.01 9.15 17.99 8.79 17.94C8.42 17.89 8.07 17.82 7.71 17.73C7.36 17.63 7.02 17.51 6.68 17.37C6.34 17.23 6.02 17.07 5.7 16.89C5.39 16.7 5.09 16.5 4.8 16.28C4.52 16.05 4.25 15.81 3.99 15.55C3.74 15.29 3.5 15.02 3.29 14.73C3.07 14.44 2.88 14.13 2.7 13.82L4.15 13.05C4.32 13.35 4.51 13.64 4.72 13.91C4.93 14.18 5.17 14.43 5.42 14.66C5.67 14.9 5.94 15.11 6.23 15.3C6.52 15.49 6.83 15.66 7.14 15.81C7.46 15.95 7.78 16.07 8.12 16.16C8.45 16.25 8.8 16.32 9.14 16.36C9.49 16.39 9.83 16.4 10.18 16.39C10.53 16.37 10.87 16.33 11.22 16.26C11.56 16.19 11.89 16.09 12.21 15.97C12.54 15.84 12.85 15.7 13.15 15.53C13.45 15.35 13.74 15.16 14.01 14.94C14.28 14.72 14.53 14.49 14.76 14.23C14.99 13.97 15.2 13.7 15.38 13.41C15.57 13.12 15.73 12.82 15.87 12.5C16 12.19 16.11 11.87 16.2 11.53C16.28 11.2 16.34 10.87 16.36 10.52C16.37 10.42 16.4 10.33 16.44 10.24C16.48 10.15 16.54 10.07 16.61 10C16.69 9.93 16.77 9.87 16.86 9.84C16.96 9.8 17.05 9.77 17.16 9.77C17.27 9.77 17.38 9.79 17.49 9.83C17.6 9.87 17.7 9.94 17.78 10.02C17.86 10.1 17.92 10.2 17.96 10.3C18 10.41 18.01 10.52 18 10.64C17.98 10.89 17.95 11.13 17.91 11.38C17.86 11.62 17.81 11.87 17.74 12.11C17.68 12.35 17.6 12.58 17.51 12.82C17.42 13.05 17.32 13.28 17.21 13.5C17.1 13.73 16.98 13.95 16.85 14.16C16.71 14.37 16.57 14.58 16.42 14.78C16.27 14.98 16.11 15.17 15.94 15.36C15.77 15.54 15.59 15.72 15.41 15.89C15.22 16.06 15.03 16.22 14.83 16.37C14.63 16.52 14.42 16.66 14.2 16.79C13.99 16.93 13.77 17.05 13.54 17.16C13.31 17.27 13.08 17.37 12.85 17.46C12.61 17.55 12.37 17.63 12.13 17.7C11.88 17.77 11.64 17.83 11.39 17.87C11.14 17.92 10.89 17.96 10.63 17.98C10.38 18 10.13 18.01 9.88 18.01Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path><path id="path" d="M2.85 10.27C2.73 10.28 2.62 10.26 2.51 10.22C2.4 10.17 2.31 10.11 2.23 10.03C2.14 9.95 2.08 9.85 2.04 9.74C2 9.63 1.99 9.52 2 9.41C2.03 8.98 2.1 8.56 2.2 8.15C2.3 7.73 2.43 7.33 2.6 6.94C2.76 6.54 2.96 6.16 3.19 5.8C3.41 5.44 3.67 5.1 3.95 4.77C4.24 4.45 4.54 4.15 4.88 3.88C5.21 3.6 5.56 3.35 5.93 3.13C6.3 2.91 6.69 2.73 7.09 2.57C7.5 2.41 7.91 2.28 8.33 2.19C8.75 2.09 9.18 2.03 9.62 2.01C10.05 1.98 10.48 1.99 10.91 2.03C11.35 2.07 11.77 2.14 12.19 2.25C12.61 2.36 13.02 2.5 13.42 2.67C13.81 2.84 14.19 3.04 14.56 3.28C14.92 3.51 15.27 3.77 15.59 4.05C15.91 4.34 16.21 4.64 16.48 4.98C16.75 5.31 17 5.66 17.21 6.03L15.78 6.83C15.61 6.54 15.42 6.25 15.2 5.99C14.98 5.73 14.74 5.48 14.49 5.25C14.23 5.02 13.96 4.82 13.66 4.63C13.37 4.45 13.07 4.29 12.75 4.15C12.44 4.01 12.11 3.9 11.77 3.82C11.44 3.73 11.1 3.67 10.76 3.64C10.41 3.61 10.07 3.6 9.72 3.62C9.37 3.64 9.03 3.69 8.69 3.77C8.36 3.84 8.03 3.94 7.71 4.07C7.38 4.2 7.08 4.35 6.78 4.52C6.48 4.7 6.2 4.89 5.94 5.11C5.67 5.33 5.43 5.57 5.2 5.83C4.97 6.08 4.77 6.36 4.59 6.65C4.41 6.94 4.25 7.24 4.12 7.55C3.98 7.87 3.88 8.19 3.8 8.52C3.72 8.85 3.66 9.19 3.64 9.53C3.63 9.62 3.6 9.72 3.56 9.81C3.52 9.9 3.46 9.98 3.39 10.05C3.32 10.12 3.23 10.17 3.14 10.21C3.05 10.25 2.95 10.27 2.85 10.27Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path></g></svg></div></div><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M18.14 9.428l-.003.019L17.114 15a3.774 3.774 0 0 1-1.313 2.27 3.673 3.673 0 0 1-2.438.894H3.895c-.57 0-1.055-.205-1.458-.614a2.033 2.033 0 0 1-.604-1.48v-5.438c0-.578.201-1.071.604-1.48.402-.41.888-.614 1.458-.614h1.932l2.317-5.293c.24-.548.6-.948 1.083-1.2.599-.312 1.156-.278 1.672.103.782.577 1.172 1.355 1.172 2.334V6.997h3.994c.638-.007 1.167.235 1.588.726.421.492.584 1.06.488 1.705zm-2.076-2.6c.686-.007 1.262.256 1.714.785.453.529.63 1.146.527 1.84v.004l-.005.02v.003l-1.022 5.552a3.943 3.943 0 0 1-1.37 2.368 3.838 3.838 0 0 1-2.545.933H3.895a2.137 2.137 0 0 1-1.576-.663 2.203 2.203 0 0 1-.652-1.6v-5.437c0-.622.218-1.159.652-1.6.434-.44.962-.663 1.576-.663H5.72l2.273-5.192c.254-.58.64-1.01 1.159-1.282.32-.167.64-.246.953-.227.315.02.613.137.893.344.824.608 1.24 1.437 1.24 2.47v2.345h3.827zM9.741 3.063c-.247.128-.437.344-.57.647L6.708 9.34v7.683h6.655a2.59 2.59 0 0 0 1.72-.63c.498-.42.807-.955.926-1.601l1.02-5.544a.936.936 0 0 0-.225-.773.917.917 0 0 0-.739-.335h-4.557a.567.567 0 0 1-.562-.571V4.483c0-.591-.236-1.061-.708-1.41-.143-.105-.309-.109-.497-.01zm7.124 6.157a.766.766 0 0 0-.186-.636.753.753 0 0 0-.612-.276h-4.559a.734.734 0 0 1-.728-.74V4.483c0-.537-.21-.956-.64-1.273a.233.233 0 0 0-.137-.05.387.387 0 0 0-.185.053c-.208.108-.374.291-.495.566m0 0L6.874 9.375v7.479h6.489c.609 0 1.145-.197 1.614-.592.468-.396.757-.894.869-1.502l1.02-5.54M3.35 16.623c.152.155.33.23.545.23h1.522V9.85H3.895a.732.732 0 0 0-.545.23.755.755 0 0 0-.226.553v5.437c0 .218.074.4.226.553zm.545-6.941a.897.897 0 0 0-.663.278.924.924 0 0 0-.274.673v5.437c0 .263.091.487.274.673.183.186.404.28.663.28h1.688V9.681H3.895z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M18.137 9.447l.004-.02a2.044 2.044 0 0 0-.488-1.704c-.421-.491-.95-.733-1.588-.726h-2.282l1.584 1.142h.698a.917.917 0 0 1 .739.335.936.936 0 0 1 .225.773l-1.02 5.543a2.663 2.663 0 0 1-.926 1.602 2.59 2.59 0 0 1-1.72.63H6.708V9.34L9.171 3.71c.133-.303.323-.519.57-.647.188-.099.354-.095.497.01.472.349.708.819.708 1.41v.467l1.125.811V4.483c0-.98-.39-1.757-1.171-2.334-.517-.38-1.074-.415-1.673-.103-.482.252-.843.652-1.083 1.2L5.827 8.54H3.895c-.57 0-1.056.205-1.458.614a2.033 2.033 0 0 0-.604 1.48v5.437c0 .578.201 1.072.604 1.48.403.41.889.615 1.458.615h9.468c.918 0 1.731-.299 2.438-.895A3.774 3.774 0 0 0 17.114 15l1.023-5.553zm-14.242.235a.897.897 0 0 0-.663.278.924.924 0 0 0-.274.673v5.437c0 .263.091.487.274.673.183.186.404.28.663.28h1.688V9.681H3.895z" fill="currentColor"></path><path d="M10.946 7.568c0 .316.252.571.563.571h3.858l-1.584-1.142h-1.712V5.76l-1.125-.811v2.618z" fill="currentColor"></path></svg></div></div><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M18.304 10.543v.004a2.214 2.214 0 0 1-.526 1.84c-.452.528-1.028.792-1.714.784h-3.827v2.345c0 1.034-.416 1.863-1.24 2.471-.28.207-.578.324-.893.343-.314.02-.632-.06-.953-.226-.519-.271-.905-.702-1.159-1.282l-2.273-5.193H3.895a2.136 2.136 0 0 1-1.576-.663 2.203 2.203 0 0 1-.652-1.6V3.93c0-.623.218-1.16.652-1.6.434-.441.963-.663 1.576-.663h9.468c.957 0 1.807.311 2.544.933a3.943 3.943 0 0 1 1.37 2.368L18.3 10.52v.002l.004.02zm-1.19-5.544a3.774 3.774 0 0 0-1.313-2.27 3.673 3.673 0 0 0-2.438-.894H3.895c-.57 0-1.055.205-1.458.614a2.033 2.033 0 0 0-.604 1.48v5.437c0 .578.201 1.072.604 1.48.402.41.888.615 1.458.615h1.932l2.317 5.292c.24.549.6.949 1.083 1.2.599.313 1.156.279 1.672-.102.782-.577 1.172-1.355 1.172-2.335v-2.513h3.994c.638.007 1.167-.235 1.588-.727.421-.491.584-1.06.488-1.704l-.004-.02L17.114 5zM9.819 16.787c.076.04.137.053.185.052a.233.233 0 0 0 .137-.05c.43-.316.64-.735.64-1.273v-3.084c0-.41.327-.74.729-.74h4.558a.752.752 0 0 0 .612-.277.766.766 0 0 0 .186-.635l-1.02-5.54a2.495 2.495 0 0 0-.869-1.502 2.426 2.426 0 0 0-1.613-.592H6.874v7.48l2.449 5.595m-2.615-5.56V2.978h6.655c.648 0 1.221.21 1.72.63.498.42.807.954.926 1.601l1.02 5.543a.936.936 0 0 1-.225.774.917.917 0 0 1-.739.335h-4.557a.567.567 0 0 0-.562.57v3.085c0 .592-.236 1.062-.708 1.41-.143.106-.309.11-.497.01-.247-.128-.437-.343-.57-.647l-2.463-5.628zM3.35 3.376a.754.754 0 0 0-.226.554v5.436c0 .218.074.4.226.554.152.154.33.23.545.23h1.522V3.146H3.895a.731.731 0 0 0-.545.23zm2.233-.398v7.34H3.895a.897.897 0 0 1-.663-.279.925.925 0 0 1-.274-.673V3.93c0-.263.091-.487.274-.673a.895.895 0 0 1 .663-.28h1.688zm4.235 13.809c-.208-.108-.375-.292-.495-.566l.495.566z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M15.801 2.73a3.774 3.774 0 0 1 1.313 2.269l1.023 5.554.004.019a2.044 2.044 0 0 1-.488 1.704c-.421.492-.95.734-1.588.727h-3.994v2.513c0 .98-.39 1.758-1.171 2.335-.517.38-1.074.415-1.673.102-.482-.251-.843-.651-1.083-1.2l-2.317-5.292H3.895c-.57 0-1.056-.205-1.458-.614a2.033 2.033 0 0 1-.604-1.48V3.93c0-.579.201-1.072.604-1.481.403-.41.889-.614 1.458-.614h9.468c.918 0 1.731.298 2.438.894zm-2.438.248c.648 0 1.221.21 1.72.63.498.42.807.954.926 1.601l1.02 5.543a.936.936 0 0 1-.225.774.917.917 0 0 1-.739.335h-4.557a.567.567 0 0 0-.562.57v3.085c0 .592-.236 1.062-.708 1.41-.143.106-.309.11-.497.01-.247-.128-.437-.343-.57-.647l-2.463-5.628V2.978h6.655zm-9.468 7.34a.897.897 0 0 1-.663-.279.925.925 0 0 1-.274-.673V3.93c0-.263.091-.487.274-.673a.895.895 0 0 1 .663-.28h1.688v7.341H3.895z" fill="currentColor"></path></svg></div></div></div><div style="flex: 1 1 0%;"></div></div></div><div class="_9663006"><div class="fbb737a4">我又发现问题了，请你改进：
1.国家兵力的文字显示超出了屏幕范围
2.我希望当我移动一个具有多组士兵的格子上的士兵时，能将该格子上所有组的士兵同时移动，入侵他国领土时也是如此
3.不要让某个国家新生成的士兵出现在另一国家的领土上</div><div class="e13328ad _3a26104"><div class="_425ea0b"><div class="ds-flex _78e0558" style="align-items: flex-end; gap: 0px;"><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px; margin-left: 14px; opacity: 1;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.712 2.79a1.854 1.854 0 0 1 2.623 0l1.673 1.672a1.854 1.854 0 0 1 0 2.623l-9.714 9.714a2.91 2.91 0 0 1-2.058.853H1.945a.8.8 0 0 1-.8-.8v-2.29c0-.773.307-1.513.853-2.058l9.714-9.715zm1.492 1.13c-.1-.1-.261-.1-.361 0l-1.327 1.326 2.035 2.035 1.327-1.326c.1-.1.1-.262 0-.362L13.204 3.92zm-.783 4.491l-2.035-2.034-7.258 7.257a1.31 1.31 0 0 0-.384.927v1.492h1.492c.348 0 .681-.138.927-.384l7.258-7.258z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M17.772 17.608c.35 0 .633-.283.633-.633v-.492a.633.633 0 0 0-.633-.633H9.858L8.1 17.608h9.672z" fill="currentColor"></path></svg></div></div></div></div></div></div><div class="_4f9bf79 _43c05b5"><div class="_7eb2358 _58dfa60"><svg viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path id="path" d="M27.501 8.46875C27.249 8.3457 27.1406 8.58008 26.9932 8.69922C26.9434 8.73828 26.9004 8.78906 26.8584 8.83398C26.4902 9.22852 26.0605 9.48633 25.5 9.45508C24.6787 9.41016 23.9785 9.66797 23.3594 10.2969C23.2275 9.52148 22.79 9.05859 22.125 8.76172C21.7764 8.60742 21.4238 8.45312 21.1807 8.11719C21.0098 7.87891 20.9639 7.61328 20.8779 7.35156C20.8242 7.19336 20.7695 7.03125 20.5879 7.00391C20.3906 6.97266 20.3135 7.13867 20.2363 7.27734C19.9258 7.84375 19.8066 8.46875 19.8174 9.10156C19.8447 10.5234 20.4453 11.6562 21.6367 12.4629C21.7725 12.5547 21.8076 12.6484 21.7646 12.7832C21.6836 13.0605 21.5869 13.3301 21.501 13.6074C21.4473 13.7852 21.3662 13.8242 21.1768 13.7461C20.5225 13.4727 19.957 13.0684 19.458 12.5781C18.6104 11.7578 17.8438 10.8516 16.8877 10.1426C16.6631 9.97656 16.4395 9.82227 16.207 9.67578C15.2314 8.72656 16.335 7.94727 16.5898 7.85547C16.8574 7.75977 16.6826 7.42773 15.8193 7.43164C14.957 7.43555 14.167 7.72461 13.1611 8.10938C13.0137 8.16797 12.8594 8.21094 12.7002 8.24414C11.7871 8.07227 10.8389 8.0332 9.84766 8.14453C7.98242 8.35352 6.49219 9.23633 5.39648 10.7441C4.08105 12.5547 3.77148 14.6133 4.15039 16.7617C4.54883 19.0234 5.70215 20.8984 7.47559 22.3633C9.31348 23.8809 11.4307 24.625 13.8457 24.4824C15.3125 24.3984 16.9463 24.2012 18.7881 22.6406C19.2529 22.8711 19.7402 22.9629 20.5498 23.0332C21.1729 23.0918 21.7725 23.002 22.2373 22.9062C22.9648 22.752 22.9141 22.0781 22.6514 21.9531C20.5186 20.959 20.9863 21.3633 20.5605 21.0371C21.6445 19.752 23.2783 18.418 23.917 14.0977C23.9668 13.7539 23.9238 13.5391 23.917 13.2598C23.9131 13.0918 23.9512 13.0254 24.1445 13.0059C24.6787 12.9453 25.1973 12.7988 25.6738 12.5352C27.0557 11.7793 27.6123 10.5391 27.7441 9.05078C27.7637 8.82422 27.7402 8.58789 27.501 8.46875ZM15.46 21.8613C13.3926 20.2344 12.3906 19.6992 11.9766 19.7227C11.5898 19.7441 11.6592 20.1875 11.7441 20.4766C11.833 20.7617 11.9492 20.959 12.1123 21.209C12.2246 21.375 12.3018 21.623 12 21.8066C11.334 22.2207 10.1768 21.668 10.1221 21.6406C8.77539 20.8477 7.64941 19.7988 6.85547 18.3652C6.08984 16.9844 5.64453 15.5039 5.57129 13.9238C5.55176 13.541 5.66406 13.4062 6.04297 13.3379C6.54199 13.2461 7.05762 13.2266 7.55664 13.2988C9.66602 13.6074 11.4619 14.5527 12.9668 16.0469C13.8262 16.9004 14.4766 17.918 15.1465 18.9121C15.8584 19.9688 16.625 20.9746 17.6006 21.7988C17.9443 22.0879 18.2197 22.3086 18.4824 22.4707C17.6895 22.5586 16.3652 22.5781 15.46 21.8613ZM16.4502 15.4805C16.4502 15.3105 16.5859 15.1758 16.7568 15.1758C16.7949 15.1758 16.8301 15.1836 16.8613 15.1953C16.9033 15.2109 16.9424 15.2344 16.9727 15.2695C17.0273 15.3223 17.0586 15.4004 17.0586 15.4805C17.0586 15.6504 16.9229 15.7852 16.7529 15.7852C16.582 15.7852 16.4502 15.6504 16.4502 15.4805ZM19.5273 17.0625C19.3301 17.1426 19.1328 17.2129 18.9434 17.2207C18.6494 17.2344 18.3281 17.1152 18.1533 16.9688C17.8828 16.7422 17.6895 16.6152 17.6074 16.2168C17.5732 16.0469 17.5928 15.7852 17.623 15.6348C17.6934 15.3105 17.6152 15.1035 17.3877 14.9141C17.2012 14.7598 16.9658 14.7188 16.7061 14.7188C16.6094 14.7188 16.5205 14.6758 16.4541 14.6406C16.3457 14.5859 16.2568 14.4512 16.3418 14.2852C16.3691 14.2324 16.501 14.1016 16.5322 14.0781C16.8838 13.877 17.29 13.9434 17.666 14.0938C18.0146 14.2363 18.2773 14.498 18.6562 14.8672C19.0439 15.3145 19.1133 15.4395 19.334 15.7734C19.5078 16.0371 19.667 16.3066 19.7754 16.6152C19.8408 16.8066 19.7559 16.9648 19.5273 17.0625Z" fill-rule="nonzero" fill="#4D6BFE"></path></svg></div><div class="_48edb25"><div class="_58a6d71 _19db599"><div class="ds-icon _7580acb" style="font-size: 12px; width: 12px; height: 12px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2.656 17.344c-1.016-1.015-1.15-2.75-.313-4.925.325-.825.73-1.617 1.205-2.365L3.582 10l-.033-.054c-.5-.799-.91-1.596-1.206-2.365-.836-2.175-.703-3.91.313-4.926.56-.56 1.364-.86 2.335-.86 1.425 0 3.168.636 4.957 1.756l.053.034.053-.034c1.79-1.12 3.532-1.757 4.957-1.757.972 0 1.776.3 2.335.86 1.014 1.015 1.148 2.752.312 4.926a13.892 13.892 0 0 1-1.206 2.365l-.034.054.034.053c.5.8.91 1.596 1.205 2.365.837 2.175.704 3.911-.311 4.926-.56.56-1.364.861-2.335.861-1.425 0-3.168-.637-4.957-1.757L10 16.415l-.053.033c-1.79 1.12-3.532 1.757-4.957 1.757-.972 0-1.776-.3-2.335-.86zm13.631-4.399c-.187-.488-.429-.988-.71-1.492l-.075-.132-.092.12a22.075 22.075 0 0 1-3.968 3.968l-.12.093.132.074c1.308.734 2.559 1.162 3.556 1.162.563 0 1.006-.138 1.298-.43.3-.3.436-.774.428-1.346-.008-.575-.159-1.264-.449-2.017zm-6.345 1.65l.058.042.058-.042a19.881 19.881 0 0 0 4.551-4.537l.043-.058-.043-.058a20.123 20.123 0 0 0-2.093-2.458 19.732 19.732 0 0 0-2.458-2.08L10 5.364l-.058.042A19.883 19.883 0 0 0 5.39 9.942L5.348 10l.042.059c.631.874 1.332 1.695 2.094 2.457a19.74 19.74 0 0 0 2.458 2.08zm6.366-10.902c-.293-.293-.736-.431-1.298-.431-.998 0-2.248.429-3.556 1.163l-.132.074.12.092a21.938 21.938 0 0 1 3.968 3.968l.092.12.074-.132c.282-.504.524-1.004.711-1.492.29-.753.442-1.442.45-2.017.007-.572-.129-1.045-.429-1.345zM3.712 7.055c.202.514.44 1.013.712 1.493l.074.13.092-.119a21.94 21.94 0 0 1 3.968-3.968l.12-.092-.132-.074C7.238 3.69 5.987 3.262 4.99 3.262c-.563 0-1.006.138-1.298.43-.3.301-.436.774-.428 1.346.007.575.159 1.264.448 2.017zm0 5.89c-.29.753-.44 1.442-.448 2.017-.008.572.127 1.045.428 1.345.293.293.736.431 1.298.431.997 0 2.247-.428 3.556-1.162l.131-.074-.12-.093a21.94 21.94 0 0 1-3.967-3.968l-.093-.12-.074.132a11.712 11.712 0 0 0-.71 1.492z" fill="currentColor" stroke="currentColor" stroke-width=".1"></path><path d="M10.706 11.704A1.843 1.843 0 0 1 8.155 10a1.845 1.845 0 1 1 2.551 1.704z" fill="currentColor" stroke="currentColor" stroke-width=".2"></path></svg></div>已深度思考（用时 236 秒）<div class="ds-icon _54f4262" style="font-size: 10px; width: 10px; height: 10px; transform: rotate(180deg);"><svg width="10" height="6" viewBox="0 0 10 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5.786 4.167L2.765 1.259c-.416-.4-.985-.482-1.273-.183-.287.298-.183.864.233 1.264l3.021 2.908c.416.4.986.482 1.273.184.287-.299.183-.865-.233-1.265z" fill="currentColor"></path><path d="M8.197 1.206L5.288 4.208c-.4.413-.484.982-.187 1.27.298.289.864.187 1.265-.227L9.274 2.25c.401-.414.485-.983.187-1.271-.297-.288-.863-.187-1.264.227z" fill="currentColor"></path></svg></div></div><div class="e1675d8b"><div class="_9ecc93a"></div>我们针对提出的三个问题进行改进：<div style="height: 6px;"></div><div style="height: 6px;"></div> 1. 国家兵力的文字显示超出了屏幕范围：<div style="height: 6px;"></div>    - 调整信息面板的布局，将电脑国家信息分行显示或者限制在一行内并自动换行。<div style="height: 6px;"></div><div style="height: 6px;"></div> 2. 移动士兵时移动整个方格上的所有士兵组：<div style="height: 6px;"></div>    - 目前是移动单个士兵组。根据新要求，当玩家选择一个方格（该方格上可能有多个士兵组）时，移动该方格上的所有士兵组。<div style="height: 6px;"></div>    - 修改选择逻辑：不再选择单个士兵组，而是选择整个方格。当玩家点击一个方格时，如果该方格属于玩家且有士兵组，则选中该方格的所有士兵组。<div style="height: 6px;"></div>    - 移动时，将这些士兵组全部移动到相邻的目标方格（如果目标方格是敌方，则发生战斗）。<div style="height: 6px;"></div><div style="height: 6px;"></div> 3. 新生成的士兵不能出现在他国领土上：<div style="height: 6px;"></div>    - 在生成新士兵组时，确保生成的位置是本国领土，并且不会在敌方领土上。<div style="height: 6px;"></div><div style="height: 6px;"></div> 具体修改计划：<div style="height: 6px;"></div><div style="height: 6px;"></div> 问题1：调整信息面板<div style="height: 6px;"></div>   - 将电脑国家信息显示在信息面板的下方，并分多行显示。<div style="height: 6px;"></div><div style="height: 6px;"></div> 问题2：移动整个方格的士兵组<div style="height: 6px;"></div>   - 修改`handle_click`方法：当玩家点击一个方格时，选中该方格（而不是单个士兵组）。记录该方格的位置和所有士兵组。<div style="height: 6px;"></div>   - 在移动时，将选中的所有士兵组一起移动到目标方格。<div style="height: 6px;"></div>   - 战斗计算时，使用移动的士兵组总数（a）与目标方格的士兵组总数（b）进行比较。<div style="height: 6px;"></div><div style="height: 6px;"></div> 问题3：确保新士兵生成在己方领土<div style="height: 6px;"></div>   - 在`add_territory`方法中，我们已经是在己方领土中随机选择位置。但是要确保这个位置没有其他国家的士兵？实际上，一个方格只能属于一个国家，所以我们只需要确保该位置属于本国即可。<div style="height: 6px;"></div>   - 但是，我们生成新士兵组时，是直接追加到该位置的士兵组列表中的，所以没有问题。<div style="height: 6px;"></div><div style="height: 6px;"></div> 由于改动较大，我们重新组织代码：<div style="height: 6px;"></div><div style="height: 6px;"></div> 步骤：<div style="height: 6px;"></div> 1. 在`Game`类中，将`selected_troop`改为`selected_tile`，用于记录选中的方格位置（x,y）。<div style="height: 6px;"></div> 2. 修改`handle_click`：第一次点击选中一个方格（如果该方格属于玩家并且有士兵组），第二次点击相邻方格则移动。<div style="height: 6px;"></div> 3. 移动时，将原方格的所有士兵组移动到目标方格，并清空原方格的士兵组（如果原方格变为无士兵且无领土？注意：原方格仍然是玩家领土，只是没有士兵组了）。<div style="height: 6px;"></div> 4. 战斗计算：移动的士兵组数量（a）与目标方格的士兵组数量（b）进行比较，按照规则进行。<div style="height: 6px;"></div><div style="height: 6px;"></div> 注意：原方格在移动后可能变为无士兵组，但仍然是玩家领土。<div style="height: 6px;"></div><div style="height: 6px;"></div> 另外，电脑AI的移动逻辑也需要修改为移动整个方格的士兵组？但问题描述只要求玩家这样。我们可以先修改玩家部分。<div style="height: 6px;"></div><div style="height: 6px;"></div> 根据要求，我们只修改玩家移动为整个方格的移动，电脑AI仍然移动一组士兵（或者也可以修改为整个方格？但问题描述没有要求）。我们先按照要求只修改玩家。<div style="height: 6px;"></div><div style="height: 6px;"></div> 但是，为了平衡性，电脑AI也应该可以移动整个方格的士兵组。不过，我们先实现玩家的，电脑AI可以后续再调整。<div style="height: 6px;"></div><div style="height: 6px;"></div> 由于时间关系，我们先按以下方案：<div style="height: 6px;"></div><div style="height: 6px;"></div> 玩家：移动整个方格的士兵组（即一个方格上所有士兵组一起移动）<div style="height: 6px;"></div> 电脑AI：仍然移动一个士兵组（即移动一组士兵）<div style="height: 6px;"></div><div style="height: 6px;"></div> 这样玩家和电脑的移动方式不同，玩家可以一次性移动多个，电脑每次移动一个。<div style="height: 6px;"></div><div style="height: 6px;"></div> 也可以修改电脑AI移动整个方格？但为了简单，我们先这样。<div style="height: 6px;"></div><div style="height: 6px;"></div> 修改后的玩家移动逻辑：<div style="height: 6px;"></div><div style="height: 6px;"></div>  步骤：<div style="height: 6px;"></div>    1. 玩家点击自己的一个领土方格（该方格有士兵组），则选中该方格（记录位置）。<div style="height: 6px;"></div>    2. 玩家再点击相邻的一个方格，则执行移动：<div style="height: 6px;"></div>        - 将原方格的所有士兵组移动到目标方格。<div style="height: 6px;"></div>        - 原方格的士兵组清空（但领土仍然是玩家的，只是没有士兵组了）。<div style="height: 6px;"></div>        - 目标方格的处理：<div style="height: 6px;"></div>            - 如果目标方格是空地：则占领，并设置玩家领土，士兵组为移动过来的所有士兵组。<div style="height: 6px;"></div>            - 如果目标方格是玩家领土：则合并（士兵组相加）。<div style="height: 6px;"></div>            - 如果目标方格是敌方领土：则发生战斗。<div style="height: 6px;"></div><div style="height: 6px;"></div> 战斗规则修改为：<div style="height: 6px;"></div>    a = 移动的士兵组数量（即原方格的所有士兵组数量）<div style="height: 6px;"></div>    b = 目标方格的士兵组数量（防守方数量）<div style="height: 6px;"></div>    计算 x = a - b<div style="height: 6px;"></div>    - 若x&gt;=0：则目标方格被占领，领土变为玩家的，并且士兵组数量变为x（如果x&gt;0，则留下x组士兵；如果x=0，则没有士兵，但领土还是玩家的？注意规则：x&gt;=0则划归入侵国，并具有x组士兵。所以如果x=0，则没有士兵组，但领土是玩家的）。<div style="height: 6px;"></div>    - 若x&lt;0：则防守方胜利，领土不变，士兵组数量变为 -x（即b-a，因为x是负数，所以-x为正）。<div style="height: 6px;"></div><div style="height: 6px;"></div> 注意：如果x=0，那么目标方格上的士兵组数量为0，但领土属于玩家。这允许吗？可以，领土上可以没有士兵组。<div style="height: 6px;"></div><div style="height: 6px;"></div> 另外，原方格在移动后，士兵组被清空，所以原方格就没有士兵组了，但领土还是玩家的。<div style="height: 6px;"></div><div style="height: 6px;"></div> 修改代码：<div style="height: 6px;"></div><div style="height: 6px;"></div> 1. 将`selected_troop`改为`selected_tile`，类型为元组(x,y)或None。<div style="height: 6px;"></div><div style="height: 6px;"></div> 2. 在`handle_click`中：<div style="height: 6px;"></div>     如果当前没有选中任何方格（selected_tile为None）：<div style="height: 6px;"></div>        如果点击的方格是玩家的并且有士兵组，则设置selected_tile为(x,y)<div style="height: 6px;"></div>     否则（已经选中了一个方格）：<div style="height: 6px;"></div>        检查点击的方格是否与选中的方格相邻<div style="height: 6px;"></div>        如果是相邻，则调用`move_troops(selected_x, selected_y, grid_x, grid_y)`<div style="height: 6px;"></div>        然后selected_tile置为None<div style="height: 6px;"></div><div style="height: 6px;"></div> 3. 重写`move_troops`方法（注意是移动整个方格的士兵组）：<div style="height: 6px;"></div>        - 获取原方格的所有士兵组（列表），记为moving_troops（注意：这些士兵组的位置信息需要更新到目标位置吗？不需要，因为士兵组的位置就是方格位置，我们移动整个方格，所以这些士兵组将不再属于原方格，而是属于新方格。在移动后，我们将这些士兵组的位置更新为目标方格的坐标？实际上，我们存储士兵组的位置就是坐标，所以移动后需要更新每个士兵组的坐标为新的位置。<div style="height: 6px;"></div><div style="height: 6px;"></div>        - 但是，注意：士兵组在`Country.troops`列表中存储的是位置列表，所以我们需要更新每个士兵组的位置到目标位置。<div style="height: 6px;"></div><div style="height: 6px;"></div>        - 步骤：<div style="height: 6px;"></div>            a. 从原方格中移除所有士兵组（清空troops列表）<div style="height: 6px;"></div>            b. 将这些士兵组的位置更新为目标位置（每个士兵组的位置更新为(to_x, to_y)）<div style="height: 6px;"></div>            c. 将这些士兵组添加到目标方格的troops列表中<div style="height: 6px;"></div><div style="height: 6px;"></div>        - 然后处理目标方格的领土变更：<div style="height: 6px;"></div>            情况1：目标方格为空<div style="height: 6px;"></div>                设置为玩家领土，士兵组为moving_troops<div style="height: 6px;"></div>                玩家领土+1（因为占领了新领土）<div style="height: 6px;"></div>                然后检查是否获得新士兵组（每3块领土）<div style="height: 6px;"></div><div style="height: 6px;"></div>            情况2：目标方格是玩家领土<div style="height: 6px;"></div>                直接将moving_troops合并到目标方格的troops列表中<div style="height: 6px;"></div><div style="height: 6px;"></div>            情况3：目标方格是敌方领土<div style="height: 6px;"></div>                战斗：<div style="height: 6px;"></div>                    a = len(moving_troops)<div style="height: 6px;"></div>                    b = len(目标方格的troops)<div style="height: 6px;"></div>                    x = a - b<div style="height: 6px;"></div>                    如果x&gt;=0:<div style="height: 6px;"></div>                        目标方格领土变为玩家，士兵组数量变为x（注意：如果x&gt;0，则留下x组士兵（从moving_troops中取x组？实际上，战斗后，移动过来的士兵组剩余x组，而防御方全部被消灭。所以，我们只需要留下x组士兵（从移动过来的士兵组中取x组），其余都消失？但是规则是计算差值，所以防御方士兵全部消失，进攻方剩下x组。<div style="height: 6px;"></div>                        因此，我们只需要保留x组士兵（从moving_troops中取x组）放在目标方格，其余的消失（从玩家的troops列表中移除）。<div style="height: 6px;"></div>                        同时，玩家领土增加1（因为占领了敌方领土），敌方领土减少1。<div style="height: 6px;"></div>                    如果x&lt;0:<div style="height: 6px;"></div>                        防御方胜利，目标方格的士兵组数量变为 -x（即b-a），但是防御方原有的士兵组全部保留？规则：具有-x组被入侵国士兵。注意，规则并没有说进攻方士兵组全部消失，而是说目标方格上留下-x组防御方士兵。但是防御方原本有b组士兵，战斗后应该剩下b - a（因为进攻方消灭了a组，但进攻方也被全部消灭）？不对，规则没有详细说明。<div style="height: 6px;"></div><div style="height: 6px;"></div>                重新阅读规则：<div style="height: 6px;"></div>                  若x&gt;=0则该方格被划归为入侵国领土，并具有x组入侵国士兵；<div style="height: 6px;"></div>                  若x&lt;0则该方格仍属于被入侵国领土，并具有-x组被入侵国士兵。<div style="height: 6px;"></div><div style="height: 6px;"></div>                所以，战斗后，无论胜负，双方士兵组都会消失，只剩下胜利方的士兵组，数量为|a-b|。<div style="height: 6px;"></div><div style="height: 6px;"></div>                因此，我们这样实现：<div style="height: 6px;"></div>                    - 战斗后，将目标方格的士兵组清空。<div style="height: 6px;"></div>                    - 如果x&gt;=0，则目标方格变为玩家领土，并放置x组士兵（从moving_troops中取前x组？但是移动的士兵组有a组，战斗后剩下x组，所以我们需要移除a-x组（即b组）？不对，战斗过程是相互消耗，我们直接按结果设置）。<div style="height: 6px;"></div>                    - 实际上，我们不需要关心过程，直接设置结果：<div style="height: 6px;"></div>                        胜利方：如果x&gt;=0，则玩家胜利；否则防御方胜利。<div style="height: 6px;"></div>                        士兵组数量：|x|（即胜利方的士兵组数量为|a-b|）<div style="height: 6px;"></div><div style="height: 6px;"></div>                但是，这些士兵组从哪里来？我们不可能凭空产生。所以，我们这样处理：<div style="height: 6px;"></div>                    - 将移动的士兵组（moving_troops）和防御方的士兵组（defending_troops）全部移除（从各自国家的troops列表中移除）。<div style="height: 6px;"></div>                    - 然后，在目标方格放置|a-b|组士兵，这些士兵属于胜利方。<div style="height: 6px;"></div><div style="height: 6px;"></div>                但是，问题：这些士兵组的位置？就是目标方格的位置。<div style="height: 6px;"></div><div style="height: 6px;"></div>                所以，在战斗后：<div style="height: 6px;"></div>                    - 移除所有移动的士兵组（因为它们在战斗中消耗了）和防御方的士兵组（同样消耗了）。<div style="height: 6px;"></div>                    - 然后在目标方格生成|a-b|组新的士兵组，属于胜利方。<div style="height: 6px;"></div><div style="height: 6px;"></div>                但是，这样会有一个问题：新生成的士兵组会立即被算作该国的士兵组，并且位置在目标方格。<div style="height: 6px;"></div><div style="height: 6px;"></div>                步骤：<div style="height: 6px;"></div>                  1. 记录 a = len(moving_troops), b = len(defending_troops)<div style="height: 6px;"></div>                  2. 计算 x = a - b<div style="height: 6px;"></div>                  3. 清空目标方格的士兵组（因为战斗后原来的都消耗掉了）<div style="height: 6px;"></div>                  4. 移除移动的士兵组（从玩家士兵组列表中移除这些士兵组）<div style="height: 6px;"></div>                  5. 移除防御方的士兵组（从防御方国家的士兵组列表中移除）<div style="height: 6px;"></div>                  6. 如果x&gt;=0:<div style="height: 6px;"></div>                        目标方格领土变为玩家<div style="height: 6px;"></div>                        生成x组新士兵组（位置为目标方格），添加到目标方格的troops列表和玩家的troops列表<div style="height: 6px;"></div>                        玩家领土增加（因为占领了这块领土，注意：如果原本就是玩家的领土？不可能，因为正在攻击敌方领土。所以这里玩家领土增加1？但是原本这块领土是敌方的，现在变成玩家的，所以玩家领土增加1，敌方领土减少1。<div style="height: 6px;"></div>                  7. 如果x&lt;0:<div style="height: 6px;"></div>                        目标方格领土不变（仍然是防御方）<div style="height: 6px;"></div>                        生成-x组新士兵组（位置为目标方格），添加到目标方格的troops列表和防御方国家的troops列表<div style="height: 6px;"></div>                        注意：领土数量不变（因为还是防御方的）<div style="height: 6px;"></div><div style="height: 6px;"></div>                但是，这样实现会有一个问题：我们无法生成新的士兵组（因为士兵组只是位置列表，我们只需要创建-x个新的士兵组，位置为目标方格的坐标）。<div style="height: 6px;"></div><div style="height: 6px;"></div>                另外，注意：如果x=0，则没有士兵组留在目标方格，但领土属于玩家（即敌方领土被占领，但玩家没有士兵组留在那里）。<div style="height: 6px;"></div><div style="height: 6px;"></div>                但是，规则要求：x&gt;=0时，具有x组入侵国士兵。所以如果x=0，那么就没有士兵组。<div style="height: 6px;"></div><div style="height: 6px;"></div>                所以，在x&gt;=0时，如果x&gt;0，我们就创建x组士兵放在目标方格；如果x=0，则不放士兵组（空列表）。<div style="height: 6px;"></div><div style="height: 6px;"></div>                但是，这样会导致一个问题：如果目标方格没有士兵组，那么它可能很容易被敌人夺回。<div style="height: 6px;"></div><div style="height: 6px;"></div>                我们按照规则实现。<div style="height: 6px;"></div><div style="height: 6px;"></div> 这个改动很大，我们一步一步来。<div style="height: 6px;"></div><div style="height: 6px;"></div> 由于时间限制，我们可能先实现玩家移动整个方格的士兵组，而战斗规则保持不变（即仍然使用单个士兵组战斗）？不，因为现在移动的是多个士兵组，所以战斗规则必须修改。<div style="height: 6px;"></div><div style="height: 6px;"></div> 我们重新设计战斗处理函数（针对多个士兵组的移动）：<div style="height: 6px;"></div><div style="height: 6px;"></div> 修改后的`resolve_battle`函数（针对玩家移动多个士兵组到敌方领土）：<div style="height: 6px;"></div><div style="height: 6px;"></div>    参数：目标方格位置 (x, y)，以及移动过来的士兵组列表 moving_troops<div style="height: 6px;"></div><div style="height: 6px;"></div>    步骤：<div style="height: 6px;"></div>        defending_troops = 目标方格的士兵组列表<div style="height: 6px;"></div>        a = len(moving_troops)<div style="height: 6px;"></div>        b = len(defending_troops)<div style="height: 6px;"></div>        x = a - b<div style="height: 6px;"></div><div style="height: 6px;"></div>        if x &gt;= 0:<div style="height: 6px;"></div>            # 进攻方胜利<div style="height: 6px;"></div>            # 1. 清除防御方士兵组：从防御方国家中移除这些士兵组<div style="height: 6px;"></div>            defending_country = self.grid[y][x]['country']<div style="height: 6px;"></div>            for troop in defending_troops:<div style="height: 6px;"></div>                defending_country.troops.remove(troop)<div style="height: 6px;"></div><div style="height: 6px;"></div>            # 2. 将目标方格设置为玩家领土<div style="height: 6px;"></div>            self.grid[y][x]['country'] = self.player_country<div style="height: 6px;"></div><div style="height: 6px;"></div>            # 3. 设置目标方格的士兵组：我们留下x组士兵（从moving_troops中取前x组？但是移动的士兵组也要移除，然后重新生成x组士兵？不，我们直接使用移动的士兵组，但只保留x组。<div style="height: 6px;"></div>            # 但是，移动的士兵组已经全部过来了，战斗后应该消耗掉a个士兵组，然后剩下x组。所以我们从moving_troops中取x组（实际上，我们只需要x组，其余的移除）。<div style="height: 6px;"></div>            # 注意：moving_troops中每个士兵组的位置已经更新为目标位置？还没有，我们在移动过程中先更新位置，然后才发生战斗。所以，我们先更新位置，然后移除多余的士兵组。<div style="height: 6px;"></div><div style="height: 6px;"></div>            # 但是，我们还没有更新位置到目标位置，所以先更新所有moving_troops中士兵组的位置为目标位置（在移动函数中已经更新？）<div style="height: 6px;"></div><div style="height: 6px;"></div>            # 移除多余的士兵组：移动的士兵组中，我们只保留x组，其余的从玩家的troops列表中移除。<div style="height: 6px;"></div>            # 注意：moving_troops中的士兵组已经更新了位置，但是这些士兵组还没有添加到目标方格的troops列表中（因为战斗还没处理）？我们在移动函数中，是先移除原方格的士兵组，然后更新位置，然后进行战斗，然后战斗后再添加到目标方格？不，因为战斗可能改变士兵组的数量。<div style="height: 6px;"></div><div style="height: 6px;"></div>            # 所以，我们这样处理：在战斗前，我们并没有将moving_troops添加到目标方格。战斗后，我们根据结果添加。<div style="height: 6px;"></div><div style="height: 6px;"></div>            # 因此，修改移动函数的步骤：<div style="height: 6px;"></div>            #   - 从原方格移除moving_troops<div style="height: 6px;"></div>            #   - 更新moving_troops中每个士兵组的位置到目标位置<div style="height: 6px;"></div>            #   - 然后，如果目标方格是敌方，则进行战斗（此时目标方格的士兵组还是原来的防御方士兵组）<div style="height: 6px;"></div>            #   - 战斗后，根据结果设置目标方格的士兵组。<div style="height: 6px;"></div><div style="height: 6px;"></div>            # 所以，在战斗函数中，我们不需要关心moving_troops是否已经添加到目标方格，因为还没有添加。<div style="height: 6px;"></div><div style="height: 6px;"></div>            # 战斗胜利后：<div style="height: 6px;"></div>            #   - 目标方格的士兵组设置为：从moving_troops中取x组（前x个）？但是，我们也可以理解为战斗后剩下x组，所以任意x组都可以。<div style="height: 6px;"></div>            #   - 将剩下的x组士兵添加到目标方格<div style="height: 6px;"></div>            #   - 同时，从moving_troops中移除多余的士兵组（即a-x组），并从玩家的troops列表中移除这些多余的士兵组。<div style="height: 6px;"></div><div style="height: 6px;"></div>            # 但是，注意：我们移动的士兵组已经在玩家的troops列表中，并且我们已经更新了它们的位置。所以，对于被移除的士兵组，我们需要从玩家的troops列表中移除。<div style="height: 6px;"></div><div style="height: 6px;"></div>            # 移除多于的士兵组（即被消耗的士兵组）：<div style="height: 6px;"></div>            troops_to_remove = moving_troops[x:]   # 保留前x个，移除后面的<div style="height: 6px;"></div>            for troop in troops_to_remove:<div style="height: 6px;"></div>                self.player_country.troops.remove(troop)<div style="height: 6px;"></div><div style="height: 6px;"></div>            # 然后，将保留的x组士兵（moving_troops[0:x]）添加到目标方格的troops列表中<div style="height: 6px;"></div>            self.grid[y][x]['troops'] = moving_troops[0:x]   # 注意：如果x=0，则空列表<div style="height: 6px;"></div><div style="height: 6px;"></div>            # 领土变更：目标方格从敌方领土变为玩家领土，所以玩家领土+1，敌方领土-1<div style="height: 6px;"></div>            self.player_country.territory += 1<div style="height: 6px;"></div>            defending_country.territory -= 1<div style="height: 6px;"></div><div style="height: 6px;"></div>            # 然后，检查玩家是否应该获得新士兵组（因为领土增加）<div style="height: 6px;"></div>            self.player_country.add_territory(self)<div style="height: 6px;"></div><div style="height: 6px;"></div>            # 检查防御方国家是否被击败<div style="height: 6px;"></div>            if defending_country.territory &lt;= 0:<div style="height: 6px;"></div>                defending_country.defeated = True<div style="height: 6px;"></div><div style="height: 6px;"></div>        else: # x&lt;0<div style="height: 6px;"></div>            # 防御方胜利<div style="height: 6px;"></div>            # 1. 清除进攻方士兵组：从玩家的troops列表中移除所有moving_troops<div style="height: 6px;"></div>            for troop in moving_troops:<div style="height: 6px;"></div>                self.player_country.troops.remove(troop)<div style="height: 6px;"></div><div style="height: 6px;"></div>            # 2. 防御方也会损失士兵组：需要移除| x |组士兵（即b - a组），但是规则是留下-x组防御方士兵。<div style="height: 6px;"></div>            # 所以，防御方需要移除 b - (-x) = b + x 组士兵？不对，规则是留下-x组士兵（即b+a-x?），不对。<div style="height: 6px;"></div><div style="height: 6px;"></div>            # 规则：具有-x组被入侵国士兵（即| x |组士兵）<div style="height: 6px;"></div>            # 所以防御方需要从原来的b组士兵中移除 b - |x| 组士兵，留下|x|组士兵。<div style="height: 6px;"></div><div style="height: 6px;"></div>            # 因此，我们随机移除 b - |x| 组士兵。<div style="height: 6px;"></div>            # 注意：x为负数，|x| = -x<div style="height: 6px;"></div>            remove_count = b - (-x)   # b - ( -x ) = b + x   (x为负，所以b+x)<div style="height: 6px;"></div>            # 由于x = a - b, 且x&lt;0, 所以b&gt;a, remove_count = b - (b - a) = a<div style="height: 6px;"></div><div style="height: 6px;"></div>            # 所以，防御方需要移除a组士兵（因为进攻方有a组，防御方损失a组，剩下b-a组，即|x|组）。<div style="height: 6px;"></div><div style="height: 6px;"></div>            # 因此，我们从防御方士兵组中随机移除a组士兵。<div style="height: 6px;"></div>            troops_to_remove = random.sample(defending_troops, a) if a &lt; b else defending_troops[:]<div style="height: 6px;"></div>            for troop in troops_to_remove:<div style="height: 6px;"></div>                defending_country.troops.remove(troop)<div style="height: 6px;"></div>                defending_troops.remove(troop)<div style="height: 6px;"></div><div style="height: 6px;"></div>            # 然后，设置目标方格的士兵组为defending_troops中剩下的士兵组（即b+a-x? 不对，剩下b-a组，即|x|组）<div style="height: 6px;"></div>            # 但是，我们上面已经移除了a组，所以剩下b-a组，正好是|x|组。<div style="height: 6px;"></div>            self.grid[y][x]['troops'] = defending_troops   # 剩下的士兵组<div style="height: 6px;"></div><div style="height: 6px;"></div>            # 注意：领土不变，所以不需要变更领土计数。<div style="height: 6px;"></div><div style="height: 6px;"></div>            # 但是，防御方士兵组的位置我们并没有改变，所以不用更新。<div style="height: 6px;"></div><div style="height: 6px;"></div> 这个战斗函数非常复杂，而且容易出错。我们可能还需要考虑移动士兵组在战斗后是否要保留（在防御方胜利时，进攻方士兵组全部被移除）。<div style="height: 6px;"></div><div style="height: 6px;"></div> 由于改动太大，而且时间有限，我们可能会选择简化规则：移动整个方格的士兵组，战斗时直接比较总数，然后胜利方保留|a-b|组士兵（在目标方格），而失败方的士兵组全部消失，胜利方的士兵组也消失，然后生成|a-b|组新的士兵组（属于胜利方）放在目标方格。<div style="height: 6px;"></div><div style="height: 6px;"></div> 但是，这样会有一个问题：士兵组是实体，我们这样直接移除和生成，会使得士兵组的位置变化记录不完整。<div style="height: 6px;"></div><div style="height: 6px;"></div> 考虑到时间，我们暂时不修改战斗规则，而是采用另一种方式：移动整个方格的士兵组，但战斗时，我们并不是移动所有士兵组去战斗，而是将整个方格的士兵组“合并”为一支部队，然后与目标方格的部队战斗。<div style="height: 6px;"></div><div style="height: 6px;"></div> 我们也可以不改变战斗规则，而是将移动的士兵组数量作为进攻方数量，与目标方格的防守方数量进行战斗，然后根据差值更新目标方格的士兵组数量。但是，我们之前存储的是士兵组列表，每个士兵组是一个独立单位。为了简化，我们可以改变数据表示：不再存储每个士兵组的位置列表，而是存储每个方格上的士兵组数量（整数）。这样，移动时就是将数量从一个方格移动到另一个方格。<div style="height: 6px;"></div><div style="height: 6px;"></div> 但是，这个改动会影响整个游戏架构。<div style="height: 6px;"></div><div style="height: 6px;"></div> 鉴于时间，我们折中：<div style="height: 6px;"></div><div style="height: 6px;"></div> 由于我们原本的士兵组就是用列表存储的，一个方格上的士兵组数量就是列表长度。所以，我们可以将战斗规则改为比较数量，而不是比较组数（一组士兵我们视为1个战斗力）。<div style="height: 6px;"></div><div style="height: 6px;"></div> 所以，我们这样实现：<div style="height: 6px;"></div><div style="height: 6px;"></div>   - 移动时，移动原方格的所有士兵组（数量为a）到目标方格。<div style="height: 6px;"></div>   - 如果目标方格是敌方，则战斗：<div style="height: 6px;"></div>        a = 进攻方士兵组数量（原方格的士兵组数量）<div style="height: 6px;"></div>        b = 防守方士兵组数量（目标方格的士兵组数量）<div style="height: 6px;"></div>        x = a - b<div style="height: 6px;"></div>        如果x&gt;=0：<div style="height: 6px;"></div>            进攻方胜利，目标方格变为玩家领土，并且士兵组数量设置为x（即我们只需要将进攻方士兵组中的x组留在目标方格，其余的移除？或者理解为战斗后剩下x组）<div style="height: 6px;"></div>            具体操作：将原方格的士兵组列表清空，目标方格的士兵组列表设置为一个包含x组士兵的列表（每个士兵组的位置为目标方格）。注意：我们不需要真的创建x组士兵，而是用x组来表示。但是，我们之前是一个一个士兵组存储的，所以我们需要创建x组士兵放在目标方格。<div style="height: 6px;"></div><div style="height: 6px;"></div>        如果x&lt;0：<div style="height: 6px;"></div>            防守方胜利，目标方格士兵组数量变为-x（即b-a），进攻方士兵组全部消失。<div style="height: 6px;"></div><div style="height: 6px;"></div>  但是，这样就需要创建和销毁士兵组，而且士兵组的位置信息会丢失。<div style="height: 6px;"></div><div style="height: 6px;"></div> 因此，我们改变存储方式：每个方格不再存储士兵组列表，而是存储一个整数（士兵数量）和一个国家标记。同时，每个国家也不再存储士兵组列表，而是存储每个方格的士兵数量？<div style="height: 6px;"></div><div style="height: 6px;"></div> 但是，题目要求不同组的士兵可以分别控制，但我们现在改为移动整个方格，所以不再需要分别控制。<div style="height: 6px;"></div><div style="height: 6px;"></div> 由于题目要求“不同组的士兵可以分别进行控制”，但我们修改为移动整个方格的士兵组，所以实际上一个方格上的士兵组被作为一个整体控制了。这符合要求吗？题目没有说明移动单位是单个士兵组还是方格上的所有士兵组。<div style="height: 6px;"></div><div style="height: 6px;"></div> 考虑到时间，我们决定简化：将每个方格上的士兵组数量存储为一个整数，而不是列表。<div style="height: 6px;"></div><div style="height: 6px;"></div> 这将大大简化我们的代码：<div style="height: 6px;"></div><div style="height: 6px;"></div>   - 在Country类中，我们可以移除troops列表，改为只记录领土和士兵数量？不，士兵数量是分散在每个方格上的。<div style="height: 6px;"></div><div style="height: 6px;"></div>   - 在grid中，每个格子存储：<div style="height: 6px;"></div>        country: 国家<div style="height: 6px;"></div>        troop_count: 整数，士兵组数量<div style="height: 6px;"></div><div style="height: 6px;"></div>   - 移动时，玩家选择一个方格，然后选择相邻方格，将源方格的troop_count全部移动到目标方格。<div style="height: 6px;"></div><div style="height: 6px;"></div>   - 战斗：a = 源方格的troop_count, b = 目标方格的troop_count, 然后x = a - b，然后按规则设置目标方格的troop_count = |x|，并且国家为胜利方。<div style="height: 6px;"></div><div style="height: 6px;"></div>   - 领土奖励：每个国家每3个领土，可以在任意一个自己的领土上增加一个士兵组（即troop_count加1）。<div style="height: 6px;"></div><div style="height: 6px;"></div> 这个改动影响非常大，几乎要重写。但是，这样更简单，也符合问题描述。<div style="height: 6px;"></div><div style="height: 6px;"></div> 我们权衡一下：由于时间，我们选择重写为基于数量的表示。<div style="height: 6px;"></div><div style="height: 6px;"></div> 重写计划：<div style="height: 6px;"></div><div style="height: 6px;"></div> 1. 修改Country类：<div style="height: 6px;"></div>       移除troops列表，因为我们不再单独存储每个士兵组。<div style="height: 6px;"></div>       保留territory（领土数量）和 next_reward。<div style="height: 6px;"></div><div style="height: 6px;"></div> 2. 修改grid单元格结构：<div style="height: 6px;"></div>       原来：{'country': country_obj, 'troops': list of troops}<div style="height: 6px;"></div>       改为：{'country': country_obj, 'troop_count': int}<div style="height: 6px;"></div><div style="height: 6px;"></div> 3. 修改初始化：每个国家初始方格troop_count=1。<div style="height: 6px;"></div><div style="height: 6px;"></div> 4. 玩家移动：<div style="height: 6px;"></div>       选中一个方格（源方格），然后移动到相邻方格（目标方格）：<div style="height: 6px;"></div>          源方格的troop_count设置为0（注意：源方格领土还是属于玩家的，只是没有兵了）<div style="height: 6px;"></div>          目标方格的troop_count增加源方格的troop_count（如果是友方或空地）？不，战斗要另外计算。<div style="height: 6px;"></div><div style="height: 6px;"></div>       如果是空地：直接占领，troop_count = 源方格的troop_count<div style="height: 6px;"></div>       如果是友方：合并， troop_count 目标 += 源<div style="height: 6px;"></div>       如果是敌方：战斗， troop_count 目标 = |a-b|，并且国家改变（如果进攻方胜利）。<div style="height: 6px;"></div><div style="height: 6px;"></div> 5. 战斗：<div style="height: 6px;"></div>        a = 源方格的 troop_count (移动的全部数量)<div style="height: 6px;"></div>        b = 目标方格的 troop_count<div style="height: 6px;"></div>        x = a - b<div style="height: 6px;"></div>        if x&gt;=0:<div style="height: 6px;"></div>            目标方格的国家 = 进攻方（玩家）<div style="height: 6px;"></div>            目标方格的 troop_count = x   # 注意：如果x=0，那么就是0<div style="height: 6px;"></div>            进攻方（玩家）领土变化：如果目标方格原本不是玩家的，那么玩家领土+1，防御方领土-1<div style="height: 6px;"></div>        else:<div style="height: 6px;"></div>            目标方格的国家不变<div style="height: 6px;"></div>            目标方格的 troop_count = -x<div style="height: 6px;"></div>            注意：领土数量不变<div style="height: 6px;"></div><div style="height: 6px;"></div> 6. 士兵组生成：每3块领土，玩家可以在任意一个自己的领土上增加1个士兵组（troop_count加1）。注意：是任意一个，我们随机选择一个己方领土。<div style="height: 6px;"></div><div style="height: 6px;"></div> 7. 电脑AI移动：选择一个有士兵组的己方格，随机选一个相邻格，移动整个方格的士兵组（同玩家）。<div style="height: 6px;"></div><div style="height: 6px;"></div> 8. 修改显示：不再显示士兵组列表，而是显示troop_count。<div style="height: 6px;"></div><div style="height: 6px;"></div> 9. 选中高亮：选中一个方格，高亮该方格。<div style="height: 6px;"></div><div style="height: 6px;"></div> 由于这是一个重大的改动，我们需要时间，但这样可以一劳永逸地解决问题。<div style="height: 6px;"></div><div style="height: 6px;"></div> 鉴于时间，我们决定进行重构。<div style="height: 6px;"></div><div style="height: 6px;"></div> 由于篇幅限制，我在这里将只写出重构后的部分关键代码，但尽量完成。<div style="height: 6px;"></div><div style="height: 6px;"></div> 注意：我们之前已经写了一部分，所以尽量复用。<div style="height: 6px;"></div><div style="height: 6px;"></div> 开始重构：<div style="height: 6px;"></div><div style="height: 6px;"></div> 步骤1：修改Country类，移除troops，修改add_territory方法（每3块领土，随机在一个己方领土上增加一个士兵）</div></div><div class="ds-markdown ds-markdown--block" style="--ds-md-zoom: 1.143;"><p class="ds-markdown-paragraph">我发现了这些问题，让我们进行改进：</p><h3>问题分析</h3><ol start="1"><li><p class="ds-markdown-paragraph"><strong>文字显示超出屏幕</strong>：</p><ul><li><p class="ds-markdown-paragraph">信息面板空间有限，需要调整布局</p></li><li><p class="ds-markdown-paragraph">电脑国家信息需要换行显示</p></li></ul></li><li><p class="ds-markdown-paragraph"><strong>移动整个方格上的士兵</strong>：</p><ul><li><p class="ds-markdown-paragraph">当前只移动单个士兵组，需要改为移动整个方格上的所有士兵组</p></li><li><p class="ds-markdown-paragraph">需要修改选择逻辑和移动逻辑</p></li></ul></li><li><p class="ds-markdown-paragraph"><strong>新士兵生成位置</strong>：</p><ul><li><p class="ds-markdown-paragraph">确保新士兵只生成在己方领土上</p></li><li><p class="ds-markdown-paragraph">需要优化士兵生成算法</p></li></ul></li></ol><h3>修复后的完整代码</h3><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre><span class="token keyword">import</span> pygame
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> random
<span class="token keyword">import</span> math
<span class="token keyword">from</span> pygame<span class="token punctuation">.</span><span class="token builtin">locals</span> <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token comment"># 初始化pygame</span>
pygame<span class="token punctuation">.</span>init<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 游戏常量</span>
SCREEN_WIDTH <span class="token operator">=</span> <span class="token number">1000</span>
SCREEN_HEIGHT <span class="token operator">=</span> <span class="token number">700</span>
GRID_SIZE <span class="token operator">=</span> <span class="token number">20</span>
GRID_WIDTH <span class="token operator">=</span> <span class="token number">40</span>
GRID_HEIGHT <span class="token operator">=</span> <span class="token number">30</span>
TILE_SIZE <span class="token operator">=</span> <span class="token number">20</span>

<span class="token comment"># 尝试加载中文字体</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token comment"># 尝试常见的中文字体</span>
    FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token string">"SimHei"</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
    LARGE_FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token string">"SimHei"</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>
    SMALL_FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token string">"SimHei"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>
<span class="token keyword">except</span><span class="token punctuation">:</span>
    <span class="token comment"># 回退到默认字体</span>
    FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
    LARGE_FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>
    SMALL_FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>

<span class="token comment"># 颜色</span>
BACKGROUND <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
GRID_COLOR <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
WHITE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
BLACK <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
RED <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
GREEN <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
BLUE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
YELLOW <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
PURPLE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
CYAN <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
ORANGE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">165</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
PINK <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span>
COLORS <span class="token operator">=</span> <span class="token punctuation">[</span>RED<span class="token punctuation">,</span> BLUE<span class="token punctuation">,</span> YELLOW<span class="token punctuation">,</span> PURPLE<span class="token punctuation">,</span> CYAN<span class="token punctuation">,</span> ORANGE<span class="token punctuation">,</span> PINK<span class="token punctuation">]</span>  <span class="token comment"># 增加更多颜色</span>
HIGHLIGHT <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Country</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> color<span class="token punctuation">,</span> name<span class="token punctuation">,</span> is_player<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>color <span class="token operator">=</span> color
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>is_player <span class="token operator">=</span> is_player
        self<span class="token punctuation">.</span>territory <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># 存储士兵组的位置坐标</span>
        self<span class="token punctuation">.</span>next_reward <span class="token operator">=</span> <span class="token number">3</span>
        self<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">add_territory</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> game<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""增加领土并检查是否应生成新士兵组"""</span>
        <span class="token comment"># 每占领3块领土获得一个新的士兵组</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>territory <span class="token operator">&gt;=</span> self<span class="token punctuation">.</span>next_reward<span class="token punctuation">:</span>
            <span class="token comment"># 更新奖励阈值</span>
            self<span class="token punctuation">.</span>next_reward <span class="token operator">+=</span> <span class="token number">3</span>
            
            <span class="token comment"># 在随机领土上生成新士兵组</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                <span class="token comment"># 收集所有安全的领土位置（仅限己方领土且无士兵重叠）</span>
                safe_positions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">if</span> game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token keyword">and</span> game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> self<span class="token punctuation">:</span>
                            <span class="token comment"># 确保不在他国领土上</span>
                            is_safe <span class="token operator">=</span> <span class="token boolean">True</span>
                            <span class="token keyword">for</span> dx<span class="token punctuation">,</span> dy <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                                nx<span class="token punctuation">,</span> ny <span class="token operator">=</span> x <span class="token operator">+</span> dx<span class="token punctuation">,</span> y <span class="token operator">+</span> dy
                                <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> nx <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> ny <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">:</span>
                                    <span class="token keyword">if</span> game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>ny<span class="token punctuation">]</span><span class="token punctuation">[</span>nx<span class="token punctuation">]</span> <span class="token keyword">and</span> game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>ny<span class="token punctuation">]</span><span class="token punctuation">[</span>nx<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> self<span class="token punctuation">:</span>
                                        is_safe <span class="token operator">=</span> <span class="token boolean">False</span>
                                        <span class="token keyword">break</span>
                            
                            <span class="token keyword">if</span> is_safe<span class="token punctuation">:</span>
                                safe_positions<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
                
                <span class="token keyword">if</span> safe_positions<span class="token punctuation">:</span>
                    <span class="token comment"># 随机选择一个安全位置</span>
                    x<span class="token punctuation">,</span> y <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>safe_positions<span class="token punctuation">)</span>
                    
                    <span class="token comment"># 创建新士兵组</span>
                    new_troop <span class="token operator">=</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span>
                    
                    <span class="token comment"># 添加到国家士兵列表</span>
                    self<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_troop<span class="token punctuation">)</span>
                    
                    <span class="token comment"># 添加到网格</span>
                    game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_troop<span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

<span class="token keyword">class</span> <span class="token class-name">Game</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>screen <span class="token operator">=</span> pygame<span class="token punctuation">.</span>display<span class="token punctuation">.</span>set_mode<span class="token punctuation">(</span><span class="token punctuation">(</span>SCREEN_WIDTH<span class="token punctuation">,</span> SCREEN_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">)</span>
        pygame<span class="token punctuation">.</span>display<span class="token punctuation">.</span>set_caption<span class="token punctuation">(</span><span class="token string">"领土征服者"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>clock <span class="token operator">=</span> pygame<span class="token punctuation">.</span>time<span class="token punctuation">.</span>Clock<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 创建国家</span>
        self<span class="token punctuation">.</span>countries <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>player_country <span class="token operator">=</span> Country<span class="token punctuation">(</span>GREEN<span class="token punctuation">,</span> <span class="token string">"玩家"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>countries<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>player_country<span class="token punctuation">)</span>
        
        <span class="token comment"># 创建电脑国家 (使用不同颜色)</span>
        ai_names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"红国"</span><span class="token punctuation">,</span> <span class="token string">"蓝国"</span><span class="token punctuation">,</span> <span class="token string">"黄国"</span><span class="token punctuation">,</span> <span class="token string">"紫国"</span><span class="token punctuation">,</span> <span class="token string">"青国"</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 创建5个电脑国家</span>
            color_idx <span class="token operator">=</span> i <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>COLORS<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>countries<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Country<span class="token punctuation">(</span>COLORS<span class="token punctuation">[</span>color_idx<span class="token punctuation">]</span><span class="token punctuation">,</span> ai_names<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 初始化网格</span>
        self<span class="token punctuation">.</span>grid <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token boolean">None</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>selected_tile <span class="token operator">=</span> <span class="token boolean">None</span>  <span class="token comment"># 改为选择整个方格</span>
        self<span class="token punctuation">.</span>game_over <span class="token operator">=</span> <span class="token boolean">False</span>
        self<span class="token punctuation">.</span>winner <span class="token operator">=</span> <span class="token boolean">None</span>
        
        <span class="token comment"># 初始化领土和士兵</span>
        self<span class="token punctuation">.</span>initialize_game<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">initialize_game</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 为每个国家分配初始领土</span>
        positions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>countries<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
                x <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> GRID_WIDTH <span class="token operator">-</span> <span class="token number">6</span><span class="token punctuation">)</span>
                y <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">-</span> <span class="token number">6</span><span class="token punctuation">)</span>
                <span class="token comment"># 确保初始位置不重叠且有一定间距</span>
                too_close <span class="token operator">=</span> <span class="token boolean">False</span>
                <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> positions<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>px <span class="token operator">-</span> x<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">8</span> <span class="token keyword">and</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>py <span class="token operator">-</span> y<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">:</span>
                        too_close <span class="token operator">=</span> <span class="token boolean">True</span>
                        <span class="token keyword">break</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> too_close <span class="token keyword">and</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">not</span> <span class="token keyword">in</span> positions<span class="token punctuation">:</span>
                    positions<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
                        <span class="token string">'country'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>countries<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token string">'troops'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">]</span>  <span class="token comment"># 初始士兵组</span>
                    <span class="token punctuation">}</span>
                    self<span class="token punctuation">.</span>countries<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>territory <span class="token operator">=</span> <span class="token number">1</span>
                    self<span class="token punctuation">.</span>countries<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">]</span>
                    self<span class="token punctuation">.</span>countries<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>next_reward <span class="token operator">=</span> <span class="token number">3</span>
                    <span class="token keyword">break</span>
    
    <span class="token keyword">def</span> <span class="token function">draw_grid</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 绘制网格背景</span>
        self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>fill<span class="token punctuation">(</span>BACKGROUND<span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制网格线</span>
        <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> SCREEN_WIDTH<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">:</span>
            pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>line<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> GRID_COLOR<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">:</span>
            pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>line<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> GRID_COLOR<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>SCREEN_WIDTH<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制领土和士兵</span>
        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">:</span>
                    country <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span>
                    rect <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Rect<span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span>
                    pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> country<span class="token punctuation">.</span>color<span class="token punctuation">,</span> rect<span class="token punctuation">)</span>
                    
                    <span class="token comment"># 绘制士兵组</span>
                    troop_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span> troop_count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                        pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> WHITE<span class="token punctuation">,</span> 
                                          <span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                          TILE_SIZE<span class="token operator">//</span><span class="token number">3</span><span class="token punctuation">)</span>
                        text <span class="token operator">=</span> FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>troop_count<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span>
                        text_rect <span class="token operator">=</span> text<span class="token punctuation">.</span>get_rect<span class="token punctuation">(</span>center<span class="token operator">=</span><span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>text<span class="token punctuation">,</span> text_rect<span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制选中的方格</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>selected_tile<span class="token punctuation">:</span>
            x<span class="token punctuation">,</span> y <span class="token operator">=</span> self<span class="token punctuation">.</span>selected_tile
            rect <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Rect<span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span>
            pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> HIGHLIGHT<span class="token punctuation">,</span> rect<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 绘制可移动范围</span>
            <span class="token keyword">for</span> dx<span class="token punctuation">,</span> dy <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                nx<span class="token punctuation">,</span> ny <span class="token operator">=</span> x <span class="token operator">+</span> dx<span class="token punctuation">,</span> y <span class="token operator">+</span> dy
                <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> nx <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> ny <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">:</span>
                    rect <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Rect<span class="token punctuation">(</span>nx <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> ny <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span>
                    pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rect<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制信息面板</span>
        info_panel_y <span class="token operator">=</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE
        info_panel_height <span class="token operator">=</span> SCREEN_HEIGHT <span class="token operator">-</span> info_panel_y
        pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> info_panel_y<span class="token punctuation">,</span> SCREEN_WIDTH<span class="token punctuation">,</span> info_panel_height<span class="token punctuation">)</span><span class="token punctuation">)</span>
        pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>line<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> WHITE<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> info_panel_y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>SCREEN_WIDTH<span class="token punctuation">,</span> info_panel_y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制玩家信息</span>
        player_text <span class="token operator">=</span> LARGE_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"玩家领土: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>territory<span class="token punctuation">}</span></span><span class="token string">  下一奖励: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>next_reward<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> GREEN<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>player_text<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> info_panel_y <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制游戏说明</span>
        instructions <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string">"游戏说明:"</span><span class="token punctuation">,</span>
            <span class="token string">"1. 点击自己的领土选择士兵"</span><span class="token punctuation">,</span>
            <span class="token string">"2. 点击相邻格子移动所有士兵"</span><span class="token punctuation">,</span>
            <span class="token string">"3. 每占领3块领土获得一个新士兵组"</span><span class="token punctuation">,</span>
            <span class="token string">"4. 战斗规则: 比较双方士兵总数，差值决定胜负"</span><span class="token punctuation">,</span>
            <span class="token string">"5. 目标: 消灭所有其他国家"</span>
        <span class="token punctuation">]</span>
        
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> text <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>instructions<span class="token punctuation">)</span><span class="token punctuation">:</span>
            rendered <span class="token operator">=</span> SMALL_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> WHITE<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>rendered<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> info_panel_y <span class="token operator">+</span> <span class="token number">60</span> <span class="token operator">+</span> i <span class="token operator">*</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制电脑国家信息 (分两列显示)</span>
        ai_info <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> country <span class="token keyword">in</span> self<span class="token punctuation">.</span>countries<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> country<span class="token punctuation">.</span>is_player <span class="token keyword">and</span> <span class="token keyword">not</span> country<span class="token punctuation">.</span>defeated<span class="token punctuation">:</span>
                ai_info<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>country<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>country<span class="token punctuation">.</span>territory<span class="token punctuation">}</span></span><span class="token string">领土"</span></span><span class="token punctuation">)</span>
        
        <span class="token comment"># 第一列</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>ai_info<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            ai_text1 <span class="token operator">=</span> SMALL_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">"电脑国家: "</span> <span class="token operator">+</span> <span class="token string">", "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>ai_info<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> YELLOW<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>ai_text1<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> info_panel_y <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 第二列</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>ai_info<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">:</span>
            ai_text2 <span class="token operator">=</span> SMALL_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>ai_info<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> YELLOW<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>ai_text2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> info_panel_y <span class="token operator">+</span> <span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制游戏结束信息</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>game_over<span class="token punctuation">:</span>
            overlay <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Surface<span class="token punctuation">(</span><span class="token punctuation">(</span>SCREEN_WIDTH<span class="token punctuation">,</span> SCREEN_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">,</span> pygame<span class="token punctuation">.</span>SRCALPHA<span class="token punctuation">)</span>
            overlay<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>overlay<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>winner<span class="token punctuation">.</span>is_player<span class="token punctuation">:</span>
                text <span class="token operator">=</span> LARGE_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">"恭喜！你赢得了战争！"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> GREEN<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                text <span class="token operator">=</span> LARGE_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>winner<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">赢得了战争！"</span></span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>winner<span class="token punctuation">.</span>color<span class="token punctuation">)</span>
            
            restart <span class="token operator">=</span> FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">"按R键重新开始游戏"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> WHITE<span class="token punctuation">)</span>
            
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token punctuation">(</span>SCREEN_WIDTH<span class="token operator">//</span><span class="token number">2</span> <span class="token operator">-</span> text<span class="token punctuation">.</span>get_width<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> SCREEN_HEIGHT<span class="token operator">//</span><span class="token number">2</span> <span class="token operator">-</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>restart<span class="token punctuation">,</span> <span class="token punctuation">(</span>SCREEN_WIDTH<span class="token operator">//</span><span class="token number">2</span> <span class="token operator">-</span> restart<span class="token punctuation">.</span>get_width<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> SCREEN_HEIGHT<span class="token operator">//</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">handle_click</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>game_over<span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        grid_x <span class="token operator">=</span> pos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">//</span> TILE_SIZE
        grid_y <span class="token operator">=</span> pos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">//</span> TILE_SIZE
        
        <span class="token comment"># 确保点击在网格范围内</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;=</span> grid_x <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> grid_y <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        <span class="token comment"># 选择整个方格</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>selected_tile <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>grid_y<span class="token punctuation">]</span><span class="token punctuation">[</span>grid_x<span class="token punctuation">]</span> <span class="token keyword">and</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>grid_y<span class="token punctuation">]</span><span class="token punctuation">[</span>grid_x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">:</span>
                <span class="token comment"># 检查该位置是否有玩家士兵组</span>
                <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>grid_y<span class="token punctuation">]</span><span class="token punctuation">[</span>grid_x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>selected_tile <span class="token operator">=</span> <span class="token punctuation">(</span>grid_x<span class="token punctuation">,</span> grid_y<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># 移动士兵组</span>
            selected_x<span class="token punctuation">,</span> selected_y <span class="token operator">=</span> self<span class="token punctuation">.</span>selected_tile
            
            <span class="token comment"># 检查是否相邻</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">abs</span><span class="token punctuation">(</span>grid_x <span class="token operator">-</span> selected_x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>grid_y <span class="token operator">-</span> selected_y<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>move_troops<span class="token punctuation">(</span>selected_x<span class="token punctuation">,</span> selected_y<span class="token punctuation">,</span> grid_x<span class="token punctuation">,</span> grid_y<span class="token punctuation">)</span>
            
            self<span class="token punctuation">.</span>selected_tile <span class="token operator">=</span> <span class="token boolean">None</span>
    
    <span class="token keyword">def</span> <span class="token function">move_troops</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> from_x<span class="token punctuation">,</span> from_y<span class="token punctuation">,</span> to_x<span class="token punctuation">,</span> to_y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 获取原方格信息</span>
        from_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>from_y<span class="token punctuation">]</span><span class="token punctuation">[</span>from_x<span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> from_tile <span class="token keyword">or</span> <span class="token keyword">not</span> from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        <span class="token comment"># 获取要移动的所有士兵组</span>
        moving_troops <span class="token operator">=</span> from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>  <span class="token comment"># 复制列表</span>
        
        <span class="token comment"># 从原位置移除所有士兵组</span>
        from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> troop <span class="token keyword">in</span> moving_troops<span class="token punctuation">:</span>
            <span class="token keyword">if</span> troop <span class="token keyword">in</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop<span class="token punctuation">)</span>
        
        <span class="token comment"># 更新士兵组位置</span>
        <span class="token keyword">for</span> troop <span class="token keyword">in</span> moving_troops<span class="token punctuation">:</span>
            troop<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_x
            troop<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_y
        
        <span class="token comment"># 添加到新位置</span>
        to_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>to_y<span class="token punctuation">]</span><span class="token punctuation">[</span>to_x<span class="token punctuation">]</span>
        
        <span class="token keyword">if</span> <span class="token keyword">not</span> to_tile<span class="token punctuation">:</span>
            <span class="token comment"># 占领新领土</span>
            self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>to_y<span class="token punctuation">]</span><span class="token punctuation">[</span>to_x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'country'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">,</span>
                <span class="token string">'troops'</span><span class="token punctuation">:</span> moving_troops
            <span class="token punctuation">}</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>territory <span class="token operator">+=</span> <span class="token number">1</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
            <span class="token comment"># 检查是否应获得新士兵组</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">:</span>
                <span class="token comment"># 合并到友方领土</span>
                to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>extend<span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># 与敌方发生战斗</span>
                self<span class="token punctuation">.</span>resolve_battle<span class="token punctuation">(</span>to_x<span class="token punctuation">,</span> to_y<span class="token punctuation">,</span> moving_troops<span class="token punctuation">)</span>
        
        <span class="token comment"># 电脑回合</span>
        self<span class="token punctuation">.</span>ai_turn<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 检查游戏是否结束</span>
        self<span class="token punctuation">.</span>check_game_over<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">resolve_battle</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> attacking_troops<span class="token punctuation">)</span><span class="token punctuation">:</span>
        tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span>
        defending_country <span class="token operator">=</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span>
        defending_troops <span class="token operator">=</span> tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
        attacking_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>attacking_troops<span class="token punctuation">)</span>
        defending_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>defending_troops<span class="token punctuation">)</span>
        
        <span class="token comment"># 计算战斗结果</span>
        difference <span class="token operator">=</span> attacking_count <span class="token operator">-</span> defending_count
        
        <span class="token keyword">if</span> difference <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token comment"># 攻击方胜利</span>
            tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>player_country
            <span class="token comment"># 只保留差值数量的士兵组</span>
            tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> attacking_troops<span class="token punctuation">[</span><span class="token punctuation">:</span>difference<span class="token punctuation">]</span> <span class="token keyword">if</span> difference <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            
            <span class="token comment"># 更新玩家士兵列表</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span>t <span class="token keyword">for</span> t <span class="token keyword">in</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops <span class="token keyword">if</span> t <span class="token keyword">not</span> <span class="token keyword">in</span> defending_troops<span class="token punctuation">]</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 领土变更</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>territory <span class="token operator">+=</span> <span class="token number">1</span>
            defending_country<span class="token punctuation">.</span>territory <span class="token operator">-=</span> <span class="token number">1</span>
            
            <span class="token comment"># 检查是否应获得新士兵组</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
            
            <span class="token comment"># 检查防御方是否被击败</span>
            <span class="token keyword">if</span> defending_country<span class="token punctuation">.</span>territory <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                defending_country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">True</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># 防御方胜利</span>
            <span class="token comment"># 移除所有进攻方士兵组</span>
            <span class="token keyword">for</span> troop <span class="token keyword">in</span> attacking_troops<span class="token punctuation">:</span>
                <span class="token keyword">if</span> troop <span class="token keyword">in</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop<span class="token punctuation">)</span>
            
            <span class="token comment"># 防御方损失士兵组数量等于进攻方数量</span>
            <span class="token keyword">if</span> defending_troops<span class="token punctuation">:</span>
                <span class="token comment"># 随机移除防御方士兵组</span>
                remove_count <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>defending_troops<span class="token punctuation">)</span><span class="token punctuation">,</span> attacking_count<span class="token punctuation">)</span>
                removed_troops <span class="token operator">=</span> random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>defending_troops<span class="token punctuation">,</span> remove_count<span class="token punctuation">)</span>
                
                <span class="token comment"># 更新防御方士兵</span>
                tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>t <span class="token keyword">for</span> t <span class="token keyword">in</span> defending_troops <span class="token keyword">if</span> t <span class="token keyword">not</span> <span class="token keyword">in</span> removed_troops<span class="token punctuation">]</span>
                defending_country<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span>t <span class="token keyword">for</span> t <span class="token keyword">in</span> defending_country<span class="token punctuation">.</span>troops <span class="token keyword">if</span> t <span class="token keyword">not</span> <span class="token keyword">in</span> removed_troops<span class="token punctuation">]</span>
                
                <span class="token keyword">if</span> <span class="token keyword">not</span> tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                    <span class="token comment"># 如果防御方没有士兵了，领土变为中立</span>
                    tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
                    defending_country<span class="token punctuation">.</span>territory <span class="token operator">-=</span> <span class="token number">1</span>
                    <span class="token keyword">if</span> defending_country<span class="token punctuation">.</span>territory <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                        defending_country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">True</span>
    
    <span class="token keyword">def</span> <span class="token function">ai_turn</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> country <span class="token keyword">in</span> self<span class="token punctuation">.</span>countries<span class="token punctuation">:</span>
            <span class="token keyword">if</span> country<span class="token punctuation">.</span>is_player <span class="token keyword">or</span> country<span class="token punctuation">.</span>defeated<span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            
            <span class="token comment"># 每个电脑国家尝试移动一组士兵</span>
            <span class="token keyword">if</span> country<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                <span class="token comment"># 随机选择一个有士兵的方格</span>
                valid_tiles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">if</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token keyword">and</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> country <span class="token keyword">and</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                            valid_tiles<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
                
                <span class="token keyword">if</span> valid_tiles<span class="token punctuation">:</span>
                    from_x<span class="token punctuation">,</span> from_y <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>valid_tiles<span class="token punctuation">)</span>
                    
                    <span class="token comment"># 随机选择一个方向</span>
                    directions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
                    random<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>directions<span class="token punctuation">)</span>
                    
                    <span class="token keyword">for</span> dx<span class="token punctuation">,</span> dy <span class="token keyword">in</span> directions<span class="token punctuation">:</span>
                        to_x<span class="token punctuation">,</span> to_y <span class="token operator">=</span> from_x <span class="token operator">+</span> dx<span class="token punctuation">,</span> from_y <span class="token operator">+</span> dy
                        <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> to_x <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> to_y <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">:</span>
                            self<span class="token punctuation">.</span>ai_move<span class="token punctuation">(</span>country<span class="token punctuation">,</span> from_x<span class="token punctuation">,</span> from_y<span class="token punctuation">,</span> to_x<span class="token punctuation">,</span> to_y<span class="token punctuation">)</span>
                            <span class="token keyword">break</span>
    
    <span class="token keyword">def</span> <span class="token function">ai_move</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> country<span class="token punctuation">,</span> from_x<span class="token punctuation">,</span> from_y<span class="token punctuation">,</span> to_x<span class="token punctuation">,</span> to_y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 获取原方格信息</span>
        from_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>from_y<span class="token punctuation">]</span><span class="token punctuation">[</span>from_x<span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> from_tile <span class="token keyword">or</span> <span class="token keyword">not</span> from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        <span class="token comment"># 获取要移动的所有士兵组</span>
        moving_troops <span class="token operator">=</span> from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>  <span class="token comment"># 复制列表</span>
        
        <span class="token comment"># 从原位置移除所有士兵组</span>
        from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> troop <span class="token keyword">in</span> moving_troops<span class="token punctuation">:</span>
            <span class="token keyword">if</span> troop <span class="token keyword">in</span> country<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop<span class="token punctuation">)</span>
        
        <span class="token comment"># 更新士兵组位置</span>
        <span class="token keyword">for</span> troop <span class="token keyword">in</span> moving_troops<span class="token punctuation">:</span>
            troop<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_x
            troop<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_y
        
        <span class="token comment"># 添加到新位置</span>
        to_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>to_y<span class="token punctuation">]</span><span class="token punctuation">[</span>to_x<span class="token punctuation">]</span>
        
        <span class="token keyword">if</span> <span class="token keyword">not</span> to_tile<span class="token punctuation">:</span>
            <span class="token comment"># 占领新领土</span>
            self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>to_y<span class="token punctuation">]</span><span class="token punctuation">[</span>to_x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'country'</span><span class="token punctuation">:</span> country<span class="token punctuation">,</span>
                <span class="token string">'troops'</span><span class="token punctuation">:</span> moving_troops
            <span class="token punctuation">}</span>
            country<span class="token punctuation">.</span>territory <span class="token operator">+=</span> <span class="token number">1</span>
            country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
            <span class="token comment"># 检查是否应获得新士兵组</span>
            country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> country<span class="token punctuation">:</span>
                <span class="token comment"># 合并到友方领土</span>
                to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>extend<span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
                country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># 与敌方发生战斗</span>
                defending_country <span class="token operator">=</span> to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token keyword">if</span> to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token keyword">else</span> <span class="token boolean">None</span>
                defending_troops <span class="token operator">=</span> to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
                attacking_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
                defending_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>defending_troops<span class="token punctuation">)</span>
                
                difference <span class="token operator">=</span> attacking_count <span class="token operator">-</span> defending_count
                
                <span class="token keyword">if</span> difference <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    <span class="token comment"># 攻击方胜利</span>
                    to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> country
                    <span class="token comment"># 只保留差值数量的士兵组</span>
                    to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> moving_troops<span class="token punctuation">[</span><span class="token punctuation">:</span>difference<span class="token punctuation">]</span> <span class="token keyword">if</span> difference <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                    
                    <span class="token comment"># 更新国家士兵列表</span>
                    country<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span>t <span class="token keyword">for</span> t <span class="token keyword">in</span> country<span class="token punctuation">.</span>troops <span class="token keyword">if</span> t <span class="token keyword">not</span> <span class="token keyword">in</span> defending_troops<span class="token punctuation">]</span>
                    country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    
                    <span class="token comment"># 领土变更</span>
                    country<span class="token punctuation">.</span>territory <span class="token operator">+=</span> <span class="token number">1</span>
                    <span class="token keyword">if</span> defending_country<span class="token punctuation">:</span>
                        defending_country<span class="token punctuation">.</span>territory <span class="token operator">-=</span> <span class="token number">1</span>
                        <span class="token keyword">if</span> defending_country<span class="token punctuation">.</span>territory <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                            defending_country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">True</span>
                    
                    <span class="token comment"># 检查是否应获得新士兵组</span>
                    country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token comment"># 防御方胜利</span>
                    <span class="token comment"># 移除所有进攻方士兵组</span>
                    <span class="token keyword">for</span> troop <span class="token keyword">in</span> moving_troops<span class="token punctuation">:</span>
                        <span class="token keyword">if</span> troop <span class="token keyword">in</span> country<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                            country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop<span class="token punctuation">)</span>
                    
                    <span class="token comment"># 防御方损失士兵组数量等于进攻方数量</span>
                    <span class="token keyword">if</span> defending_troops <span class="token keyword">and</span> defending_country<span class="token punctuation">:</span>
                        <span class="token comment"># 随机移除防御方士兵组</span>
                        remove_count <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>defending_troops<span class="token punctuation">)</span><span class="token punctuation">,</span> attacking_count<span class="token punctuation">)</span>
                        removed_troops <span class="token operator">=</span> random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>defending_troops<span class="token punctuation">,</span> remove_count<span class="token punctuation">)</span>
                        
                        <span class="token comment"># 更新防御方士兵</span>
                        to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>t <span class="token keyword">for</span> t <span class="token keyword">in</span> defending_troops <span class="token keyword">if</span> t <span class="token keyword">not</span> <span class="token keyword">in</span> removed_troops<span class="token punctuation">]</span>
                        defending_country<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span>t <span class="token keyword">for</span> t <span class="token keyword">in</span> defending_country<span class="token punctuation">.</span>troops <span class="token keyword">if</span> t <span class="token keyword">not</span> <span class="token keyword">in</span> removed_troops<span class="token punctuation">]</span>
                        
                        <span class="token keyword">if</span> <span class="token keyword">not</span> to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                            <span class="token comment"># 如果防御方没有士兵了，领土变为中立</span>
                            to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
                            <span class="token keyword">if</span> defending_country<span class="token punctuation">:</span>
                                defending_country<span class="token punctuation">.</span>territory <span class="token operator">-=</span> <span class="token number">1</span>
                                <span class="token keyword">if</span> defending_country<span class="token punctuation">.</span>territory <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                                    defending_country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">True</span>
    
    <span class="token keyword">def</span> <span class="token function">check_game_over</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        active_countries <span class="token operator">=</span> <span class="token punctuation">[</span>c <span class="token keyword">for</span> c <span class="token keyword">in</span> self<span class="token punctuation">.</span>countries <span class="token keyword">if</span> <span class="token keyword">not</span> c<span class="token punctuation">.</span>defeated<span class="token punctuation">]</span>
        
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>active_countries<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>game_over <span class="token operator">=</span> <span class="token boolean">True</span>
            self<span class="token punctuation">.</span>winner <span class="token operator">=</span> active_countries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    
    <span class="token keyword">def</span> <span class="token function">restart_game</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 重置游戏状态</span>
        self<span class="token punctuation">.</span>grid <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token boolean">None</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> country <span class="token keyword">in</span> self<span class="token punctuation">.</span>countries<span class="token punctuation">:</span>
            country<span class="token punctuation">.</span>territory <span class="token operator">=</span> <span class="token number">0</span>
            country<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            country<span class="token punctuation">.</span>next_reward <span class="token operator">=</span> <span class="token number">3</span>
            country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">False</span>
        
        self<span class="token punctuation">.</span>selected_tile <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>game_over <span class="token operator">=</span> <span class="token boolean">False</span>
        self<span class="token punctuation">.</span>winner <span class="token operator">=</span> <span class="token boolean">None</span>
        
        <span class="token comment"># 重新初始化游戏</span>
        self<span class="token punctuation">.</span>initialize_game<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> event <span class="token keyword">in</span> pygame<span class="token punctuation">.</span>event<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> event<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> QUIT<span class="token punctuation">:</span>
                    pygame<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">elif</span> event<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> MOUSEBUTTONDOWN<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> event<span class="token punctuation">.</span>button <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>  <span class="token comment"># 左键点击</span>
                        self<span class="token punctuation">.</span>handle_click<span class="token punctuation">(</span>event<span class="token punctuation">.</span>pos<span class="token punctuation">)</span>
                <span class="token keyword">elif</span> event<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> KEYDOWN<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> event<span class="token punctuation">.</span>key <span class="token operator">==</span> K_r<span class="token punctuation">:</span>  <span class="token comment"># 按R键重新开始</span>
                        self<span class="token punctuation">.</span>restart_game<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            self<span class="token punctuation">.</span>draw_grid<span class="token punctuation">(</span><span class="token punctuation">)</span>
            pygame<span class="token punctuation">.</span>display<span class="token punctuation">.</span>flip<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>clock<span class="token punctuation">.</span>tick<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    game <span class="token operator">=</span> Game<span class="token punctuation">(</span><span class="token punctuation">)</span>
    game<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></div><h3>主要修复内容：</h3><h4>1. 解决文字显示超出屏幕问题</h4><ul><li><p class="ds-markdown-paragraph"><strong>重新设计信息面板布局</strong>：</p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre><span class="token comment"># 电脑国家信息分两列显示</span>
ai_info <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> country <span class="token keyword">in</span> self<span class="token punctuation">.</span>countries<span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> country<span class="token punctuation">.</span>is_player <span class="token keyword">and</span> <span class="token keyword">not</span> country<span class="token punctuation">.</span>defeated<span class="token punctuation">:</span>
        ai_info<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>country<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>country<span class="token punctuation">.</span>territory<span class="token punctuation">}</span></span><span class="token string">领土"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 第一列</span>
<span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>ai_info<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
    ai_text1 <span class="token operator">=</span> SMALL_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">"电脑国家: "</span> <span class="token operator">+</span> <span class="token string">", "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>ai_info<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> YELLOW<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>ai_text1<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> info_panel_y <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 第二列</span>
<span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>ai_info<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">:</span>
    ai_text2 <span class="token operator">=</span> SMALL_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>ai_info<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> YELLOW<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>ai_text2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> info_panel_y <span class="token operator">+</span> <span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></div></li><li><p class="ds-markdown-paragraph"><strong>使用更小的字体</strong>：</p><ul><li><p class="ds-markdown-paragraph"><code>LARGE_FONT</code> 从36减小到30</p></li><li><p class="ds-markdown-paragraph">添加 <code>SMALL_FONT</code> 用于详细说明</p></li></ul></li></ul><h4>2. 移动整个方格上的士兵组</h4><ul><li><p class="ds-markdown-paragraph"><strong>修改选择逻辑</strong>：</p><ul><li><p class="ds-markdown-paragraph">将 <code>selected_troop</code> 改为 <code>selected_tile</code>，选择整个方格</p></li></ul><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre>self<span class="token punctuation">.</span>selected_tile <span class="token operator">=</span> <span class="token punctuation">(</span>grid_x<span class="token punctuation">,</span> grid_y<span class="token punctuation">)</span></pre></div></li><li><p class="ds-markdown-paragraph"><strong>修改移动逻辑</strong>：</p><ul><li><p class="ds-markdown-paragraph">移动整个方格上的所有士兵组</p></li></ul><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre><span class="token keyword">def</span> <span class="token function">move_troops</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> from_x<span class="token punctuation">,</span> from_y<span class="token punctuation">,</span> to_x<span class="token punctuation">,</span> to_y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 获取原方格的所有士兵组</span>
    moving_troops <span class="token operator">=</span> from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>  <span class="token comment"># 复制列表</span>
    
    <span class="token comment"># 从原位置移除所有士兵组</span>
    from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> troop <span class="token keyword">in</span> moving_troops<span class="token punctuation">:</span>
        <span class="token keyword">if</span> troop <span class="token keyword">in</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop<span class="token punctuation">)</span>
    
    <span class="token comment"># 更新士兵组位置</span>
    <span class="token keyword">for</span> troop <span class="token keyword">in</span> moving_troops<span class="token punctuation">:</span>
        troop<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_x
        troop<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_y
    
    <span class="token comment"># 添加到新位置</span>
    <span class="token comment"># ...（根据目标方格类型处理）</span></pre></div></li></ul><h4>3. 确保新士兵生成在己方领土</h4><ul><li><p class="ds-markdown-paragraph"><strong>优化士兵生成算法</strong>：</p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre><span class="token keyword">def</span> <span class="token function">add_territory</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> game<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 收集所有安全的领土位置（仅限己方领土且周围无敌方领土）</span>
    safe_positions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token keyword">and</span> game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> self<span class="token punctuation">:</span>
                <span class="token comment"># 确保不在他国领土附近</span>
                is_safe <span class="token operator">=</span> <span class="token boolean">True</span>
                <span class="token keyword">for</span> dx<span class="token punctuation">,</span> dy <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                    nx<span class="token punctuation">,</span> ny <span class="token operator">=</span> x <span class="token operator">+</span> dx<span class="token punctuation">,</span> y <span class="token operator">+</span> dy
                    <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> nx <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> ny <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">:</span>
                        <span class="token keyword">if</span> game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>ny<span class="token punctuation">]</span><span class="token punctuation">[</span>nx<span class="token punctuation">]</span> <span class="token keyword">and</span> game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>ny<span class="token punctuation">]</span><span class="token punctuation">[</span>nx<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> self<span class="token punctuation">:</span>
                            is_safe <span class="token operator">=</span> <span class="token boolean">False</span>
                            <span class="token keyword">break</span>
                
                <span class="token keyword">if</span> is_safe<span class="token punctuation">:</span>
                    safe_positions<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> safe_positions<span class="token punctuation">:</span>
        <span class="token comment"># 随机选择一个安全位置</span>
        x<span class="token punctuation">,</span> y <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>safe_positions<span class="token punctuation">)</span>
        <span class="token comment"># ...（创建新士兵组）</span></pre></div></li></ul><h3>其他改进：</h3><ol start="1"><li><p class="ds-markdown-paragraph"><strong>战斗系统优化</strong>：</p><ul><li><p class="ds-markdown-paragraph">移动整个方格上的所有士兵组参与战斗</p></li><li><p class="ds-markdown-paragraph">战斗后只保留差值数量的士兵组</p></li></ul></li><li><p class="ds-markdown-paragraph"><strong>AI行为改进</strong>：</p><ul><li><p class="ds-markdown-paragraph">电脑现在也会移动整个方格上的士兵组</p></li><li><p class="ds-markdown-paragraph">更智能地选择移动目标</p></li></ul></li><li><p class="ds-markdown-paragraph"><strong>初始位置优化</strong>：</p><ul><li><p class="ds-markdown-paragraph">国家初始位置更分散，避免早期冲突</p></li></ul><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre>x <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> GRID_WIDTH <span class="token operator">-</span> <span class="token number">6</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">-</span> <span class="token number">6</span><span class="token punctuation">)</span></pre></div></li><li><p class="ds-markdown-paragraph"><strong>界面美化</strong>：</p><ul><li><p class="ds-markdown-paragraph">士兵组数字居中显示</p></li><li><p class="ds-markdown-paragraph">信息面板布局更合理</p></li><li><p class="ds-markdown-paragraph">字体大小调整确保内容不超出屏幕</p></li></ul></li></ol><h3>游戏特点：</h3><ol start="1"><li><p class="ds-markdown-paragraph"><strong>整体移动士兵</strong>：</p><ul><li><p class="ds-markdown-paragraph">现在点击一个方格会选中该方格上的所有士兵组</p></li><li><p class="ds-markdown-paragraph">移动到相邻方格时会移动所有士兵组</p></li></ul></li><li><p class="ds-markdown-paragraph"><strong>安全的新兵生成</strong>：</p><ul><li><p class="ds-markdown-paragraph">新士兵只会生成在安全的己方领土上</p></li><li><p class="ds-markdown-paragraph">确保不会出现在敌方领土附近</p></li></ul></li><li><p class="ds-markdown-paragraph"><strong>更清晰的界面</strong>：</p><ul><li><p class="ds-markdown-paragraph">电脑国家信息分两列显示</p></li><li><p class="ds-markdown-paragraph">使用更小的字体确保内容不超出屏幕</p></li><li><p class="ds-markdown-paragraph">游戏说明更简洁明了</p></li></ul></li></ol><p class="ds-markdown-paragraph">这个版本应该解决了您提出的所有问题，并提供了更好的游戏体验。请尝试运行这个改进后的版本！</p></div><div class="ds-flex" style="margin-top: 12px; height: 20px; margin-bottom: 20px; align-items: center; gap: 10px;"><div class="ds-flex _965abe9" style="align-items: center; gap: 16px;"><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px; opacity: 1;"><svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><clippath id="clip1258_20811"><rect id="重新生成" width="20.000000" height="20.000000" fill="white" fill-opacity="0"></rect></clippath></defs><rect id="重新生成" width="20.000000" height="20.000000" fill="#FFFFFF" fill-opacity="0"></rect><g clip-path="url(#clip1258_20811)"><path id="path" d="M17.01 7.63L13.98 7.62C13.88 7.62 13.79 7.6 13.7 7.56C13.62 7.52 13.54 7.47 13.47 7.4C13.4 7.33 13.35 7.25 13.32 7.16C13.28 7.07 13.26 6.98 13.26 6.88C13.26 6.79 13.28 6.69 13.32 6.6C13.35 6.51 13.4 6.43 13.47 6.36C13.54 6.3 13.62 6.24 13.7 6.21C13.79 6.17 13.88 6.15 13.98 6.15L15.57 6.16C15.67 6.16 15.76 6.14 15.85 6.1C15.94 6.06 16.01 6.01 16.08 5.94C16.15 5.87 16.2 5.79 16.23 5.7C16.27 5.61 16.29 5.52 16.29 5.42L16.3 3.89C16.3 3.79 16.32 3.7 16.36 3.61C16.39 3.52 16.44 3.44 16.51 3.37C16.58 3.3 16.66 3.25 16.74 3.21C16.83 3.17 16.92 3.16 17.02 3.16C17.11 3.16 17.2 3.17 17.29 3.21C17.38 3.25 17.46 3.3 17.52 3.37C17.59 3.44 17.64 3.52 17.68 3.61C17.71 3.7 17.73 3.79 17.73 3.89L17.72 6.9C17.72 7 17.71 7.09 17.67 7.18C17.63 7.27 17.58 7.34 17.52 7.41C17.45 7.48 17.37 7.53 17.29 7.57C17.2 7.61 17.11 7.63 17.01 7.63Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path><path id="path" d="M2.31 16.29L2.32 13.3C2.32 13.21 2.34 13.11 2.37 13.02C2.41 12.93 2.46 12.85 2.53 12.78C2.6 12.71 2.67 12.66 2.76 12.62C2.85 12.58 2.94 12.56 3.03 12.56L6.07 12.57C6.16 12.57 6.25 12.59 6.34 12.63C6.43 12.67 6.51 12.72 6.57 12.79C6.64 12.86 6.69 12.94 6.73 13.03C6.76 13.12 6.78 13.22 6.78 13.32C6.78 13.41 6.76 13.51 6.73 13.6C6.69 13.69 6.64 13.77 6.57 13.84C6.51 13.91 6.43 13.96 6.34 14C6.25 14.04 6.16 14.06 6.07 14.06L4.47 14.05C4.38 14.05 4.29 14.07 4.2 14.11C4.11 14.15 4.03 14.2 3.97 14.27C3.9 14.34 3.85 14.42 3.81 14.51C3.78 14.6 3.76 14.7 3.76 14.8L3.75 16.29C3.75 16.39 3.73 16.48 3.69 16.58C3.65 16.67 3.6 16.75 3.54 16.82C3.47 16.89 3.39 16.94 3.3 16.98C3.22 17.01 3.13 17.03 3.03 17.03C2.94 17.03 2.85 17.02 2.76 16.98C2.67 16.94 2.59 16.89 2.52 16.82C2.46 16.75 2.4 16.67 2.37 16.58C2.33 16.49 2.31 16.39 2.31 16.29Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path><path id="path" d="M9.88 18.01C9.51 18.01 9.15 17.99 8.79 17.94C8.42 17.89 8.07 17.82 7.71 17.73C7.36 17.63 7.02 17.51 6.68 17.37C6.34 17.23 6.02 17.07 5.7 16.89C5.39 16.7 5.09 16.5 4.8 16.28C4.52 16.05 4.25 15.81 3.99 15.55C3.74 15.29 3.5 15.02 3.29 14.73C3.07 14.44 2.88 14.13 2.7 13.82L4.15 13.05C4.32 13.35 4.51 13.64 4.72 13.91C4.93 14.18 5.17 14.43 5.42 14.66C5.67 14.9 5.94 15.11 6.23 15.3C6.52 15.49 6.83 15.66 7.14 15.81C7.46 15.95 7.78 16.07 8.12 16.16C8.45 16.25 8.8 16.32 9.14 16.36C9.49 16.39 9.83 16.4 10.18 16.39C10.53 16.37 10.87 16.33 11.22 16.26C11.56 16.19 11.89 16.09 12.21 15.97C12.54 15.84 12.85 15.7 13.15 15.53C13.45 15.35 13.74 15.16 14.01 14.94C14.28 14.72 14.53 14.49 14.76 14.23C14.99 13.97 15.2 13.7 15.38 13.41C15.57 13.12 15.73 12.82 15.87 12.5C16 12.19 16.11 11.87 16.2 11.53C16.28 11.2 16.34 10.87 16.36 10.52C16.37 10.42 16.4 10.33 16.44 10.24C16.48 10.15 16.54 10.07 16.61 10C16.69 9.93 16.77 9.87 16.86 9.84C16.96 9.8 17.05 9.77 17.16 9.77C17.27 9.77 17.38 9.79 17.49 9.83C17.6 9.87 17.7 9.94 17.78 10.02C17.86 10.1 17.92 10.2 17.96 10.3C18 10.41 18.01 10.52 18 10.64C17.98 10.89 17.95 11.13 17.91 11.38C17.86 11.62 17.81 11.87 17.74 12.11C17.68 12.35 17.6 12.58 17.51 12.82C17.42 13.05 17.32 13.28 17.21 13.5C17.1 13.73 16.98 13.95 16.85 14.16C16.71 14.37 16.57 14.58 16.42 14.78C16.27 14.98 16.11 15.17 15.94 15.36C15.77 15.54 15.59 15.72 15.41 15.89C15.22 16.06 15.03 16.22 14.83 16.37C14.63 16.52 14.42 16.66 14.2 16.79C13.99 16.93 13.77 17.05 13.54 17.16C13.31 17.27 13.08 17.37 12.85 17.46C12.61 17.55 12.37 17.63 12.13 17.7C11.88 17.77 11.64 17.83 11.39 17.87C11.14 17.92 10.89 17.96 10.63 17.98C10.38 18 10.13 18.01 9.88 18.01Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path><path id="path" d="M2.85 10.27C2.73 10.28 2.62 10.26 2.51 10.22C2.4 10.17 2.31 10.11 2.23 10.03C2.14 9.95 2.08 9.85 2.04 9.74C2 9.63 1.99 9.52 2 9.41C2.03 8.98 2.1 8.56 2.2 8.15C2.3 7.73 2.43 7.33 2.6 6.94C2.76 6.54 2.96 6.16 3.19 5.8C3.41 5.44 3.67 5.1 3.95 4.77C4.24 4.45 4.54 4.15 4.88 3.88C5.21 3.6 5.56 3.35 5.93 3.13C6.3 2.91 6.69 2.73 7.09 2.57C7.5 2.41 7.91 2.28 8.33 2.19C8.75 2.09 9.18 2.03 9.62 2.01C10.05 1.98 10.48 1.99 10.91 2.03C11.35 2.07 11.77 2.14 12.19 2.25C12.61 2.36 13.02 2.5 13.42 2.67C13.81 2.84 14.19 3.04 14.56 3.28C14.92 3.51 15.27 3.77 15.59 4.05C15.91 4.34 16.21 4.64 16.48 4.98C16.75 5.31 17 5.66 17.21 6.03L15.78 6.83C15.61 6.54 15.42 6.25 15.2 5.99C14.98 5.73 14.74 5.48 14.49 5.25C14.23 5.02 13.96 4.82 13.66 4.63C13.37 4.45 13.07 4.29 12.75 4.15C12.44 4.01 12.11 3.9 11.77 3.82C11.44 3.73 11.1 3.67 10.76 3.64C10.41 3.61 10.07 3.6 9.72 3.62C9.37 3.64 9.03 3.69 8.69 3.77C8.36 3.84 8.03 3.94 7.71 4.07C7.38 4.2 7.08 4.35 6.78 4.52C6.48 4.7 6.2 4.89 5.94 5.11C5.67 5.33 5.43 5.57 5.2 5.83C4.97 6.08 4.77 6.36 4.59 6.65C4.41 6.94 4.25 7.24 4.12 7.55C3.98 7.87 3.88 8.19 3.8 8.52C3.72 8.85 3.66 9.19 3.64 9.53C3.63 9.62 3.6 9.72 3.56 9.81C3.52 9.9 3.46 9.98 3.39 10.05C3.32 10.12 3.23 10.17 3.14 10.21C3.05 10.25 2.95 10.27 2.85 10.27Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path></g></svg></div></div><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M18.14 9.428l-.003.019L17.114 15a3.774 3.774 0 0 1-1.313 2.27 3.673 3.673 0 0 1-2.438.894H3.895c-.57 0-1.055-.205-1.458-.614a2.033 2.033 0 0 1-.604-1.48v-5.438c0-.578.201-1.071.604-1.48.402-.41.888-.614 1.458-.614h1.932l2.317-5.293c.24-.548.6-.948 1.083-1.2.599-.312 1.156-.278 1.672.103.782.577 1.172 1.355 1.172 2.334V6.997h3.994c.638-.007 1.167.235 1.588.726.421.492.584 1.06.488 1.705zm-2.076-2.6c.686-.007 1.262.256 1.714.785.453.529.63 1.146.527 1.84v.004l-.005.02v.003l-1.022 5.552a3.943 3.943 0 0 1-1.37 2.368 3.838 3.838 0 0 1-2.545.933H3.895a2.137 2.137 0 0 1-1.576-.663 2.203 2.203 0 0 1-.652-1.6v-5.437c0-.622.218-1.159.652-1.6.434-.44.962-.663 1.576-.663H5.72l2.273-5.192c.254-.58.64-1.01 1.159-1.282.32-.167.64-.246.953-.227.315.02.613.137.893.344.824.608 1.24 1.437 1.24 2.47v2.345h3.827zM9.741 3.063c-.247.128-.437.344-.57.647L6.708 9.34v7.683h6.655a2.59 2.59 0 0 0 1.72-.63c.498-.42.807-.955.926-1.601l1.02-5.544a.936.936 0 0 0-.225-.773.917.917 0 0 0-.739-.335h-4.557a.567.567 0 0 1-.562-.571V4.483c0-.591-.236-1.061-.708-1.41-.143-.105-.309-.109-.497-.01zm7.124 6.157a.766.766 0 0 0-.186-.636.753.753 0 0 0-.612-.276h-4.559a.734.734 0 0 1-.728-.74V4.483c0-.537-.21-.956-.64-1.273a.233.233 0 0 0-.137-.05.387.387 0 0 0-.185.053c-.208.108-.374.291-.495.566m0 0L6.874 9.375v7.479h6.489c.609 0 1.145-.197 1.614-.592.468-.396.757-.894.869-1.502l1.02-5.54M3.35 16.623c.152.155.33.23.545.23h1.522V9.85H3.895a.732.732 0 0 0-.545.23.755.755 0 0 0-.226.553v5.437c0 .218.074.4.226.553zm.545-6.941a.897.897 0 0 0-.663.278.924.924 0 0 0-.274.673v5.437c0 .263.091.487.274.673.183.186.404.28.663.28h1.688V9.681H3.895z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M18.137 9.447l.004-.02a2.044 2.044 0 0 0-.488-1.704c-.421-.491-.95-.733-1.588-.726h-2.282l1.584 1.142h.698a.917.917 0 0 1 .739.335.936.936 0 0 1 .225.773l-1.02 5.543a2.663 2.663 0 0 1-.926 1.602 2.59 2.59 0 0 1-1.72.63H6.708V9.34L9.171 3.71c.133-.303.323-.519.57-.647.188-.099.354-.095.497.01.472.349.708.819.708 1.41v.467l1.125.811V4.483c0-.98-.39-1.757-1.171-2.334-.517-.38-1.074-.415-1.673-.103-.482.252-.843.652-1.083 1.2L5.827 8.54H3.895c-.57 0-1.056.205-1.458.614a2.033 2.033 0 0 0-.604 1.48v5.437c0 .578.201 1.072.604 1.48.403.41.889.615 1.458.615h9.468c.918 0 1.731-.299 2.438-.895A3.774 3.774 0 0 0 17.114 15l1.023-5.553zm-14.242.235a.897.897 0 0 0-.663.278.924.924 0 0 0-.274.673v5.437c0 .263.091.487.274.673.183.186.404.28.663.28h1.688V9.681H3.895z" fill="currentColor"></path><path d="M10.946 7.568c0 .316.252.571.563.571h3.858l-1.584-1.142h-1.712V5.76l-1.125-.811v2.618z" fill="currentColor"></path></svg></div></div><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M18.304 10.543v.004a2.214 2.214 0 0 1-.526 1.84c-.452.528-1.028.792-1.714.784h-3.827v2.345c0 1.034-.416 1.863-1.24 2.471-.28.207-.578.324-.893.343-.314.02-.632-.06-.953-.226-.519-.271-.905-.702-1.159-1.282l-2.273-5.193H3.895a2.136 2.136 0 0 1-1.576-.663 2.203 2.203 0 0 1-.652-1.6V3.93c0-.623.218-1.16.652-1.6.434-.441.963-.663 1.576-.663h9.468c.957 0 1.807.311 2.544.933a3.943 3.943 0 0 1 1.37 2.368L18.3 10.52v.002l.004.02zm-1.19-5.544a3.774 3.774 0 0 0-1.313-2.27 3.673 3.673 0 0 0-2.438-.894H3.895c-.57 0-1.055.205-1.458.614a2.033 2.033 0 0 0-.604 1.48v5.437c0 .578.201 1.072.604 1.48.402.41.888.615 1.458.615h1.932l2.317 5.292c.24.549.6.949 1.083 1.2.599.313 1.156.279 1.672-.102.782-.577 1.172-1.355 1.172-2.335v-2.513h3.994c.638.007 1.167-.235 1.588-.727.421-.491.584-1.06.488-1.704l-.004-.02L17.114 5zM9.819 16.787c.076.04.137.053.185.052a.233.233 0 0 0 .137-.05c.43-.316.64-.735.64-1.273v-3.084c0-.41.327-.74.729-.74h4.558a.752.752 0 0 0 .612-.277.766.766 0 0 0 .186-.635l-1.02-5.54a2.495 2.495 0 0 0-.869-1.502 2.426 2.426 0 0 0-1.613-.592H6.874v7.48l2.449 5.595m-2.615-5.56V2.978h6.655c.648 0 1.221.21 1.72.63.498.42.807.954.926 1.601l1.02 5.543a.936.936 0 0 1-.225.774.917.917 0 0 1-.739.335h-4.557a.567.567 0 0 0-.562.57v3.085c0 .592-.236 1.062-.708 1.41-.143.106-.309.11-.497.01-.247-.128-.437-.343-.57-.647l-2.463-5.628zM3.35 3.376a.754.754 0 0 0-.226.554v5.436c0 .218.074.4.226.554.152.154.33.23.545.23h1.522V3.146H3.895a.731.731 0 0 0-.545.23zm2.233-.398v7.34H3.895a.897.897 0 0 1-.663-.279.925.925 0 0 1-.274-.673V3.93c0-.263.091-.487.274-.673a.895.895 0 0 1 .663-.28h1.688zm4.235 13.809c-.208-.108-.375-.292-.495-.566l.495.566z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M15.801 2.73a3.774 3.774 0 0 1 1.313 2.269l1.023 5.554.004.019a2.044 2.044 0 0 1-.488 1.704c-.421.492-.95.734-1.588.727h-3.994v2.513c0 .98-.39 1.758-1.171 2.335-.517.38-1.074.415-1.673.102-.482-.251-.843-.651-1.083-1.2l-2.317-5.292H3.895c-.57 0-1.056-.205-1.458-.614a2.033 2.033 0 0 1-.604-1.48V3.93c0-.579.201-1.072.604-1.481.403-.41.889-.614 1.458-.614h9.468c.918 0 1.731.298 2.438.894zm-2.438.248c.648 0 1.221.21 1.72.63.498.42.807.954.926 1.601l1.02 5.543a.936.936 0 0 1-.225.774.917.917 0 0 1-.739.335h-4.557a.567.567 0 0 0-.562.57v3.085c0 .592-.236 1.062-.708 1.41-.143.106-.309.11-.497.01-.247-.128-.437-.343-.57-.647l-2.463-5.628V2.978h6.655zm-9.468 7.34a.897.897 0 0 1-.663-.279.925.925 0 0 1-.274-.673V3.93c0-.263.091-.487.274-.673a.895.895 0 0 1 .663-.28h1.688v7.341H3.895z" fill="currentColor"></path></svg></div></div></div><div style="flex: 1 1 0%;"></div></div></div><div class="_9663006"><div class="fbb737a4">游戏大体上没有什么问题，我现在需要以下新功能
1.士兵组每次移动的最大距离增大到2格
2.每占领一格他国领土，给占领国增加一组士兵
3.增强电脑控制的国家的策略性，当自身边境实力低于邻国边境实力时不进攻，高于时主动进攻</div><div class="e13328ad _3a26104"><div class="_425ea0b"><div class="ds-flex _78e0558" style="align-items: flex-end; gap: 0px;"><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px; margin-left: 14px; opacity: 1;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.712 2.79a1.854 1.854 0 0 1 2.623 0l1.673 1.672a1.854 1.854 0 0 1 0 2.623l-9.714 9.714a2.91 2.91 0 0 1-2.058.853H1.945a.8.8 0 0 1-.8-.8v-2.29c0-.773.307-1.513.853-2.058l9.714-9.715zm1.492 1.13c-.1-.1-.261-.1-.361 0l-1.327 1.326 2.035 2.035 1.327-1.326c.1-.1.1-.262 0-.362L13.204 3.92zm-.783 4.491l-2.035-2.034-7.258 7.257a1.31 1.31 0 0 0-.384.927v1.492h1.492c.348 0 .681-.138.927-.384l7.258-7.258z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M17.772 17.608c.35 0 .633-.283.633-.633v-.492a.633.633 0 0 0-.633-.633H9.858L8.1 17.608h9.672z" fill="currentColor"></path></svg></div></div></div></div></div></div><div class="_4f9bf79 _43c05b5"><div class="_7eb2358 _58dfa60"><svg viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path id="path" d="M27.501 8.46875C27.249 8.3457 27.1406 8.58008 26.9932 8.69922C26.9434 8.73828 26.9004 8.78906 26.8584 8.83398C26.4902 9.22852 26.0605 9.48633 25.5 9.45508C24.6787 9.41016 23.9785 9.66797 23.3594 10.2969C23.2275 9.52148 22.79 9.05859 22.125 8.76172C21.7764 8.60742 21.4238 8.45312 21.1807 8.11719C21.0098 7.87891 20.9639 7.61328 20.8779 7.35156C20.8242 7.19336 20.7695 7.03125 20.5879 7.00391C20.3906 6.97266 20.3135 7.13867 20.2363 7.27734C19.9258 7.84375 19.8066 8.46875 19.8174 9.10156C19.8447 10.5234 20.4453 11.6562 21.6367 12.4629C21.7725 12.5547 21.8076 12.6484 21.7646 12.7832C21.6836 13.0605 21.5869 13.3301 21.501 13.6074C21.4473 13.7852 21.3662 13.8242 21.1768 13.7461C20.5225 13.4727 19.957 13.0684 19.458 12.5781C18.6104 11.7578 17.8438 10.8516 16.8877 10.1426C16.6631 9.97656 16.4395 9.82227 16.207 9.67578C15.2314 8.72656 16.335 7.94727 16.5898 7.85547C16.8574 7.75977 16.6826 7.42773 15.8193 7.43164C14.957 7.43555 14.167 7.72461 13.1611 8.10938C13.0137 8.16797 12.8594 8.21094 12.7002 8.24414C11.7871 8.07227 10.8389 8.0332 9.84766 8.14453C7.98242 8.35352 6.49219 9.23633 5.39648 10.7441C4.08105 12.5547 3.77148 14.6133 4.15039 16.7617C4.54883 19.0234 5.70215 20.8984 7.47559 22.3633C9.31348 23.8809 11.4307 24.625 13.8457 24.4824C15.3125 24.3984 16.9463 24.2012 18.7881 22.6406C19.2529 22.8711 19.7402 22.9629 20.5498 23.0332C21.1729 23.0918 21.7725 23.002 22.2373 22.9062C22.9648 22.752 22.9141 22.0781 22.6514 21.9531C20.5186 20.959 20.9863 21.3633 20.5605 21.0371C21.6445 19.752 23.2783 18.418 23.917 14.0977C23.9668 13.7539 23.9238 13.5391 23.917 13.2598C23.9131 13.0918 23.9512 13.0254 24.1445 13.0059C24.6787 12.9453 25.1973 12.7988 25.6738 12.5352C27.0557 11.7793 27.6123 10.5391 27.7441 9.05078C27.7637 8.82422 27.7402 8.58789 27.501 8.46875ZM15.46 21.8613C13.3926 20.2344 12.3906 19.6992 11.9766 19.7227C11.5898 19.7441 11.6592 20.1875 11.7441 20.4766C11.833 20.7617 11.9492 20.959 12.1123 21.209C12.2246 21.375 12.3018 21.623 12 21.8066C11.334 22.2207 10.1768 21.668 10.1221 21.6406C8.77539 20.8477 7.64941 19.7988 6.85547 18.3652C6.08984 16.9844 5.64453 15.5039 5.57129 13.9238C5.55176 13.541 5.66406 13.4062 6.04297 13.3379C6.54199 13.2461 7.05762 13.2266 7.55664 13.2988C9.66602 13.6074 11.4619 14.5527 12.9668 16.0469C13.8262 16.9004 14.4766 17.918 15.1465 18.9121C15.8584 19.9688 16.625 20.9746 17.6006 21.7988C17.9443 22.0879 18.2197 22.3086 18.4824 22.4707C17.6895 22.5586 16.3652 22.5781 15.46 21.8613ZM16.4502 15.4805C16.4502 15.3105 16.5859 15.1758 16.7568 15.1758C16.7949 15.1758 16.8301 15.1836 16.8613 15.1953C16.9033 15.2109 16.9424 15.2344 16.9727 15.2695C17.0273 15.3223 17.0586 15.4004 17.0586 15.4805C17.0586 15.6504 16.9229 15.7852 16.7529 15.7852C16.582 15.7852 16.4502 15.6504 16.4502 15.4805ZM19.5273 17.0625C19.3301 17.1426 19.1328 17.2129 18.9434 17.2207C18.6494 17.2344 18.3281 17.1152 18.1533 16.9688C17.8828 16.7422 17.6895 16.6152 17.6074 16.2168C17.5732 16.0469 17.5928 15.7852 17.623 15.6348C17.6934 15.3105 17.6152 15.1035 17.3877 14.9141C17.2012 14.7598 16.9658 14.7188 16.7061 14.7188C16.6094 14.7188 16.5205 14.6758 16.4541 14.6406C16.3457 14.5859 16.2568 14.4512 16.3418 14.2852C16.3691 14.2324 16.501 14.1016 16.5322 14.0781C16.8838 13.877 17.29 13.9434 17.666 14.0938C18.0146 14.2363 18.2773 14.498 18.6562 14.8672C19.0439 15.3145 19.1133 15.4395 19.334 15.7734C19.5078 16.0371 19.667 16.3066 19.7754 16.6152C19.8408 16.8066 19.7559 16.9648 19.5273 17.0625Z" fill-rule="nonzero" fill="#4D6BFE"></path></svg></div><div class="_48edb25"><div class="_58a6d71 _19db599"><div class="ds-icon _7580acb" style="font-size: 12px; width: 12px; height: 12px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2.656 17.344c-1.016-1.015-1.15-2.75-.313-4.925.325-.825.73-1.617 1.205-2.365L3.582 10l-.033-.054c-.5-.799-.91-1.596-1.206-2.365-.836-2.175-.703-3.91.313-4.926.56-.56 1.364-.86 2.335-.86 1.425 0 3.168.636 4.957 1.756l.053.034.053-.034c1.79-1.12 3.532-1.757 4.957-1.757.972 0 1.776.3 2.335.86 1.014 1.015 1.148 2.752.312 4.926a13.892 13.892 0 0 1-1.206 2.365l-.034.054.034.053c.5.8.91 1.596 1.205 2.365.837 2.175.704 3.911-.311 4.926-.56.56-1.364.861-2.335.861-1.425 0-3.168-.637-4.957-1.757L10 16.415l-.053.033c-1.79 1.12-3.532 1.757-4.957 1.757-.972 0-1.776-.3-2.335-.86zm13.631-4.399c-.187-.488-.429-.988-.71-1.492l-.075-.132-.092.12a22.075 22.075 0 0 1-3.968 3.968l-.12.093.132.074c1.308.734 2.559 1.162 3.556 1.162.563 0 1.006-.138 1.298-.43.3-.3.436-.774.428-1.346-.008-.575-.159-1.264-.449-2.017zm-6.345 1.65l.058.042.058-.042a19.881 19.881 0 0 0 4.551-4.537l.043-.058-.043-.058a20.123 20.123 0 0 0-2.093-2.458 19.732 19.732 0 0 0-2.458-2.08L10 5.364l-.058.042A19.883 19.883 0 0 0 5.39 9.942L5.348 10l.042.059c.631.874 1.332 1.695 2.094 2.457a19.74 19.74 0 0 0 2.458 2.08zm6.366-10.902c-.293-.293-.736-.431-1.298-.431-.998 0-2.248.429-3.556 1.163l-.132.074.12.092a21.938 21.938 0 0 1 3.968 3.968l.092.12.074-.132c.282-.504.524-1.004.711-1.492.29-.753.442-1.442.45-2.017.007-.572-.129-1.045-.429-1.345zM3.712 7.055c.202.514.44 1.013.712 1.493l.074.13.092-.119a21.94 21.94 0 0 1 3.968-3.968l.12-.092-.132-.074C7.238 3.69 5.987 3.262 4.99 3.262c-.563 0-1.006.138-1.298.43-.3.301-.436.774-.428 1.346.007.575.159 1.264.448 2.017zm0 5.89c-.29.753-.44 1.442-.448 2.017-.008.572.127 1.045.428 1.345.293.293.736.431 1.298.431.997 0 2.247-.428 3.556-1.162l.131-.074-.12-.093a21.94 21.94 0 0 1-3.967-3.968l-.093-.12-.074.132a11.712 11.712 0 0 0-.71 1.492z" fill="currentColor" stroke="currentColor" stroke-width=".1"></path><path d="M10.706 11.704A1.843 1.843 0 0 1 8.155 10a1.845 1.845 0 1 1 2.551 1.704z" fill="currentColor" stroke="currentColor" stroke-width=".2"></path></svg></div>已深度思考（用时 45 秒）<div class="ds-icon _54f4262" style="font-size: 10px; width: 10px; height: 10px; transform: rotate(180deg);"><svg width="10" height="6" viewBox="0 0 10 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5.786 4.167L2.765 1.259c-.416-.4-.985-.482-1.273-.183-.287.298-.183.864.233 1.264l3.021 2.908c.416.4.986.482 1.273.184.287-.299.183-.865-.233-1.265z" fill="currentColor"></path><path d="M8.197 1.206L5.288 4.208c-.4.413-.484.982-.187 1.27.298.289.864.187 1.265-.227L9.274 2.25c.401-.414.485-.983.187-1.271-.297-.288-.863-.187-1.264.227z" fill="currentColor"></path></svg></div></div><div class="e1675d8b"><div class="_9ecc93a"></div>我们将逐步添加新功能：<div style="height: 6px;"></div> 1. 士兵组每次移动的最大距离增大到2格：这意味着我们需要改变移动范围的计算，并允许玩家选择2格范围内的格子。<div style="height: 6px;"></div> 2. 每占领一格他国领土，给占领国增加一组士兵：在成功占领敌方领土后，除了领土转移，还要增加一组士兵（放在新占领的领土上）。<div style="height: 6px;"></div> 3. 增强电脑AI：在移动前评估边境实力，只有当我方士兵数量大于相邻敌方士兵数量时才进攻。<div style="height: 6px;"></div><div style="height: 6px;"></div> 注意：由于移动距离变为2格，我们需要考虑路径是否畅通（中间格子是否可通行）？但是根据规则，士兵可以跨越一格（即使中间有障碍？），我们这里简化处理：允许直接移动到2格范围内的任何格子（不需要考虑中间格子），但只能移动到相邻或对角相邻的格子（即曼哈顿距离&lt;=2）？然而，我们之前只有上下左右四个方向，现在要扩展到包括斜角？但问题描述是“横纵向的网格”，所以我们只考虑上下左右四个方向，但距离为2（即可以一次移动两格，但方向只能是上下左右，不能斜向）。<div style="height: 6px;"></div><div style="height: 6px;"></div> 因此，我们将移动范围改为当前格子周围曼哈顿距离1和2的格子（但只能在同一行或同一列，因为斜向不允许）。实际上，曼哈顿距离为2的格子可以是上下左右两格，或者斜角（但斜角曼哈顿距离为2）？但是问题要求是横纵向，所以我们只考虑同一行或同一列，距离为1或2的格子。<div style="height: 6px;"></div><div style="height: 6px;"></div> 具体修改：<div style="height: 6px;"></div><div style="height: 6px;"></div> 1. 移动范围：<div style="height: 6px;"></div>    当前格子：(x, y)<div style="height: 6px;"></div>    可移动范围： <div style="height: 6px;"></div>        (x-2, y), (x-1, y), (x+1, y), (x+2, y)  同一行<div style="height: 6px;"></div>        (x, y-2), (x, y-1), (x, y+1), (x, y+2)  同一列<div style="height: 6px;"></div><div style="height: 6px;"></div>    注意：要检查这些格子是否在网格内。<div style="height: 6px;"></div><div style="height: 6px;"></div> 2. 占领他国领土后增加一组士兵：<div style="height: 6px;"></div>    在成功占领（即战斗胜利）后，我们在新占领的领土上增加一组士兵（即士兵组数量+1）。注意：战斗胜利后，我们原本会保留差值数量的士兵组，现在额外增加一组。<div style="height: 6px;"></div><div style="height: 6px;"></div> 3. 电脑AI策略增强：<div style="height: 6px;"></div>    当电脑考虑移动一个边境格子（与敌方相邻的格子）时，它会评估该格子上的士兵组数量与相邻敌方格子上的士兵组数量。<div style="height: 6px;"></div>    如果相邻敌方格子的士兵组数量总和小于等于我方该格子的士兵组数量，则发动进攻；否则，按兵不动。<div style="height: 6px;"></div><div style="height: 6px;"></div>    但是，电脑也可能向空白格子扩张，这不需要评估实力。<div style="height: 6px;"></div><div style="height: 6px;"></div>    因此，我们修改电脑的移动决策：<div style="height: 6px;"></div>        a. 首先，收集所有可能的移动（包括空白格子和敌方格子，距离为1或2的同一行/列格子）。<div style="height: 6px;"></div>        b. 对于每个可能的移动目标格子：<div style="height: 6px;"></div>            - 如果是空白格子，则直接移动（扩张）。<div style="height: 6px;"></div>            - 如果是敌方格子，则评估：我方出发格子的士兵组数量是否大于目标格子相邻的敌方士兵组数量（注意：目标格子本身就是一个敌方格子，我们只考虑目标格子上的士兵组数量？还是考虑目标格子及其周围一圈的敌方士兵组？根据要求，是“邻国边境实力”，我们这里简化：只比较目标格子上的士兵组数量（因为我们要进攻的就是这个格子）和出发格子的士兵组数量。<div style="height: 6px;"></div><div style="height: 6px;"></div>        规则：只有当出发格子的士兵组数量 &gt; 目标格子的士兵组数量（即目标格子上的敌方士兵组数量）时，才进攻。<div style="height: 6px;"></div><div style="height: 6px;"></div>    注意：电脑一次移动整个方格的士兵组，所以比较的是出发格子的士兵组数量。<div style="height: 6px;"></div><div style="height: 6px;"></div> 由于改动较大，我们将逐步修改代码。<div style="height: 6px;"></div><div style="height: 6px;"></div> 注意：移动距离为2，可能会跨越一个格子，这个中间格子可能是己方、敌方或空白。按照规则，我们允许直接跨越（不需要中间格子是己方），但移动后，士兵组到达目标格子，中间格子不受影响。<div style="height: 6px;"></div><div style="height: 6px;"></div> 修改步骤：<div style="height: 6px;"></div><div style="height: 6px;"></div> 一、修改移动范围（玩家和电脑）<div style="height: 6px;"></div>     在绘制可移动范围时，除了相邻四格外，还要增加同一行/列的两格位置（共8个位置）。<div style="height: 6px;"></div>     在移动时，检查目标格子是否在移动范围内（曼哈顿距离为1或2，且在同一行或同一列）。<div style="height: 6px;"></div><div style="height: 6px;"></div> 二、修改战斗后的奖励<div style="height: 6px;"></div>     在成功占领敌方领土后（即战斗胜利且差值为非负），我们在新领土上增加一组士兵（注意：战斗后已经保留了一些士兵组，我们再增加一组）。<div style="height: 6px;"></div><div style="height: 6px;"></div> 三、修改电脑AI的移动决策<div style="height: 6px;"></div>     在电脑选择移动时，对每个可能的目标格子进行判断：<div style="height: 6px;"></div>        如果是空白，则允许移动。<div style="height: 6px;"></div>        如果是敌方，则比较出发格子的士兵组数量是否大于目标格子的士兵组数量，如果大于则进攻，否则跳过。<div style="height: 6px;"></div><div style="height: 6px;"></div> 由于时间关系，我们只考虑距离为1和2的同一行/列格子（即上下左右四个方向，但可以走1步或2步）。<div style="height: 6px;"></div><div style="height: 6px;"></div> 注意：移动2步时，中间格子是什么情况不影响移动。<div style="height: 6px;"></div><div style="height: 6px;"></div> 开始修改代码：</div></div><div class="ds-markdown ds-markdown--block" style="--ds-md-zoom: 1.143;"><p class="ds-markdown-paragraph">我将为您添加这些新功能。以下是完整的改进代码：</p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre><span class="token keyword">import</span> pygame
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> random
<span class="token keyword">import</span> math
<span class="token keyword">from</span> pygame<span class="token punctuation">.</span><span class="token builtin">locals</span> <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token comment"># 初始化pygame</span>
pygame<span class="token punctuation">.</span>init<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 游戏常量</span>
SCREEN_WIDTH <span class="token operator">=</span> <span class="token number">1000</span>
SCREEN_HEIGHT <span class="token operator">=</span> <span class="token number">700</span>
GRID_SIZE <span class="token operator">=</span> <span class="token number">20</span>
GRID_WIDTH <span class="token operator">=</span> <span class="token number">40</span>
GRID_HEIGHT <span class="token operator">=</span> <span class="token number">30</span>
TILE_SIZE <span class="token operator">=</span> <span class="token number">20</span>

<span class="token comment"># 尝试加载中文字体</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token comment"># 尝试常见的中文字体</span>
    FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token string">"SimHei"</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
    LARGE_FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token string">"SimHei"</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>
    SMALL_FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token string">"SimHei"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>
<span class="token keyword">except</span><span class="token punctuation">:</span>
    <span class="token comment"># 回退到默认字体</span>
    FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
    LARGE_FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>
    SMALL_FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>

<span class="token comment"># 颜色</span>
BACKGROUND <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
GRID_COLOR <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
WHITE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
BLACK <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
RED <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
GREEN <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
BLUE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
YELLOW <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
PURPLE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
CYAN <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
ORANGE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">165</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
PINK <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span>
COLORS <span class="token operator">=</span> <span class="token punctuation">[</span>RED<span class="token punctuation">,</span> BLUE<span class="token punctuation">,</span> YELLOW<span class="token punctuation">,</span> PURPLE<span class="token punctuation">,</span> CYAN<span class="token punctuation">,</span> ORANGE<span class="token punctuation">,</span> PINK<span class="token punctuation">]</span>  <span class="token comment"># 增加更多颜色</span>
HIGHLIGHT <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Country</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> color<span class="token punctuation">,</span> name<span class="token punctuation">,</span> is_player<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>color <span class="token operator">=</span> color
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>is_player <span class="token operator">=</span> is_player
        self<span class="token punctuation">.</span>territory <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># 存储士兵组的位置坐标</span>
        self<span class="token punctuation">.</span>next_reward <span class="token operator">=</span> <span class="token number">3</span>
        self<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">add_territory</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> game<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""增加领土并检查是否应生成新士兵组"""</span>
        <span class="token comment"># 每占领3块领土获得一个新的士兵组</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>territory <span class="token operator">&gt;=</span> self<span class="token punctuation">.</span>next_reward<span class="token punctuation">:</span>
            <span class="token comment"># 更新奖励阈值</span>
            self<span class="token punctuation">.</span>next_reward <span class="token operator">+=</span> <span class="token number">3</span>
            
            <span class="token comment"># 在随机领土上生成新士兵组</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                <span class="token comment"># 收集所有安全的领土位置（仅限己方领土且无士兵重叠）</span>
                safe_positions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">if</span> game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token keyword">and</span> game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> self<span class="token punctuation">:</span>
                            <span class="token comment"># 确保不在他国领土上</span>
                            is_safe <span class="token operator">=</span> <span class="token boolean">True</span>
                            <span class="token keyword">for</span> dx<span class="token punctuation">,</span> dy <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                                nx<span class="token punctuation">,</span> ny <span class="token operator">=</span> x <span class="token operator">+</span> dx<span class="token punctuation">,</span> y <span class="token operator">+</span> dy
                                <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> nx <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> ny <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">:</span>
                                    <span class="token keyword">if</span> game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>ny<span class="token punctuation">]</span><span class="token punctuation">[</span>nx<span class="token punctuation">]</span> <span class="token keyword">and</span> game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>ny<span class="token punctuation">]</span><span class="token punctuation">[</span>nx<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> self<span class="token punctuation">:</span>
                                        is_safe <span class="token operator">=</span> <span class="token boolean">False</span>
                                        <span class="token keyword">break</span>
                            
                            <span class="token keyword">if</span> is_safe<span class="token punctuation">:</span>
                                safe_positions<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
                
                <span class="token keyword">if</span> safe_positions<span class="token punctuation">:</span>
                    <span class="token comment"># 随机选择一个安全位置</span>
                    x<span class="token punctuation">,</span> y <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>safe_positions<span class="token punctuation">)</span>
                    
                    <span class="token comment"># 创建新士兵组</span>
                    new_troop <span class="token operator">=</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span>
                    
                    <span class="token comment"># 添加到国家士兵列表</span>
                    self<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_troop<span class="token punctuation">)</span>
                    
                    <span class="token comment"># 添加到网格</span>
                    game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_troop<span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

<span class="token keyword">class</span> <span class="token class-name">Game</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>screen <span class="token operator">=</span> pygame<span class="token punctuation">.</span>display<span class="token punctuation">.</span>set_mode<span class="token punctuation">(</span><span class="token punctuation">(</span>SCREEN_WIDTH<span class="token punctuation">,</span> SCREEN_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">)</span>
        pygame<span class="token punctuation">.</span>display<span class="token punctuation">.</span>set_caption<span class="token punctuation">(</span><span class="token string">"领土征服者"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>clock <span class="token operator">=</span> pygame<span class="token punctuation">.</span>time<span class="token punctuation">.</span>Clock<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 创建国家</span>
        self<span class="token punctuation">.</span>countries <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>player_country <span class="token operator">=</span> Country<span class="token punctuation">(</span>GREEN<span class="token punctuation">,</span> <span class="token string">"玩家"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>countries<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>player_country<span class="token punctuation">)</span>
        
        <span class="token comment"># 创建电脑国家 (使用不同颜色)</span>
        ai_names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"红国"</span><span class="token punctuation">,</span> <span class="token string">"蓝国"</span><span class="token punctuation">,</span> <span class="token string">"黄国"</span><span class="token punctuation">,</span> <span class="token string">"紫国"</span><span class="token punctuation">,</span> <span class="token string">"青国"</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 创建5个电脑国家</span>
            color_idx <span class="token operator">=</span> i <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>COLORS<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>countries<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Country<span class="token punctuation">(</span>COLORS<span class="token punctuation">[</span>color_idx<span class="token punctuation">]</span><span class="token punctuation">,</span> ai_names<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 初始化网格</span>
        self<span class="token punctuation">.</span>grid <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token boolean">None</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>selected_tile <span class="token operator">=</span> <span class="token boolean">None</span>  <span class="token comment"># 改为选择整个方格</span>
        self<span class="token punctuation">.</span>game_over <span class="token operator">=</span> <span class="token boolean">False</span>
        self<span class="token punctuation">.</span>winner <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>turn_count <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 回合计数器</span>
        
        <span class="token comment"># 初始化领土和士兵</span>
        self<span class="token punctuation">.</span>initialize_game<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">initialize_game</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 为每个国家分配初始领土</span>
        positions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>countries<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
                x <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> GRID_WIDTH <span class="token operator">-</span> <span class="token number">6</span><span class="token punctuation">)</span>
                y <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">-</span> <span class="token number">6</span><span class="token punctuation">)</span>
                <span class="token comment"># 确保初始位置不重叠且有一定间距</span>
                too_close <span class="token operator">=</span> <span class="token boolean">False</span>
                <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> positions<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>px <span class="token operator">-</span> x<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">8</span> <span class="token keyword">and</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>py <span class="token operator">-</span> y<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">:</span>
                        too_close <span class="token operator">=</span> <span class="token boolean">True</span>
                        <span class="token keyword">break</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> too_close <span class="token keyword">and</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">not</span> <span class="token keyword">in</span> positions<span class="token punctuation">:</span>
                    positions<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
                        <span class="token string">'country'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>countries<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token string">'troops'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">]</span>  <span class="token comment"># 初始士兵组</span>
                    <span class="token punctuation">}</span>
                    self<span class="token punctuation">.</span>countries<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>territory <span class="token operator">=</span> <span class="token number">1</span>
                    self<span class="token punctuation">.</span>countries<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">]</span>
                    self<span class="token punctuation">.</span>countries<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>next_reward <span class="token operator">=</span> <span class="token number">3</span>
                    <span class="token keyword">break</span>
    
    <span class="token keyword">def</span> <span class="token function">draw_grid</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 绘制网格背景</span>
        self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>fill<span class="token punctuation">(</span>BACKGROUND<span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制网格线</span>
        <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> SCREEN_WIDTH<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">:</span>
            pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>line<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> GRID_COLOR<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">:</span>
            pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>line<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> GRID_COLOR<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>SCREEN_WIDTH<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制领土和士兵</span>
        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">:</span>
                    country <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span>
                    rect <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Rect<span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span>
                    pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> country<span class="token punctuation">.</span>color<span class="token punctuation">,</span> rect<span class="token punctuation">)</span>
                    
                    <span class="token comment"># 绘制士兵组</span>
                    troop_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span> troop_count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                        pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> WHITE<span class="token punctuation">,</span> 
                                          <span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                          TILE_SIZE<span class="token operator">//</span><span class="token number">3</span><span class="token punctuation">)</span>
                        text <span class="token operator">=</span> FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>troop_count<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span>
                        text_rect <span class="token operator">=</span> text<span class="token punctuation">.</span>get_rect<span class="token punctuation">(</span>center<span class="token operator">=</span><span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>text<span class="token punctuation">,</span> text_rect<span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制选中的方格</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>selected_tile<span class="token punctuation">:</span>
            x<span class="token punctuation">,</span> y <span class="token operator">=</span> self<span class="token punctuation">.</span>selected_tile
            rect <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Rect<span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span>
            pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> HIGHLIGHT<span class="token punctuation">,</span> rect<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 绘制可移动范围 (距离2格)</span>
            <span class="token keyword">for</span> dx<span class="token punctuation">,</span> dy <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 相邻格子</span>
                          <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>  <span class="token comment"># 距离2格</span>
                nx<span class="token punctuation">,</span> ny <span class="token operator">=</span> x <span class="token operator">+</span> dx<span class="token punctuation">,</span> y <span class="token operator">+</span> dy
                <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> nx <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> ny <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">:</span>
                    rect <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Rect<span class="token punctuation">(</span>nx <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> ny <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span>
                    pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rect<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制信息面板</span>
        info_panel_y <span class="token operator">=</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE
        info_panel_height <span class="token operator">=</span> SCREEN_HEIGHT <span class="token operator">-</span> info_panel_y
        pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> info_panel_y<span class="token punctuation">,</span> SCREEN_WIDTH<span class="token punctuation">,</span> info_panel_height<span class="token punctuation">)</span><span class="token punctuation">)</span>
        pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>line<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> WHITE<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> info_panel_y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>SCREEN_WIDTH<span class="token punctuation">,</span> info_panel_y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制玩家信息</span>
        player_text <span class="token operator">=</span> LARGE_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"玩家领土: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>territory<span class="token punctuation">}</span></span><span class="token string">  下一奖励: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>next_reward<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> GREEN<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>player_text<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> info_panel_y <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制游戏说明</span>
        instructions <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string">"游戏说明:"</span><span class="token punctuation">,</span>
            <span class="token string">"1. 点击自己的领土选择士兵"</span><span class="token punctuation">,</span>
            <span class="token string">"2. 点击相邻格子移动所有士兵 (可移动1-2格)"</span><span class="token punctuation">,</span>
            <span class="token string">"3. 每占领3块领土获得一个新士兵组"</span><span class="token punctuation">,</span>
            <span class="token string">"4. 每占领敌国领土额外获得一组士兵"</span><span class="token punctuation">,</span>
            <span class="token string">"5. 目标: 消灭所有其他国家"</span>
        <span class="token punctuation">]</span>
        
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> text <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>instructions<span class="token punctuation">)</span><span class="token punctuation">:</span>
            rendered <span class="token operator">=</span> SMALL_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> WHITE<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>rendered<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> info_panel_y <span class="token operator">+</span> <span class="token number">60</span> <span class="token operator">+</span> i <span class="token operator">*</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制电脑国家信息 (分两列显示)</span>
        ai_info <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> country <span class="token keyword">in</span> self<span class="token punctuation">.</span>countries<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> country<span class="token punctuation">.</span>is_player <span class="token keyword">and</span> <span class="token keyword">not</span> country<span class="token punctuation">.</span>defeated<span class="token punctuation">:</span>
                ai_info<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>country<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>country<span class="token punctuation">.</span>territory<span class="token punctuation">}</span></span><span class="token string">领土"</span></span><span class="token punctuation">)</span>
        
        <span class="token comment"># 第一列</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>ai_info<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            ai_text1 <span class="token operator">=</span> SMALL_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">"电脑国家: "</span> <span class="token operator">+</span> <span class="token string">", "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>ai_info<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> YELLOW<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>ai_text1<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> info_panel_y <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 第二列</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>ai_info<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">:</span>
            ai_text2 <span class="token operator">=</span> SMALL_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>ai_info<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> YELLOW<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>ai_text2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> info_panel_y <span class="token operator">+</span> <span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 回合计数</span>
        turn_text <span class="token operator">=</span> SMALL_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"回合: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>turn_count<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> CYAN<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>turn_text<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> info_panel_y <span class="token operator">+</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制游戏结束信息</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>game_over<span class="token punctuation">:</span>
            overlay <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Surface<span class="token punctuation">(</span><span class="token punctuation">(</span>SCREEN_WIDTH<span class="token punctuation">,</span> SCREEN_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">,</span> pygame<span class="token punctuation">.</span>SRCALPHA<span class="token punctuation">)</span>
            overlay<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>overlay<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>winner<span class="token punctuation">.</span>is_player<span class="token punctuation">:</span>
                text <span class="token operator">=</span> LARGE_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">"恭喜！你赢得了战争！"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> GREEN<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                text <span class="token operator">=</span> LARGE_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>winner<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">赢得了战争！"</span></span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>winner<span class="token punctuation">.</span>color<span class="token punctuation">)</span>
            
            restart <span class="token operator">=</span> FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">"按R键重新开始游戏"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> WHITE<span class="token punctuation">)</span>
            
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token punctuation">(</span>SCREEN_WIDTH<span class="token operator">//</span><span class="token number">2</span> <span class="token operator">-</span> text<span class="token punctuation">.</span>get_width<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> SCREEN_HEIGHT<span class="token operator">//</span><span class="token number">2</span> <span class="token operator">-</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>restart<span class="token punctuation">,</span> <span class="token punctuation">(</span>SCREEN_WIDTH<span class="token operator">//</span><span class="token number">2</span> <span class="token operator">-</span> restart<span class="token punctuation">.</span>get_width<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> SCREEN_HEIGHT<span class="token operator">//</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">handle_click</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>game_over<span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        grid_x <span class="token operator">=</span> pos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">//</span> TILE_SIZE
        grid_y <span class="token operator">=</span> pos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">//</span> TILE_SIZE
        
        <span class="token comment"># 确保点击在网格范围内</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;=</span> grid_x <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> grid_y <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        <span class="token comment"># 选择整个方格</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>selected_tile <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>grid_y<span class="token punctuation">]</span><span class="token punctuation">[</span>grid_x<span class="token punctuation">]</span> <span class="token keyword">and</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>grid_y<span class="token punctuation">]</span><span class="token punctuation">[</span>grid_x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">:</span>
                <span class="token comment"># 检查该位置是否有玩家士兵组</span>
                <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>grid_y<span class="token punctuation">]</span><span class="token punctuation">[</span>grid_x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>selected_tile <span class="token operator">=</span> <span class="token punctuation">(</span>grid_x<span class="token punctuation">,</span> grid_y<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># 移动士兵组</span>
            selected_x<span class="token punctuation">,</span> selected_y <span class="token operator">=</span> self<span class="token punctuation">.</span>selected_tile
            
            <span class="token comment"># 检查是否在移动范围内 (曼哈顿距离 &lt;= 2 且在同一行或列)</span>
            dx <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>grid_x <span class="token operator">-</span> selected_x<span class="token punctuation">)</span>
            dy <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>grid_y <span class="token operator">-</span> selected_y<span class="token punctuation">)</span>
            
            <span class="token comment"># 只能水平或垂直移动，距离1-2格</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>dx <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">or</span> dx <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">and</span> dy <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>dy <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">or</span> dy <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">and</span> dx <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>move_troops<span class="token punctuation">(</span>selected_x<span class="token punctuation">,</span> selected_y<span class="token punctuation">,</span> grid_x<span class="token punctuation">,</span> grid_y<span class="token punctuation">)</span>
            
            self<span class="token punctuation">.</span>selected_tile <span class="token operator">=</span> <span class="token boolean">None</span>
    
    <span class="token keyword">def</span> <span class="token function">move_troops</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> from_x<span class="token punctuation">,</span> from_y<span class="token punctuation">,</span> to_x<span class="token punctuation">,</span> to_y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 获取原方格信息</span>
        from_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>from_y<span class="token punctuation">]</span><span class="token punctuation">[</span>from_x<span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> from_tile <span class="token keyword">or</span> <span class="token keyword">not</span> from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        <span class="token comment"># 获取要移动的所有士兵组</span>
        moving_troops <span class="token operator">=</span> from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>  <span class="token comment"># 复制列表</span>
        
        <span class="token comment"># 从原位置移除所有士兵组</span>
        from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> troop <span class="token keyword">in</span> moving_troops<span class="token punctuation">:</span>
            <span class="token keyword">if</span> troop <span class="token keyword">in</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop<span class="token punctuation">)</span>
        
        <span class="token comment"># 更新士兵组位置</span>
        <span class="token keyword">for</span> troop <span class="token keyword">in</span> moving_troops<span class="token punctuation">:</span>
            troop<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_x
            troop<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_y
        
        <span class="token comment"># 添加到新位置</span>
        to_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>to_y<span class="token punctuation">]</span><span class="token punctuation">[</span>to_x<span class="token punctuation">]</span>
        
        <span class="token keyword">if</span> <span class="token keyword">not</span> to_tile<span class="token punctuation">:</span>
            <span class="token comment"># 占领新领土</span>
            self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>to_y<span class="token punctuation">]</span><span class="token punctuation">[</span>to_x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'country'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">,</span>
                <span class="token string">'troops'</span><span class="token punctuation">:</span> moving_troops
            <span class="token punctuation">}</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>territory <span class="token operator">+=</span> <span class="token number">1</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
            <span class="token comment"># 检查是否应获得新士兵组</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">:</span>
                <span class="token comment"># 合并到友方领土</span>
                to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>extend<span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># 与敌方发生战斗</span>
                self<span class="token punctuation">.</span>resolve_battle<span class="token punctuation">(</span>to_x<span class="token punctuation">,</span> to_y<span class="token punctuation">,</span> moving_troops<span class="token punctuation">)</span>
        
        <span class="token comment"># 电脑回合</span>
        self<span class="token punctuation">.</span>ai_turn<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>turn_count <span class="token operator">+=</span> <span class="token number">1</span>
        
        <span class="token comment"># 检查游戏是否结束</span>
        self<span class="token punctuation">.</span>check_game_over<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">resolve_battle</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> attacking_troops<span class="token punctuation">)</span><span class="token punctuation">:</span>
        tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span>
        defending_country <span class="token operator">=</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span>
        defending_troops <span class="token operator">=</span> tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
        attacking_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>attacking_troops<span class="token punctuation">)</span>
        defending_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>defending_troops<span class="token punctuation">)</span>
        
        <span class="token comment"># 计算战斗结果</span>
        difference <span class="token operator">=</span> attacking_count <span class="token operator">-</span> defending_count
        
        <span class="token keyword">if</span> difference <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token comment"># 攻击方胜利</span>
            tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>player_country
            <span class="token comment"># 只保留差值数量的士兵组</span>
            tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> attacking_troops
            
            <span class="token comment"># 额外奖励一组士兵（新功能2）</span>
            new_troop <span class="token operator">=</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span>
            tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_troop<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_troop<span class="token punctuation">)</span>
            
            <span class="token comment"># 更新玩家士兵列表</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span>t <span class="token keyword">for</span> t <span class="token keyword">in</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops <span class="token keyword">if</span> t <span class="token keyword">not</span> <span class="token keyword">in</span> defending_troops<span class="token punctuation">]</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 领土变更</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>territory <span class="token operator">+=</span> <span class="token number">1</span>
            defending_country<span class="token punctuation">.</span>territory <span class="token operator">-=</span> <span class="token number">1</span>
            
            <span class="token comment"># 检查是否应获得新士兵组</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
            
            <span class="token comment"># 检查防御方是否被击败</span>
            <span class="token keyword">if</span> defending_country<span class="token punctuation">.</span>territory <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                defending_country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">True</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># 防御方胜利</span>
            <span class="token comment"># 移除所有进攻方士兵组</span>
            <span class="token keyword">for</span> troop <span class="token keyword">in</span> attacking_troops<span class="token punctuation">:</span>
                <span class="token keyword">if</span> troop <span class="token keyword">in</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop<span class="token punctuation">)</span>
            
            <span class="token comment"># 防御方损失士兵组数量等于进攻方数量</span>
            <span class="token keyword">if</span> defending_troops<span class="token punctuation">:</span>
                <span class="token comment"># 随机移除防御方士兵组</span>
                remove_count <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>defending_troops<span class="token punctuation">)</span><span class="token punctuation">,</span> attacking_count<span class="token punctuation">)</span>
                removed_troops <span class="token operator">=</span> random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>defending_troops<span class="token punctuation">,</span> remove_count<span class="token punctuation">)</span>
                
                <span class="token comment"># 更新防御方士兵</span>
                tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>t <span class="token keyword">for</span> t <span class="token keyword">in</span> defending_troops <span class="token keyword">if</span> t <span class="token keyword">not</span> <span class="token keyword">in</span> removed_troops<span class="token punctuation">]</span>
                defending_country<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span>t <span class="token keyword">for</span> t <span class="token keyword">in</span> defending_country<span class="token punctuation">.</span>troops <span class="token keyword">if</span> t <span class="token keyword">not</span> <span class="token keyword">in</span> removed_troops<span class="token punctuation">]</span>
                
                <span class="token keyword">if</span> <span class="token keyword">not</span> tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                    <span class="token comment"># 如果防御方没有士兵了，领土变为中立</span>
                    tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
                    defending_country<span class="token punctuation">.</span>territory <span class="token operator">-=</span> <span class="token number">1</span>
                    <span class="token keyword">if</span> defending_country<span class="token punctuation">.</span>territory <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                        defending_country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">True</span>
    
    <span class="token keyword">def</span> <span class="token function">ai_turn</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> country <span class="token keyword">in</span> self<span class="token punctuation">.</span>countries<span class="token punctuation">:</span>
            <span class="token keyword">if</span> country<span class="token punctuation">.</span>is_player <span class="token keyword">or</span> country<span class="token punctuation">.</span>defeated<span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            
            <span class="token comment"># 收集所有可能的移动</span>
            possible_moves <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            
            <span class="token comment"># 收集所有边境格子（与敌方或空白相邻的格子）</span>
            border_tiles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">if</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token keyword">and</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> country <span class="token keyword">and</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                        <span class="token comment"># 检查是否在边境</span>
                        is_border <span class="token operator">=</span> <span class="token boolean">False</span>
                        <span class="token keyword">for</span> dx<span class="token punctuation">,</span> dy <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                            nx<span class="token punctuation">,</span> ny <span class="token operator">=</span> x <span class="token operator">+</span> dx<span class="token punctuation">,</span> y <span class="token operator">+</span> dy
                            <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> nx <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> ny <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">:</span>
                                <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>ny<span class="token punctuation">]</span><span class="token punctuation">[</span>nx<span class="token punctuation">]</span> <span class="token keyword">or</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>ny<span class="token punctuation">]</span><span class="token punctuation">[</span>nx<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> country<span class="token punctuation">:</span>
                                    is_border <span class="token operator">=</span> <span class="token boolean">True</span>
                                    <span class="token keyword">break</span>
                        
                        <span class="token keyword">if</span> is_border<span class="token punctuation">:</span>
                            border_tiles<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> <span class="token keyword">not</span> border_tiles<span class="token punctuation">:</span>
                <span class="token comment"># 如果没有边境格子，使用所有有士兵的格子</span>
                <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">if</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token keyword">and</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> country <span class="token keyword">and</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                            border_tiles<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 尝试每个边境格子</span>
            random<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>border_tiles<span class="token punctuation">)</span>
            moved <span class="token operator">=</span> <span class="token boolean">False</span>
            
            <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> border_tiles<span class="token punctuation">:</span>
                <span class="token comment"># 检查该格子是否还有士兵（可能在之前的移动中已被移动）</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token keyword">or</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token keyword">or</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> country<span class="token punctuation">:</span>
                    <span class="token keyword">continue</span>
                
                <span class="token comment"># 收集可能的移动目标</span>
                targets <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                
                <span class="token comment"># 检查所有可能的方向（1-2格距离）</span>
                <span class="token keyword">for</span> dx<span class="token punctuation">,</span> dy <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                    nx<span class="token punctuation">,</span> ny <span class="token operator">=</span> x <span class="token operator">+</span> dx<span class="token punctuation">,</span> y <span class="token operator">+</span> dy
                    <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> nx <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> ny <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">:</span>
                        targets<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>nx<span class="token punctuation">,</span> ny<span class="token punctuation">)</span><span class="token punctuation">)</span>
                
                <span class="token comment"># 随机打乱目标顺序</span>
                random<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>targets<span class="token punctuation">)</span>
                
                <span class="token keyword">for</span> tx<span class="token punctuation">,</span> ty <span class="token keyword">in</span> targets<span class="token punctuation">:</span>
                    <span class="token comment"># 获取目标格子</span>
                    target_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>ty<span class="token punctuation">]</span><span class="token punctuation">[</span>tx<span class="token punctuation">]</span>
                    
                    <span class="token comment"># 如果是空白格子，直接占领</span>
                    <span class="token keyword">if</span> <span class="token keyword">not</span> target_tile<span class="token punctuation">:</span>
                        self<span class="token punctuation">.</span>ai_move<span class="token punctuation">(</span>country<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> tx<span class="token punctuation">,</span> ty<span class="token punctuation">)</span>
                        moved <span class="token operator">=</span> <span class="token boolean">True</span>
                        <span class="token keyword">break</span>
                    
                    <span class="token comment"># 如果是敌方格子，评估实力</span>
                    <span class="token keyword">if</span> target_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> country<span class="token punctuation">:</span>
                        <span class="token comment"># 获取边境实力</span>
                        my_strength <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                        enemy_strength <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>target_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                        
                        <span class="token comment"># 新功能3：增强策略性 - 只在实力足够时进攻</span>
                        <span class="token keyword">if</span> my_strength <span class="token operator">&gt;</span> enemy_strength<span class="token punctuation">:</span>
                            self<span class="token punctuation">.</span>ai_move<span class="token punctuation">(</span>country<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> tx<span class="token punctuation">,</span> ty<span class="token punctuation">)</span>
                            moved <span class="token operator">=</span> <span class="token boolean">True</span>
                            <span class="token keyword">break</span>
                
                <span class="token keyword">if</span> moved<span class="token punctuation">:</span>
                    <span class="token keyword">break</span>
    
    <span class="token keyword">def</span> <span class="token function">ai_move</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> country<span class="token punctuation">,</span> from_x<span class="token punctuation">,</span> from_y<span class="token punctuation">,</span> to_x<span class="token punctuation">,</span> to_y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 获取原方格信息</span>
        from_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>from_y<span class="token punctuation">]</span><span class="token punctuation">[</span>from_x<span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> from_tile <span class="token keyword">or</span> <span class="token keyword">not</span> from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        <span class="token comment"># 获取要移动的所有士兵组</span>
        moving_troops <span class="token operator">=</span> from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>  <span class="token comment"># 复制列表</span>
        
        <span class="token comment"># 从原位置移除所有士兵组</span>
        from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> troop <span class="token keyword">in</span> moving_troops<span class="token punctuation">:</span>
            <span class="token keyword">if</span> troop <span class="token keyword">in</span> country<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop<span class="token punctuation">)</span>
        
        <span class="token comment"># 更新士兵组位置</span>
        <span class="token keyword">for</span> troop <span class="token keyword">in</span> moving_troops<span class="token punctuation">:</span>
            troop<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_x
            troop<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_y
        
        <span class="token comment"># 添加到新位置</span>
        to_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>to_y<span class="token punctuation">]</span><span class="token punctuation">[</span>to_x<span class="token punctuation">]</span>
        
        <span class="token keyword">if</span> <span class="token keyword">not</span> to_tile<span class="token punctuation">:</span>
            <span class="token comment"># 占领新领土</span>
            self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>to_y<span class="token punctuation">]</span><span class="token punctuation">[</span>to_x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'country'</span><span class="token punctuation">:</span> country<span class="token punctuation">,</span>
                <span class="token string">'troops'</span><span class="token punctuation">:</span> moving_troops
            <span class="token punctuation">}</span>
            country<span class="token punctuation">.</span>territory <span class="token operator">+=</span> <span class="token number">1</span>
            country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
            <span class="token comment"># 检查是否应获得新士兵组</span>
            country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> country<span class="token punctuation">:</span>
                <span class="token comment"># 合并到友方领土</span>
                to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>extend<span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
                country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># 与敌方发生战斗</span>
                defending_country <span class="token operator">=</span> to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token keyword">if</span> to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token keyword">else</span> <span class="token boolean">None</span>
                defending_troops <span class="token operator">=</span> to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
                attacking_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
                defending_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>defending_troops<span class="token punctuation">)</span>
                
                difference <span class="token operator">=</span> attacking_count <span class="token operator">-</span> defending_count
                
                <span class="token keyword">if</span> difference <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    <span class="token comment"># 攻击方胜利</span>
                    to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> country
                    to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> moving_troops
                    
                    <span class="token comment"># 额外奖励一组士兵（新功能2）</span>
                    new_troop <span class="token operator">=</span> <span class="token punctuation">[</span>to_x<span class="token punctuation">,</span> to_y<span class="token punctuation">]</span>
                    to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_troop<span class="token punctuation">)</span>
                    country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_troop<span class="token punctuation">)</span>
                    
                    <span class="token comment"># 更新国家士兵列表</span>
                    country<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span>t <span class="token keyword">for</span> t <span class="token keyword">in</span> country<span class="token punctuation">.</span>troops <span class="token keyword">if</span> t <span class="token keyword">not</span> <span class="token keyword">in</span> defending_troops<span class="token punctuation">]</span>
                    country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    
                    <span class="token comment"># 领土变更</span>
                    country<span class="token punctuation">.</span>territory <span class="token operator">+=</span> <span class="token number">1</span>
                    <span class="token keyword">if</span> defending_country<span class="token punctuation">:</span>
                        defending_country<span class="token punctuation">.</span>territory <span class="token operator">-=</span> <span class="token number">1</span>
                        <span class="token keyword">if</span> defending_country<span class="token punctuation">.</span>territory <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                            defending_country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">True</span>
                    
                    <span class="token comment"># 检查是否应获得新士兵组</span>
                    country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token comment"># 防御方胜利</span>
                    <span class="token comment"># 移除所有进攻方士兵组</span>
                    <span class="token keyword">for</span> troop <span class="token keyword">in</span> moving_troops<span class="token punctuation">:</span>
                        <span class="token keyword">if</span> troop <span class="token keyword">in</span> country<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                            country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop<span class="token punctuation">)</span>
                    
                    <span class="token comment"># 防御方损失士兵组数量等于进攻方数量</span>
                    <span class="token keyword">if</span> defending_troops <span class="token keyword">and</span> defending_country<span class="token punctuation">:</span>
                        <span class="token comment"># 随机移除防御方士兵组</span>
                        remove_count <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>defending_troops<span class="token punctuation">)</span><span class="token punctuation">,</span> attacking_count<span class="token punctuation">)</span>
                        removed_troops <span class="token operator">=</span> random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>defending_troops<span class="token punctuation">,</span> remove_count<span class="token punctuation">)</span>
                        
                        <span class="token comment"># 更新防御方士兵</span>
                        to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>t <span class="token keyword">for</span> t <span class="token keyword">in</span> defending_troops <span class="token keyword">if</span> t <span class="token keyword">not</span> <span class="token keyword">in</span> removed_troops<span class="token punctuation">]</span>
                        defending_country<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span>t <span class="token keyword">for</span> t <span class="token keyword">in</span> defending_country<span class="token punctuation">.</span>troops <span class="token keyword">if</span> t <span class="token keyword">not</span> <span class="token keyword">in</span> removed_troops<span class="token punctuation">]</span>
                        
                        <span class="token keyword">if</span> <span class="token keyword">not</span> to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                            <span class="token comment"># 如果防御方没有士兵了，领土变为中立</span>
                            to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
                            <span class="token keyword">if</span> defending_country<span class="token punctuation">:</span>
                                defending_country<span class="token punctuation">.</span>territory <span class="token operator">-=</span> <span class="token number">1</span>
                                <span class="token keyword">if</span> defending_country<span class="token punctuation">.</span>territory <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                                    defending_country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">True</span>
    
    <span class="token keyword">def</span> <span class="token function">check_game_over</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        active_countries <span class="token operator">=</span> <span class="token punctuation">[</span>c <span class="token keyword">for</span> c <span class="token keyword">in</span> self<span class="token punctuation">.</span>countries <span class="token keyword">if</span> <span class="token keyword">not</span> c<span class="token punctuation">.</span>defeated<span class="token punctuation">]</span>
        
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>active_countries<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>game_over <span class="token operator">=</span> <span class="token boolean">True</span>
            self<span class="token punctuation">.</span>winner <span class="token operator">=</span> active_countries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    
    <span class="token keyword">def</span> <span class="token function">restart_game</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 重置游戏状态</span>
        self<span class="token punctuation">.</span>grid <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token boolean">None</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> country <span class="token keyword">in</span> self<span class="token punctuation">.</span>countries<span class="token punctuation">:</span>
            country<span class="token punctuation">.</span>territory <span class="token operator">=</span> <span class="token number">0</span>
            country<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            country<span class="token punctuation">.</span>next_reward <span class="token operator">=</span> <span class="token number">3</span>
            country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">False</span>
        
        self<span class="token punctuation">.</span>selected_tile <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>game_over <span class="token operator">=</span> <span class="token boolean">False</span>
        self<span class="token punctuation">.</span>winner <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>turn_count <span class="token operator">=</span> <span class="token number">0</span>
        
        <span class="token comment"># 重新初始化游戏</span>
        self<span class="token punctuation">.</span>initialize_game<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> event <span class="token keyword">in</span> pygame<span class="token punctuation">.</span>event<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> event<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> QUIT<span class="token punctuation">:</span>
                    pygame<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">elif</span> event<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> MOUSEBUTTONDOWN<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> event<span class="token punctuation">.</span>button <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>  <span class="token comment"># 左键点击</span>
                        self<span class="token punctuation">.</span>handle_click<span class="token punctuation">(</span>event<span class="token punctuation">.</span>pos<span class="token punctuation">)</span>
                <span class="token keyword">elif</span> event<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> KEYDOWN<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> event<span class="token punctuation">.</span>key <span class="token operator">==</span> K_r<span class="token punctuation">:</span>  <span class="token comment"># 按R键重新开始</span>
                        self<span class="token punctuation">.</span>restart_game<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            self<span class="token punctuation">.</span>draw_grid<span class="token punctuation">(</span><span class="token punctuation">)</span>
            pygame<span class="token punctuation">.</span>display<span class="token punctuation">.</span>flip<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>clock<span class="token punctuation">.</span>tick<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    game <span class="token operator">=</span> Game<span class="token punctuation">(</span><span class="token punctuation">)</span>
    game<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></div><h2>新功能实现说明：</h2><h3>1. 士兵组移动距离增加到2格</h3><ul><li><p class="ds-markdown-paragraph"><strong>移动范围扩展</strong>：</p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre><span class="token comment"># 绘制可移动范围 (距离2格)</span>
<span class="token keyword">for</span> dx<span class="token punctuation">,</span> dy <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 相邻格子</span>
              <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>  <span class="token comment"># 距离2格</span></pre></div></li><li><p class="ds-markdown-paragraph"><strong>移动验证</strong>：</p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre><span class="token comment"># 检查是否在移动范围内 (曼哈顿距离 &lt;= 2 且在同一行或列)</span>
dx <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>grid_x <span class="token operator">-</span> selected_x<span class="token punctuation">)</span>
dy <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>grid_y <span class="token operator">-</span> selected_y<span class="token punctuation">)</span>

<span class="token comment"># 只能水平或垂直移动，距离1-2格</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>dx <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">or</span> dx <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">and</span> dy <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>dy <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">or</span> dy <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">and</span> dx <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    self<span class="token punctuation">.</span>move_troops<span class="token punctuation">(</span>selected_x<span class="token punctuation">,</span> selected_y<span class="token punctuation">,</span> grid_x<span class="token punctuation">,</span> grid_y<span class="token punctuation">)</span></pre></div></li></ul><h3>2. 占领敌国领土奖励一组士兵</h3><ul><li><p class="ds-markdown-paragraph"><strong>玩家占领奖励</strong>：</p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre><span class="token comment"># 额外奖励一组士兵（新功能2）</span>
new_troop <span class="token operator">=</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span>
tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_troop<span class="token punctuation">)</span>
self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_troop<span class="token punctuation">)</span></pre></div></li><li><p class="ds-markdown-paragraph"><strong>AI占领奖励</strong>：</p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre><span class="token comment"># 额外奖励一组士兵（新功能2）</span>
new_troop <span class="token operator">=</span> <span class="token punctuation">[</span>to_x<span class="token punctuation">,</span> to_y<span class="token punctuation">]</span>
to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_troop<span class="token punctuation">)</span>
country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_troop<span class="token punctuation">)</span></pre></div></li></ul><h3>3. 增强电脑AI策略性</h3><ul><li><p class="ds-markdown-paragraph"><strong>边境实力评估</strong>：</p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre><span class="token comment"># 收集所有边境格子（与敌方或空白相邻的格子）</span>
border_tiles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token keyword">and</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> country <span class="token keyword">and</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token comment"># 检查是否在边境</span>
            is_border <span class="token operator">=</span> <span class="token boolean">False</span>
            <span class="token keyword">for</span> dx<span class="token punctuation">,</span> dy <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                nx<span class="token punctuation">,</span> ny <span class="token operator">=</span> x <span class="token operator">+</span> dx<span class="token punctuation">,</span> y <span class="token operator">+</span> dy
                <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> nx <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> ny <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>ny<span class="token punctuation">]</span><span class="token punctuation">[</span>nx<span class="token punctuation">]</span> <span class="token keyword">or</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>ny<span class="token punctuation">]</span><span class="token punctuation">[</span>nx<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> country<span class="token punctuation">:</span>
                        is_border <span class="token operator">=</span> <span class="token boolean">True</span>
                        <span class="token keyword">break</span>
            
            <span class="token keyword">if</span> is_border<span class="token punctuation">:</span>
                border_tiles<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></div></li><li><p class="ds-markdown-paragraph"><strong>实力对比决策</strong>：</p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre><span class="token comment"># 如果是敌方格子，评估实力</span>
<span class="token keyword">if</span> target_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> country<span class="token punctuation">:</span>
    <span class="token comment"># 获取边境实力</span>
    my_strength <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    enemy_strength <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>target_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 新功能3：增强策略性 - 只在实力足够时进攻</span>
    <span class="token keyword">if</span> my_strength <span class="token operator">&gt;</span> enemy_strength<span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>ai_move<span class="token punctuation">(</span>country<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> tx<span class="token punctuation">,</span> ty<span class="token punctuation">)</span>
        moved <span class="token operator">=</span> <span class="token boolean">True</span>
        <span class="token keyword">break</span></pre></div></li></ul><h3>其他改进：</h3><ol start="1"><li><p class="ds-markdown-paragraph"><strong>回合计数器</strong>：</p><ul><li><p class="ds-markdown-paragraph">添加了回合计数显示在信息面板</p></li><li><p class="ds-markdown-paragraph">每次玩家移动后增加回合数</p></li></ul><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre>self<span class="token punctuation">.</span>turn_count <span class="token operator">+=</span> <span class="token number">1</span></pre></div></li><li><p class="ds-markdown-paragraph"><strong>AI移动优化</strong>：</p><ul><li><p class="ds-markdown-paragraph">优先考虑边境格子</p></li><li><p class="ds-markdown-paragraph">如果没有边境格子，使用所有有士兵的格子</p></li><li><p class="ds-markdown-paragraph">随机化移动顺序，增加不可预测性</p></li></ul></li><li><p class="ds-markdown-paragraph"><strong>游戏说明更新</strong>：</p><ul><li><p class="ds-markdown-paragraph">添加了新功能的说明</p></li><li><p class="ds-markdown-paragraph">更新了移动范围说明</p></li><li><p class="ds-markdown-paragraph">添加了占领敌国领土奖励说明</p></li></ul></li><li><p class="ds-markdown-paragraph"><strong>界面优化</strong>：</p><ul><li><p class="ds-markdown-paragraph">信息面板布局调整</p></li><li><p class="ds-markdown-paragraph">电脑国家信息分两列显示，避免溢出</p></li><li><p class="ds-markdown-paragraph">士兵组数字居中显示更美观</p></li></ul></li></ol><p class="ds-markdown-paragraph">这个版本实现了您要求的所有新功能，并增强了游戏的策略性和可玩性。电脑AI现在更加智能，只会在实力占优时发动进攻，玩家也可以使用更大的移动范围进行战略部署。</p></div><div class="ds-flex" style="margin-top: 12px; height: 20px; margin-bottom: 20px; align-items: center; gap: 10px;"><div class="ds-flex _965abe9" style="align-items: center; gap: 16px;"><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px; opacity: 1;"><svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><clippath id="clip1258_20811"><rect id="重新生成" width="20.000000" height="20.000000" fill="white" fill-opacity="0"></rect></clippath></defs><rect id="重新生成" width="20.000000" height="20.000000" fill="#FFFFFF" fill-opacity="0"></rect><g clip-path="url(#clip1258_20811)"><path id="path" d="M17.01 7.63L13.98 7.62C13.88 7.62 13.79 7.6 13.7 7.56C13.62 7.52 13.54 7.47 13.47 7.4C13.4 7.33 13.35 7.25 13.32 7.16C13.28 7.07 13.26 6.98 13.26 6.88C13.26 6.79 13.28 6.69 13.32 6.6C13.35 6.51 13.4 6.43 13.47 6.36C13.54 6.3 13.62 6.24 13.7 6.21C13.79 6.17 13.88 6.15 13.98 6.15L15.57 6.16C15.67 6.16 15.76 6.14 15.85 6.1C15.94 6.06 16.01 6.01 16.08 5.94C16.15 5.87 16.2 5.79 16.23 5.7C16.27 5.61 16.29 5.52 16.29 5.42L16.3 3.89C16.3 3.79 16.32 3.7 16.36 3.61C16.39 3.52 16.44 3.44 16.51 3.37C16.58 3.3 16.66 3.25 16.74 3.21C16.83 3.17 16.92 3.16 17.02 3.16C17.11 3.16 17.2 3.17 17.29 3.21C17.38 3.25 17.46 3.3 17.52 3.37C17.59 3.44 17.64 3.52 17.68 3.61C17.71 3.7 17.73 3.79 17.73 3.89L17.72 6.9C17.72 7 17.71 7.09 17.67 7.18C17.63 7.27 17.58 7.34 17.52 7.41C17.45 7.48 17.37 7.53 17.29 7.57C17.2 7.61 17.11 7.63 17.01 7.63Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path><path id="path" d="M2.31 16.29L2.32 13.3C2.32 13.21 2.34 13.11 2.37 13.02C2.41 12.93 2.46 12.85 2.53 12.78C2.6 12.71 2.67 12.66 2.76 12.62C2.85 12.58 2.94 12.56 3.03 12.56L6.07 12.57C6.16 12.57 6.25 12.59 6.34 12.63C6.43 12.67 6.51 12.72 6.57 12.79C6.64 12.86 6.69 12.94 6.73 13.03C6.76 13.12 6.78 13.22 6.78 13.32C6.78 13.41 6.76 13.51 6.73 13.6C6.69 13.69 6.64 13.77 6.57 13.84C6.51 13.91 6.43 13.96 6.34 14C6.25 14.04 6.16 14.06 6.07 14.06L4.47 14.05C4.38 14.05 4.29 14.07 4.2 14.11C4.11 14.15 4.03 14.2 3.97 14.27C3.9 14.34 3.85 14.42 3.81 14.51C3.78 14.6 3.76 14.7 3.76 14.8L3.75 16.29C3.75 16.39 3.73 16.48 3.69 16.58C3.65 16.67 3.6 16.75 3.54 16.82C3.47 16.89 3.39 16.94 3.3 16.98C3.22 17.01 3.13 17.03 3.03 17.03C2.94 17.03 2.85 17.02 2.76 16.98C2.67 16.94 2.59 16.89 2.52 16.82C2.46 16.75 2.4 16.67 2.37 16.58C2.33 16.49 2.31 16.39 2.31 16.29Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path><path id="path" d="M9.88 18.01C9.51 18.01 9.15 17.99 8.79 17.94C8.42 17.89 8.07 17.82 7.71 17.73C7.36 17.63 7.02 17.51 6.68 17.37C6.34 17.23 6.02 17.07 5.7 16.89C5.39 16.7 5.09 16.5 4.8 16.28C4.52 16.05 4.25 15.81 3.99 15.55C3.74 15.29 3.5 15.02 3.29 14.73C3.07 14.44 2.88 14.13 2.7 13.82L4.15 13.05C4.32 13.35 4.51 13.64 4.72 13.91C4.93 14.18 5.17 14.43 5.42 14.66C5.67 14.9 5.94 15.11 6.23 15.3C6.52 15.49 6.83 15.66 7.14 15.81C7.46 15.95 7.78 16.07 8.12 16.16C8.45 16.25 8.8 16.32 9.14 16.36C9.49 16.39 9.83 16.4 10.18 16.39C10.53 16.37 10.87 16.33 11.22 16.26C11.56 16.19 11.89 16.09 12.21 15.97C12.54 15.84 12.85 15.7 13.15 15.53C13.45 15.35 13.74 15.16 14.01 14.94C14.28 14.72 14.53 14.49 14.76 14.23C14.99 13.97 15.2 13.7 15.38 13.41C15.57 13.12 15.73 12.82 15.87 12.5C16 12.19 16.11 11.87 16.2 11.53C16.28 11.2 16.34 10.87 16.36 10.52C16.37 10.42 16.4 10.33 16.44 10.24C16.48 10.15 16.54 10.07 16.61 10C16.69 9.93 16.77 9.87 16.86 9.84C16.96 9.8 17.05 9.77 17.16 9.77C17.27 9.77 17.38 9.79 17.49 9.83C17.6 9.87 17.7 9.94 17.78 10.02C17.86 10.1 17.92 10.2 17.96 10.3C18 10.41 18.01 10.52 18 10.64C17.98 10.89 17.95 11.13 17.91 11.38C17.86 11.62 17.81 11.87 17.74 12.11C17.68 12.35 17.6 12.58 17.51 12.82C17.42 13.05 17.32 13.28 17.21 13.5C17.1 13.73 16.98 13.95 16.85 14.16C16.71 14.37 16.57 14.58 16.42 14.78C16.27 14.98 16.11 15.17 15.94 15.36C15.77 15.54 15.59 15.72 15.41 15.89C15.22 16.06 15.03 16.22 14.83 16.37C14.63 16.52 14.42 16.66 14.2 16.79C13.99 16.93 13.77 17.05 13.54 17.16C13.31 17.27 13.08 17.37 12.85 17.46C12.61 17.55 12.37 17.63 12.13 17.7C11.88 17.77 11.64 17.83 11.39 17.87C11.14 17.92 10.89 17.96 10.63 17.98C10.38 18 10.13 18.01 9.88 18.01Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path><path id="path" d="M2.85 10.27C2.73 10.28 2.62 10.26 2.51 10.22C2.4 10.17 2.31 10.11 2.23 10.03C2.14 9.95 2.08 9.85 2.04 9.74C2 9.63 1.99 9.52 2 9.41C2.03 8.98 2.1 8.56 2.2 8.15C2.3 7.73 2.43 7.33 2.6 6.94C2.76 6.54 2.96 6.16 3.19 5.8C3.41 5.44 3.67 5.1 3.95 4.77C4.24 4.45 4.54 4.15 4.88 3.88C5.21 3.6 5.56 3.35 5.93 3.13C6.3 2.91 6.69 2.73 7.09 2.57C7.5 2.41 7.91 2.28 8.33 2.19C8.75 2.09 9.18 2.03 9.62 2.01C10.05 1.98 10.48 1.99 10.91 2.03C11.35 2.07 11.77 2.14 12.19 2.25C12.61 2.36 13.02 2.5 13.42 2.67C13.81 2.84 14.19 3.04 14.56 3.28C14.92 3.51 15.27 3.77 15.59 4.05C15.91 4.34 16.21 4.64 16.48 4.98C16.75 5.31 17 5.66 17.21 6.03L15.78 6.83C15.61 6.54 15.42 6.25 15.2 5.99C14.98 5.73 14.74 5.48 14.49 5.25C14.23 5.02 13.96 4.82 13.66 4.63C13.37 4.45 13.07 4.29 12.75 4.15C12.44 4.01 12.11 3.9 11.77 3.82C11.44 3.73 11.1 3.67 10.76 3.64C10.41 3.61 10.07 3.6 9.72 3.62C9.37 3.64 9.03 3.69 8.69 3.77C8.36 3.84 8.03 3.94 7.71 4.07C7.38 4.2 7.08 4.35 6.78 4.52C6.48 4.7 6.2 4.89 5.94 5.11C5.67 5.33 5.43 5.57 5.2 5.83C4.97 6.08 4.77 6.36 4.59 6.65C4.41 6.94 4.25 7.24 4.12 7.55C3.98 7.87 3.88 8.19 3.8 8.52C3.72 8.85 3.66 9.19 3.64 9.53C3.63 9.62 3.6 9.72 3.56 9.81C3.52 9.9 3.46 9.98 3.39 10.05C3.32 10.12 3.23 10.17 3.14 10.21C3.05 10.25 2.95 10.27 2.85 10.27Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path></g></svg></div></div><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M18.14 9.428l-.003.019L17.114 15a3.774 3.774 0 0 1-1.313 2.27 3.673 3.673 0 0 1-2.438.894H3.895c-.57 0-1.055-.205-1.458-.614a2.033 2.033 0 0 1-.604-1.48v-5.438c0-.578.201-1.071.604-1.48.402-.41.888-.614 1.458-.614h1.932l2.317-5.293c.24-.548.6-.948 1.083-1.2.599-.312 1.156-.278 1.672.103.782.577 1.172 1.355 1.172 2.334V6.997h3.994c.638-.007 1.167.235 1.588.726.421.492.584 1.06.488 1.705zm-2.076-2.6c.686-.007 1.262.256 1.714.785.453.529.63 1.146.527 1.84v.004l-.005.02v.003l-1.022 5.552a3.943 3.943 0 0 1-1.37 2.368 3.838 3.838 0 0 1-2.545.933H3.895a2.137 2.137 0 0 1-1.576-.663 2.203 2.203 0 0 1-.652-1.6v-5.437c0-.622.218-1.159.652-1.6.434-.44.962-.663 1.576-.663H5.72l2.273-5.192c.254-.58.64-1.01 1.159-1.282.32-.167.64-.246.953-.227.315.02.613.137.893.344.824.608 1.24 1.437 1.24 2.47v2.345h3.827zM9.741 3.063c-.247.128-.437.344-.57.647L6.708 9.34v7.683h6.655a2.59 2.59 0 0 0 1.72-.63c.498-.42.807-.955.926-1.601l1.02-5.544a.936.936 0 0 0-.225-.773.917.917 0 0 0-.739-.335h-4.557a.567.567 0 0 1-.562-.571V4.483c0-.591-.236-1.061-.708-1.41-.143-.105-.309-.109-.497-.01zm7.124 6.157a.766.766 0 0 0-.186-.636.753.753 0 0 0-.612-.276h-4.559a.734.734 0 0 1-.728-.74V4.483c0-.537-.21-.956-.64-1.273a.233.233 0 0 0-.137-.05.387.387 0 0 0-.185.053c-.208.108-.374.291-.495.566m0 0L6.874 9.375v7.479h6.489c.609 0 1.145-.197 1.614-.592.468-.396.757-.894.869-1.502l1.02-5.54M3.35 16.623c.152.155.33.23.545.23h1.522V9.85H3.895a.732.732 0 0 0-.545.23.755.755 0 0 0-.226.553v5.437c0 .218.074.4.226.553zm.545-6.941a.897.897 0 0 0-.663.278.924.924 0 0 0-.274.673v5.437c0 .263.091.487.274.673.183.186.404.28.663.28h1.688V9.681H3.895z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M18.137 9.447l.004-.02a2.044 2.044 0 0 0-.488-1.704c-.421-.491-.95-.733-1.588-.726h-2.282l1.584 1.142h.698a.917.917 0 0 1 .739.335.936.936 0 0 1 .225.773l-1.02 5.543a2.663 2.663 0 0 1-.926 1.602 2.59 2.59 0 0 1-1.72.63H6.708V9.34L9.171 3.71c.133-.303.323-.519.57-.647.188-.099.354-.095.497.01.472.349.708.819.708 1.41v.467l1.125.811V4.483c0-.98-.39-1.757-1.171-2.334-.517-.38-1.074-.415-1.673-.103-.482.252-.843.652-1.083 1.2L5.827 8.54H3.895c-.57 0-1.056.205-1.458.614a2.033 2.033 0 0 0-.604 1.48v5.437c0 .578.201 1.072.604 1.48.403.41.889.615 1.458.615h9.468c.918 0 1.731-.299 2.438-.895A3.774 3.774 0 0 0 17.114 15l1.023-5.553zm-14.242.235a.897.897 0 0 0-.663.278.924.924 0 0 0-.274.673v5.437c0 .263.091.487.274.673.183.186.404.28.663.28h1.688V9.681H3.895z" fill="currentColor"></path><path d="M10.946 7.568c0 .316.252.571.563.571h3.858l-1.584-1.142h-1.712V5.76l-1.125-.811v2.618z" fill="currentColor"></path></svg></div></div><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M18.304 10.543v.004a2.214 2.214 0 0 1-.526 1.84c-.452.528-1.028.792-1.714.784h-3.827v2.345c0 1.034-.416 1.863-1.24 2.471-.28.207-.578.324-.893.343-.314.02-.632-.06-.953-.226-.519-.271-.905-.702-1.159-1.282l-2.273-5.193H3.895a2.136 2.136 0 0 1-1.576-.663 2.203 2.203 0 0 1-.652-1.6V3.93c0-.623.218-1.16.652-1.6.434-.441.963-.663 1.576-.663h9.468c.957 0 1.807.311 2.544.933a3.943 3.943 0 0 1 1.37 2.368L18.3 10.52v.002l.004.02zm-1.19-5.544a3.774 3.774 0 0 0-1.313-2.27 3.673 3.673 0 0 0-2.438-.894H3.895c-.57 0-1.055.205-1.458.614a2.033 2.033 0 0 0-.604 1.48v5.437c0 .578.201 1.072.604 1.48.402.41.888.615 1.458.615h1.932l2.317 5.292c.24.549.6.949 1.083 1.2.599.313 1.156.279 1.672-.102.782-.577 1.172-1.355 1.172-2.335v-2.513h3.994c.638.007 1.167-.235 1.588-.727.421-.491.584-1.06.488-1.704l-.004-.02L17.114 5zM9.819 16.787c.076.04.137.053.185.052a.233.233 0 0 0 .137-.05c.43-.316.64-.735.64-1.273v-3.084c0-.41.327-.74.729-.74h4.558a.752.752 0 0 0 .612-.277.766.766 0 0 0 .186-.635l-1.02-5.54a2.495 2.495 0 0 0-.869-1.502 2.426 2.426 0 0 0-1.613-.592H6.874v7.48l2.449 5.595m-2.615-5.56V2.978h6.655c.648 0 1.221.21 1.72.63.498.42.807.954.926 1.601l1.02 5.543a.936.936 0 0 1-.225.774.917.917 0 0 1-.739.335h-4.557a.567.567 0 0 0-.562.57v3.085c0 .592-.236 1.062-.708 1.41-.143.106-.309.11-.497.01-.247-.128-.437-.343-.57-.647l-2.463-5.628zM3.35 3.376a.754.754 0 0 0-.226.554v5.436c0 .218.074.4.226.554.152.154.33.23.545.23h1.522V3.146H3.895a.731.731 0 0 0-.545.23zm2.233-.398v7.34H3.895a.897.897 0 0 1-.663-.279.925.925 0 0 1-.274-.673V3.93c0-.263.091-.487.274-.673a.895.895 0 0 1 .663-.28h1.688zm4.235 13.809c-.208-.108-.375-.292-.495-.566l.495.566z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M15.801 2.73a3.774 3.774 0 0 1 1.313 2.269l1.023 5.554.004.019a2.044 2.044 0 0 1-.488 1.704c-.421.492-.95.734-1.588.727h-3.994v2.513c0 .98-.39 1.758-1.171 2.335-.517.38-1.074.415-1.673.102-.482-.251-.843-.651-1.083-1.2l-2.317-5.292H3.895c-.57 0-1.056-.205-1.458-.614a2.033 2.033 0 0 1-.604-1.48V3.93c0-.579.201-1.072.604-1.481.403-.41.889-.614 1.458-.614h9.468c.918 0 1.731.298 2.438.894zm-2.438.248c.648 0 1.221.21 1.72.63.498.42.807.954.926 1.601l1.02 5.543a.936.936 0 0 1-.225.774.917.917 0 0 1-.739.335h-4.557a.567.567 0 0 0-.562.57v3.085c0 .592-.236 1.062-.708 1.41-.143.106-.309.11-.497.01-.247-.128-.437-.343-.57-.647l-2.463-5.628V2.978h6.655zm-9.468 7.34a.897.897 0 0 1-.663-.279.925.925 0 0 1-.274-.673V3.93c0-.263.091-.487.274-.673a.895.895 0 0 1 .663-.28h1.688v7.341H3.895z" fill="currentColor"></path></svg></div></div></div><div style="flex: 1 1 0%;"></div></div></div><div class="_9663006"><div class="fbb737a4">我在游玩过程中突然出现以下报错：
Traceback (most recent call last):
  File "d:\Desktop\code\python\war.py", line 605, in &lt;module&gt;
    game.run()
    ~~~~~~~~^^
    self.draw_grid()
    ~~~~~~~~~~~~~~^^
  File "d:\Desktop\code\python\war.py", line 164, in draw_grid
    pygame.draw.rect(self.screen, country.color, rect)
                                  ^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'color'
请你尝试解决该问题</div><div class="e13328ad _3a26104"><div class="_425ea0b"><div class="ds-flex _78e0558" style="align-items: flex-end; gap: 0px;"><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px; margin-left: 14px; opacity: 1;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.712 2.79a1.854 1.854 0 0 1 2.623 0l1.673 1.672a1.854 1.854 0 0 1 0 2.623l-9.714 9.714a2.91 2.91 0 0 1-2.058.853H1.945a.8.8 0 0 1-.8-.8v-2.29c0-.773.307-1.513.853-2.058l9.714-9.715zm1.492 1.13c-.1-.1-.261-.1-.361 0l-1.327 1.326 2.035 2.035 1.327-1.326c.1-.1.1-.262 0-.362L13.204 3.92zm-.783 4.491l-2.035-2.034-7.258 7.257a1.31 1.31 0 0 0-.384.927v1.492h1.492c.348 0 .681-.138.927-.384l7.258-7.258z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M17.772 17.608c.35 0 .633-.283.633-.633v-.492a.633.633 0 0 0-.633-.633H9.858L8.1 17.608h9.672z" fill="currentColor"></path></svg></div></div></div></div></div></div><div class="_4f9bf79 _43c05b5"><div class="_7eb2358 _58dfa60"><svg viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path id="path" d="M27.501 8.46875C27.249 8.3457 27.1406 8.58008 26.9932 8.69922C26.9434 8.73828 26.9004 8.78906 26.8584 8.83398C26.4902 9.22852 26.0605 9.48633 25.5 9.45508C24.6787 9.41016 23.9785 9.66797 23.3594 10.2969C23.2275 9.52148 22.79 9.05859 22.125 8.76172C21.7764 8.60742 21.4238 8.45312 21.1807 8.11719C21.0098 7.87891 20.9639 7.61328 20.8779 7.35156C20.8242 7.19336 20.7695 7.03125 20.5879 7.00391C20.3906 6.97266 20.3135 7.13867 20.2363 7.27734C19.9258 7.84375 19.8066 8.46875 19.8174 9.10156C19.8447 10.5234 20.4453 11.6562 21.6367 12.4629C21.7725 12.5547 21.8076 12.6484 21.7646 12.7832C21.6836 13.0605 21.5869 13.3301 21.501 13.6074C21.4473 13.7852 21.3662 13.8242 21.1768 13.7461C20.5225 13.4727 19.957 13.0684 19.458 12.5781C18.6104 11.7578 17.8438 10.8516 16.8877 10.1426C16.6631 9.97656 16.4395 9.82227 16.207 9.67578C15.2314 8.72656 16.335 7.94727 16.5898 7.85547C16.8574 7.75977 16.6826 7.42773 15.8193 7.43164C14.957 7.43555 14.167 7.72461 13.1611 8.10938C13.0137 8.16797 12.8594 8.21094 12.7002 8.24414C11.7871 8.07227 10.8389 8.0332 9.84766 8.14453C7.98242 8.35352 6.49219 9.23633 5.39648 10.7441C4.08105 12.5547 3.77148 14.6133 4.15039 16.7617C4.54883 19.0234 5.70215 20.8984 7.47559 22.3633C9.31348 23.8809 11.4307 24.625 13.8457 24.4824C15.3125 24.3984 16.9463 24.2012 18.7881 22.6406C19.2529 22.8711 19.7402 22.9629 20.5498 23.0332C21.1729 23.0918 21.7725 23.002 22.2373 22.9062C22.9648 22.752 22.9141 22.0781 22.6514 21.9531C20.5186 20.959 20.9863 21.3633 20.5605 21.0371C21.6445 19.752 23.2783 18.418 23.917 14.0977C23.9668 13.7539 23.9238 13.5391 23.917 13.2598C23.9131 13.0918 23.9512 13.0254 24.1445 13.0059C24.6787 12.9453 25.1973 12.7988 25.6738 12.5352C27.0557 11.7793 27.6123 10.5391 27.7441 9.05078C27.7637 8.82422 27.7402 8.58789 27.501 8.46875ZM15.46 21.8613C13.3926 20.2344 12.3906 19.6992 11.9766 19.7227C11.5898 19.7441 11.6592 20.1875 11.7441 20.4766C11.833 20.7617 11.9492 20.959 12.1123 21.209C12.2246 21.375 12.3018 21.623 12 21.8066C11.334 22.2207 10.1768 21.668 10.1221 21.6406C8.77539 20.8477 7.64941 19.7988 6.85547 18.3652C6.08984 16.9844 5.64453 15.5039 5.57129 13.9238C5.55176 13.541 5.66406 13.4062 6.04297 13.3379C6.54199 13.2461 7.05762 13.2266 7.55664 13.2988C9.66602 13.6074 11.4619 14.5527 12.9668 16.0469C13.8262 16.9004 14.4766 17.918 15.1465 18.9121C15.8584 19.9688 16.625 20.9746 17.6006 21.7988C17.9443 22.0879 18.2197 22.3086 18.4824 22.4707C17.6895 22.5586 16.3652 22.5781 15.46 21.8613ZM16.4502 15.4805C16.4502 15.3105 16.5859 15.1758 16.7568 15.1758C16.7949 15.1758 16.8301 15.1836 16.8613 15.1953C16.9033 15.2109 16.9424 15.2344 16.9727 15.2695C17.0273 15.3223 17.0586 15.4004 17.0586 15.4805C17.0586 15.6504 16.9229 15.7852 16.7529 15.7852C16.582 15.7852 16.4502 15.6504 16.4502 15.4805ZM19.5273 17.0625C19.3301 17.1426 19.1328 17.2129 18.9434 17.2207C18.6494 17.2344 18.3281 17.1152 18.1533 16.9688C17.8828 16.7422 17.6895 16.6152 17.6074 16.2168C17.5732 16.0469 17.5928 15.7852 17.623 15.6348C17.6934 15.3105 17.6152 15.1035 17.3877 14.9141C17.2012 14.7598 16.9658 14.7188 16.7061 14.7188C16.6094 14.7188 16.5205 14.6758 16.4541 14.6406C16.3457 14.5859 16.2568 14.4512 16.3418 14.2852C16.3691 14.2324 16.501 14.1016 16.5322 14.0781C16.8838 13.877 17.29 13.9434 17.666 14.0938C18.0146 14.2363 18.2773 14.498 18.6562 14.8672C19.0439 15.3145 19.1133 15.4395 19.334 15.7734C19.5078 16.0371 19.667 16.3066 19.7754 16.6152C19.8408 16.8066 19.7559 16.9648 19.5273 17.0625Z" fill-rule="nonzero" fill="#4D6BFE"></path></svg></div><div class="_48edb25"><div class="_58a6d71 _19db599"><div class="ds-icon _7580acb" style="font-size: 12px; width: 12px; height: 12px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2.656 17.344c-1.016-1.015-1.15-2.75-.313-4.925.325-.825.73-1.617 1.205-2.365L3.582 10l-.033-.054c-.5-.799-.91-1.596-1.206-2.365-.836-2.175-.703-3.91.313-4.926.56-.56 1.364-.86 2.335-.86 1.425 0 3.168.636 4.957 1.756l.053.034.053-.034c1.79-1.12 3.532-1.757 4.957-1.757.972 0 1.776.3 2.335.86 1.014 1.015 1.148 2.752.312 4.926a13.892 13.892 0 0 1-1.206 2.365l-.034.054.034.053c.5.8.91 1.596 1.205 2.365.837 2.175.704 3.911-.311 4.926-.56.56-1.364.861-2.335.861-1.425 0-3.168-.637-4.957-1.757L10 16.415l-.053.033c-1.79 1.12-3.532 1.757-4.957 1.757-.972 0-1.776-.3-2.335-.86zm13.631-4.399c-.187-.488-.429-.988-.71-1.492l-.075-.132-.092.12a22.075 22.075 0 0 1-3.968 3.968l-.12.093.132.074c1.308.734 2.559 1.162 3.556 1.162.563 0 1.006-.138 1.298-.43.3-.3.436-.774.428-1.346-.008-.575-.159-1.264-.449-2.017zm-6.345 1.65l.058.042.058-.042a19.881 19.881 0 0 0 4.551-4.537l.043-.058-.043-.058a20.123 20.123 0 0 0-2.093-2.458 19.732 19.732 0 0 0-2.458-2.08L10 5.364l-.058.042A19.883 19.883 0 0 0 5.39 9.942L5.348 10l.042.059c.631.874 1.332 1.695 2.094 2.457a19.74 19.74 0 0 0 2.458 2.08zm6.366-10.902c-.293-.293-.736-.431-1.298-.431-.998 0-2.248.429-3.556 1.163l-.132.074.12.092a21.938 21.938 0 0 1 3.968 3.968l.092.12.074-.132c.282-.504.524-1.004.711-1.492.29-.753.442-1.442.45-2.017.007-.572-.129-1.045-.429-1.345zM3.712 7.055c.202.514.44 1.013.712 1.493l.074.13.092-.119a21.94 21.94 0 0 1 3.968-3.968l.12-.092-.132-.074C7.238 3.69 5.987 3.262 4.99 3.262c-.563 0-1.006.138-1.298.43-.3.301-.436.774-.428 1.346.007.575.159 1.264.448 2.017zm0 5.89c-.29.753-.44 1.442-.448 2.017-.008.572.127 1.045.428 1.345.293.293.736.431 1.298.431.997 0 2.247-.428 3.556-1.162l.131-.074-.12-.093a21.94 21.94 0 0 1-3.967-3.968l-.093-.12-.074.132a11.712 11.712 0 0 0-.71 1.492z" fill="currentColor" stroke="currentColor" stroke-width=".1"></path><path d="M10.706 11.704A1.843 1.843 0 0 1 8.155 10a1.845 1.845 0 1 1 2.551 1.704z" fill="currentColor" stroke="currentColor" stroke-width=".2"></path></svg></div>已深度思考（用时 18 秒）<div class="ds-icon _54f4262" style="font-size: 10px; width: 10px; height: 10px; transform: rotate(180deg);"><svg width="10" height="6" viewBox="0 0 10 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5.786 4.167L2.765 1.259c-.416-.4-.985-.482-1.273-.183-.287.298-.183.864.233 1.264l3.021 2.908c.416.4.986.482 1.273.184.287-.299.183-.865-.233-1.265z" fill="currentColor"></path><path d="M8.197 1.206L5.288 4.208c-.4.413-.484.982-.187 1.27.298.289.864.187 1.265-.227L9.274 2.25c.401-.414.485-.983.187-1.271-.297-.288-.863-.187-1.264.227z" fill="currentColor"></path></svg></div></div><div class="e1675d8b"><div class="_9ecc93a"></div>这个错误表明在绘制网格时，某个格子的country属性为None，但在绘制时尝试访问其color属性。<div style="height: 6px;"></div> 我们需要确保在访问country.color之前，country不为None。<div style="height: 6px;"></div><div style="height: 6px;"></div> 出现这种情况的原因可能是某个格子被设置为中立（country为None），但在绘制时没有正确处理。<div style="height: 6px;"></div><div style="height: 6px;"></div> 解决方案：<div style="height: 6px;"></div> 在绘制每个格子时，先检查格子数据是否存在（非None）以及格子中的country是否存在。<div style="height: 6px;"></div><div style="height: 6px;"></div> 具体修改draw_grid方法中绘制领土的部分：<div style="height: 6px;"></div><div style="height: 6px;"></div> 原代码：<div style="height: 6px;"></div>   if self.grid[y][x]:<div style="height: 6px;"></div>        country = self.grid[y][x]['country']<div style="height: 6px;"></div>        ... # 直接使用country.color<div style="height: 6px;"></div><div style="height: 6px;"></div> 修改为：<div style="height: 6px;"></div>   tile = self.grid[y][x]<div style="height: 6px;"></div>   if tile and tile['country'] is not None:<div style="height: 6px;"></div>        ... # 绘制该国家的颜色<div style="height: 6px;"></div>   else:<div style="height: 6px;"></div>        # 如果是中立格子，可以绘制为默认背景或者特殊颜色<div style="height: 6px;"></div>        ... <div style="height: 6px;"></div><div style="height: 6px;"></div> 但注意，我们的游戏逻辑中，中立格子（无主之地）在grid中存储为None吗？还是存储为字典但country为None？<div style="height: 6px;"></div><div style="height: 6px;"></div> 回顾代码，在战斗过程中，当防御方士兵全部被消灭时，我们会将格子的country设为None，但格子本身不为None。<div style="height: 6px;"></div> 例如：<div style="height: 6px;"></div>     tile['country'] = None<div style="height: 6px;"></div><div style="height: 6px;"></div> 所以，我们应该检查tile['country']是否为None。<div style="height: 6px;"></div><div style="height: 6px;"></div> 因此，修改绘制领土的代码：<div style="height: 6px;"></div><div style="height: 6px;"></div> 另外，我们还需要考虑格子为None的情况（比如未被占领的格子？）但根据我们的初始化，未被占领的格子是None吗？<div style="height: 6px;"></div> 在初始化时，未被占领的格子是None。在游戏过程中，当占领一个格子时，我们将其设置为一个字典；当格子变为中立时，我们将其字典中的country设置为None，但格子本身（字典）仍然存在。<div style="height: 6px;"></div><div style="height: 6px;"></div> 所以，我们需要处理两种情况：<div style="height: 6px;"></div>   1. 格子为None（未被占领）：不绘制颜色（使用背景色）<div style="height: 6px;"></div>   2. 格子不为None，但country为None（中立）：可以绘制为灰色<div style="height: 6px;"></div><div style="height: 6px;"></div> 让我们修改代码，同时处理这两种情况。<div style="height: 6px;"></div><div style="height: 6px;"></div> 修改后的draw_grid部分：</div></div><div class="ds-markdown ds-markdown--block" style="--ds-md-zoom: 1.143;"><p class="ds-markdown-paragraph">这个错误表明在绘制网格时，某个格子的 <code>country</code> 属性为 <code>None</code>，但代码尝试访问其 <code>color</code> 属性。这通常发生在某个格子的国家被击败后，但网格数据没有正确更新。让我修复这个问题并提供完整的解决方案：</p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre><span class="token keyword">import</span> pygame
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> random
<span class="token keyword">import</span> math
<span class="token keyword">from</span> pygame<span class="token punctuation">.</span><span class="token builtin">locals</span> <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token comment"># 初始化pygame</span>
pygame<span class="token punctuation">.</span>init<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 游戏常量</span>
SCREEN_WIDTH <span class="token operator">=</span> <span class="token number">1000</span>
SCREEN_HEIGHT <span class="token operator">=</span> <span class="token number">700</span>
GRID_SIZE <span class="token operator">=</span> <span class="token number">20</span>
GRID_WIDTH <span class="token operator">=</span> <span class="token number">40</span>
GRID_HEIGHT <span class="token operator">=</span> <span class="token number">30</span>
TILE_SIZE <span class="token operator">=</span> <span class="token number">20</span>

<span class="token comment"># 尝试加载中文字体</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token comment"># 尝试常见的中文字体</span>
    FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token string">"SimHei"</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
    LARGE_FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token string">"SimHei"</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>
    SMALL_FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token string">"SimHei"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>
<span class="token keyword">except</span><span class="token punctuation">:</span>
    <span class="token comment"># 回退到默认字体</span>
    FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
    LARGE_FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>
    SMALL_FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>

<span class="token comment"># 颜色</span>
BACKGROUND <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
GRID_COLOR <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
WHITE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
BLACK <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
RED <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
GREEN <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
BLUE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
YELLOW <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
PURPLE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
CYAN <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
ORANGE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">165</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
PINK <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span>
COLORS <span class="token operator">=</span> <span class="token punctuation">[</span>RED<span class="token punctuation">,</span> BLUE<span class="token punctuation">,</span> YELLOW<span class="token punctuation">,</span> PURPLE<span class="token punctuation">,</span> CYAN<span class="token punctuation">,</span> ORANGE<span class="token punctuation">,</span> PINK<span class="token punctuation">]</span>  <span class="token comment"># 增加更多颜色</span>
HIGHLIGHT <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
NEUTRAL_COLOR <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>  <span class="token comment"># 中立领土颜色</span>

<span class="token keyword">class</span> <span class="token class-name">Country</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> color<span class="token punctuation">,</span> name<span class="token punctuation">,</span> is_player<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>color <span class="token operator">=</span> color
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>is_player <span class="token operator">=</span> is_player
        self<span class="token punctuation">.</span>territory <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># 存储士兵组的位置坐标</span>
        self<span class="token punctuation">.</span>next_reward <span class="token operator">=</span> <span class="token number">3</span>
        self<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">add_territory</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> game<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""增加领土并检查是否应生成新士兵组"""</span>
        <span class="token comment"># 每占领3块领土获得一个新的士兵组</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>territory <span class="token operator">&gt;=</span> self<span class="token punctuation">.</span>next_reward<span class="token punctuation">:</span>
            <span class="token comment"># 更新奖励阈值</span>
            self<span class="token punctuation">.</span>next_reward <span class="token operator">+=</span> <span class="token number">3</span>
            
            <span class="token comment"># 在随机领土上生成新士兵组</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                <span class="token comment"># 收集所有安全的领土位置（仅限己方领土且无士兵重叠）</span>
                safe_positions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">if</span> game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token keyword">and</span> game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> self<span class="token punctuation">:</span>
                            <span class="token comment"># 确保不在他国领土上</span>
                            is_safe <span class="token operator">=</span> <span class="token boolean">True</span>
                            <span class="token keyword">for</span> dx<span class="token punctuation">,</span> dy <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                                nx<span class="token punctuation">,</span> ny <span class="token operator">=</span> x <span class="token operator">+</span> dx<span class="token punctuation">,</span> y <span class="token operator">+</span> dy
                                <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> nx <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> ny <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">:</span>
                                    <span class="token keyword">if</span> game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>ny<span class="token punctuation">]</span><span class="token punctuation">[</span>nx<span class="token punctuation">]</span> <span class="token keyword">and</span> game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>ny<span class="token punctuation">]</span><span class="token punctuation">[</span>nx<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> self<span class="token punctuation">:</span>
                                        is_safe <span class="token operator">=</span> <span class="token boolean">False</span>
                                        <span class="token keyword">break</span>
                            
                            <span class="token keyword">if</span> is_safe<span class="token punctuation">:</span>
                                safe_positions<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
                
                <span class="token keyword">if</span> safe_positions<span class="token punctuation">:</span>
                    <span class="token comment"># 随机选择一个安全位置</span>
                    x<span class="token punctuation">,</span> y <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>safe_positions<span class="token punctuation">)</span>
                    
                    <span class="token comment"># 创建新士兵组</span>
                    new_troop <span class="token operator">=</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span>
                    
                    <span class="token comment"># 添加到国家士兵列表</span>
                    self<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_troop<span class="token punctuation">)</span>
                    
                    <span class="token comment"># 添加到网格</span>
                    game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_troop<span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

<span class="token keyword">class</span> <span class="token class-name">Game</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>screen <span class="token operator">=</span> pygame<span class="token punctuation">.</span>display<span class="token punctuation">.</span>set_mode<span class="token punctuation">(</span><span class="token punctuation">(</span>SCREEN_WIDTH<span class="token punctuation">,</span> SCREEN_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">)</span>
        pygame<span class="token punctuation">.</span>display<span class="token punctuation">.</span>set_caption<span class="token punctuation">(</span><span class="token string">"领土征服者"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>clock <span class="token operator">=</span> pygame<span class="token punctuation">.</span>time<span class="token punctuation">.</span>Clock<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 创建国家</span>
        self<span class="token punctuation">.</span>countries <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>player_country <span class="token operator">=</span> Country<span class="token punctuation">(</span>GREEN<span class="token punctuation">,</span> <span class="token string">"玩家"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>countries<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>player_country<span class="token punctuation">)</span>
        
        <span class="token comment"># 创建电脑国家 (使用不同颜色)</span>
        ai_names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"红国"</span><span class="token punctuation">,</span> <span class="token string">"蓝国"</span><span class="token punctuation">,</span> <span class="token string">"黄国"</span><span class="token punctuation">,</span> <span class="token string">"紫国"</span><span class="token punctuation">,</span> <span class="token string">"青国"</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 创建5个电脑国家</span>
            color_idx <span class="token operator">=</span> i <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>COLORS<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>countries<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Country<span class="token punctuation">(</span>COLORS<span class="token punctuation">[</span>color_idx<span class="token punctuation">]</span><span class="token punctuation">,</span> ai_names<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 初始化网格</span>
        self<span class="token punctuation">.</span>grid <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token boolean">None</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>selected_tile <span class="token operator">=</span> <span class="token boolean">None</span>  <span class="token comment"># 改为选择整个方格</span>
        self<span class="token punctuation">.</span>game_over <span class="token operator">=</span> <span class="token boolean">False</span>
        self<span class="token punctuation">.</span>winner <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>turn_count <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 回合计数器</span>
        
        <span class="token comment"># 初始化领土和士兵</span>
        self<span class="token punctuation">.</span>initialize_game<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">initialize_game</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 为每个国家分配初始领土</span>
        positions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>countries<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
                x <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> GRID_WIDTH <span class="token operator">-</span> <span class="token number">6</span><span class="token punctuation">)</span>
                y <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">-</span> <span class="token number">6</span><span class="token punctuation">)</span>
                <span class="token comment"># 确保初始位置不重叠且有一定间距</span>
                too_close <span class="token operator">=</span> <span class="token boolean">False</span>
                <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> positions<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>px <span class="token operator">-</span> x<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">8</span> <span class="token keyword">and</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>py <span class="token operator">-</span> y<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">:</span>
                        too_close <span class="token operator">=</span> <span class="token boolean">True</span>
                        <span class="token keyword">break</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> too_close <span class="token keyword">and</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">not</span> <span class="token keyword">in</span> positions<span class="token punctuation">:</span>
                    positions<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
                        <span class="token string">'country'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>countries<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token string">'troops'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">]</span>  <span class="token comment"># 初始士兵组</span>
                    <span class="token punctuation">}</span>
                    self<span class="token punctuation">.</span>countries<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>territory <span class="token operator">=</span> <span class="token number">1</span>
                    self<span class="token punctuation">.</span>countries<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">]</span>
                    self<span class="token punctuation">.</span>countries<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>next_reward <span class="token operator">=</span> <span class="token number">3</span>
                    <span class="token keyword">break</span>
    
    <span class="token keyword">def</span> <span class="token function">draw_grid</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 绘制网格背景</span>
        self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>fill<span class="token punctuation">(</span>BACKGROUND<span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制网格线</span>
        <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> SCREEN_WIDTH<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">:</span>
            pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>line<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> GRID_COLOR<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">:</span>
            pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>line<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> GRID_COLOR<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>SCREEN_WIDTH<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制领土和士兵</span>
        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span>
                <span class="token keyword">if</span> tile<span class="token punctuation">:</span>
                    <span class="token comment"># 确保国家对象存在</span>
                    <span class="token keyword">if</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                        rect <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Rect<span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span>
                        pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>color<span class="token punctuation">,</span> rect<span class="token punctuation">)</span>
                        
                        <span class="token comment"># 绘制士兵组</span>
                        troop_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                        <span class="token keyword">if</span> troop_count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                            pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> WHITE<span class="token punctuation">,</span> 
                                            <span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                            TILE_SIZE<span class="token operator">//</span><span class="token number">3</span><span class="token punctuation">)</span>
                            text <span class="token operator">=</span> FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>troop_count<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span>
                            text_rect <span class="token operator">=</span> text<span class="token punctuation">.</span>get_rect<span class="token punctuation">(</span>center<span class="token operator">=</span><span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>text<span class="token punctuation">,</span> text_rect<span class="token punctuation">)</span>
                    <span class="token keyword">else</span><span class="token punctuation">:</span>
                        <span class="token comment"># 绘制中立领土</span>
                        rect <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Rect<span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span>
                        pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> NEUTRAL_COLOR<span class="token punctuation">,</span> rect<span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制选中的方格</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>selected_tile<span class="token punctuation">:</span>
            x<span class="token punctuation">,</span> y <span class="token operator">=</span> self<span class="token punctuation">.</span>selected_tile
            rect <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Rect<span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span>
            pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> HIGHLIGHT<span class="token punctuation">,</span> rect<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 绘制可移动范围 (距离2格)</span>
            <span class="token keyword">for</span> dx<span class="token punctuation">,</span> dy <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 相邻格子</span>
                          <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>  <span class="token comment"># 距离2格</span>
                nx<span class="token punctuation">,</span> ny <span class="token operator">=</span> x <span class="token operator">+</span> dx<span class="token punctuation">,</span> y <span class="token operator">+</span> dy
                <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> nx <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> ny <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">:</span>
                    rect <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Rect<span class="token punctuation">(</span>nx <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> ny <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span>
                    pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rect<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制信息面板</span>
        info_panel_y <span class="token operator">=</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE
        info_panel_height <span class="token operator">=</span> SCREEN_HEIGHT <span class="token operator">-</span> info_panel_y
        pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> info_panel_y<span class="token punctuation">,</span> SCREEN_WIDTH<span class="token punctuation">,</span> info_panel_height<span class="token punctuation">)</span><span class="token punctuation">)</span>
        pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>line<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> WHITE<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> info_panel_y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>SCREEN_WIDTH<span class="token punctuation">,</span> info_panel_y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制玩家信息</span>
        player_text <span class="token operator">=</span> LARGE_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"玩家领土: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>territory<span class="token punctuation">}</span></span><span class="token string">  下一奖励: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>next_reward<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> GREEN<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>player_text<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> info_panel_y <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制游戏说明</span>
        instructions <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string">"游戏说明:"</span><span class="token punctuation">,</span>
            <span class="token string">"1. 点击自己的领土选择士兵"</span><span class="token punctuation">,</span>
            <span class="token string">"2. 点击相邻格子移动所有士兵 (可移动1-2格)"</span><span class="token punctuation">,</span>
            <span class="token string">"3. 每占领3块领土获得一个新士兵组"</span><span class="token punctuation">,</span>
            <span class="token string">"4. 每占领敌国领土额外获得一组士兵"</span><span class="token punctuation">,</span>
            <span class="token string">"5. 目标: 消灭所有其他国家"</span>
        <span class="token punctuation">]</span>
        
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> text <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>instructions<span class="token punctuation">)</span><span class="token punctuation">:</span>
            rendered <span class="token operator">=</span> SMALL_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> WHITE<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>rendered<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> info_panel_y <span class="token operator">+</span> <span class="token number">60</span> <span class="token operator">+</span> i <span class="token operator">*</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制电脑国家信息 (分两列显示)</span>
        ai_info <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> country <span class="token keyword">in</span> self<span class="token punctuation">.</span>countries<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> country<span class="token punctuation">.</span>is_player <span class="token keyword">and</span> <span class="token keyword">not</span> country<span class="token punctuation">.</span>defeated<span class="token punctuation">:</span>
                ai_info<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>country<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>country<span class="token punctuation">.</span>territory<span class="token punctuation">}</span></span><span class="token string">领土"</span></span><span class="token punctuation">)</span>
        
        <span class="token comment"># 第一列</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>ai_info<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            ai_text1 <span class="token operator">=</span> SMALL_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">"电脑国家: "</span> <span class="token operator">+</span> <span class="token string">", "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>ai_info<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> YELLOW<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>ai_text1<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> info_panel_y <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 第二列</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>ai_info<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">:</span>
            ai_text2 <span class="token operator">=</span> SMALL_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>ai_info<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> YELLOW<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>ai_text2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> info_panel_y <span class="token operator">+</span> <span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 回合计数</span>
        turn_text <span class="token operator">=</span> SMALL_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"回合: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>turn_count<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> CYAN<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>turn_text<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> info_panel_y <span class="token operator">+</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制游戏结束信息</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>game_over<span class="token punctuation">:</span>
            overlay <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Surface<span class="token punctuation">(</span><span class="token punctuation">(</span>SCREEN_WIDTH<span class="token punctuation">,</span> SCREEN_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">,</span> pygame<span class="token punctuation">.</span>SRCALPHA<span class="token punctuation">)</span>
            overlay<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>overlay<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>winner<span class="token punctuation">.</span>is_player<span class="token punctuation">:</span>
                text <span class="token operator">=</span> LARGE_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">"恭喜！你赢得了战争！"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> GREEN<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                text <span class="token operator">=</span> LARGE_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>winner<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">赢得了战争！"</span></span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>winner<span class="token punctuation">.</span>color<span class="token punctuation">)</span>
            
            restart <span class="token operator">=</span> FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">"按R键重新开始游戏"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> WHITE<span class="token punctuation">)</span>
            
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token punctuation">(</span>SCREEN_WIDTH<span class="token operator">//</span><span class="token number">2</span> <span class="token operator">-</span> text<span class="token punctuation">.</span>get_width<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> SCREEN_HEIGHT<span class="token operator">//</span><span class="token number">2</span> <span class="token operator">-</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>restart<span class="token punctuation">,</span> <span class="token punctuation">(</span>SCREEN_WIDTH<span class="token operator">//</span><span class="token number">2</span> <span class="token operator">-</span> restart<span class="token punctuation">.</span>get_width<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> SCREEN_HEIGHT<span class="token operator">//</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">handle_click</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>game_over<span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        grid_x <span class="token operator">=</span> pos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">//</span> TILE_SIZE
        grid_y <span class="token operator">=</span> pos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">//</span> TILE_SIZE
        
        <span class="token comment"># 确保点击在网格范围内</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;=</span> grid_x <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> grid_y <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        <span class="token comment"># 选择整个方格</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>selected_tile <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>grid_y<span class="token punctuation">]</span><span class="token punctuation">[</span>grid_x<span class="token punctuation">]</span>
            <span class="token keyword">if</span> tile <span class="token keyword">and</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">:</span>
                <span class="token comment"># 检查该位置是否有玩家士兵组</span>
                <span class="token keyword">if</span> tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>selected_tile <span class="token operator">=</span> <span class="token punctuation">(</span>grid_x<span class="token punctuation">,</span> grid_y<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># 移动士兵组</span>
            selected_x<span class="token punctuation">,</span> selected_y <span class="token operator">=</span> self<span class="token punctuation">.</span>selected_tile
            
            <span class="token comment"># 检查是否在移动范围内 (曼哈顿距离 &lt;= 2 且在同一行或列)</span>
            dx <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>grid_x <span class="token operator">-</span> selected_x<span class="token punctuation">)</span>
            dy <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>grid_y <span class="token operator">-</span> selected_y<span class="token punctuation">)</span>
            
            <span class="token comment"># 只能水平或垂直移动，距离1-2格</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>dx <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">or</span> dx <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">and</span> dy <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>dy <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">or</span> dy <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">and</span> dx <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>move_troops<span class="token punctuation">(</span>selected_x<span class="token punctuation">,</span> selected_y<span class="token punctuation">,</span> grid_x<span class="token punctuation">,</span> grid_y<span class="token punctuation">)</span>
            
            self<span class="token punctuation">.</span>selected_tile <span class="token operator">=</span> <span class="token boolean">None</span>
    
    <span class="token keyword">def</span> <span class="token function">move_troops</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> from_x<span class="token punctuation">,</span> from_y<span class="token punctuation">,</span> to_x<span class="token punctuation">,</span> to_y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 获取原方格信息</span>
        from_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>from_y<span class="token punctuation">]</span><span class="token punctuation">[</span>from_x<span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> from_tile <span class="token keyword">or</span> <span class="token keyword">not</span> from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        <span class="token comment"># 获取要移动的所有士兵组</span>
        moving_troops <span class="token operator">=</span> from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>  <span class="token comment"># 复制列表</span>
        
        <span class="token comment"># 从原位置移除所有士兵组</span>
        from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> troop <span class="token keyword">in</span> moving_troops<span class="token punctuation">:</span>
            <span class="token keyword">if</span> troop <span class="token keyword">in</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop<span class="token punctuation">)</span>
        
        <span class="token comment"># 更新士兵组位置</span>
        <span class="token keyword">for</span> troop <span class="token keyword">in</span> moving_troops<span class="token punctuation">:</span>
            troop<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_x
            troop<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_y
        
        <span class="token comment"># 添加到新位置</span>
        to_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>to_y<span class="token punctuation">]</span><span class="token punctuation">[</span>to_x<span class="token punctuation">]</span>
        
        <span class="token keyword">if</span> <span class="token keyword">not</span> to_tile<span class="token punctuation">:</span>
            <span class="token comment"># 占领新领土</span>
            self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>to_y<span class="token punctuation">]</span><span class="token punctuation">[</span>to_x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'country'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">,</span>
                <span class="token string">'troops'</span><span class="token punctuation">:</span> moving_troops
            <span class="token punctuation">}</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>territory <span class="token operator">+=</span> <span class="token number">1</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
            <span class="token comment"># 检查是否应获得新士兵组</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">:</span>
                <span class="token comment"># 合并到友方领土</span>
                to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>extend<span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># 与敌方发生战斗</span>
                self<span class="token punctuation">.</span>resolve_battle<span class="token punctuation">(</span>to_x<span class="token punctuation">,</span> to_y<span class="token punctuation">,</span> moving_troops<span class="token punctuation">)</span>
        
        <span class="token comment"># 电脑回合</span>
        self<span class="token punctuation">.</span>ai_turn<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>turn_count <span class="token operator">+=</span> <span class="token number">1</span>
        
        <span class="token comment"># 检查游戏是否结束</span>
        self<span class="token punctuation">.</span>check_game_over<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">resolve_battle</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> attacking_troops<span class="token punctuation">)</span><span class="token punctuation">:</span>
        tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span>
        defending_country <span class="token operator">=</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span>
        defending_troops <span class="token operator">=</span> tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
        attacking_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>attacking_troops<span class="token punctuation">)</span>
        defending_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>defending_troops<span class="token punctuation">)</span>
        
        <span class="token comment"># 计算战斗结果</span>
        difference <span class="token operator">=</span> attacking_count <span class="token operator">-</span> defending_count
        
        <span class="token keyword">if</span> difference <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token comment"># 攻击方胜利</span>
            tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>player_country
            <span class="token comment"># 只保留差值数量的士兵组</span>
            tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> attacking_troops
            
            <span class="token comment"># 额外奖励一组士兵</span>
            new_troop <span class="token operator">=</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span>
            tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_troop<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_troop<span class="token punctuation">)</span>
            
            <span class="token comment"># 更新玩家士兵列表</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span>t <span class="token keyword">for</span> t <span class="token keyword">in</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops <span class="token keyword">if</span> t <span class="token keyword">not</span> <span class="token keyword">in</span> defending_troops<span class="token punctuation">]</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 领土变更</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>territory <span class="token operator">+=</span> <span class="token number">1</span>
            <span class="token keyword">if</span> defending_country<span class="token punctuation">:</span>
                defending_country<span class="token punctuation">.</span>territory <span class="token operator">-=</span> <span class="token number">1</span>
                <span class="token comment"># 检查防御方是否被击败</span>
                <span class="token keyword">if</span> defending_country<span class="token punctuation">.</span>territory <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    defending_country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">True</span>
                    <span class="token comment"># 移除所有该国家的领土</span>
                    <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                            tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span>
                            <span class="token keyword">if</span> tile <span class="token keyword">and</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> defending_country<span class="token punctuation">:</span>
                                tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
            
            <span class="token comment"># 检查是否应获得新士兵组</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># 防御方胜利</span>
            <span class="token comment"># 移除所有进攻方士兵组</span>
            <span class="token keyword">for</span> troop <span class="token keyword">in</span> attacking_troops<span class="token punctuation">:</span>
                <span class="token keyword">if</span> troop <span class="token keyword">in</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop<span class="token punctuation">)</span>
            
            <span class="token comment"># 防御方损失士兵组数量等于进攻方数量</span>
            <span class="token keyword">if</span> defending_troops<span class="token punctuation">:</span>
                <span class="token comment"># 随机移除防御方士兵组</span>
                remove_count <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>defending_troops<span class="token punctuation">)</span><span class="token punctuation">,</span> attacking_count<span class="token punctuation">)</span>
                removed_troops <span class="token operator">=</span> random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>defending_troops<span class="token punctuation">,</span> remove_count<span class="token punctuation">)</span>
                
                <span class="token comment"># 更新防御方士兵</span>
                tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>t <span class="token keyword">for</span> t <span class="token keyword">in</span> defending_troops <span class="token keyword">if</span> t <span class="token keyword">not</span> <span class="token keyword">in</span> removed_troops<span class="token punctuation">]</span>
                <span class="token keyword">if</span> defending_country<span class="token punctuation">:</span>
                    defending_country<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span>t <span class="token keyword">for</span> t <span class="token keyword">in</span> defending_country<span class="token punctuation">.</span>troops <span class="token keyword">if</span> t <span class="token keyword">not</span> <span class="token keyword">in</span> removed_troops<span class="token punctuation">]</span>
                
                <span class="token keyword">if</span> <span class="token keyword">not</span> tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                    <span class="token comment"># 如果防御方没有士兵了，领土变为中立</span>
                    tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
                    <span class="token keyword">if</span> defending_country<span class="token punctuation">:</span>
                        defending_country<span class="token punctuation">.</span>territory <span class="token operator">-=</span> <span class="token number">1</span>
                        <span class="token keyword">if</span> defending_country<span class="token punctuation">.</span>territory <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                            defending_country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">True</span>
                            <span class="token comment"># 移除所有该国家的领土</span>
                            <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
                                <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                                    t <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span>
                                    <span class="token keyword">if</span> t <span class="token keyword">and</span> t<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> defending_country<span class="token punctuation">:</span>
                                        t<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
    
    <span class="token keyword">def</span> <span class="token function">ai_turn</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> country <span class="token keyword">in</span> self<span class="token punctuation">.</span>countries<span class="token punctuation">:</span>
            <span class="token keyword">if</span> country<span class="token punctuation">.</span>is_player <span class="token keyword">or</span> country<span class="token punctuation">.</span>defeated<span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            
            <span class="token comment"># 收集所有可能的移动</span>
            possible_moves <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            
            <span class="token comment"># 收集所有边境格子（与敌方或空白相邻的格子）</span>
            border_tiles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span>
                    <span class="token keyword">if</span> tile <span class="token keyword">and</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> country <span class="token keyword">and</span> tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                        <span class="token comment"># 检查是否在边境</span>
                        is_border <span class="token operator">=</span> <span class="token boolean">False</span>
                        <span class="token keyword">for</span> dx<span class="token punctuation">,</span> dy <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                            nx<span class="token punctuation">,</span> ny <span class="token operator">=</span> x <span class="token operator">+</span> dx<span class="token punctuation">,</span> y <span class="token operator">+</span> dy
                            <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> nx <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> ny <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">:</span>
                                neighbor <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>ny<span class="token punctuation">]</span><span class="token punctuation">[</span>nx<span class="token punctuation">]</span>
                                <span class="token keyword">if</span> <span class="token keyword">not</span> neighbor <span class="token keyword">or</span> <span class="token punctuation">(</span>neighbor<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token keyword">and</span> neighbor<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> country<span class="token punctuation">)</span><span class="token punctuation">:</span>
                                    is_border <span class="token operator">=</span> <span class="token boolean">True</span>
                                    <span class="token keyword">break</span>
                        
                        <span class="token keyword">if</span> is_border<span class="token punctuation">:</span>
                            border_tiles<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> <span class="token keyword">not</span> border_tiles<span class="token punctuation">:</span>
                <span class="token comment"># 如果没有边境格子，使用所有有士兵的格子</span>
                <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                        tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span>
                        <span class="token keyword">if</span> tile <span class="token keyword">and</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> country <span class="token keyword">and</span> tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                            border_tiles<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 尝试每个边境格子</span>
            random<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>border_tiles<span class="token punctuation">)</span>
            moved <span class="token operator">=</span> <span class="token boolean">False</span>
            
            <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> border_tiles<span class="token punctuation">:</span>
                tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span>
                <span class="token comment"># 检查该格子是否还有士兵（可能在之前的移动中已被移动）</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> tile <span class="token keyword">or</span> <span class="token keyword">not</span> tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token keyword">or</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> country<span class="token punctuation">:</span>
                    <span class="token keyword">continue</span>
                
                <span class="token comment"># 收集可能的移动目标</span>
                targets <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                
                <span class="token comment"># 检查所有可能的方向（1-2格距离）</span>
                <span class="token keyword">for</span> dx<span class="token punctuation">,</span> dy <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                    nx<span class="token punctuation">,</span> ny <span class="token operator">=</span> x <span class="token operator">+</span> dx<span class="token punctuation">,</span> y <span class="token operator">+</span> dy
                    <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> nx <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> ny <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">:</span>
                        targets<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>nx<span class="token punctuation">,</span> ny<span class="token punctuation">)</span><span class="token punctuation">)</span>
                
                <span class="token comment"># 随机打乱目标顺序</span>
                random<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>targets<span class="token punctuation">)</span>
                
                <span class="token keyword">for</span> tx<span class="token punctuation">,</span> ty <span class="token keyword">in</span> targets<span class="token punctuation">:</span>
                    <span class="token comment"># 获取目标格子</span>
                    target_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>ty<span class="token punctuation">]</span><span class="token punctuation">[</span>tx<span class="token punctuation">]</span>
                    
                    <span class="token comment"># 如果是空白格子，直接占领</span>
                    <span class="token keyword">if</span> <span class="token keyword">not</span> target_tile<span class="token punctuation">:</span>
                        self<span class="token punctuation">.</span>ai_move<span class="token punctuation">(</span>country<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> tx<span class="token punctuation">,</span> ty<span class="token punctuation">)</span>
                        moved <span class="token operator">=</span> <span class="token boolean">True</span>
                        <span class="token keyword">break</span>
                    
                    <span class="token comment"># 如果是敌方格子，评估实力</span>
                    <span class="token keyword">if</span> target_tile <span class="token keyword">and</span> target_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token keyword">and</span> target_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> country<span class="token punctuation">:</span>
                        <span class="token comment"># 获取边境实力</span>
                        my_strength <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                        enemy_strength <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>target_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                        
                        <span class="token comment"># 增强策略性 - 只在实力足够时进攻</span>
                        <span class="token keyword">if</span> my_strength <span class="token operator">&gt;</span> enemy_strength<span class="token punctuation">:</span>
                            self<span class="token punctuation">.</span>ai_move<span class="token punctuation">(</span>country<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> tx<span class="token punctuation">,</span> ty<span class="token punctuation">)</span>
                            moved <span class="token operator">=</span> <span class="token boolean">True</span>
                            <span class="token keyword">break</span>
                
                <span class="token keyword">if</span> moved<span class="token punctuation">:</span>
                    <span class="token keyword">break</span>
    
    <span class="token keyword">def</span> <span class="token function">ai_move</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> country<span class="token punctuation">,</span> from_x<span class="token punctuation">,</span> from_y<span class="token punctuation">,</span> to_x<span class="token punctuation">,</span> to_y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 获取原方格信息</span>
        from_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>from_y<span class="token punctuation">]</span><span class="token punctuation">[</span>from_x<span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> from_tile <span class="token keyword">or</span> <span class="token keyword">not</span> from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        <span class="token comment"># 获取要移动的所有士兵组</span>
        moving_troops <span class="token operator">=</span> from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>  <span class="token comment"># 复制列表</span>
        
        <span class="token comment"># 从原位置移除所有士兵组</span>
        from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> troop <span class="token keyword">in</span> moving_troops<span class="token punctuation">:</span>
            <span class="token keyword">if</span> troop <span class="token keyword">in</span> country<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop<span class="token punctuation">)</span>
        
        <span class="token comment"># 更新士兵组位置</span>
        <span class="token keyword">for</span> troop <span class="token keyword">in</span> moving_troops<span class="token punctuation">:</span>
            troop<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_x
            troop<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_y
        
        <span class="token comment"># 添加到新位置</span>
        to_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>to_y<span class="token punctuation">]</span><span class="token punctuation">[</span>to_x<span class="token punctuation">]</span>
        
        <span class="token keyword">if</span> <span class="token keyword">not</span> to_tile<span class="token punctuation">:</span>
            <span class="token comment"># 占领新领土</span>
            self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>to_y<span class="token punctuation">]</span><span class="token punctuation">[</span>to_x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'country'</span><span class="token punctuation">:</span> country<span class="token punctuation">,</span>
                <span class="token string">'troops'</span><span class="token punctuation">:</span> moving_troops
            <span class="token punctuation">}</span>
            country<span class="token punctuation">.</span>territory <span class="token operator">+=</span> <span class="token number">1</span>
            country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
            <span class="token comment"># 检查是否应获得新士兵组</span>
            country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> country<span class="token punctuation">:</span>
                <span class="token comment"># 合并到友方领土</span>
                to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>extend<span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
                country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># 与敌方发生战斗</span>
                defending_country <span class="token operator">=</span> to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token keyword">if</span> to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token keyword">else</span> <span class="token boolean">None</span>
                defending_troops <span class="token operator">=</span> to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
                attacking_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
                defending_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>defending_troops<span class="token punctuation">)</span>
                
                difference <span class="token operator">=</span> attacking_count <span class="token operator">-</span> defending_count
                
                <span class="token keyword">if</span> difference <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    <span class="token comment"># 攻击方胜利</span>
                    to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> country
                    to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> moving_troops
                    
                    <span class="token comment"># 额外奖励一组士兵</span>
                    new_troop <span class="token operator">=</span> <span class="token punctuation">[</span>to_x<span class="token punctuation">,</span> to_y<span class="token punctuation">]</span>
                    to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_troop<span class="token punctuation">)</span>
                    country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_troop<span class="token punctuation">)</span>
                    
                    <span class="token comment"># 更新国家士兵列表</span>
                    country<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span>t <span class="token keyword">for</span> t <span class="token keyword">in</span> country<span class="token punctuation">.</span>troops <span class="token keyword">if</span> t <span class="token keyword">not</span> <span class="token keyword">in</span> defending_troops<span class="token punctuation">]</span>
                    country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    
                    <span class="token comment"># 领土变更</span>
                    country<span class="token punctuation">.</span>territory <span class="token operator">+=</span> <span class="token number">1</span>
                    <span class="token keyword">if</span> defending_country<span class="token punctuation">:</span>
                        defending_country<span class="token punctuation">.</span>territory <span class="token operator">-=</span> <span class="token number">1</span>
                        <span class="token keyword">if</span> defending_country<span class="token punctuation">.</span>territory <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                            defending_country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">True</span>
                            <span class="token comment"># 移除所有该国家的领土</span>
                            <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
                                <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                                    tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span>
                                    <span class="token keyword">if</span> tile <span class="token keyword">and</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> defending_country<span class="token punctuation">:</span>
                                        tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
                    
                    <span class="token comment"># 检查是否应获得新士兵组</span>
                    country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token comment"># 防御方胜利</span>
                    <span class="token comment"># 移除所有进攻方士兵组</span>
                    <span class="token keyword">for</span> troop <span class="token keyword">in</span> moving_troops<span class="token punctuation">:</span>
                        <span class="token keyword">if</span> troop <span class="token keyword">in</span> country<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                            country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop<span class="token punctuation">)</span>
                    
                    <span class="token comment"># 防御方损失士兵组数量等于进攻方数量</span>
                    <span class="token keyword">if</span> defending_troops <span class="token keyword">and</span> defending_country<span class="token punctuation">:</span>
                        <span class="token comment"># 随机移除防御方士兵组</span>
                        remove_count <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>defending_troops<span class="token punctuation">)</span><span class="token punctuation">,</span> attacking_count<span class="token punctuation">)</span>
                        removed_troops <span class="token operator">=</span> random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>defending_troops<span class="token punctuation">,</span> remove_count<span class="token punctuation">)</span>
                        
                        <span class="token comment"># 更新防御方士兵</span>
                        to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>t <span class="token keyword">for</span> t <span class="token keyword">in</span> defending_troops <span class="token keyword">if</span> t <span class="token keyword">not</span> <span class="token keyword">in</span> removed_troops<span class="token punctuation">]</span>
                        defending_country<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span>t <span class="token keyword">for</span> t <span class="token keyword">in</span> defending_country<span class="token punctuation">.</span>troops <span class="token keyword">if</span> t <span class="token keyword">not</span> <span class="token keyword">in</span> removed_troops<span class="token punctuation">]</span>
                        
                        <span class="token keyword">if</span> <span class="token keyword">not</span> to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                            <span class="token comment"># 如果防御方没有士兵了，领土变为中立</span>
                            to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
                            <span class="token keyword">if</span> defending_country<span class="token punctuation">:</span>
                                defending_country<span class="token punctuation">.</span>territory <span class="token operator">-=</span> <span class="token number">1</span>
                                <span class="token keyword">if</span> defending_country<span class="token punctuation">.</span>territory <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                                    defending_country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">True</span>
                                    <span class="token comment"># 移除所有该国家的领土</span>
                                    <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
                                        <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                                            t <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span>
                                            <span class="token keyword">if</span> t <span class="token keyword">and</span> t<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> defending_country<span class="token punctuation">:</span>
                                                t<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
    
    <span class="token keyword">def</span> <span class="token function">check_game_over</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        active_countries <span class="token operator">=</span> <span class="token punctuation">[</span>c <span class="token keyword">for</span> c <span class="token keyword">in</span> self<span class="token punctuation">.</span>countries <span class="token keyword">if</span> <span class="token keyword">not</span> c<span class="token punctuation">.</span>defeated<span class="token punctuation">]</span>
        
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>active_countries<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>game_over <span class="token operator">=</span> <span class="token boolean">True</span>
            self<span class="token punctuation">.</span>winner <span class="token operator">=</span> active_countries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    
    <span class="token keyword">def</span> <span class="token function">restart_game</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 重置游戏状态</span>
        self<span class="token punctuation">.</span>grid <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token boolean">None</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> country <span class="token keyword">in</span> self<span class="token punctuation">.</span>countries<span class="token punctuation">:</span>
            country<span class="token punctuation">.</span>territory <span class="token operator">=</span> <span class="token number">0</span>
            country<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            country<span class="token punctuation">.</span>next_reward <span class="token operator">=</span> <span class="token number">3</span>
            country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">False</span>
        
        self<span class="token punctuation">.</span>selected_tile <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>game_over <span class="token operator">=</span> <span class="token boolean">False</span>
        self<span class="token punctuation">.</span>winner <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>turn_count <span class="token operator">=</span> <span class="token number">0</span>
        
        <span class="token comment"># 重新初始化游戏</span>
        self<span class="token punctuation">.</span>initialize_game<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> event <span class="token keyword">in</span> pygame<span class="token punctuation">.</span>event<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> event<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> QUIT<span class="token punctuation">:</span>
                    pygame<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">elif</span> event<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> MOUSEBUTTONDOWN<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> event<span class="token punctuation">.</span>button <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>  <span class="token comment"># 左键点击</span>
                        self<span class="token punctuation">.</span>handle_click<span class="token punctuation">(</span>event<span class="token punctuation">.</span>pos<span class="token punctuation">)</span>
                <span class="token keyword">elif</span> event<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> KEYDOWN<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> event<span class="token punctuation">.</span>key <span class="token operator">==</span> K_r<span class="token punctuation">:</span>  <span class="token comment"># 按R键重新开始</span>
                        self<span class="token punctuation">.</span>restart_game<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            self<span class="token punctuation">.</span>draw_grid<span class="token punctuation">(</span><span class="token punctuation">)</span>
            pygame<span class="token punctuation">.</span>display<span class="token punctuation">.</span>flip<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>clock<span class="token punctuation">.</span>tick<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    game <span class="token operator">=</span> Game<span class="token punctuation">(</span><span class="token punctuation">)</span>
    game<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></div><h2>主要修复内容：</h2><h3>1. 修复 <code>AttributeError: 'NoneType' object has no attribute 'color'</code> 错误</h3><p class="ds-markdown-paragraph">在 <code>draw_grid</code> 方法中，我添加了对 <code>country</code> 属性的额外检查：</p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre><span class="token comment"># 绘制领土和士兵</span>
<span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
        tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span>
        <span class="token keyword">if</span> tile<span class="token punctuation">:</span>
            <span class="token comment"># 确保国家对象存在</span>
            <span class="token keyword">if</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                rect <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Rect<span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span>
                pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>color<span class="token punctuation">,</span> rect<span class="token punctuation">)</span>
                
                <span class="token comment"># 绘制士兵组...</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># 绘制中立领土</span>
                rect <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Rect<span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span>
                pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> NEUTRAL_COLOR<span class="token punctuation">,</span> rect<span class="token punctuation">)</span></pre></div><h3>2. 添加中立领土颜色</h3><p class="ds-markdown-paragraph">定义了一个新的中立领土颜色：</p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre>NEUTRAL_COLOR <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>  <span class="token comment"># 中立领土颜色</span></pre></div><h3>3. 完善国家被击败时的处理逻辑</h3><p class="ds-markdown-paragraph">当国家被击败时，清理其所有领土：</p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre><span class="token comment"># 在resolve_battle方法中</span>
<span class="token keyword">if</span> defending_country<span class="token punctuation">.</span>territory <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
    defending_country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">True</span>
    <span class="token comment"># 移除所有该国家的领土</span>
    <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
            tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span>
            <span class="token keyword">if</span> tile <span class="token keyword">and</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> defending_country<span class="token punctuation">:</span>
                tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span></pre></div><h3>4. 添加额外的安全检查</h3><p class="ds-markdown-paragraph">在多个地方添加了对 <code>tile</code> 和 <code>country</code> 是否为 <code>None</code> 的检查：</p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre><span class="token comment"># 在handle_click中</span>
tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>grid_y<span class="token punctuation">]</span><span class="token punctuation">[</span>grid_x<span class="token punctuation">]</span>
<span class="token keyword">if</span> tile <span class="token keyword">and</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">:</span>
    <span class="token comment"># ...</span>

<span class="token comment"># 在ai_turn中</span>
tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span>
<span class="token keyword">if</span> tile <span class="token keyword">and</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> country <span class="token keyword">and</span> tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token comment"># ...</span></pre></div><h3>5. 优化边境检测逻辑</h3><p class="ds-markdown-paragraph">改进了边境检测逻辑，确保正确处理边界情况：</p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre><span class="token comment"># 在ai_turn中</span>
<span class="token keyword">for</span> dx<span class="token punctuation">,</span> dy <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    nx<span class="token punctuation">,</span> ny <span class="token operator">=</span> x <span class="token operator">+</span> dx<span class="token punctuation">,</span> y <span class="token operator">+</span> dy
    <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> nx <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> ny <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">:</span>
        neighbor <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>ny<span class="token punctuation">]</span><span class="token punctuation">[</span>nx<span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> neighbor <span class="token keyword">or</span> <span class="token punctuation">(</span>neighbor<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token keyword">and</span> neighbor<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> country<span class="token punctuation">)</span><span class="token punctuation">:</span>
            is_border <span class="token operator">=</span> <span class="token boolean">True</span>
            <span class="token keyword">break</span></pre></div><h3>6. 添加更多的空值检查</h3><p class="ds-markdown-paragraph">在战斗逻辑中添加了额外的空值检查，防止出现空引用：</p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre><span class="token comment"># 在resolve_battle中</span>
<span class="token keyword">if</span> defending_country<span class="token punctuation">:</span>
    defending_country<span class="token punctuation">.</span>territory <span class="token operator">-=</span> <span class="token number">1</span>
    <span class="token comment"># ...</span></pre></div><h2>其他改进：</h2><ol start="1"><li><p class="ds-markdown-paragraph"><strong>代码健壮性提升</strong>：</p><ul><li><p class="ds-markdown-paragraph">在多个关键位置添加了对 <code>None</code> 值的检查</p></li><li><p class="ds-markdown-paragraph">确保所有网格访问都经过验证</p></li><li><p class="ds-markdown-paragraph">优化了国家被击败时的清理过程</p></li></ul></li><li><p class="ds-markdown-paragraph"><strong>中立领土可视化</strong>：</p><ul><li><p class="ds-markdown-paragraph">添加了中立领土的特殊颜色（灰色）</p></li><li><p class="ds-markdown-paragraph">使玩家能够清晰区分占领区和无人区</p></li></ul></li><li><p class="ds-markdown-paragraph"><strong>错误处理</strong>：</p><ul><li><p class="ds-markdown-paragraph">防止在访问国家属性时出现空引用</p></li><li><p class="ds-markdown-paragraph">确保士兵移动时不会引用无效位置</p></li></ul></li><li><p class="ds-markdown-paragraph"><strong>AI策略优化</strong>：</p><ul><li><p class="ds-markdown-paragraph">改进边境检测逻辑</p></li><li><p class="ds-markdown-paragraph">添加更多安全检查防止AI尝试无效移动</p></li></ul></li></ol><p class="ds-markdown-paragraph">这个修复版本应该能够解决您遇到的 <code>AttributeError</code> 错误，并提高游戏的稳定性和健壮性。当国家被击败时，它的所有领土都会被标记为中立（灰色），而不是保持原国家的颜色但国家对象已被移除。</p></div><div class="ds-flex" style="margin-top: 12px; height: 20px; margin-bottom: 20px; align-items: center; gap: 10px;"><div class="ds-flex _965abe9" style="align-items: center; gap: 16px;"><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px; opacity: 1;"><svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><clippath id="clip1258_20811"><rect id="重新生成" width="20.000000" height="20.000000" fill="white" fill-opacity="0"></rect></clippath></defs><rect id="重新生成" width="20.000000" height="20.000000" fill="#FFFFFF" fill-opacity="0"></rect><g clip-path="url(#clip1258_20811)"><path id="path" d="M17.01 7.63L13.98 7.62C13.88 7.62 13.79 7.6 13.7 7.56C13.62 7.52 13.54 7.47 13.47 7.4C13.4 7.33 13.35 7.25 13.32 7.16C13.28 7.07 13.26 6.98 13.26 6.88C13.26 6.79 13.28 6.69 13.32 6.6C13.35 6.51 13.4 6.43 13.47 6.36C13.54 6.3 13.62 6.24 13.7 6.21C13.79 6.17 13.88 6.15 13.98 6.15L15.57 6.16C15.67 6.16 15.76 6.14 15.85 6.1C15.94 6.06 16.01 6.01 16.08 5.94C16.15 5.87 16.2 5.79 16.23 5.7C16.27 5.61 16.29 5.52 16.29 5.42L16.3 3.89C16.3 3.79 16.32 3.7 16.36 3.61C16.39 3.52 16.44 3.44 16.51 3.37C16.58 3.3 16.66 3.25 16.74 3.21C16.83 3.17 16.92 3.16 17.02 3.16C17.11 3.16 17.2 3.17 17.29 3.21C17.38 3.25 17.46 3.3 17.52 3.37C17.59 3.44 17.64 3.52 17.68 3.61C17.71 3.7 17.73 3.79 17.73 3.89L17.72 6.9C17.72 7 17.71 7.09 17.67 7.18C17.63 7.27 17.58 7.34 17.52 7.41C17.45 7.48 17.37 7.53 17.29 7.57C17.2 7.61 17.11 7.63 17.01 7.63Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path><path id="path" d="M2.31 16.29L2.32 13.3C2.32 13.21 2.34 13.11 2.37 13.02C2.41 12.93 2.46 12.85 2.53 12.78C2.6 12.71 2.67 12.66 2.76 12.62C2.85 12.58 2.94 12.56 3.03 12.56L6.07 12.57C6.16 12.57 6.25 12.59 6.34 12.63C6.43 12.67 6.51 12.72 6.57 12.79C6.64 12.86 6.69 12.94 6.73 13.03C6.76 13.12 6.78 13.22 6.78 13.32C6.78 13.41 6.76 13.51 6.73 13.6C6.69 13.69 6.64 13.77 6.57 13.84C6.51 13.91 6.43 13.96 6.34 14C6.25 14.04 6.16 14.06 6.07 14.06L4.47 14.05C4.38 14.05 4.29 14.07 4.2 14.11C4.11 14.15 4.03 14.2 3.97 14.27C3.9 14.34 3.85 14.42 3.81 14.51C3.78 14.6 3.76 14.7 3.76 14.8L3.75 16.29C3.75 16.39 3.73 16.48 3.69 16.58C3.65 16.67 3.6 16.75 3.54 16.82C3.47 16.89 3.39 16.94 3.3 16.98C3.22 17.01 3.13 17.03 3.03 17.03C2.94 17.03 2.85 17.02 2.76 16.98C2.67 16.94 2.59 16.89 2.52 16.82C2.46 16.75 2.4 16.67 2.37 16.58C2.33 16.49 2.31 16.39 2.31 16.29Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path><path id="path" d="M9.88 18.01C9.51 18.01 9.15 17.99 8.79 17.94C8.42 17.89 8.07 17.82 7.71 17.73C7.36 17.63 7.02 17.51 6.68 17.37C6.34 17.23 6.02 17.07 5.7 16.89C5.39 16.7 5.09 16.5 4.8 16.28C4.52 16.05 4.25 15.81 3.99 15.55C3.74 15.29 3.5 15.02 3.29 14.73C3.07 14.44 2.88 14.13 2.7 13.82L4.15 13.05C4.32 13.35 4.51 13.64 4.72 13.91C4.93 14.18 5.17 14.43 5.42 14.66C5.67 14.9 5.94 15.11 6.23 15.3C6.52 15.49 6.83 15.66 7.14 15.81C7.46 15.95 7.78 16.07 8.12 16.16C8.45 16.25 8.8 16.32 9.14 16.36C9.49 16.39 9.83 16.4 10.18 16.39C10.53 16.37 10.87 16.33 11.22 16.26C11.56 16.19 11.89 16.09 12.21 15.97C12.54 15.84 12.85 15.7 13.15 15.53C13.45 15.35 13.74 15.16 14.01 14.94C14.28 14.72 14.53 14.49 14.76 14.23C14.99 13.97 15.2 13.7 15.38 13.41C15.57 13.12 15.73 12.82 15.87 12.5C16 12.19 16.11 11.87 16.2 11.53C16.28 11.2 16.34 10.87 16.36 10.52C16.37 10.42 16.4 10.33 16.44 10.24C16.48 10.15 16.54 10.07 16.61 10C16.69 9.93 16.77 9.87 16.86 9.84C16.96 9.8 17.05 9.77 17.16 9.77C17.27 9.77 17.38 9.79 17.49 9.83C17.6 9.87 17.7 9.94 17.78 10.02C17.86 10.1 17.92 10.2 17.96 10.3C18 10.41 18.01 10.52 18 10.64C17.98 10.89 17.95 11.13 17.91 11.38C17.86 11.62 17.81 11.87 17.74 12.11C17.68 12.35 17.6 12.58 17.51 12.82C17.42 13.05 17.32 13.28 17.21 13.5C17.1 13.73 16.98 13.95 16.85 14.16C16.71 14.37 16.57 14.58 16.42 14.78C16.27 14.98 16.11 15.17 15.94 15.36C15.77 15.54 15.59 15.72 15.41 15.89C15.22 16.06 15.03 16.22 14.83 16.37C14.63 16.52 14.42 16.66 14.2 16.79C13.99 16.93 13.77 17.05 13.54 17.16C13.31 17.27 13.08 17.37 12.85 17.46C12.61 17.55 12.37 17.63 12.13 17.7C11.88 17.77 11.64 17.83 11.39 17.87C11.14 17.92 10.89 17.96 10.63 17.98C10.38 18 10.13 18.01 9.88 18.01Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path><path id="path" d="M2.85 10.27C2.73 10.28 2.62 10.26 2.51 10.22C2.4 10.17 2.31 10.11 2.23 10.03C2.14 9.95 2.08 9.85 2.04 9.74C2 9.63 1.99 9.52 2 9.41C2.03 8.98 2.1 8.56 2.2 8.15C2.3 7.73 2.43 7.33 2.6 6.94C2.76 6.54 2.96 6.16 3.19 5.8C3.41 5.44 3.67 5.1 3.95 4.77C4.24 4.45 4.54 4.15 4.88 3.88C5.21 3.6 5.56 3.35 5.93 3.13C6.3 2.91 6.69 2.73 7.09 2.57C7.5 2.41 7.91 2.28 8.33 2.19C8.75 2.09 9.18 2.03 9.62 2.01C10.05 1.98 10.48 1.99 10.91 2.03C11.35 2.07 11.77 2.14 12.19 2.25C12.61 2.36 13.02 2.5 13.42 2.67C13.81 2.84 14.19 3.04 14.56 3.28C14.92 3.51 15.27 3.77 15.59 4.05C15.91 4.34 16.21 4.64 16.48 4.98C16.75 5.31 17 5.66 17.21 6.03L15.78 6.83C15.61 6.54 15.42 6.25 15.2 5.99C14.98 5.73 14.74 5.48 14.49 5.25C14.23 5.02 13.96 4.82 13.66 4.63C13.37 4.45 13.07 4.29 12.75 4.15C12.44 4.01 12.11 3.9 11.77 3.82C11.44 3.73 11.1 3.67 10.76 3.64C10.41 3.61 10.07 3.6 9.72 3.62C9.37 3.64 9.03 3.69 8.69 3.77C8.36 3.84 8.03 3.94 7.71 4.07C7.38 4.2 7.08 4.35 6.78 4.52C6.48 4.7 6.2 4.89 5.94 5.11C5.67 5.33 5.43 5.57 5.2 5.83C4.97 6.08 4.77 6.36 4.59 6.65C4.41 6.94 4.25 7.24 4.12 7.55C3.98 7.87 3.88 8.19 3.8 8.52C3.72 8.85 3.66 9.19 3.64 9.53C3.63 9.62 3.6 9.72 3.56 9.81C3.52 9.9 3.46 9.98 3.39 10.05C3.32 10.12 3.23 10.17 3.14 10.21C3.05 10.25 2.95 10.27 2.85 10.27Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path></g></svg></div></div><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M18.14 9.428l-.003.019L17.114 15a3.774 3.774 0 0 1-1.313 2.27 3.673 3.673 0 0 1-2.438.894H3.895c-.57 0-1.055-.205-1.458-.614a2.033 2.033 0 0 1-.604-1.48v-5.438c0-.578.201-1.071.604-1.48.402-.41.888-.614 1.458-.614h1.932l2.317-5.293c.24-.548.6-.948 1.083-1.2.599-.312 1.156-.278 1.672.103.782.577 1.172 1.355 1.172 2.334V6.997h3.994c.638-.007 1.167.235 1.588.726.421.492.584 1.06.488 1.705zm-2.076-2.6c.686-.007 1.262.256 1.714.785.453.529.63 1.146.527 1.84v.004l-.005.02v.003l-1.022 5.552a3.943 3.943 0 0 1-1.37 2.368 3.838 3.838 0 0 1-2.545.933H3.895a2.137 2.137 0 0 1-1.576-.663 2.203 2.203 0 0 1-.652-1.6v-5.437c0-.622.218-1.159.652-1.6.434-.44.962-.663 1.576-.663H5.72l2.273-5.192c.254-.58.64-1.01 1.159-1.282.32-.167.64-.246.953-.227.315.02.613.137.893.344.824.608 1.24 1.437 1.24 2.47v2.345h3.827zM9.741 3.063c-.247.128-.437.344-.57.647L6.708 9.34v7.683h6.655a2.59 2.59 0 0 0 1.72-.63c.498-.42.807-.955.926-1.601l1.02-5.544a.936.936 0 0 0-.225-.773.917.917 0 0 0-.739-.335h-4.557a.567.567 0 0 1-.562-.571V4.483c0-.591-.236-1.061-.708-1.41-.143-.105-.309-.109-.497-.01zm7.124 6.157a.766.766 0 0 0-.186-.636.753.753 0 0 0-.612-.276h-4.559a.734.734 0 0 1-.728-.74V4.483c0-.537-.21-.956-.64-1.273a.233.233 0 0 0-.137-.05.387.387 0 0 0-.185.053c-.208.108-.374.291-.495.566m0 0L6.874 9.375v7.479h6.489c.609 0 1.145-.197 1.614-.592.468-.396.757-.894.869-1.502l1.02-5.54M3.35 16.623c.152.155.33.23.545.23h1.522V9.85H3.895a.732.732 0 0 0-.545.23.755.755 0 0 0-.226.553v5.437c0 .218.074.4.226.553zm.545-6.941a.897.897 0 0 0-.663.278.924.924 0 0 0-.274.673v5.437c0 .263.091.487.274.673.183.186.404.28.663.28h1.688V9.681H3.895z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M18.137 9.447l.004-.02a2.044 2.044 0 0 0-.488-1.704c-.421-.491-.95-.733-1.588-.726h-2.282l1.584 1.142h.698a.917.917 0 0 1 .739.335.936.936 0 0 1 .225.773l-1.02 5.543a2.663 2.663 0 0 1-.926 1.602 2.59 2.59 0 0 1-1.72.63H6.708V9.34L9.171 3.71c.133-.303.323-.519.57-.647.188-.099.354-.095.497.01.472.349.708.819.708 1.41v.467l1.125.811V4.483c0-.98-.39-1.757-1.171-2.334-.517-.38-1.074-.415-1.673-.103-.482.252-.843.652-1.083 1.2L5.827 8.54H3.895c-.57 0-1.056.205-1.458.614a2.033 2.033 0 0 0-.604 1.48v5.437c0 .578.201 1.072.604 1.48.403.41.889.615 1.458.615h9.468c.918 0 1.731-.299 2.438-.895A3.774 3.774 0 0 0 17.114 15l1.023-5.553zm-14.242.235a.897.897 0 0 0-.663.278.924.924 0 0 0-.274.673v5.437c0 .263.091.487.274.673.183.186.404.28.663.28h1.688V9.681H3.895z" fill="currentColor"></path><path d="M10.946 7.568c0 .316.252.571.563.571h3.858l-1.584-1.142h-1.712V5.76l-1.125-.811v2.618z" fill="currentColor"></path></svg></div></div><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M18.304 10.543v.004a2.214 2.214 0 0 1-.526 1.84c-.452.528-1.028.792-1.714.784h-3.827v2.345c0 1.034-.416 1.863-1.24 2.471-.28.207-.578.324-.893.343-.314.02-.632-.06-.953-.226-.519-.271-.905-.702-1.159-1.282l-2.273-5.193H3.895a2.136 2.136 0 0 1-1.576-.663 2.203 2.203 0 0 1-.652-1.6V3.93c0-.623.218-1.16.652-1.6.434-.441.963-.663 1.576-.663h9.468c.957 0 1.807.311 2.544.933a3.943 3.943 0 0 1 1.37 2.368L18.3 10.52v.002l.004.02zm-1.19-5.544a3.774 3.774 0 0 0-1.313-2.27 3.673 3.673 0 0 0-2.438-.894H3.895c-.57 0-1.055.205-1.458.614a2.033 2.033 0 0 0-.604 1.48v5.437c0 .578.201 1.072.604 1.48.402.41.888.615 1.458.615h1.932l2.317 5.292c.24.549.6.949 1.083 1.2.599.313 1.156.279 1.672-.102.782-.577 1.172-1.355 1.172-2.335v-2.513h3.994c.638.007 1.167-.235 1.588-.727.421-.491.584-1.06.488-1.704l-.004-.02L17.114 5zM9.819 16.787c.076.04.137.053.185.052a.233.233 0 0 0 .137-.05c.43-.316.64-.735.64-1.273v-3.084c0-.41.327-.74.729-.74h4.558a.752.752 0 0 0 .612-.277.766.766 0 0 0 .186-.635l-1.02-5.54a2.495 2.495 0 0 0-.869-1.502 2.426 2.426 0 0 0-1.613-.592H6.874v7.48l2.449 5.595m-2.615-5.56V2.978h6.655c.648 0 1.221.21 1.72.63.498.42.807.954.926 1.601l1.02 5.543a.936.936 0 0 1-.225.774.917.917 0 0 1-.739.335h-4.557a.567.567 0 0 0-.562.57v3.085c0 .592-.236 1.062-.708 1.41-.143.106-.309.11-.497.01-.247-.128-.437-.343-.57-.647l-2.463-5.628zM3.35 3.376a.754.754 0 0 0-.226.554v5.436c0 .218.074.4.226.554.152.154.33.23.545.23h1.522V3.146H3.895a.731.731 0 0 0-.545.23zm2.233-.398v7.34H3.895a.897.897 0 0 1-.663-.279.925.925 0 0 1-.274-.673V3.93c0-.263.091-.487.274-.673a.895.895 0 0 1 .663-.28h1.688zm4.235 13.809c-.208-.108-.375-.292-.495-.566l.495.566z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M15.801 2.73a3.774 3.774 0 0 1 1.313 2.269l1.023 5.554.004.019a2.044 2.044 0 0 1-.488 1.704c-.421.492-.95.734-1.588.727h-3.994v2.513c0 .98-.39 1.758-1.171 2.335-.517.38-1.074.415-1.673.102-.482-.251-.843-.651-1.083-1.2l-2.317-5.292H3.895c-.57 0-1.056-.205-1.458-.614a2.033 2.033 0 0 1-.604-1.48V3.93c0-.579.201-1.072.604-1.481.403-.41.889-.614 1.458-.614h9.468c.918 0 1.731.298 2.438.894zm-2.438.248c.648 0 1.221.21 1.72.63.498.42.807.954.926 1.601l1.02 5.543a.936.936 0 0 1-.225.774.917.917 0 0 1-.739.335h-4.557a.567.567 0 0 0-.562.57v3.085c0 .592-.236 1.062-.708 1.41-.143.106-.309.11-.497.01-.247-.128-.437-.343-.57-.647l-2.463-5.628V2.978h6.655zm-9.468 7.34a.897.897 0 0 1-.663-.279.925.925 0 0 1-.274-.673V3.93c0-.263.091-.487.274-.673a.895.895 0 0 1 .663-.28h1.688v7.341H3.895z" fill="currentColor"></path></svg></div></div></div><div style="flex: 1 1 0%;"></div></div></div><div class="_9663006"><div class="fbb737a4">我发现当一个方格内的士兵侵入另一个国家领土后，数量不减反增，这与我一开始制订的游戏规则相违背，请修复这一问题</div><div class="e13328ad _3a26104"><div class="_425ea0b"><div class="ds-flex _78e0558 _0bbda35" style="align-items: flex-end; gap: 0px;"><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px; margin-left: 14px; opacity: 1;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.712 2.79a1.854 1.854 0 0 1 2.623 0l1.673 1.672a1.854 1.854 0 0 1 0 2.623l-9.714 9.714a2.91 2.91 0 0 1-2.058.853H1.945a.8.8 0 0 1-.8-.8v-2.29c0-.773.307-1.513.853-2.058l9.714-9.715zm1.492 1.13c-.1-.1-.261-.1-.361 0l-1.327 1.326 2.035 2.035 1.327-1.326c.1-.1.1-.262 0-.362L13.204 3.92zm-.783 4.491l-2.035-2.034-7.258 7.257a1.31 1.31 0 0 0-.384.927v1.492h1.492c.348 0 .681-.138.927-.384l7.258-7.258z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M17.772 17.608c.35 0 .633-.283.633-.633v-.492a.633.633 0 0 0-.633-.633H9.858L8.1 17.608h9.672z" fill="currentColor"></path></svg></div></div></div></div></div></div><div class="_4f9bf79 d7dc56a8 _43c05b5"><div class="_7eb2358 _58dfa60"><svg viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path id="path" d="M27.501 8.46875C27.249 8.3457 27.1406 8.58008 26.9932 8.69922C26.9434 8.73828 26.9004 8.78906 26.8584 8.83398C26.4902 9.22852 26.0605 9.48633 25.5 9.45508C24.6787 9.41016 23.9785 9.66797 23.3594 10.2969C23.2275 9.52148 22.79 9.05859 22.125 8.76172C21.7764 8.60742 21.4238 8.45312 21.1807 8.11719C21.0098 7.87891 20.9639 7.61328 20.8779 7.35156C20.8242 7.19336 20.7695 7.03125 20.5879 7.00391C20.3906 6.97266 20.3135 7.13867 20.2363 7.27734C19.9258 7.84375 19.8066 8.46875 19.8174 9.10156C19.8447 10.5234 20.4453 11.6562 21.6367 12.4629C21.7725 12.5547 21.8076 12.6484 21.7646 12.7832C21.6836 13.0605 21.5869 13.3301 21.501 13.6074C21.4473 13.7852 21.3662 13.8242 21.1768 13.7461C20.5225 13.4727 19.957 13.0684 19.458 12.5781C18.6104 11.7578 17.8438 10.8516 16.8877 10.1426C16.6631 9.97656 16.4395 9.82227 16.207 9.67578C15.2314 8.72656 16.335 7.94727 16.5898 7.85547C16.8574 7.75977 16.6826 7.42773 15.8193 7.43164C14.957 7.43555 14.167 7.72461 13.1611 8.10938C13.0137 8.16797 12.8594 8.21094 12.7002 8.24414C11.7871 8.07227 10.8389 8.0332 9.84766 8.14453C7.98242 8.35352 6.49219 9.23633 5.39648 10.7441C4.08105 12.5547 3.77148 14.6133 4.15039 16.7617C4.54883 19.0234 5.70215 20.8984 7.47559 22.3633C9.31348 23.8809 11.4307 24.625 13.8457 24.4824C15.3125 24.3984 16.9463 24.2012 18.7881 22.6406C19.2529 22.8711 19.7402 22.9629 20.5498 23.0332C21.1729 23.0918 21.7725 23.002 22.2373 22.9062C22.9648 22.752 22.9141 22.0781 22.6514 21.9531C20.5186 20.959 20.9863 21.3633 20.5605 21.0371C21.6445 19.752 23.2783 18.418 23.917 14.0977C23.9668 13.7539 23.9238 13.5391 23.917 13.2598C23.9131 13.0918 23.9512 13.0254 24.1445 13.0059C24.6787 12.9453 25.1973 12.7988 25.6738 12.5352C27.0557 11.7793 27.6123 10.5391 27.7441 9.05078C27.7637 8.82422 27.7402 8.58789 27.501 8.46875ZM15.46 21.8613C13.3926 20.2344 12.3906 19.6992 11.9766 19.7227C11.5898 19.7441 11.6592 20.1875 11.7441 20.4766C11.833 20.7617 11.9492 20.959 12.1123 21.209C12.2246 21.375 12.3018 21.623 12 21.8066C11.334 22.2207 10.1768 21.668 10.1221 21.6406C8.77539 20.8477 7.64941 19.7988 6.85547 18.3652C6.08984 16.9844 5.64453 15.5039 5.57129 13.9238C5.55176 13.541 5.66406 13.4062 6.04297 13.3379C6.54199 13.2461 7.05762 13.2266 7.55664 13.2988C9.66602 13.6074 11.4619 14.5527 12.9668 16.0469C13.8262 16.9004 14.4766 17.918 15.1465 18.9121C15.8584 19.9688 16.625 20.9746 17.6006 21.7988C17.9443 22.0879 18.2197 22.3086 18.4824 22.4707C17.6895 22.5586 16.3652 22.5781 15.46 21.8613ZM16.4502 15.4805C16.4502 15.3105 16.5859 15.1758 16.7568 15.1758C16.7949 15.1758 16.8301 15.1836 16.8613 15.1953C16.9033 15.2109 16.9424 15.2344 16.9727 15.2695C17.0273 15.3223 17.0586 15.4004 17.0586 15.4805C17.0586 15.6504 16.9229 15.7852 16.7529 15.7852C16.582 15.7852 16.4502 15.6504 16.4502 15.4805ZM19.5273 17.0625C19.3301 17.1426 19.1328 17.2129 18.9434 17.2207C18.6494 17.2344 18.3281 17.1152 18.1533 16.9688C17.8828 16.7422 17.6895 16.6152 17.6074 16.2168C17.5732 16.0469 17.5928 15.7852 17.623 15.6348C17.6934 15.3105 17.6152 15.1035 17.3877 14.9141C17.2012 14.7598 16.9658 14.7188 16.7061 14.7188C16.6094 14.7188 16.5205 14.6758 16.4541 14.6406C16.3457 14.5859 16.2568 14.4512 16.3418 14.2852C16.3691 14.2324 16.501 14.1016 16.5322 14.0781C16.8838 13.877 17.29 13.9434 17.666 14.0938C18.0146 14.2363 18.2773 14.498 18.6562 14.8672C19.0439 15.3145 19.1133 15.4395 19.334 15.7734C19.5078 16.0371 19.667 16.3066 19.7754 16.6152C19.8408 16.8066 19.7559 16.9648 19.5273 17.0625Z" fill-rule="nonzero" fill="#4D6BFE"></path></svg></div><div class="_48edb25"><div class="_58a6d71 _19db599"><div class="ds-icon _7580acb" style="font-size: 12px; width: 12px; height: 12px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2.656 17.344c-1.016-1.015-1.15-2.75-.313-4.925.325-.825.73-1.617 1.205-2.365L3.582 10l-.033-.054c-.5-.799-.91-1.596-1.206-2.365-.836-2.175-.703-3.91.313-4.926.56-.56 1.364-.86 2.335-.86 1.425 0 3.168.636 4.957 1.756l.053.034.053-.034c1.79-1.12 3.532-1.757 4.957-1.757.972 0 1.776.3 2.335.86 1.014 1.015 1.148 2.752.312 4.926a13.892 13.892 0 0 1-1.206 2.365l-.034.054.034.053c.5.8.91 1.596 1.205 2.365.837 2.175.704 3.911-.311 4.926-.56.56-1.364.861-2.335.861-1.425 0-3.168-.637-4.957-1.757L10 16.415l-.053.033c-1.79 1.12-3.532 1.757-4.957 1.757-.972 0-1.776-.3-2.335-.86zm13.631-4.399c-.187-.488-.429-.988-.71-1.492l-.075-.132-.092.12a22.075 22.075 0 0 1-3.968 3.968l-.12.093.132.074c1.308.734 2.559 1.162 3.556 1.162.563 0 1.006-.138 1.298-.43.3-.3.436-.774.428-1.346-.008-.575-.159-1.264-.449-2.017zm-6.345 1.65l.058.042.058-.042a19.881 19.881 0 0 0 4.551-4.537l.043-.058-.043-.058a20.123 20.123 0 0 0-2.093-2.458 19.732 19.732 0 0 0-2.458-2.08L10 5.364l-.058.042A19.883 19.883 0 0 0 5.39 9.942L5.348 10l.042.059c.631.874 1.332 1.695 2.094 2.457a19.74 19.74 0 0 0 2.458 2.08zm6.366-10.902c-.293-.293-.736-.431-1.298-.431-.998 0-2.248.429-3.556 1.163l-.132.074.12.092a21.938 21.938 0 0 1 3.968 3.968l.092.12.074-.132c.282-.504.524-1.004.711-1.492.29-.753.442-1.442.45-2.017.007-.572-.129-1.045-.429-1.345zM3.712 7.055c.202.514.44 1.013.712 1.493l.074.13.092-.119a21.94 21.94 0 0 1 3.968-3.968l.12-.092-.132-.074C7.238 3.69 5.987 3.262 4.99 3.262c-.563 0-1.006.138-1.298.43-.3.301-.436.774-.428 1.346.007.575.159 1.264.448 2.017zm0 5.89c-.29.753-.44 1.442-.448 2.017-.008.572.127 1.045.428 1.345.293.293.736.431 1.298.431.997 0 2.247-.428 3.556-1.162l.131-.074-.12-.093a21.94 21.94 0 0 1-3.967-3.968l-.093-.12-.074.132a11.712 11.712 0 0 0-.71 1.492z" fill="currentColor" stroke="currentColor" stroke-width=".1"></path><path d="M10.706 11.704A1.843 1.843 0 0 1 8.155 10a1.845 1.845 0 1 1 2.551 1.704z" fill="currentColor" stroke="currentColor" stroke-width=".2"></path></svg></div>已深度思考（用时 59 秒）<div class="ds-icon _54f4262" style="font-size: 10px; width: 10px; height: 10px; transform: rotate(180deg);"><svg width="10" height="6" viewBox="0 0 10 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5.786 4.167L2.765 1.259c-.416-.4-.985-.482-1.273-.183-.287.298-.183.864.233 1.264l3.021 2.908c.416.4.986.482 1.273.184.287-.299.183-.865-.233-1.265z" fill="currentColor"></path><path d="M8.197 1.206L5.288 4.208c-.4.413-.484.982-.187 1.27.298.289.864.187 1.265-.227L9.274 2.25c.401-.414.485-.983.187-1.271-.297-.288-.863-.187-1.264.227z" fill="currentColor"></path></svg></div></div><div class="e1675d8b"><div class="_9ecc93a"></div>我们注意到在战斗逻辑中，当攻击方胜利时，我们不仅保留了所有进攻士兵，还额外添加了一组士兵（新功能2）。但根据最初的规则，应该是：<div style="height: 6px;"></div>   - 计算x = a - b，若x&gt;=0，则该方格被划归为入侵国领土，并具有x组入侵国士兵。<div style="height: 6px;"></div><div style="height: 6px;"></div> 然而，在实现新功能2（每占领敌国领土额外获得一组士兵）时，我们在胜利后添加了一组士兵，这导致了士兵数量增加。<div style="height: 6px;"></div><div style="height: 6px;"></div> 我们需要调整战斗逻辑，使其符合规则：<div style="height: 6px;"></div>  1. 攻击方胜利：保留x组士兵（x = a - b），然后再加上额外奖励的一组士兵？ <div style="height: 6px;"></div>  但是，规则中并没有额外奖励一组士兵，这是新功能2的要求。所以我们需要明确：<div style="height: 6px;"></div><div style="height: 6px;"></div> 新功能2要求：每占领一格他国领土，给占领国增加一组士兵。<div style="height: 6px;"></div><div style="height: 6px;"></div> 因此，在战斗胜利后，我们应该：<div style="height: 6px;"></div>   - 保留x组士兵（x = a - b）<div style="height: 6px;"></div>   - 然后，再额外增加一组士兵（作为奖励）<div style="height: 6px;"></div><div style="height: 6px;"></div> 这样，最终士兵数量为 (a-b) + 1<div style="height: 6px;"></div><div style="height: 6px;"></div> 但是，我们目前的实现是：保留所有进攻士兵（a组），然后再额外加一组，这显然太多了。<div style="height: 6px;"></div><div style="height: 6px;"></div> 让我们重新设计战斗逻辑（以玩家为例）：<div style="height: 6px;"></div><div style="height: 6px;"></div> 假设：<div style="height: 6px;"></div>   a = 攻击方士兵组数（即移动的士兵组数）<div style="height: 6px;"></div>   b = 防御方士兵组数<div style="height: 6px;"></div><div style="height: 6px;"></div> 战斗后：<div style="height: 6px;"></div>   if a &gt;= b:<div style="height: 6px;"></div>      攻击方胜利，领土变为攻击方所有<div style="height: 6px;"></div>      领土上剩余的士兵组数 = (a - b) + 1   [其中1是额外奖励]<div style="height: 6px;"></div>   else:<div style="height: 6px;"></div>      防御方胜利，领土仍属于防御方<div style="height: 6px;"></div>      领土上剩余的士兵组数 = (b - a)   [注意：这里没有奖励]<div style="height: 6px;"></div><div style="height: 6px;"></div> 但是，我们之前实现中，在攻击方胜利时，我们保留了所有a组士兵，然后再加上一组，变成了a+1，这显然不对。<div style="height: 6px;"></div><div style="height: 6px;"></div> 所以，我们需要修改：<div style="height: 6px;"></div><div style="height: 6px;"></div>  攻击方胜利时：<div style="height: 6px;"></div>      领土上的士兵组 = 移动过来的士兵组（数量a）中保留 (a - b) 组，然后再加上奖励的1组，总共 (a-b+1) 组。<div style="height: 6px;"></div><div style="height: 6px;"></div> 具体步骤：<div style="height: 6px;"></div>      1. 先移除防御方的b组士兵。<div style="height: 6px;"></div>      2. 从进攻方士兵中移除b组士兵（表示在战斗中损失）。<div style="height: 6px;"></div>      3. 然后，再添加1组新士兵（奖励）。<div style="height: 6px;"></div><div style="height: 6px;"></div> 但是，注意：我们移动的士兵组是一个列表，我们无法直接从中移除b组士兵（因为我们可能移动了a组士兵，但a-b可能大于0，我们保留a-b组）。<div style="height: 6px;"></div><div style="height: 6px;"></div> 因此，我们可以这样做：<div style="height: 6px;"></div>      - 首先，战斗后，防御方士兵全部被移除。<div style="height: 6px;"></div>      - 然后，进攻方士兵也损失b组（如果a&gt;=b，则进攻方损失b组，保留a-b组）。<div style="height: 6px;"></div>      - 最后，在领土上添加1组新士兵（奖励）。<div style="height: 6px;"></div><div style="height: 6px;"></div> 所以，最终士兵组数 = (a - b) + 1<div style="height: 6px;"></div><div style="height: 6px;"></div> 在代码中，我们可以：<div style="height: 6px;"></div><div style="height: 6px;"></div>      # 攻击方胜利<div style="height: 6px;"></div>      tile['country'] = self.player_country<div style="height: 6px;"></div>      # 进攻方保留 a-b 组士兵<div style="height: 6px;"></div>      remaining_attacking_troops = moving_troops[0:(a - b)]   # 取前(a-b)组<div style="height: 6px;"></div>      # 额外奖励一组士兵<div style="height: 6px;"></div>      new_troop = [x, y]<div style="height: 6px;"></div>      # 设置领土上的士兵组<div style="height: 6px;"></div>      tile['troops'] = remaining_attacking_troops + [new_troop]<div style="height: 6px;"></div><div style="height: 6px;"></div>      # 更新玩家士兵列表：移除在战斗中损失的b组士兵（即 moving_troops 中除了保留的，其余都移除）<div style="height: 6px;"></div>      # 注意：我们移动的士兵组 moving_troops 中，有b组被消耗了，剩下的a-b组保留，再加上新的一组<div style="height: 6px;"></div>      # 所以，玩家士兵列表需要移除那些被消耗的士兵组（即 moving_troops 中保留部分以外的部分）？ <div style="height: 6px;"></div>      # 实际上，我们可以这样：先将移动的士兵组全部从玩家士兵列表中移除，然后再加上保留的士兵组和新士兵组。<div style="height: 6px;"></div><div style="height: 6px;"></div> 但是，这样处理比较复杂。我们可以调整思路：<div style="height: 6px;"></div><div style="height: 6px;"></div>  在移动士兵组时，我们先将移动的士兵组从玩家士兵列表中移除（在移动函数中已经做了）。然后，在战斗胜利后，我们将保留的士兵组和新士兵组添加到玩家士兵列表中。<div style="height: 6px;"></div><div style="height: 6px;"></div> 所以，在战斗胜利后，我们需要：<div style="height: 6px;"></div>      # 移除移动士兵组中未保留的部分（即被消耗的士兵组）已经在移动过程中移除了，现在只需要添加保留的士兵组和新士兵组。<div style="height: 6px;"></div>      # 但是，在移动函数中，我们已经将移动的士兵组全部从玩家士兵列表中移除了。所以，现在我们要将保留的士兵组和新士兵组加回去。<div style="height: 6px;"></div><div style="height: 6px;"></div> 步骤：<div style="height: 6px;"></div><div style="height: 6px;"></div>      1. 在移动函数中，移动的士兵组已经被从玩家士兵列表中移除。<div style="height: 6px;"></div>      2. 战斗胜利后，我们保留 remaining_attacking_troops（数量为a-b）和一组新士兵 new_troop。<div style="height: 6px;"></div>      3. 将这两部分添加到玩家士兵列表中。<div style="height: 6px;"></div><div style="height: 6px;"></div> 因此，代码修改如下（以玩家为例）：<div style="height: 6px;"></div><div style="height: 6px;"></div>      # 计算a和b<div style="height: 6px;"></div>      a = len(attacking_troops)<div style="height: 6px;"></div>      b = len(defending_troops)<div style="height: 6px;"></div><div style="height: 6px;"></div>      if a &gt;= b:<div style="height: 6px;"></div>          # 进攻方胜利<div style="height: 6px;"></div>          # 保留的士兵组<div style="height: 6px;"></div>          remaining_attacking_troops = attacking_troops[0: a - b]<div style="height: 6px;"></div>          # 额外奖励一组士兵<div style="height: 6px;"></div>          new_troop = [x, y]<div style="height: 6px;"></div>          # 设置领土上的士兵组<div style="height: 6px;"></div>          tile['troops'] = remaining_attacking_troops + [new_troop]<div style="height: 6px;"></div>          # 更新玩家士兵列表：添加保留的士兵组和新的士兵组<div style="height: 6px;"></div>          self.player_country.troops.extend(remaining_attacking_troops)<div style="height: 6px;"></div>          self.player_country.troops.append(new_troop)<div style="height: 6px;"></div><div style="height: 6px;"></div>          # 领土变更<div style="height: 6px;"></div>          # ...（同之前）<div style="height: 6px;"></div><div style="height: 6px;"></div>      else:<div style="height: 6px;"></div>          # 防御方胜利<div style="height: 6px;"></div>          # ...（不需要奖励）<div style="height: 6px;"></div><div style="height: 6px;"></div> 同时，防御方胜利时，我们不需要添加奖励士兵。<div style="height: 6px;"></div><div style="height: 6px;"></div> 注意：防御方胜利时，我们只保留 b - a 组士兵（即防御方剩余的士兵组），但是我们在之前的实现中是随机移除a组士兵（因为进攻方数量为a，防御方损失a组）。这符合规则：防御方剩余 b - a 组士兵。<div style="height: 6px;"></div><div style="height: 6px;"></div> 所以，防御方不需要修改。<div style="height: 6px;"></div><div style="height: 6px;"></div> 另外，对于AI的战斗逻辑，我们也要做同样的修改。<div style="height: 6px;"></div><div style="height: 6px;"></div> 由于改动较大，我将重新编写战斗逻辑部分。<div style="height: 6px;"></div><div style="height: 6px;"></div> 同时，我们也要注意：在战斗过程中，防御方的士兵组应该被全部移除（因为他们被击败了），但是我们在胜利后并没有立即移除，而是在更新领土时处理。所以，在攻击方胜利时，我们需要清除防御方的士兵组。<div style="height: 6px;"></div><div style="height: 6px;"></div> 具体修改如下：<div style="height: 6px;"></div><div style="height: 6px;"></div> 在 `resolve_battle` 方法中（玩家攻击）：</div></div><div class="ds-markdown ds-markdown--block" style="--ds-md-zoom: 1.143;"><p class="ds-markdown-paragraph">您指出了一个严重的问题，我将修复战斗逻辑，使其符合最初的游戏规则。以下是修复后的完整代码：</p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre><span class="token keyword">import</span> pygame
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> random
<span class="token keyword">import</span> math
<span class="token keyword">from</span> pygame<span class="token punctuation">.</span><span class="token builtin">locals</span> <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token comment"># 初始化pygame</span>
pygame<span class="token punctuation">.</span>init<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 游戏常量</span>
SCREEN_WIDTH <span class="token operator">=</span> <span class="token number">1000</span>
SCREEN_HEIGHT <span class="token operator">=</span> <span class="token number">700</span>
GRID_SIZE <span class="token operator">=</span> <span class="token number">20</span>
GRID_WIDTH <span class="token operator">=</span> <span class="token number">40</span>
GRID_HEIGHT <span class="token operator">=</span> <span class="token number">30</span>
TILE_SIZE <span class="token operator">=</span> <span class="token number">20</span>

<span class="token comment"># 尝试加载中文字体</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token comment"># 尝试常见的中文字体</span>
    FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token string">"SimHei"</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
    LARGE_FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token string">"SimHei"</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>
    SMALL_FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token string">"SimHei"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>
<span class="token keyword">except</span><span class="token punctuation">:</span>
    <span class="token comment"># 回退到默认字体</span>
    FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
    LARGE_FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>
    SMALL_FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>

<span class="token comment"># 颜色</span>
BACKGROUND <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
GRID_COLOR <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
WHITE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
BLACK <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
RED <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
GREEN <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
BLUE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
YELLOW <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
PURPLE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
CYAN <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
ORANGE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">165</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
PINK <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span>
COLORS <span class="token operator">=</span> <span class="token punctuation">[</span>RED<span class="token punctuation">,</span> BLUE<span class="token punctuation">,</span> YELLOW<span class="token punctuation">,</span> PURPLE<span class="token punctuation">,</span> CYAN<span class="token punctuation">,</span> ORANGE<span class="token punctuation">,</span> PINK<span class="token punctuation">]</span>  <span class="token comment"># 增加更多颜色</span>
HIGHLIGHT <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
NEUTRAL_COLOR <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>  <span class="token comment"># 中立领土颜色</span>

<span class="token keyword">class</span> <span class="token class-name">Country</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> color<span class="token punctuation">,</span> name<span class="token punctuation">,</span> is_player<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>color <span class="token operator">=</span> color
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>is_player <span class="token operator">=</span> is_player
        self<span class="token punctuation">.</span>territory <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># 存储士兵组的位置坐标</span>
        self<span class="token punctuation">.</span>next_reward <span class="token operator">=</span> <span class="token number">3</span>
        self<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">add_territory</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> game<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""增加领土并检查是否应生成新士兵组"""</span>
        <span class="token comment"># 每占领3块领土获得一个新的士兵组</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>territory <span class="token operator">&gt;=</span> self<span class="token punctuation">.</span>next_reward<span class="token punctuation">:</span>
            <span class="token comment"># 更新奖励阈值</span>
            self<span class="token punctuation">.</span>next_reward <span class="token operator">+=</span> <span class="token number">3</span>
            
            <span class="token comment"># 在随机领土上生成新士兵组</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                <span class="token comment"># 收集所有安全的领土位置（仅限己方领土且无士兵重叠）</span>
                safe_positions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">if</span> game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token keyword">and</span> game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> self<span class="token punctuation">:</span>
                            <span class="token comment"># 确保不在他国领土上</span>
                            is_safe <span class="token operator">=</span> <span class="token boolean">True</span>
                            <span class="token keyword">for</span> dx<span class="token punctuation">,</span> dy <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                                nx<span class="token punctuation">,</span> ny <span class="token operator">=</span> x <span class="token operator">+</span> dx<span class="token punctuation">,</span> y <span class="token operator">+</span> dy
                                <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> nx <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> ny <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">:</span>
                                    <span class="token keyword">if</span> game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>ny<span class="token punctuation">]</span><span class="token punctuation">[</span>nx<span class="token punctuation">]</span> <span class="token keyword">and</span> game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>ny<span class="token punctuation">]</span><span class="token punctuation">[</span>nx<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> self<span class="token punctuation">:</span>
                                        is_safe <span class="token operator">=</span> <span class="token boolean">False</span>
                                        <span class="token keyword">break</span>
                            
                            <span class="token keyword">if</span> is_safe<span class="token punctuation">:</span>
                                safe_positions<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
                
                <span class="token keyword">if</span> safe_positions<span class="token punctuation">:</span>
                    <span class="token comment"># 随机选择一个安全位置</span>
                    x<span class="token punctuation">,</span> y <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>safe_positions<span class="token punctuation">)</span>
                    
                    <span class="token comment"># 创建新士兵组</span>
                    new_troop <span class="token operator">=</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span>
                    
                    <span class="token comment"># 添加到国家士兵列表</span>
                    self<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_troop<span class="token punctuation">)</span>
                    
                    <span class="token comment"># 添加到网格</span>
                    game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_troop<span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

<span class="token keyword">class</span> <span class="token class-name">Game</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>screen <span class="token operator">=</span> pygame<span class="token punctuation">.</span>display<span class="token punctuation">.</span>set_mode<span class="token punctuation">(</span><span class="token punctuation">(</span>SCREEN_WIDTH<span class="token punctuation">,</span> SCREEN_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">)</span>
        pygame<span class="token punctuation">.</span>display<span class="token punctuation">.</span>set_caption<span class="token punctuation">(</span><span class="token string">"领土征服者"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>clock <span class="token operator">=</span> pygame<span class="token punctuation">.</span>time<span class="token punctuation">.</span>Clock<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 创建国家</span>
        self<span class="token punctuation">.</span>countries <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>player_country <span class="token operator">=</span> Country<span class="token punctuation">(</span>GREEN<span class="token punctuation">,</span> <span class="token string">"玩家"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>countries<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>player_country<span class="token punctuation">)</span>
        
        <span class="token comment"># 创建电脑国家 (使用不同颜色)</span>
        ai_names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"红国"</span><span class="token punctuation">,</span> <span class="token string">"蓝国"</span><span class="token punctuation">,</span> <span class="token string">"黄国"</span><span class="token punctuation">,</span> <span class="token string">"紫国"</span><span class="token punctuation">,</span> <span class="token string">"青国"</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 创建5个电脑国家</span>
            color_idx <span class="token operator">=</span> i <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>COLORS<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>countries<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Country<span class="token punctuation">(</span>COLORS<span class="token punctuation">[</span>color_idx<span class="token punctuation">]</span><span class="token punctuation">,</span> ai_names<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 初始化网格</span>
        self<span class="token punctuation">.</span>grid <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token boolean">None</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>selected_tile <span class="token operator">=</span> <span class="token boolean">None</span>  <span class="token comment"># 改为选择整个方格</span>
        self<span class="token punctuation">.</span>game_over <span class="token operator">=</span> <span class="token boolean">False</span>
        self<span class="token punctuation">.</span>winner <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>turn_count <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 回合计数器</span>
        
        <span class="token comment"># 初始化领土和士兵</span>
        self<span class="token punctuation">.</span>initialize_game<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">initialize_game</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 为每个国家分配初始领土</span>
        positions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>countries<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
                x <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> GRID_WIDTH <span class="token operator">-</span> <span class="token number">6</span><span class="token punctuation">)</span>
                y <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">-</span> <span class="token number">6</span><span class="token punctuation">)</span>
                <span class="token comment"># 确保初始位置不重叠且有一定间距</span>
                too_close <span class="token operator">=</span> <span class="token boolean">False</span>
                <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> positions<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>px <span class="token operator">-</span> x<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">8</span> <span class="token keyword">and</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>py <span class="token operator">-</span> y<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">:</span>
                        too_close <span class="token operator">=</span> <span class="token boolean">True</span>
                        <span class="token keyword">break</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> too_close <span class="token keyword">and</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">not</span> <span class="token keyword">in</span> positions<span class="token punctuation">:</span>
                    positions<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
                        <span class="token string">'country'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>countries<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token string">'troops'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">]</span>  <span class="token comment"># 初始士兵组</span>
                    <span class="token punctuation">}</span>
                    self<span class="token punctuation">.</span>countries<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>territory <span class="token operator">=</span> <span class="token number">1</span>
                    self<span class="token punctuation">.</span>countries<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">]</span>
                    self<span class="token punctuation">.</span>countries<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>next_reward <span class="token operator">=</span> <span class="token number">3</span>
                    <span class="token keyword">break</span>
    
    <span class="token keyword">def</span> <span class="token function">draw_grid</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 绘制网格背景</span>
        self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>fill<span class="token punctuation">(</span>BACKGROUND<span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制网格线</span>
        <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> SCREEN_WIDTH<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">:</span>
            pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>line<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> GRID_COLOR<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">:</span>
            pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>line<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> GRID_COLOR<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>SCREEN_WIDTH<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制领土和士兵</span>
        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span>
                <span class="token keyword">if</span> tile<span class="token punctuation">:</span>
                    <span class="token comment"># 确保国家对象存在</span>
                    <span class="token keyword">if</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                        rect <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Rect<span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span>
                        pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>color<span class="token punctuation">,</span> rect<span class="token punctuation">)</span>
                        
                        <span class="token comment"># 绘制士兵组</span>
                        troop_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                        <span class="token keyword">if</span> troop_count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                            pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> WHITE<span class="token punctuation">,</span> 
                                            <span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                            TILE_SIZE<span class="token operator">//</span><span class="token number">3</span><span class="token punctuation">)</span>
                            text <span class="token operator">=</span> FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>troop_count<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span>
                            text_rect <span class="token operator">=</span> text<span class="token punctuation">.</span>get_rect<span class="token punctuation">(</span>center<span class="token operator">=</span><span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>text<span class="token punctuation">,</span> text_rect<span class="token punctuation">)</span>
                    <span class="token keyword">else</span><span class="token punctuation">:</span>
                        <span class="token comment"># 绘制中立领土</span>
                        rect <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Rect<span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span>
                        pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> NEUTRAL_COLOR<span class="token punctuation">,</span> rect<span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制选中的方格</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>selected_tile<span class="token punctuation">:</span>
            x<span class="token punctuation">,</span> y <span class="token operator">=</span> self<span class="token punctuation">.</span>selected_tile
            rect <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Rect<span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span>
            pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> HIGHLIGHT<span class="token punctuation">,</span> rect<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 绘制可移动范围 (距离2格)</span>
            <span class="token keyword">for</span> dx<span class="token punctuation">,</span> dy <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 相邻格子</span>
                          <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>  <span class="token comment"># 距离2格</span>
                nx<span class="token punctuation">,</span> ny <span class="token operator">=</span> x <span class="token operator">+</span> dx<span class="token punctuation">,</span> y <span class="token operator">+</span> dy
                <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> nx <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> ny <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">:</span>
                    rect <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Rect<span class="token punctuation">(</span>nx <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> ny <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span>
                    pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rect<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制信息面板</span>
        info_panel_y <span class="token operator">=</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE
        info_panel_height <span class="token operator">=</span> SCREEN_HEIGHT <span class="token operator">-</span> info_panel_y
        pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> info_panel_y<span class="token punctuation">,</span> SCREEN_WIDTH<span class="token punctuation">,</span> info_panel_height<span class="token punctuation">)</span><span class="token punctuation">)</span>
        pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>line<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> WHITE<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> info_panel_y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>SCREEN_WIDTH<span class="token punctuation">,</span> info_panel_y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制玩家信息</span>
        player_text <span class="token operator">=</span> LARGE_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"玩家领土: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>territory<span class="token punctuation">}</span></span><span class="token string">  下一奖励: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>next_reward<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> GREEN<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>player_text<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> info_panel_y <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制游戏说明</span>
        instructions <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string">"游戏说明:"</span><span class="token punctuation">,</span>
            <span class="token string">"1. 点击自己的领土选择士兵"</span><span class="token punctuation">,</span>
            <span class="token string">"2. 点击相邻格子移动所有士兵 (可移动1-2格)"</span><span class="token punctuation">,</span>
            <span class="token string">"3. 每占领3块领土获得一个新士兵组"</span><span class="token punctuation">,</span>
            <span class="token string">"4. 战斗规则: 比较双方士兵总数，差值决定胜负"</span><span class="token punctuation">,</span>
            <span class="token string">"5. 目标: 消灭所有其他国家"</span>
        <span class="token punctuation">]</span>
        
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> text <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>instructions<span class="token punctuation">)</span><span class="token punctuation">:</span>
            rendered <span class="token operator">=</span> SMALL_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> WHITE<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>rendered<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> info_panel_y <span class="token operator">+</span> <span class="token number">60</span> <span class="token operator">+</span> i <span class="token operator">*</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制电脑国家信息 (分两列显示)</span>
        ai_info <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> country <span class="token keyword">in</span> self<span class="token punctuation">.</span>countries<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> country<span class="token punctuation">.</span>is_player <span class="token keyword">and</span> <span class="token keyword">not</span> country<span class="token punctuation">.</span>defeated<span class="token punctuation">:</span>
                ai_info<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>country<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>country<span class="token punctuation">.</span>territory<span class="token punctuation">}</span></span><span class="token string">领土"</span></span><span class="token punctuation">)</span>
        
        <span class="token comment"># 第一列</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>ai_info<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            ai_text1 <span class="token operator">=</span> SMALL_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">"电脑国家: "</span> <span class="token operator">+</span> <span class="token string">", "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>ai_info<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> YELLOW<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>ai_text1<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> info_panel_y <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 第二列</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>ai_info<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">:</span>
            ai_text2 <span class="token operator">=</span> SMALL_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>ai_info<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> YELLOW<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>ai_text2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> info_panel_y <span class="token operator">+</span> <span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 回合计数</span>
        turn_text <span class="token operator">=</span> SMALL_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"回合: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>turn_count<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> CYAN<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>turn_text<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> info_panel_y <span class="token operator">+</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制游戏结束信息</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>game_over<span class="token punctuation">:</span>
            overlay <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Surface<span class="token punctuation">(</span><span class="token punctuation">(</span>SCREEN_WIDTH<span class="token punctuation">,</span> SCREEN_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">,</span> pygame<span class="token punctuation">.</span>SRCALPHA<span class="token punctuation">)</span>
            overlay<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>overlay<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>winner<span class="token punctuation">.</span>is_player<span class="token punctuation">:</span>
                text <span class="token operator">=</span> LARGE_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">"恭喜！你赢得了战争！"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> GREEN<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                text <span class="token operator">=</span> LARGE_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>winner<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">赢得了战争！"</span></span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>winner<span class="token punctuation">.</span>color<span class="token punctuation">)</span>
            
            restart <span class="token operator">=</span> FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">"按R键重新开始游戏"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> WHITE<span class="token punctuation">)</span>
            
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token punctuation">(</span>SCREEN_WIDTH<span class="token operator">//</span><span class="token number">2</span> <span class="token operator">-</span> text<span class="token punctuation">.</span>get_width<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> SCREEN_HEIGHT<span class="token operator">//</span><span class="token number">2</span> <span class="token operator">-</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>restart<span class="token punctuation">,</span> <span class="token punctuation">(</span>SCREEN_WIDTH<span class="token operator">//</span><span class="token number">2</span> <span class="token operator">-</span> restart<span class="token punctuation">.</span>get_width<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> SCREEN_HEIGHT<span class="token operator">//</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">handle_click</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>game_over<span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        grid_x <span class="token operator">=</span> pos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">//</span> TILE_SIZE
        grid_y <span class="token operator">=</span> pos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">//</span> TILE_SIZE
        
        <span class="token comment"># 确保点击在网格范围内</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;=</span> grid_x <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> grid_y <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        <span class="token comment"># 选择整个方格</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>selected_tile <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>grid_y<span class="token punctuation">]</span><span class="token punctuation">[</span>grid_x<span class="token punctuation">]</span>
            <span class="token keyword">if</span> tile <span class="token keyword">and</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">:</span>
                <span class="token comment"># 检查该位置是否有玩家士兵组</span>
                <span class="token keyword">if</span> tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>selected_tile <span class="token operator">=</span> <span class="token punctuation">(</span>grid_x<span class="token punctuation">,</span> grid_y<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># 移动士兵组</span>
            selected_x<span class="token punctuation">,</span> selected_y <span class="token operator">=</span> self<span class="token punctuation">.</span>selected_tile
            
            <span class="token comment"># 检查是否在移动范围内 (曼哈顿距离 &lt;= 2 且在同一行或列)</span>
            dx <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>grid_x <span class="token operator">-</span> selected_x<span class="token punctuation">)</span>
            dy <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>grid_y <span class="token operator">-</span> selected_y<span class="token punctuation">)</span>
            
            <span class="token comment"># 只能水平或垂直移动，距离1-2格</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>dx <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">or</span> dx <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">and</span> dy <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>dy <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">or</span> dy <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">and</span> dx <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>move_troops<span class="token punctuation">(</span>selected_x<span class="token punctuation">,</span> selected_y<span class="token punctuation">,</span> grid_x<span class="token punctuation">,</span> grid_y<span class="token punctuation">)</span>
            
            self<span class="token punctuation">.</span>selected_tile <span class="token operator">=</span> <span class="token boolean">None</span>
    
    <span class="token keyword">def</span> <span class="token function">move_troops</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> from_x<span class="token punctuation">,</span> from_y<span class="token punctuation">,</span> to_x<span class="token punctuation">,</span> to_y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 获取原方格信息</span>
        from_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>from_y<span class="token punctuation">]</span><span class="token punctuation">[</span>from_x<span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> from_tile <span class="token keyword">or</span> <span class="token keyword">not</span> from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        <span class="token comment"># 获取要移动的所有士兵组</span>
        moving_troops <span class="token operator">=</span> from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>  <span class="token comment"># 复制列表</span>
        
        <span class="token comment"># 从原位置移除所有士兵组</span>
        from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> troop <span class="token keyword">in</span> moving_troops<span class="token punctuation">:</span>
            <span class="token keyword">if</span> troop <span class="token keyword">in</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop<span class="token punctuation">)</span>
        
        <span class="token comment"># 更新士兵组位置</span>
        <span class="token keyword">for</span> troop <span class="token keyword">in</span> moving_troops<span class="token punctuation">:</span>
            troop<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_x
            troop<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_y
        
        <span class="token comment"># 添加到新位置</span>
        to_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>to_y<span class="token punctuation">]</span><span class="token punctuation">[</span>to_x<span class="token punctuation">]</span>
        
        <span class="token keyword">if</span> <span class="token keyword">not</span> to_tile<span class="token punctuation">:</span>
            <span class="token comment"># 占领新领土</span>
            self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>to_y<span class="token punctuation">]</span><span class="token punctuation">[</span>to_x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'country'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">,</span>
                <span class="token string">'troops'</span><span class="token punctuation">:</span> moving_troops
            <span class="token punctuation">}</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>territory <span class="token operator">+=</span> <span class="token number">1</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
            <span class="token comment"># 检查是否应获得新士兵组</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">:</span>
                <span class="token comment"># 合并到友方领土</span>
                to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>extend<span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># 与敌方发生战斗</span>
                self<span class="token punctuation">.</span>resolve_battle<span class="token punctuation">(</span>to_x<span class="token punctuation">,</span> to_y<span class="token punctuation">,</span> moving_troops<span class="token punctuation">)</span>
        
        <span class="token comment"># 电脑回合</span>
        self<span class="token punctuation">.</span>ai_turn<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>turn_count <span class="token operator">+=</span> <span class="token number">1</span>
        
        <span class="token comment"># 检查游戏是否结束</span>
        self<span class="token punctuation">.</span>check_game_over<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">resolve_battle</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> attacking_troops<span class="token punctuation">)</span><span class="token punctuation">:</span>
        tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span>
        defending_country <span class="token operator">=</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span>
        defending_troops <span class="token operator">=</span> tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
        attacking_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>attacking_troops<span class="token punctuation">)</span>
        defending_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>defending_troops<span class="token punctuation">)</span>
        
        <span class="token comment"># 计算战斗结果</span>
        difference <span class="token operator">=</span> attacking_count <span class="token operator">-</span> defending_count
        
        <span class="token keyword">if</span> difference <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token comment"># 攻击方胜利</span>
            tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>player_country
            
            <span class="token comment"># 保留差值数量的士兵组</span>
            remaining_attacking_troops <span class="token operator">=</span> attacking_troops<span class="token punctuation">[</span><span class="token punctuation">:</span>difference<span class="token punctuation">]</span> <span class="token keyword">if</span> difference <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            
            <span class="token comment"># 设置领土上的士兵组</span>
            tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> remaining_attacking_troops
            
            <span class="token comment"># 更新玩家士兵列表</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>remaining_attacking_troops<span class="token punctuation">)</span>
            
            <span class="token comment"># 领土变更</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>territory <span class="token operator">+=</span> <span class="token number">1</span>
            <span class="token keyword">if</span> defending_country<span class="token punctuation">:</span>
                defending_country<span class="token punctuation">.</span>territory <span class="token operator">-=</span> <span class="token number">1</span>
                <span class="token comment"># 检查防御方是否被击败</span>
                <span class="token keyword">if</span> defending_country<span class="token punctuation">.</span>territory <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    defending_country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">True</span>
                    <span class="token comment"># 移除所有该国家的领土</span>
                    <span class="token keyword">for</span> y2 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">for</span> x2 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                            tile2 <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y2<span class="token punctuation">]</span><span class="token punctuation">[</span>x2<span class="token punctuation">]</span>
                            <span class="token keyword">if</span> tile2 <span class="token keyword">and</span> tile2<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> defending_country<span class="token punctuation">:</span>
                                tile2<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
            
            <span class="token comment"># 检查是否应获得新士兵组</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># 防御方胜利</span>
            <span class="token comment"># 移除所有进攻方士兵组</span>
            <span class="token keyword">for</span> troop <span class="token keyword">in</span> attacking_troops<span class="token punctuation">:</span>
                <span class="token keyword">if</span> troop <span class="token keyword">in</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop<span class="token punctuation">)</span>
            
            <span class="token comment"># 防御方损失士兵组数量等于进攻方数量</span>
            <span class="token keyword">if</span> defending_troops<span class="token punctuation">:</span>
                <span class="token comment"># 随机移除防御方士兵组</span>
                remove_count <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>defending_troops<span class="token punctuation">)</span><span class="token punctuation">,</span> attacking_count<span class="token punctuation">)</span>
                removed_troops <span class="token operator">=</span> random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>defending_troops<span class="token punctuation">,</span> remove_count<span class="token punctuation">)</span>
                
                <span class="token comment"># 更新防御方士兵</span>
                tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>t <span class="token keyword">for</span> t <span class="token keyword">in</span> defending_troops <span class="token keyword">if</span> t <span class="token keyword">not</span> <span class="token keyword">in</span> removed_troops<span class="token punctuation">]</span>
                <span class="token keyword">if</span> defending_country<span class="token punctuation">:</span>
                    defending_country<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span>t <span class="token keyword">for</span> t <span class="token keyword">in</span> defending_country<span class="token punctuation">.</span>troops <span class="token keyword">if</span> t <span class="token keyword">not</span> <span class="token keyword">in</span> removed_troops<span class="token punctuation">]</span>
                
                <span class="token keyword">if</span> <span class="token keyword">not</span> tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                    <span class="token comment"># 如果防御方没有士兵了，领土变为中立</span>
                    tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
                    <span class="token keyword">if</span> defending_country<span class="token punctuation">:</span>
                        defending_country<span class="token punctuation">.</span>territory <span class="token operator">-=</span> <span class="token number">1</span>
                        <span class="token keyword">if</span> defending_country<span class="token punctuation">.</span>territory <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                            defending_country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">True</span>
                            <span class="token comment"># 移除所有该国家的领土</span>
                            <span class="token keyword">for</span> y2 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
                                <span class="token keyword">for</span> x2 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                                    t <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y2<span class="token punctuation">]</span><span class="token punctuation">[</span>x2<span class="token punctuation">]</span>
                                    <span class="token keyword">if</span> t <span class="token keyword">and</span> t<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> defending_country<span class="token punctuation">:</span>
                                        t<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
    
    <span class="token keyword">def</span> <span class="token function">ai_turn</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> country <span class="token keyword">in</span> self<span class="token punctuation">.</span>countries<span class="token punctuation">:</span>
            <span class="token keyword">if</span> country<span class="token punctuation">.</span>is_player <span class="token keyword">or</span> country<span class="token punctuation">.</span>defeated<span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            
            <span class="token comment"># 收集所有可能的移动</span>
            possible_moves <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            
            <span class="token comment"># 收集所有边境格子（与敌方或空白相邻的格子）</span>
            border_tiles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span>
                    <span class="token keyword">if</span> tile <span class="token keyword">and</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> country <span class="token keyword">and</span> tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                        <span class="token comment"># 检查是否在边境</span>
                        is_border <span class="token operator">=</span> <span class="token boolean">False</span>
                        <span class="token keyword">for</span> dx<span class="token punctuation">,</span> dy <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                            nx<span class="token punctuation">,</span> ny <span class="token operator">=</span> x <span class="token operator">+</span> dx<span class="token punctuation">,</span> y <span class="token operator">+</span> dy
                            <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> nx <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> ny <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">:</span>
                                neighbor <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>ny<span class="token punctuation">]</span><span class="token punctuation">[</span>nx<span class="token punctuation">]</span>
                                <span class="token keyword">if</span> <span class="token keyword">not</span> neighbor <span class="token keyword">or</span> <span class="token punctuation">(</span>neighbor<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token keyword">and</span> neighbor<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> country<span class="token punctuation">)</span><span class="token punctuation">:</span>
                                    is_border <span class="token operator">=</span> <span class="token boolean">True</span>
                                    <span class="token keyword">break</span>
                        
                        <span class="token keyword">if</span> is_border<span class="token punctuation">:</span>
                            border_tiles<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> <span class="token keyword">not</span> border_tiles<span class="token punctuation">:</span>
                <span class="token comment"># 如果没有边境格子，使用所有有士兵的格子</span>
                <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                        tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span>
                        <span class="token keyword">if</span> tile <span class="token keyword">and</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> country <span class="token keyword">and</span> tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                            border_tiles<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 尝试每个边境格子</span>
            random<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>border_tiles<span class="token punctuation">)</span>
            moved <span class="token operator">=</span> <span class="token boolean">False</span>
            
            <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> border_tiles<span class="token punctuation">:</span>
                tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span>
                <span class="token comment"># 检查该格子是否还有士兵（可能在之前的移动中已被移动）</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> tile <span class="token keyword">or</span> <span class="token keyword">not</span> tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token keyword">or</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> country<span class="token punctuation">:</span>
                    <span class="token keyword">continue</span>
                
                <span class="token comment"># 收集可能的移动目标</span>
                targets <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                
                <span class="token comment"># 检查所有可能的方向（1-2格距离）</span>
                <span class="token keyword">for</span> dx<span class="token punctuation">,</span> dy <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                    nx<span class="token punctuation">,</span> ny <span class="token operator">=</span> x <span class="token operator">+</span> dx<span class="token punctuation">,</span> y <span class="token operator">+</span> dy
                    <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> nx <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> ny <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">:</span>
                        targets<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>nx<span class="token punctuation">,</span> ny<span class="token punctuation">)</span><span class="token punctuation">)</span>
                
                <span class="token comment"># 随机打乱目标顺序</span>
                random<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>targets<span class="token punctuation">)</span>
                
                <span class="token keyword">for</span> tx<span class="token punctuation">,</span> ty <span class="token keyword">in</span> targets<span class="token punctuation">:</span>
                    <span class="token comment"># 获取目标格子</span>
                    target_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>ty<span class="token punctuation">]</span><span class="token punctuation">[</span>tx<span class="token punctuation">]</span>
                    
                    <span class="token comment"># 如果是空白格子，直接占领</span>
                    <span class="token keyword">if</span> <span class="token keyword">not</span> target_tile<span class="token punctuation">:</span>
                        self<span class="token punctuation">.</span>ai_move<span class="token punctuation">(</span>country<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> tx<span class="token punctuation">,</span> ty<span class="token punctuation">)</span>
                        moved <span class="token operator">=</span> <span class="token boolean">True</span>
                        <span class="token keyword">break</span>
                    
                    <span class="token comment"># 如果是敌方格子，评估实力</span>
                    <span class="token keyword">if</span> target_tile <span class="token keyword">and</span> target_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token keyword">and</span> target_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> country<span class="token punctuation">:</span>
                        <span class="token comment"># 获取边境实力</span>
                        my_strength <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                        enemy_strength <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>target_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                        
                        <span class="token comment"># 增强策略性 - 只在实力足够时进攻</span>
                        <span class="token keyword">if</span> my_strength <span class="token operator">&gt;</span> enemy_strength<span class="token punctuation">:</span>
                            self<span class="token punctuation">.</span>ai_move<span class="token punctuation">(</span>country<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> tx<span class="token punctuation">,</span> ty<span class="token punctuation">)</span>
                            moved <span class="token operator">=</span> <span class="token boolean">True</span>
                            <span class="token keyword">break</span>
                
                <span class="token keyword">if</span> moved<span class="token punctuation">:</span>
                    <span class="token keyword">break</span>
    
    <span class="token keyword">def</span> <span class="token function">ai_move</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> country<span class="token punctuation">,</span> from_x<span class="token punctuation">,</span> from_y<span class="token punctuation">,</span> to_x<span class="token punctuation">,</span> to_y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 获取原方格信息</span>
        from_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>from_y<span class="token punctuation">]</span><span class="token punctuation">[</span>from_x<span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> from_tile <span class="token keyword">or</span> <span class="token keyword">not</span> from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        <span class="token comment"># 获取要移动的所有士兵组</span>
        moving_troops <span class="token operator">=</span> from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>  <span class="token comment"># 复制列表</span>
        
        <span class="token comment"># 从原位置移除所有士兵组</span>
        from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> troop <span class="token keyword">in</span> moving_troops<span class="token punctuation">:</span>
            <span class="token keyword">if</span> troop <span class="token keyword">in</span> country<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop<span class="token punctuation">)</span>
        
        <span class="token comment"># 更新士兵组位置</span>
        <span class="token keyword">for</span> troop <span class="token keyword">in</span> moving_troops<span class="token punctuation">:</span>
            troop<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_x
            troop<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_y
        
        <span class="token comment"># 添加到新位置</span>
        to_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>to_y<span class="token punctuation">]</span><span class="token punctuation">[</span>to_x<span class="token punctuation">]</span>
        
        <span class="token keyword">if</span> <span class="token keyword">not</span> to_tile<span class="token punctuation">:</span>
            <span class="token comment"># 占领新领土</span>
            self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>to_y<span class="token punctuation">]</span><span class="token punctuation">[</span>to_x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'country'</span><span class="token punctuation">:</span> country<span class="token punctuation">,</span>
                <span class="token string">'troops'</span><span class="token punctuation">:</span> moving_troops
            <span class="token punctuation">}</span>
            country<span class="token punctuation">.</span>territory <span class="token operator">+=</span> <span class="token number">1</span>
            country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
            <span class="token comment"># 检查是否应获得新士兵组</span>
            country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> country<span class="token punctuation">:</span>
                <span class="token comment"># 合并到友方领土</span>
                to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>extend<span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
                country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># 与敌方发生战斗</span>
                defending_country <span class="token operator">=</span> to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token keyword">if</span> to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token keyword">else</span> <span class="token boolean">None</span>
                defending_troops <span class="token operator">=</span> to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
                attacking_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
                defending_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>defending_troops<span class="token punctuation">)</span>
                
                difference <span class="token operator">=</span> attacking_count <span class="token operator">-</span> defending_count
                
                <span class="token keyword">if</span> difference <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    <span class="token comment"># 攻击方胜利</span>
                    to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> country
                    
                    <span class="token comment"># 保留差值数量的士兵组</span>
                    remaining_attacking_troops <span class="token operator">=</span> moving_troops<span class="token punctuation">[</span><span class="token punctuation">:</span>difference<span class="token punctuation">]</span> <span class="token keyword">if</span> difference <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                    
                    <span class="token comment"># 设置领土上的士兵组</span>
                    to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> remaining_attacking_troops
                    
                    <span class="token comment"># 更新国家士兵列表</span>
                    country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>remaining_attacking_troops<span class="token punctuation">)</span>
                    
                    <span class="token comment"># 领土变更</span>
                    country<span class="token punctuation">.</span>territory <span class="token operator">+=</span> <span class="token number">1</span>
                    <span class="token keyword">if</span> defending_country<span class="token punctuation">:</span>
                        defending_country<span class="token punctuation">.</span>territory <span class="token operator">-=</span> <span class="token number">1</span>
                        <span class="token keyword">if</span> defending_country<span class="token punctuation">.</span>territory <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                            defending_country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">True</span>
                            <span class="token comment"># 移除所有该国家的领土</span>
                            <span class="token keyword">for</span> y2 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
                                <span class="token keyword">for</span> x2 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                                    tile2 <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y2<span class="token punctuation">]</span><span class="token punctuation">[</span>x2<span class="token punctuation">]</span>
                                    <span class="token keyword">if</span> tile2 <span class="token keyword">and</span> tile2<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> defending_country<span class="token punctuation">:</span>
                                        tile2<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
                    
                    <span class="token comment"># 检查是否应获得新士兵组</span>
                    country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token comment"># 防御方胜利</span>
                    <span class="token comment"># 移除所有进攻方士兵组</span>
                    <span class="token keyword">for</span> troop <span class="token keyword">in</span> moving_troops<span class="token punctuation">:</span>
                        <span class="token keyword">if</span> troop <span class="token keyword">in</span> country<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                            country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop<span class="token punctuation">)</span>
                    
                    <span class="token comment"># 防御方损失士兵组数量等于进攻方数量</span>
                    <span class="token keyword">if</span> defending_troops <span class="token keyword">and</span> defending_country<span class="token punctuation">:</span>
                        <span class="token comment"># 随机移除防御方士兵组</span>
                        remove_count <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>defending_troops<span class="token punctuation">)</span><span class="token punctuation">,</span> attacking_count<span class="token punctuation">)</span>
                        removed_troops <span class="token operator">=</span> random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>defending_troops<span class="token punctuation">,</span> remove_count<span class="token punctuation">)</span>
                        
                        <span class="token comment"># 更新防御方士兵</span>
                        to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>t <span class="token keyword">for</span> t <span class="token keyword">in</span> defending_troops <span class="token keyword">if</span> t <span class="token keyword">not</span> <span class="token keyword">in</span> removed_troops<span class="token punctuation">]</span>
                        defending_country<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span>t <span class="token keyword">for</span> t <span class="token keyword">in</span> defending_country<span class="token punctuation">.</span>troops <span class="token keyword">if</span> t <span class="token keyword">not</span> <span class="token keyword">in</span> removed_troops<span class="token punctuation">]</span>
                        
                        <span class="token keyword">if</span> <span class="token keyword">not</span> to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                            <span class="token comment"># 如果防御方没有士兵了，领土变为中立</span>
                            to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
                            <span class="token keyword">if</span> defending_country<span class="token punctuation">:</span>
                                defending_country<span class="token punctuation">.</span>territory <span class="token operator">-=</span> <span class="token number">1</span>
                                <span class="token keyword">if</span> defending_country<span class="token punctuation">.</span>territory <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                                    defending_country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">True</span>
                                    <span class="token comment"># 移除所有该国家的领土</span>
                                    <span class="token keyword">for</span> y2 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
                                        <span class="token keyword">for</span> x2 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                                            t <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y2<span class="token punctuation">]</span><span class="token punctuation">[</span>x2<span class="token punctuation">]</span>
                                            <span class="token keyword">if</span> t <span class="token keyword">and</span> t<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> defending_country<span class="token punctuation">:</span>
                                                t<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
    
    <span class="token keyword">def</span> <span class="token function">check_game_over</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        active_countries <span class="token operator">=</span> <span class="token punctuation">[</span>c <span class="token keyword">for</span> c <span class="token keyword">in</span> self<span class="token punctuation">.</span>countries <span class="token keyword">if</span> <span class="token keyword">not</span> c<span class="token punctuation">.</span>defeated<span class="token punctuation">]</span>
        
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>active_countries<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>game_over <span class="token operator">=</span> <span class="token boolean">True</span>
            self<span class="token punctuation">.</span>winner <span class="token operator">=</span> active_countries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    
    <span class="token keyword">def</span> <span class="token function">restart_game</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 重置游戏状态</span>
        self<span class="token punctuation">.</span>grid <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token boolean">None</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> country <span class="token keyword">in</span> self<span class="token punctuation">.</span>countries<span class="token punctuation">:</span>
            country<span class="token punctuation">.</span>territory <span class="token operator">=</span> <span class="token number">0</span>
            country<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            country<span class="token punctuation">.</span>next_reward <span class="token operator">=</span> <span class="token number">3</span>
            country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">False</span>
        
        self<span class="token punctuation">.</span>selected_tile <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>game_over <span class="token operator">=</span> <span class="token boolean">False</span>
        self<span class="token punctuation">.</span>winner <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>turn_count <span class="token operator">=</span> <span class="token number">0</span>
        
        <span class="token comment"># 重新初始化游戏</span>
        self<span class="token punctuation">.</span>initialize_game<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> event <span class="token keyword">in</span> pygame<span class="token punctuation">.</span>event<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> event<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> QUIT<span class="token punctuation">:</span>
                    pygame<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">elif</span> event<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> MOUSEBUTTONDOWN<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> event<span class="token punctuation">.</span>button <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>  <span class="token comment"># 左键点击</span>
                        self<span class="token punctuation">.</span>handle_click<span class="token punctuation">(</span>event<span class="token punctuation">.</span>pos<span class="token punctuation">)</span>
                <span class="token keyword">elif</span> event<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token keyword">import</span> pygame
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> random
<span class="token keyword">import</span> math
<span class="token keyword">from</span> pygame<span class="token punctuation">.</span><span class="token builtin">locals</span> <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token comment"># 初始化pygame</span>
pygame<span class="token punctuation">.</span>init<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 游戏常量</span>
SCREEN_WIDTH <span class="token operator">=</span> <span class="token number">1000</span>
SCREEN_HEIGHT <span class="token operator">=</span> <span class="token number">700</span>
GRID_SIZE <span class="token operator">=</span> <span class="token number">20</span>
GRID_WIDTH <span class="token operator">=</span> <span class="token number">40</span>
GRID_HEIGHT <span class="token operator">=</span> <span class="token number">30</span>
TILE_SIZE <span class="token operator">=</span> <span class="token number">20</span>

<span class="token comment"># 尝试加载中文字体</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token comment"># 尝试常见的中文字体</span>
    FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token string">"SimHei"</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
    LARGE_FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token string">"SimHei"</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>
    SMALL_FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token string">"SimHei"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>
<span class="token keyword">except</span><span class="token punctuation">:</span>
    <span class="token comment"># 回退到默认字体</span>
    FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
    LARGE_FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>
    SMALL_FONT <span class="token operator">=</span> pygame<span class="token punctuation">.</span>font<span class="token punctuation">.</span>SysFont<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>

<span class="token comment"># 颜色</span>
BACKGROUND <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
GRID_COLOR <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
WHITE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
BLACK <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
RED <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
GREEN <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
BLUE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
YELLOW <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
PURPLE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
CYAN <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
ORANGE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">165</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
PINK <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span>
COLORS <span class="token operator">=</span> <span class="token punctuation">[</span>RED<span class="token punctuation">,</span> BLUE<span class="token punctuation">,</span> YELLOW<span class="token punctuation">,</span> PURPLE<span class="token punctuation">,</span> CYAN<span class="token punctuation">,</span> ORANGE<span class="token punctuation">,</span> PINK<span class="token punctuation">]</span>  <span class="token comment"># 增加更多颜色</span>
HIGHLIGHT <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
NEUTRAL_COLOR <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>  <span class="token comment"># 中立领土颜色</span>

<span class="token keyword">class</span> <span class="token class-name">Country</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> color<span class="token punctuation">,</span> name<span class="token punctuation">,</span> is_player<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>color <span class="token operator">=</span> color
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>is_player <span class="token operator">=</span> is_player
        self<span class="token punctuation">.</span>territory <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># 存储士兵组的位置坐标</span>
        self<span class="token punctuation">.</span>next_reward <span class="token operator">=</span> <span class="token number">3</span>
        self<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">add_territory</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> game<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""增加领土并检查是否应生成新士兵组"""</span>
        <span class="token comment"># 每占领3块领土获得一个新的士兵组</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>territory <span class="token operator">&gt;=</span> self<span class="token punctuation">.</span>next_reward<span class="token punctuation">:</span>
            <span class="token comment"># 更新奖励阈值</span>
            self<span class="token punctuation">.</span>next_reward <span class="token operator">+=</span> <span class="token number">3</span>
            
            <span class="token comment"># 在随机领土上生成新士兵组</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                <span class="token comment"># 收集所有安全的领土位置（仅限己方领土且无士兵重叠）</span>
                safe_positions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">if</span> game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token keyword">and</span> game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> self<span class="token punctuation">:</span>
                            <span class="token comment"># 确保不在他国领土上</span>
                            is_safe <span class="token operator">=</span> <span class="token boolean">True</span>
                            <span class="token keyword">for</span> dx<span class="token punctuation">,</span> dy <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                                nx<span class="token punctuation">,</span> ny <span class="token operator">=</span> x <span class="token operator">+</span> dx<span class="token punctuation">,</span> y <span class="token operator">+</span> dy
                                <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> nx <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> ny <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">:</span>
                                    <span class="token keyword">if</span> game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>ny<span class="token punctuation">]</span><span class="token punctuation">[</span>nx<span class="token punctuation">]</span> <span class="token keyword">and</span> game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>ny<span class="token punctuation">]</span><span class="token punctuation">[</span>nx<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> self<span class="token punctuation">:</span>
                                        is_safe <span class="token operator">=</span> <span class="token boolean">False</span>
                                        <span class="token keyword">break</span>
                            
                            <span class="token keyword">if</span> is_safe<span class="token punctuation">:</span>
                                safe_positions<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
                
                <span class="token keyword">if</span> safe_positions<span class="token punctuation">:</span>
                    <span class="token comment"># 随机选择一个安全位置</span>
                    x<span class="token punctuation">,</span> y <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>safe_positions<span class="token punctuation">)</span>
                    
                    <span class="token comment"># 创建新士兵组</span>
                    new_troop <span class="token operator">=</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span>
                    
                    <span class="token comment"># 添加到国家士兵列表</span>
                    self<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_troop<span class="token punctuation">)</span>
                    
                    <span class="token comment"># 添加到网格</span>
                    game<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_troop<span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

<span class="token keyword">class</span> <span class="token class-name">Game</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>screen <span class="token operator">=</span> pygame<span class="token punctuation">.</span>display<span class="token punctuation">.</span>set_mode<span class="token punctuation">(</span><span class="token punctuation">(</span>SCREEN_WIDTH<span class="token punctuation">,</span> SCREEN_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">)</span>
        pygame<span class="token punctuation">.</span>display<span class="token punctuation">.</span>set_caption<span class="token punctuation">(</span><span class="token string">"领土征服者"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>clock <span class="token operator">=</span> pygame<span class="token punctuation">.</span>time<span class="token punctuation">.</span>Clock<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 创建国家</span>
        self<span class="token punctuation">.</span>countries <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>player_country <span class="token operator">=</span> Country<span class="token punctuation">(</span>GREEN<span class="token punctuation">,</span> <span class="token string">"玩家"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>countries<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>player_country<span class="token punctuation">)</span>
        
        <span class="token comment"># 创建电脑国家 (使用不同颜色)</span>
        ai_names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"红国"</span><span class="token punctuation">,</span> <span class="token string">"蓝国"</span><span class="token punctuation">,</span> <span class="token string">"黄国"</span><span class="token punctuation">,</span> <span class="token string">"紫国"</span><span class="token punctuation">,</span> <span class="token string">"青国"</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 创建5个电脑国家</span>
            color_idx <span class="token operator">=</span> i <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>COLORS<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>countries<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Country<span class="token punctuation">(</span>COLORS<span class="token punctuation">[</span>color_idx<span class="token punctuation">]</span><span class="token punctuation">,</span> ai_names<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 初始化网格</span>
        self<span class="token punctuation">.</span>grid <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token boolean">None</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>selected_tile <span class="token operator">=</span> <span class="token boolean">None</span>  <span class="token comment"># 改为选择整个方格</span>
        self<span class="token punctuation">.</span>game_over <span class="token operator">=</span> <span class="token boolean">False</span>
        self<span class="token punctuation">.</span>winner <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>turn_count <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 回合计数器</span>
        
        <span class="token comment"># 初始化领土和士兵</span>
        self<span class="token punctuation">.</span>initialize_game<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">initialize_game</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 为每个国家分配初始领土</span>
        positions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>countries<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
                x <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> GRID_WIDTH <span class="token operator">-</span> <span class="token number">6</span><span class="token punctuation">)</span>
                y <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">-</span> <span class="token number">6</span><span class="token punctuation">)</span>
                <span class="token comment"># 确保初始位置不重叠且有一定间距</span>
                too_close <span class="token operator">=</span> <span class="token boolean">False</span>
                <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> positions<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>px <span class="token operator">-</span> x<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">8</span> <span class="token keyword">and</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>py <span class="token operator">-</span> y<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">:</span>
                        too_close <span class="token operator">=</span> <span class="token boolean">True</span>
                        <span class="token keyword">break</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> too_close <span class="token keyword">and</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">not</span> <span class="token keyword">in</span> positions<span class="token punctuation">:</span>
                    positions<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
                        <span class="token string">'country'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>countries<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token string">'troops'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">]</span>  <span class="token comment"># 初始士兵组</span>
                    <span class="token punctuation">}</span>
                    self<span class="token punctuation">.</span>countries<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>territory <span class="token operator">=</span> <span class="token number">1</span>
                    self<span class="token punctuation">.</span>countries<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">]</span>
                    self<span class="token punctuation">.</span>countries<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>next_reward <span class="token operator">=</span> <span class="token number">3</span>
                    <span class="token keyword">break</span>
    
    <span class="token keyword">def</span> <span class="token function">draw_grid</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 绘制网格背景</span>
        self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>fill<span class="token punctuation">(</span>BACKGROUND<span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制网格线</span>
        <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> SCREEN_WIDTH<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">:</span>
            pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>line<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> GRID_COLOR<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span><span class="token punctuation">:</span>
            pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>line<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> GRID_COLOR<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>SCREEN_WIDTH<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制领土和士兵</span>
        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span>
                <span class="token keyword">if</span> tile<span class="token punctuation">:</span>
                    <span class="token comment"># 确保国家对象存在</span>
                    <span class="token keyword">if</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                        rect <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Rect<span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span>
                        pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>color<span class="token punctuation">,</span> rect<span class="token punctuation">)</span>
                        
                        <span class="token comment"># 绘制士兵组</span>
                        troop_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                        <span class="token keyword">if</span> troop_count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                            pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> WHITE<span class="token punctuation">,</span> 
                                            <span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                            TILE_SIZE<span class="token operator">//</span><span class="token number">3</span><span class="token punctuation">)</span>
                            text <span class="token operator">=</span> FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>troop_count<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span>
                            text_rect <span class="token operator">=</span> text<span class="token punctuation">.</span>get_rect<span class="token punctuation">(</span>center<span class="token operator">=</span><span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE <span class="token operator">+</span> TILE_SIZE<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>text<span class="token punctuation">,</span> text_rect<span class="token punctuation">)</span>
                    <span class="token keyword">else</span><span class="token punctuation">:</span>
                        <span class="token comment"># 绘制中立领土</span>
                        rect <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Rect<span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span>
                        pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> NEUTRAL_COLOR<span class="token punctuation">,</span> rect<span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制选中的方格</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>selected_tile<span class="token punctuation">:</span>
            x<span class="token punctuation">,</span> y <span class="token operator">=</span> self<span class="token punctuation">.</span>selected_tile
            rect <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Rect<span class="token punctuation">(</span>x <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> y <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span>
            pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> HIGHLIGHT<span class="token punctuation">,</span> rect<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 绘制可移动范围 (距离2格)</span>
            <span class="token keyword">for</span> dx<span class="token punctuation">,</span> dy <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 相邻格子</span>
                          <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>  <span class="token comment"># 距离2格</span>
                nx<span class="token punctuation">,</span> ny <span class="token operator">=</span> x <span class="token operator">+</span> dx<span class="token punctuation">,</span> y <span class="token operator">+</span> dy
                <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> nx <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> ny <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">:</span>
                    rect <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Rect<span class="token punctuation">(</span>nx <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> ny <span class="token operator">*</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">,</span> TILE_SIZE<span class="token punctuation">)</span>
                    pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rect<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制信息面板</span>
        info_panel_y <span class="token operator">=</span> GRID_HEIGHT <span class="token operator">*</span> TILE_SIZE
        info_panel_height <span class="token operator">=</span> SCREEN_HEIGHT <span class="token operator">-</span> info_panel_y
        pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> info_panel_y<span class="token punctuation">,</span> SCREEN_WIDTH<span class="token punctuation">,</span> info_panel_height<span class="token punctuation">)</span><span class="token punctuation">)</span>
        pygame<span class="token punctuation">.</span>draw<span class="token punctuation">.</span>line<span class="token punctuation">(</span>self<span class="token punctuation">.</span>screen<span class="token punctuation">,</span> WHITE<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> info_panel_y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>SCREEN_WIDTH<span class="token punctuation">,</span> info_panel_y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制玩家信息</span>
        player_text <span class="token operator">=</span> LARGE_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"玩家领土: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>territory<span class="token punctuation">}</span></span><span class="token string">  下一奖励: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>next_reward<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> GREEN<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>player_text<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> info_panel_y <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制游戏说明</span>
        instructions <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string">"游戏说明:"</span><span class="token punctuation">,</span>
            <span class="token string">"1. 点击自己的领土选择士兵"</span><span class="token punctuation">,</span>
            <span class="token string">"2. 点击相邻格子移动所有士兵 (可移动1-2格)"</span><span class="token punctuation">,</span>
            <span class="token string">"3. 每占领3块领土获得一个新士兵组"</span><span class="token punctuation">,</span>
            <span class="token string">"4. 战斗规则: 比较双方士兵总数，差值决定胜负"</span><span class="token punctuation">,</span>
            <span class="token string">"5. 目标: 消灭所有其他国家"</span>
        <span class="token punctuation">]</span>
        
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> text <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>instructions<span class="token punctuation">)</span><span class="token punctuation">:</span>
            rendered <span class="token operator">=</span> SMALL_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> WHITE<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>rendered<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> info_panel_y <span class="token operator">+</span> <span class="token number">60</span> <span class="token operator">+</span> i <span class="token operator">*</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制电脑国家信息 (分两列显示)</span>
        ai_info <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> country <span class="token keyword">in</span> self<span class="token punctuation">.</span>countries<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> country<span class="token punctuation">.</span>is_player <span class="token keyword">and</span> <span class="token keyword">not</span> country<span class="token punctuation">.</span>defeated<span class="token punctuation">:</span>
                ai_info<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>country<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>country<span class="token punctuation">.</span>territory<span class="token punctuation">}</span></span><span class="token string">领土"</span></span><span class="token punctuation">)</span>
        
        <span class="token comment"># 第一列</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>ai_info<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            ai_text1 <span class="token operator">=</span> SMALL_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">"电脑国家: "</span> <span class="token operator">+</span> <span class="token string">", "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>ai_info<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> YELLOW<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>ai_text1<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> info_panel_y <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 第二列</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>ai_info<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">:</span>
            ai_text2 <span class="token operator">=</span> SMALL_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>ai_info<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> YELLOW<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>ai_text2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> info_panel_y <span class="token operator">+</span> <span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 回合计数</span>
        turn_text <span class="token operator">=</span> SMALL_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"回合: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>turn_count<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> CYAN<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>turn_text<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> info_panel_y <span class="token operator">+</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 绘制游戏结束信息</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>game_over<span class="token punctuation">:</span>
            overlay <span class="token operator">=</span> pygame<span class="token punctuation">.</span>Surface<span class="token punctuation">(</span><span class="token punctuation">(</span>SCREEN_WIDTH<span class="token punctuation">,</span> SCREEN_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">,</span> pygame<span class="token punctuation">.</span>SRCALPHA<span class="token punctuation">)</span>
            overlay<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>overlay<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>winner<span class="token punctuation">.</span>is_player<span class="token punctuation">:</span>
                text <span class="token operator">=</span> LARGE_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">"恭喜！你赢得了战争！"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> GREEN<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                text <span class="token operator">=</span> LARGE_FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>winner<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">赢得了战争！"</span></span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>winner<span class="token punctuation">.</span>color<span class="token punctuation">)</span>
            
            restart <span class="token operator">=</span> FONT<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">"按R键重新开始游戏"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> WHITE<span class="token punctuation">)</span>
            
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token punctuation">(</span>SCREEN_WIDTH<span class="token operator">//</span><span class="token number">2</span> <span class="token operator">-</span> text<span class="token punctuation">.</span>get_width<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> SCREEN_HEIGHT<span class="token operator">//</span><span class="token number">2</span> <span class="token operator">-</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>restart<span class="token punctuation">,</span> <span class="token punctuation">(</span>SCREEN_WIDTH<span class="token operator">//</span><span class="token number">2</span> <span class="token operator">-</span> restart<span class="token punctuation">.</span>get_width<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> SCREEN_HEIGHT<span class="token operator">//</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">handle_click</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>game_over<span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        grid_x <span class="token operator">=</span> pos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">//</span> TILE_SIZE
        grid_y <span class="token operator">=</span> pos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">//</span> TILE_SIZE
        
        <span class="token comment"># 确保点击在网格范围内</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;=</span> grid_x <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> grid_y <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        <span class="token comment"># 选择整个方格</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>selected_tile <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>grid_y<span class="token punctuation">]</span><span class="token punctuation">[</span>grid_x<span class="token punctuation">]</span>
            <span class="token keyword">if</span> tile <span class="token keyword">and</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">:</span>
                <span class="token comment"># 检查该位置是否有玩家士兵组</span>
                <span class="token keyword">if</span> tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>selected_tile <span class="token operator">=</span> <span class="token punctuation">(</span>grid_x<span class="token punctuation">,</span> grid_y<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># 移动士兵组</span>
            selected_x<span class="token punctuation">,</span> selected_y <span class="token operator">=</span> self<span class="token punctuation">.</span>selected_tile
            
            <span class="token comment"># 检查是否在移动范围内 (曼哈顿距离 &lt;= 2 且在同一行或列)</span>
            dx <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>grid_x <span class="token operator">-</span> selected_x<span class="token punctuation">)</span>
            dy <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>grid_y <span class="token operator">-</span> selected_y<span class="token punctuation">)</span>
            
            <span class="token comment"># 只能水平或垂直移动，距离1-2格</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>dx <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">or</span> dx <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">and</span> dy <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>dy <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">or</span> dy <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">and</span> dx <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>move_troops<span class="token punctuation">(</span>selected_x<span class="token punctuation">,</span> selected_y<span class="token punctuation">,</span> grid_x<span class="token punctuation">,</span> grid_y<span class="token punctuation">)</span>
            
            self<span class="token punctuation">.</span>selected_tile <span class="token operator">=</span> <span class="token boolean">None</span>
    
    <span class="token keyword">def</span> <span class="token function">move_troops</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> from_x<span class="token punctuation">,</span> from_y<span class="token punctuation">,</span> to_x<span class="token punctuation">,</span> to_y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 获取原方格信息</span>
        from_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>from_y<span class="token punctuation">]</span><span class="token punctuation">[</span>from_x<span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> from_tile <span class="token keyword">or</span> <span class="token keyword">not</span> from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        <span class="token comment"># 获取要移动的所有士兵组</span>
        moving_troops <span class="token operator">=</span> from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>  <span class="token comment"># 复制列表</span>
        
        <span class="token comment"># 从原位置移除所有士兵组</span>
        from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> troop <span class="token keyword">in</span> moving_troops<span class="token punctuation">:</span>
            <span class="token keyword">if</span> troop <span class="token keyword">in</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop<span class="token punctuation">)</span>
        
        <span class="token comment"># 更新士兵组位置</span>
        <span class="token keyword">for</span> troop <span class="token keyword">in</span> moving_troops<span class="token punctuation">:</span>
            troop<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_x
            troop<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_y
        
        <span class="token comment"># 添加到新位置</span>
        to_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>to_y<span class="token punctuation">]</span><span class="token punctuation">[</span>to_x<span class="token punctuation">]</span>
        
        <span class="token keyword">if</span> <span class="token keyword">not</span> to_tile<span class="token punctuation">:</span>
            <span class="token comment"># 占领新领土</span>
            self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>to_y<span class="token punctuation">]</span><span class="token punctuation">[</span>to_x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'country'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">,</span>
                <span class="token string">'troops'</span><span class="token punctuation">:</span> moving_troops
            <span class="token punctuation">}</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>territory <span class="token operator">+=</span> <span class="token number">1</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
            <span class="token comment"># 检查是否应获得新士兵组</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">:</span>
                <span class="token comment"># 合并到友方领土</span>
                to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>extend<span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># 与敌方发生战斗</span>
                self<span class="token punctuation">.</span>resolve_battle<span class="token punctuation">(</span>to_x<span class="token punctuation">,</span> to_y<span class="token punctuation">,</span> moving_troops<span class="token punctuation">)</span>
        
        <span class="token comment"># 电脑回合</span>
        self<span class="token punctuation">.</span>ai_turn<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>turn_count <span class="token operator">+=</span> <span class="token number">1</span>
        
        <span class="token comment"># 检查游戏是否结束</span>
        self<span class="token punctuation">.</span>check_game_over<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">resolve_battle</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> attacking_troops<span class="token punctuation">)</span><span class="token punctuation">:</span>
        tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span>
        defending_country <span class="token operator">=</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span>
        defending_troops <span class="token operator">=</span> tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
        attacking_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>attacking_troops<span class="token punctuation">)</span>
        defending_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>defending_troops<span class="token punctuation">)</span>
        
        <span class="token comment"># 计算战斗结果</span>
        difference <span class="token operator">=</span> attacking_count <span class="token operator">-</span> defending_count
        
        <span class="token keyword">if</span> difference <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token comment"># 攻击方胜利</span>
            tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>player_country
            
            <span class="token comment"># 保留差值数量的士兵组</span>
            remaining_attacking_troops <span class="token operator">=</span> attacking_troops<span class="token punctuation">[</span><span class="token punctuation">:</span>difference<span class="token punctuation">]</span> <span class="token keyword">if</span> difference <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            
            <span class="token comment"># 设置领土上的士兵组</span>
            tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> remaining_attacking_troops
            
            <span class="token comment"># 更新玩家士兵列表</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>remaining_attacking_troops<span class="token punctuation">)</span>
            
            <span class="token comment"># 领土变更</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>territory <span class="token operator">+=</span> <span class="token number">1</span>
            <span class="token keyword">if</span> defending_country<span class="token punctuation">:</span>
                defending_country<span class="token punctuation">.</span>territory <span class="token operator">-=</span> <span class="token number">1</span>
                <span class="token comment"># 检查防御方是否被击败</span>
                <span class="token keyword">if</span> defending_country<span class="token punctuation">.</span>territory <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    defending_country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">True</span>
                    <span class="token comment"># 移除所有该国家的领土</span>
                    <span class="token keyword">for</span> y2 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">for</span> x2 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                            tile2 <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y2<span class="token punctuation">]</span><span class="token punctuation">[</span>x2<span class="token punctuation">]</span>
                            <span class="token keyword">if</span> tile2 <span class="token keyword">and</span> tile2<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> defending_country<span class="token punctuation">:</span>
                                tile2<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
            
            <span class="token comment"># 检查是否应获得新士兵组</span>
            self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># 防御方胜利</span>
            <span class="token comment"># 移除所有进攻方士兵组</span>
            <span class="token keyword">for</span> troop <span class="token keyword">in</span> attacking_troops<span class="token punctuation">:</span>
                <span class="token keyword">if</span> troop <span class="token keyword">in</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop<span class="token punctuation">)</span>
            
            <span class="token comment"># 防御方损失士兵组数量等于进攻方数量</span>
            <span class="token keyword">if</span> defending_troops<span class="token punctuation">:</span>
                <span class="token comment"># 随机移除防御方士兵组</span>
                remove_count <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>defending_troops<span class="token punctuation">)</span><span class="token punctuation">,</span> attacking_count<span class="token punctuation">)</span>
                removed_troops <span class="token operator">=</span> random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>defending_troops<span class="token punctuation">,</span> remove_count<span class="token punctuation">)</span>
                
                <span class="token comment"># 更新防御方士兵</span>
                tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>t <span class="token keyword">for</span> t <span class="token keyword">in</span> defending_troops <span class="token keyword">if</span> t <span class="token keyword">not</span> <span class="token keyword">in</span> removed_troops<span class="token punctuation">]</span>
                <span class="token keyword">if</span> defending_country<span class="token punctuation">:</span>
                    defending_country<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span>t <span class="token keyword">for</span> t <span class="token keyword">in</span> defending_country<span class="token punctuation">.</span>troops <span class="token keyword">if</span> t <span class="token keyword">not</span> <span class="token keyword">in</span> removed_troops<span class="token punctuation">]</span>
                
                <span class="token keyword">if</span> <span class="token keyword">not</span> tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                    <span class="token comment"># 如果防御方没有士兵了，领土变为中立</span>
                    tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
                    <span class="token keyword">if</span> defending_country<span class="token punctuation">:</span>
                        defending_country<span class="token punctuation">.</span>territory <span class="token operator">-=</span> <span class="token number">1</span>
                        <span class="token keyword">if</span> defending_country<span class="token punctuation">.</span>territory <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                            defending_country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">True</span>
                            <span class="token comment"># 移除所有该国家的领土</span>
                            <span class="token keyword">for</span> y2 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
                                <span class="token keyword">for</span> x2 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                                    t <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y2<span class="token punctuation">]</span><span class="token punctuation">[</span>x2<span class="token punctuation">]</span>
                                    <span class="token keyword">if</span> t <span class="token keyword">and</span> t<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> defending_country<span class="token punctuation">:</span>
                                        t<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
    
    <span class="token keyword">def</span> <span class="token function">ai_turn</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> country <span class="token keyword">in</span> self<span class="token punctuation">.</span>countries<span class="token punctuation">:</span>
            <span class="token keyword">if</span> country<span class="token punctuation">.</span>is_player <span class="token keyword">or</span> country<span class="token punctuation">.</span>defeated<span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            
            <span class="token comment"># 收集所有可能的移动</span>
            possible_moves <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            
            <span class="token comment"># 收集所有边境格子（与敌方或空白相邻的格子）</span>
            border_tiles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span>
                    <span class="token keyword">if</span> tile <span class="token keyword">and</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> country <span class="token keyword">and</span> tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                        <span class="token comment"># 检查是否在边境</span>
                        is_border <span class="token operator">=</span> <span class="token boolean">False</span>
                        <span class="token keyword">for</span> dx<span class="token punctuation">,</span> dy <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                            nx<span class="token punctuation">,</span> ny <span class="token operator">=</span> x <span class="token operator">+</span> dx<span class="token punctuation">,</span> y <span class="token operator">+</span> dy
                            <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> nx <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> ny <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">:</span>
                                neighbor <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>ny<span class="token punctuation">]</span><span class="token punctuation">[</span>nx<span class="token punctuation">]</span>
                                <span class="token keyword">if</span> <span class="token keyword">not</span> neighbor <span class="token keyword">or</span> <span class="token punctuation">(</span>neighbor<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token keyword">and</span> neighbor<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> country<span class="token punctuation">)</span><span class="token punctuation">:</span>
                                    is_border <span class="token operator">=</span> <span class="token boolean">True</span>
                                    <span class="token keyword">break</span>
                        
                        <span class="token keyword">if</span> is_border<span class="token punctuation">:</span>
                            border_tiles<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> <span class="token keyword">not</span> border_tiles<span class="token punctuation">:</span>
                <span class="token comment"># 如果没有边境格子，使用所有有士兵的格子</span>
                <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                        tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span>
                        <span class="token keyword">if</span> tile <span class="token keyword">and</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> country <span class="token keyword">and</span> tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                            border_tiles<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 尝试每个边境格子</span>
            random<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>border_tiles<span class="token punctuation">)</span>
            moved <span class="token operator">=</span> <span class="token boolean">False</span>
            
            <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> border_tiles<span class="token punctuation">:</span>
                tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span>
                <span class="token comment"># 检查该格子是否还有士兵（可能在之前的移动中已被移动）</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> tile <span class="token keyword">or</span> <span class="token keyword">not</span> tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token keyword">or</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> country<span class="token punctuation">:</span>
                    <span class="token keyword">continue</span>
                
                <span class="token comment"># 收集可能的移动目标</span>
                targets <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                
                <span class="token comment"># 检查所有可能的方向（1-2格距离）</span>
                <span class="token keyword">for</span> dx<span class="token punctuation">,</span> dy <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                    nx<span class="token punctuation">,</span> ny <span class="token operator">=</span> x <span class="token operator">+</span> dx<span class="token punctuation">,</span> y <span class="token operator">+</span> dy
                    <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> nx <span class="token operator">&lt;</span> GRID_WIDTH <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> ny <span class="token operator">&lt;</span> GRID_HEIGHT<span class="token punctuation">:</span>
                        targets<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>nx<span class="token punctuation">,</span> ny<span class="token punctuation">)</span><span class="token punctuation">)</span>
                
                <span class="token comment"># 随机打乱目标顺序</span>
                random<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>targets<span class="token punctuation">)</span>
                
                <span class="token keyword">for</span> tx<span class="token punctuation">,</span> ty <span class="token keyword">in</span> targets<span class="token punctuation">:</span>
                    <span class="token comment"># 获取目标格子</span>
                    target_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>ty<span class="token punctuation">]</span><span class="token punctuation">[</span>tx<span class="token punctuation">]</span>
                    
                    <span class="token comment"># 如果是空白格子，直接占领</span>
                    <span class="token keyword">if</span> <span class="token keyword">not</span> target_tile<span class="token punctuation">:</span>
                        self<span class="token punctuation">.</span>ai_move<span class="token punctuation">(</span>country<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> tx<span class="token punctuation">,</span> ty<span class="token punctuation">)</span>
                        moved <span class="token operator">=</span> <span class="token boolean">True</span>
                        <span class="token keyword">break</span>
                    
                    <span class="token comment"># 如果是敌方格子，评估实力</span>
                    <span class="token keyword">if</span> target_tile <span class="token keyword">and</span> target_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token keyword">and</span> target_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> country<span class="token punctuation">:</span>
                        <span class="token comment"># 获取边境实力</span>
                        my_strength <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                        enemy_strength <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>target_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                        
                        <span class="token comment"># 增强策略性 - 只在实力足够时进攻</span>
                        <span class="token keyword">if</span> my_strength <span class="token operator">&gt;</span> enemy_strength<span class="token punctuation">:</span>
                            self<span class="token punctuation">.</span>ai_move<span class="token punctuation">(</span>country<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> tx<span class="token punctuation">,</span> ty<span class="token punctuation">)</span>
                            moved <span class="token operator">=</span> <span class="token boolean">True</span>
                            <span class="token keyword">break</span>
                
                <span class="token keyword">if</span> moved<span class="token punctuation">:</span>
                    <span class="token keyword">break</span>
    
    <span class="token keyword">def</span> <span class="token function">ai_move</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> country<span class="token punctuation">,</span> from_x<span class="token punctuation">,</span> from_y<span class="token punctuation">,</span> to_x<span class="token punctuation">,</span> to_y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 获取原方格信息</span>
        from_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>from_y<span class="token punctuation">]</span><span class="token punctuation">[</span>from_x<span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> from_tile <span class="token keyword">or</span> <span class="token keyword">not</span> from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        
        <span class="token comment"># 获取要移动的所有士兵组</span>
        moving_troops <span class="token operator">=</span> from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>  <span class="token comment"># 复制列表</span>
        
        <span class="token comment"># 从原位置移除所有士兵组</span>
        from_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> troop <span class="token keyword">in</span> moving_troops<span class="token punctuation">:</span>
            <span class="token keyword">if</span> troop <span class="token keyword">in</span> country<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop<span class="token punctuation">)</span>
        
        <span class="token comment"># 更新士兵组位置</span>
        <span class="token keyword">for</span> troop <span class="token keyword">in</span> moving_troops<span class="token punctuation">:</span>
            troop<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_x
            troop<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> to_y
        
        <span class="token comment"># 添加到新位置</span>
        to_tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>to_y<span class="token punctuation">]</span><span class="token punctuation">[</span>to_x<span class="token punctuation">]</span>
        
        <span class="token keyword">if</span> <span class="token keyword">not</span> to_tile<span class="token punctuation">:</span>
            <span class="token comment"># 占领新领土</span>
            self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>to_y<span class="token punctuation">]</span><span class="token punctuation">[</span>to_x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'country'</span><span class="token punctuation">:</span> country<span class="token punctuation">,</span>
                <span class="token string">'troops'</span><span class="token punctuation">:</span> moving_troops
            <span class="token punctuation">}</span>
            country<span class="token punctuation">.</span>territory <span class="token operator">+=</span> <span class="token number">1</span>
            country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
            <span class="token comment"># 检查是否应获得新士兵组</span>
            country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> country<span class="token punctuation">:</span>
                <span class="token comment"># 合并到友方领土</span>
                to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>extend<span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
                country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># 与敌方发生战斗</span>
                defending_country <span class="token operator">=</span> to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token keyword">if</span> to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token keyword">else</span> <span class="token boolean">None</span>
                defending_troops <span class="token operator">=</span> to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
                attacking_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>moving_troops<span class="token punctuation">)</span>
                defending_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>defending_troops<span class="token punctuation">)</span>
                
                difference <span class="token operator">=</span> attacking_count <span class="token operator">-</span> defending_count
                
                <span class="token keyword">if</span> difference <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    <span class="token comment"># 攻击方胜利</span>
                    to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> country
                    
                    <span class="token comment"># 保留差值数量的士兵组</span>
                    remaining_attacking_troops <span class="token operator">=</span> moving_troops<span class="token punctuation">[</span><span class="token punctuation">:</span>difference<span class="token punctuation">]</span> <span class="token keyword">if</span> difference <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                    
                    <span class="token comment"># 设置领土上的士兵组</span>
                    to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> remaining_attacking_troops
                    
                    <span class="token comment"># 更新国家士兵列表</span>
                    country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>remaining_attacking_troops<span class="token punctuation">)</span>
                    
                    <span class="token comment"># 领土变更</span>
                    country<span class="token punctuation">.</span>territory <span class="token operator">+=</span> <span class="token number">1</span>
                    <span class="token keyword">if</span> defending_country<span class="token punctuation">:</span>
                        defending_country<span class="token punctuation">.</span>territory <span class="token operator">-=</span> <span class="token number">1</span>
                        <span class="token keyword">if</span> defending_country<span class="token punctuation">.</span>territory <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                            defending_country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">True</span>
                            <span class="token comment"># 移除所有该国家的领土</span>
                            <span class="token keyword">for</span> y2 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
                                <span class="token keyword">for</span> x2 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                                    tile2 <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y2<span class="token punctuation">]</span><span class="token punctuation">[</span>x2<span class="token punctuation">]</span>
                                    <span class="token keyword">if</span> tile2 <span class="token keyword">and</span> tile2<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> defending_country<span class="token punctuation">:</span>
                                        tile2<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
                    
                    <span class="token comment"># 检查是否应获得新士兵组</span>
                    country<span class="token punctuation">.</span>add_territory<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token comment"># 防御方胜利</span>
                    <span class="token comment"># 移除所有进攻方士兵组</span>
                    <span class="token keyword">for</span> troop <span class="token keyword">in</span> moving_troops<span class="token punctuation">:</span>
                        <span class="token keyword">if</span> troop <span class="token keyword">in</span> country<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                            country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop<span class="token punctuation">)</span>
                    
                    <span class="token comment"># 防御方损失士兵组数量等于进攻方数量</span>
                    <span class="token keyword">if</span> defending_troops <span class="token keyword">and</span> defending_country<span class="token punctuation">:</span>
                        <span class="token comment"># 随机移除防御方士兵组</span>
                        remove_count <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>defending_troops<span class="token punctuation">)</span><span class="token punctuation">,</span> attacking_count<span class="token punctuation">)</span>
                        removed_troops <span class="token operator">=</span> random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>defending_troops<span class="token punctuation">,</span> remove_count<span class="token punctuation">)</span>
                        
                        <span class="token comment"># 更新防御方士兵</span>
                        to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>t <span class="token keyword">for</span> t <span class="token keyword">in</span> defending_troops <span class="token keyword">if</span> t <span class="token keyword">not</span> <span class="token keyword">in</span> removed_troops<span class="token punctuation">]</span>
                        defending_country<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span>t <span class="token keyword">for</span> t <span class="token keyword">in</span> defending_country<span class="token punctuation">.</span>troops <span class="token keyword">if</span> t <span class="token keyword">not</span> <span class="token keyword">in</span> removed_troops<span class="token punctuation">]</span>
                        
                        <span class="token keyword">if</span> <span class="token keyword">not</span> to_tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                            <span class="token comment"># 如果防御方没有士兵了，领土变为中立</span>
                            to_tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
                            <span class="token keyword">if</span> defending_country<span class="token punctuation">:</span>
                                defending_country<span class="token punctuation">.</span>territory <span class="token operator">-=</span> <span class="token number">1</span>
                                <span class="token keyword">if</span> defending_country<span class="token punctuation">.</span>territory <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                                    defending_country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">True</span>
                                    <span class="token comment"># 移除所有该国家的领土</span>
                                    <span class="token keyword">for</span> y2 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
                                        <span class="token keyword">for</span> x2 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
                                            t <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y2<span class="token punctuation">]</span><span class="token punctuation">[</span>x2<span class="token punctuation">]</span>
                                            <span class="token keyword">if</span> t <span class="token keyword">and</span> t<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> defending_country<span class="token punctuation">:</span>
                                                t<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
    
    <span class="token keyword">def</span> <span class="token function">check_game_over</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        active_countries <span class="token operator">=</span> <span class="token punctuation">[</span>c <span class="token keyword">for</span> c <span class="token keyword">in</span> self<span class="token punctuation">.</span>countries <span class="token keyword">if</span> <span class="token keyword">not</span> c<span class="token punctuation">.</span>defeated<span class="token punctuation">]</span>
        
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>active_countries<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>game_over <span class="token operator">=</span> <span class="token boolean">True</span>
            self<span class="token punctuation">.</span>winner <span class="token operator">=</span> active_countries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    
    <span class="token keyword">def</span> <span class="token function">restart_game</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 重置游戏状态</span>
        self<span class="token punctuation">.</span>grid <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token boolean">None</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> country <span class="token keyword">in</span> self<span class="token punctuation">.</span>countries<span class="token punctuation">:</span>
            country<span class="token punctuation">.</span>territory <span class="token operator">=</span> <span class="token number">0</span>
            country<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            country<span class="token punctuation">.</span>next_reward <span class="token operator">=</span> <span class="token number">3</span>
            country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">False</span>
        
        self<span class="token punctuation">.</span>selected_tile <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>game_over <span class="token operator">=</span> <span class="token boolean">False</span>
        self<span class="token punctuation">.</span>winner <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>turn_count <span class="token operator">=</span> <span class="token number">0</span>
        
        <span class="token comment"># 重新初始化游戏</span>
        self<span class="token punctuation">.</span>initialize_game<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> event <span class="token keyword">in</span> pygame<span class="token punctuation">.</span>event<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> event<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> QUIT<span class="token punctuation">:</span>
                    pygame<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">elif</span> event<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> MOUSEBUTTONDOWN<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> event<span class="token punctuation">.</span>button <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>  <span class="token comment"># 左键点击</span>
                        self<span class="token punctuation">.</span>handle_click<span class="token punctuation">(</span>event<span class="token punctuation">.</span>pos<span class="token punctuation">)</span>
                <span class="token keyword">elif</span> event<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> KEYDOWN<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> event<span class="token punctuation">.</span>key <span class="token operator">==</span> K_r<span class="token punctuation">:</span>  <span class="token comment"># 按R键重新开始</span>
                        self<span class="token punctuation">.</span>restart_game<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            self<span class="token punctuation">.</span>draw_grid<span class="token punctuation">(</span><span class="token punctuation">)</span>
            pygame<span class="token punctuation">.</span>display<span class="token punctuation">.</span>flip<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>clock<span class="token punctuation">.</span>tick<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    game <span class="token operator">=</span> Game<span class="token punctuation">(</span><span class="token punctuation">)</span>
    game<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></div><h2>主要修复内容：</h2><h3>1. 修复战斗逻辑问题</h3><p class="ds-markdown-paragraph">我修改了战斗逻辑，使其符合最初的游戏规则：</p><ul><li><p class="ds-markdown-paragraph">当攻击方胜利时，只保留差值数量的士兵组（a - b）</p></li><li><p class="ds-markdown-paragraph">当防御方胜利时，保留差值数量的士兵组（b - a）</p></li></ul><p class="ds-markdown-paragraph">修改后的战斗逻辑代码：</p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre><span class="token keyword">def</span> <span class="token function">resolve_battle</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> attacking_troops<span class="token punctuation">)</span><span class="token punctuation">:</span>
    tile <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span>
    defending_country <span class="token operator">=</span> tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span>
    defending_troops <span class="token operator">=</span> tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    attacking_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>attacking_troops<span class="token punctuation">)</span>
    defending_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>defending_troops<span class="token punctuation">)</span>
    
    <span class="token comment"># 计算战斗结果</span>
    difference <span class="token operator">=</span> attacking_count <span class="token operator">-</span> defending_count
    
    <span class="token keyword">if</span> difference <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token comment"># 攻击方胜利</span>
        tile<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>player_country
        
        <span class="token comment"># 保留差值数量的士兵组</span>
        remaining_attacking_troops <span class="token operator">=</span> attacking_troops<span class="token punctuation">[</span><span class="token punctuation">:</span>difference<span class="token punctuation">]</span> <span class="token keyword">if</span> difference <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        
        <span class="token comment"># 设置领土上的士兵组</span>
        tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> remaining_attacking_troops
        
        <span class="token comment"># 更新玩家士兵列表</span>
        self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>remaining_attacking_troops<span class="token punctuation">)</span>
        
        <span class="token comment"># ...（其他逻辑不变）</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token comment"># 防御方胜利</span>
        <span class="token comment"># 移除所有进攻方士兵组</span>
        <span class="token keyword">for</span> troop <span class="token keyword">in</span> attacking_troops<span class="token punctuation">:</span>
            <span class="token keyword">if</span> troop <span class="token keyword">in</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop<span class="token punctuation">)</span>
        
        <span class="token comment"># 防御方保留差值数量的士兵组</span>
        remaining_defending_troops <span class="token operator">=</span> defending_troops<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token builtin">abs</span><span class="token punctuation">(</span>difference<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">if</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>difference<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> remaining_defending_troops
        
        <span class="token comment"># 更新防御方士兵列表</span>
        <span class="token keyword">if</span> defending_country<span class="token punctuation">:</span>
            defending_country<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span>t <span class="token keyword">for</span> t <span class="token keyword">in</span> defending_country<span class="token punctuation">.</span>troops <span class="token keyword">if</span> t <span class="token keyword">in</span> remaining_defending_troops<span class="token punctuation">]</span>
        
        <span class="token comment"># ...（其他逻辑不变）</span></pre></div><h3>2. 移除了额外的士兵奖励</h3><p class="ds-markdown-paragraph">我移除了之前添加的额外士兵奖励功能，因为这与最初的游戏规则不符：</p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre><span class="token comment"># 移除了以下代码：</span>
<span class="token comment"># 额外奖励一组士兵</span>
new_troop <span class="token operator">=</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span>
tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_troop<span class="token punctuation">)</span>
self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_troop<span class="token punctuation">)</span></pre></div><h3>3. 优化了防御方胜利时的处理</h3><p class="ds-markdown-paragraph">在防御方胜利时，现在只保留差值数量的士兵组（b - a）：</p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre><span class="token comment"># 防御方胜利</span>
<span class="token comment"># 移除所有进攻方士兵组</span>
<span class="token keyword">for</span> troop <span class="token keyword">in</span> attacking_troops<span class="token punctuation">:</span>
    <span class="token keyword">if</span> troop <span class="token keyword">in</span> self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>player_country<span class="token punctuation">.</span>troops<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>troop<span class="token punctuation">)</span>

<span class="token comment"># 防御方保留差值数量的士兵组</span>
remaining_defending_troops <span class="token operator">=</span> defending_troops<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token builtin">abs</span><span class="token punctuation">(</span>difference<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">if</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>difference<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
tile<span class="token punctuation">[</span><span class="token string">'troops'</span><span class="token punctuation">]</span> <span class="token operator">=</span> remaining_defending_troops

<span class="token comment"># 更新防御方士兵列表</span>
<span class="token keyword">if</span> defending_country<span class="token punctuation">:</span>
    defending_country<span class="token punctuation">.</span>troops <span class="token operator">=</span> <span class="token punctuation">[</span>t <span class="token keyword">for</span> t <span class="token keyword">in</span> defending_country<span class="token punctuation">.</span>troops <span class="token keyword">if</span> t <span class="token keyword">in</span> remaining_defending_troops<span class="token punctuation">]</span></pre></div><h3>4. 修复了国家被击败后的领土处理</h3><p class="ds-markdown-paragraph">当国家被击败时，将其所有领土标记为中立：</p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03"><div class="efa13877"><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--m _7db3914" tabindex="0" style="margin-right: 8px; font-size: 13px; height: 28px; padding: 0px 4px; --button-text-color: var(--dsr-text-2);"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">复制</span></div><div role="button" class="ds-button ds-button--secondary ds-button--borderless ds-button--rect ds-button--s _7db3914" tabindex="0" style="padding: 0px 4px; height: 28px; --button-text-color: var(--dsr-text-2); --button-font-size: 13px;"><div class="ds-button__icon"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.55a.97.97 0 0 1 .982.956v13.04a.97.97 0 0 1-.982.957.97.97 0 0 1-.982-.956V3.507A.97.97 0 0 1 12 2.55z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.418 9.808c.382.375.37.971-.027 1.332l-6.7 6.085a1.04 1.04 0 0 1-1.41-.025.905.905 0 0 1 .027-1.332l6.7-6.085a1.04 1.04 0 0 1 1.41.025z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4.582 9.808a1.04 1.04 0 0 1 1.41-.025l6.7 6.085c.397.361.409.957.027 1.332a1.04 1.04 0 0 1-1.41.025l-6.7-6.085a.905.905 0 0 1-.027-1.332z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M3.068 16.46a.97.97 0 0 1 .983.956v1.739c0 .432.36.782.803.782h14.291c.445 0 .804-.35.804-.782v-1.739a.97.97 0 0 1 .983-.956.97.97 0 0 1 .982.956v1.739c0 1.488-1.24 2.695-2.769 2.695H4.855c-1.53 0-2.77-1.207-2.77-2.695v-1.739a.97.97 0 0 1 .983-.956z" fill="currentColor"></path></svg></div></div><span class="code-info-button-text">下载</span></div></div></div></div></div></div><pre><span class="token keyword">if</span> defending_country<span class="token punctuation">.</span>territory <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
    defending_country<span class="token punctuation">.</span>defeated <span class="token operator">=</span> <span class="token boolean">True</span>
    <span class="token comment"># 移除所有该国家的领土</span>
    <span class="token keyword">for</span> y2 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> x2 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>GRID_WIDTH<span class="token punctuation">)</span><span class="token punctuation">:</span>
            tile2 <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>y2<span class="token punctuation">]</span><span class="token punctuation">[</span>x2<span class="token punctuation">]</span>
            <span class="token keyword">if</span> tile2 <span class="token keyword">and</span> tile2<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">==</span> defending_country<span class="token punctuation">:</span>
                tile2<span class="token punctuation">[</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span></pre></div><h3>5. 其他优化</h3><ul><li><p class="ds-markdown-paragraph">添加了更多的空值检查，防止出现属性错误</p></li><li><p class="ds-markdown-paragraph">优化了代码结构，提高可读性</p></li><li><p class="ds-markdown-paragraph">保持其他功能不变（如移动距离增加到2格，AI策略增强等）</p></li></ul><p class="ds-markdown-paragraph">这个修复版本应该解决了士兵数量不减反增的问题，同时保持了游戏的其他功能和稳定性。现在战斗逻辑应该完全符合您最初制定的规则。</p></div><div class="ds-flex" style="margin-top: 12px; height: 20px; margin-bottom: 20px; align-items: center; gap: 10px;"><div class="ds-flex _965abe9" style="align-items: center; gap: 16px;"><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" fill="currentColor"></path></svg></div></div><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px; opacity: 1;"><svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><clippath id="clip1258_20811"><rect id="重新生成" width="20.000000" height="20.000000" fill="white" fill-opacity="0"></rect></clippath></defs><rect id="重新生成" width="20.000000" height="20.000000" fill="#FFFFFF" fill-opacity="0"></rect><g clip-path="url(#clip1258_20811)"><path id="path" d="M17.01 7.63L13.98 7.62C13.88 7.62 13.79 7.6 13.7 7.56C13.62 7.52 13.54 7.47 13.47 7.4C13.4 7.33 13.35 7.25 13.32 7.16C13.28 7.07 13.26 6.98 13.26 6.88C13.26 6.79 13.28 6.69 13.32 6.6C13.35 6.51 13.4 6.43 13.47 6.36C13.54 6.3 13.62 6.24 13.7 6.21C13.79 6.17 13.88 6.15 13.98 6.15L15.57 6.16C15.67 6.16 15.76 6.14 15.85 6.1C15.94 6.06 16.01 6.01 16.08 5.94C16.15 5.87 16.2 5.79 16.23 5.7C16.27 5.61 16.29 5.52 16.29 5.42L16.3 3.89C16.3 3.79 16.32 3.7 16.36 3.61C16.39 3.52 16.44 3.44 16.51 3.37C16.58 3.3 16.66 3.25 16.74 3.21C16.83 3.17 16.92 3.16 17.02 3.16C17.11 3.16 17.2 3.17 17.29 3.21C17.38 3.25 17.46 3.3 17.52 3.37C17.59 3.44 17.64 3.52 17.68 3.61C17.71 3.7 17.73 3.79 17.73 3.89L17.72 6.9C17.72 7 17.71 7.09 17.67 7.18C17.63 7.27 17.58 7.34 17.52 7.41C17.45 7.48 17.37 7.53 17.29 7.57C17.2 7.61 17.11 7.63 17.01 7.63Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path><path id="path" d="M2.31 16.29L2.32 13.3C2.32 13.21 2.34 13.11 2.37 13.02C2.41 12.93 2.46 12.85 2.53 12.78C2.6 12.71 2.67 12.66 2.76 12.62C2.85 12.58 2.94 12.56 3.03 12.56L6.07 12.57C6.16 12.57 6.25 12.59 6.34 12.63C6.43 12.67 6.51 12.72 6.57 12.79C6.64 12.86 6.69 12.94 6.73 13.03C6.76 13.12 6.78 13.22 6.78 13.32C6.78 13.41 6.76 13.51 6.73 13.6C6.69 13.69 6.64 13.77 6.57 13.84C6.51 13.91 6.43 13.96 6.34 14C6.25 14.04 6.16 14.06 6.07 14.06L4.47 14.05C4.38 14.05 4.29 14.07 4.2 14.11C4.11 14.15 4.03 14.2 3.97 14.27C3.9 14.34 3.85 14.42 3.81 14.51C3.78 14.6 3.76 14.7 3.76 14.8L3.75 16.29C3.75 16.39 3.73 16.48 3.69 16.58C3.65 16.67 3.6 16.75 3.54 16.82C3.47 16.89 3.39 16.94 3.3 16.98C3.22 17.01 3.13 17.03 3.03 17.03C2.94 17.03 2.85 17.02 2.76 16.98C2.67 16.94 2.59 16.89 2.52 16.82C2.46 16.75 2.4 16.67 2.37 16.58C2.33 16.49 2.31 16.39 2.31 16.29Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path><path id="path" d="M9.88 18.01C9.51 18.01 9.15 17.99 8.79 17.94C8.42 17.89 8.07 17.82 7.71 17.73C7.36 17.63 7.02 17.51 6.68 17.37C6.34 17.23 6.02 17.07 5.7 16.89C5.39 16.7 5.09 16.5 4.8 16.28C4.52 16.05 4.25 15.81 3.99 15.55C3.74 15.29 3.5 15.02 3.29 14.73C3.07 14.44 2.88 14.13 2.7 13.82L4.15 13.05C4.32 13.35 4.51 13.64 4.72 13.91C4.93 14.18 5.17 14.43 5.42 14.66C5.67 14.9 5.94 15.11 6.23 15.3C6.52 15.49 6.83 15.66 7.14 15.81C7.46 15.95 7.78 16.07 8.12 16.16C8.45 16.25 8.8 16.32 9.14 16.36C9.49 16.39 9.83 16.4 10.18 16.39C10.53 16.37 10.87 16.33 11.22 16.26C11.56 16.19 11.89 16.09 12.21 15.97C12.54 15.84 12.85 15.7 13.15 15.53C13.45 15.35 13.74 15.16 14.01 14.94C14.28 14.72 14.53 14.49 14.76 14.23C14.99 13.97 15.2 13.7 15.38 13.41C15.57 13.12 15.73 12.82 15.87 12.5C16 12.19 16.11 11.87 16.2 11.53C16.28 11.2 16.34 10.87 16.36 10.52C16.37 10.42 16.4 10.33 16.44 10.24C16.48 10.15 16.54 10.07 16.61 10C16.69 9.93 16.77 9.87 16.86 9.84C16.96 9.8 17.05 9.77 17.16 9.77C17.27 9.77 17.38 9.79 17.49 9.83C17.6 9.87 17.7 9.94 17.78 10.02C17.86 10.1 17.92 10.2 17.96 10.3C18 10.41 18.01 10.52 18 10.64C17.98 10.89 17.95 11.13 17.91 11.38C17.86 11.62 17.81 11.87 17.74 12.11C17.68 12.35 17.6 12.58 17.51 12.82C17.42 13.05 17.32 13.28 17.21 13.5C17.1 13.73 16.98 13.95 16.85 14.16C16.71 14.37 16.57 14.58 16.42 14.78C16.27 14.98 16.11 15.17 15.94 15.36C15.77 15.54 15.59 15.72 15.41 15.89C15.22 16.06 15.03 16.22 14.83 16.37C14.63 16.52 14.42 16.66 14.2 16.79C13.99 16.93 13.77 17.05 13.54 17.16C13.31 17.27 13.08 17.37 12.85 17.46C12.61 17.55 12.37 17.63 12.13 17.7C11.88 17.77 11.64 17.83 11.39 17.87C11.14 17.92 10.89 17.96 10.63 17.98C10.38 18 10.13 18.01 9.88 18.01Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path><path id="path" d="M2.85 10.27C2.73 10.28 2.62 10.26 2.51 10.22C2.4 10.17 2.31 10.11 2.23 10.03C2.14 9.95 2.08 9.85 2.04 9.74C2 9.63 1.99 9.52 2 9.41C2.03 8.98 2.1 8.56 2.2 8.15C2.3 7.73 2.43 7.33 2.6 6.94C2.76 6.54 2.96 6.16 3.19 5.8C3.41 5.44 3.67 5.1 3.95 4.77C4.24 4.45 4.54 4.15 4.88 3.88C5.21 3.6 5.56 3.35 5.93 3.13C6.3 2.91 6.69 2.73 7.09 2.57C7.5 2.41 7.91 2.28 8.33 2.19C8.75 2.09 9.18 2.03 9.62 2.01C10.05 1.98 10.48 1.99 10.91 2.03C11.35 2.07 11.77 2.14 12.19 2.25C12.61 2.36 13.02 2.5 13.42 2.67C13.81 2.84 14.19 3.04 14.56 3.28C14.92 3.51 15.27 3.77 15.59 4.05C15.91 4.34 16.21 4.64 16.48 4.98C16.75 5.31 17 5.66 17.21 6.03L15.78 6.83C15.61 6.54 15.42 6.25 15.2 5.99C14.98 5.73 14.74 5.48 14.49 5.25C14.23 5.02 13.96 4.82 13.66 4.63C13.37 4.45 13.07 4.29 12.75 4.15C12.44 4.01 12.11 3.9 11.77 3.82C11.44 3.73 11.1 3.67 10.76 3.64C10.41 3.61 10.07 3.6 9.72 3.62C9.37 3.64 9.03 3.69 8.69 3.77C8.36 3.84 8.03 3.94 7.71 4.07C7.38 4.2 7.08 4.35 6.78 4.52C6.48 4.7 6.2 4.89 5.94 5.11C5.67 5.33 5.43 5.57 5.2 5.83C4.97 6.08 4.77 6.36 4.59 6.65C4.41 6.94 4.25 7.24 4.12 7.55C3.98 7.87 3.88 8.19 3.8 8.52C3.72 8.85 3.66 9.19 3.64 9.53C3.63 9.62 3.6 9.72 3.56 9.81C3.52 9.9 3.46 9.98 3.39 10.05C3.32 10.12 3.23 10.17 3.14 10.21C3.05 10.25 2.95 10.27 2.85 10.27Z" fill="currentColor" fill-opacity="1.000000" fill-rule="nonzero"></path></g></svg></div></div><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M18.14 9.428l-.003.019L17.114 15a3.774 3.774 0 0 1-1.313 2.27 3.673 3.673 0 0 1-2.438.894H3.895c-.57 0-1.055-.205-1.458-.614a2.033 2.033 0 0 1-.604-1.48v-5.438c0-.578.201-1.071.604-1.48.402-.41.888-.614 1.458-.614h1.932l2.317-5.293c.24-.548.6-.948 1.083-1.2.599-.312 1.156-.278 1.672.103.782.577 1.172 1.355 1.172 2.334V6.997h3.994c.638-.007 1.167.235 1.588.726.421.492.584 1.06.488 1.705zm-2.076-2.6c.686-.007 1.262.256 1.714.785.453.529.63 1.146.527 1.84v.004l-.005.02v.003l-1.022 5.552a3.943 3.943 0 0 1-1.37 2.368 3.838 3.838 0 0 1-2.545.933H3.895a2.137 2.137 0 0 1-1.576-.663 2.203 2.203 0 0 1-.652-1.6v-5.437c0-.622.218-1.159.652-1.6.434-.44.962-.663 1.576-.663H5.72l2.273-5.192c.254-.58.64-1.01 1.159-1.282.32-.167.64-.246.953-.227.315.02.613.137.893.344.824.608 1.24 1.437 1.24 2.47v2.345h3.827zM9.741 3.063c-.247.128-.437.344-.57.647L6.708 9.34v7.683h6.655a2.59 2.59 0 0 0 1.72-.63c.498-.42.807-.955.926-1.601l1.02-5.544a.936.936 0 0 0-.225-.773.917.917 0 0 0-.739-.335h-4.557a.567.567 0 0 1-.562-.571V4.483c0-.591-.236-1.061-.708-1.41-.143-.105-.309-.109-.497-.01zm7.124 6.157a.766.766 0 0 0-.186-.636.753.753 0 0 0-.612-.276h-4.559a.734.734 0 0 1-.728-.74V4.483c0-.537-.21-.956-.64-1.273a.233.233 0 0 0-.137-.05.387.387 0 0 0-.185.053c-.208.108-.374.291-.495.566m0 0L6.874 9.375v7.479h6.489c.609 0 1.145-.197 1.614-.592.468-.396.757-.894.869-1.502l1.02-5.54M3.35 16.623c.152.155.33.23.545.23h1.522V9.85H3.895a.732.732 0 0 0-.545.23.755.755 0 0 0-.226.553v5.437c0 .218.074.4.226.553zm.545-6.941a.897.897 0 0 0-.663.278.924.924 0 0 0-.274.673v5.437c0 .263.091.487.274.673.183.186.404.28.663.28h1.688V9.681H3.895z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M18.137 9.447l.004-.02a2.044 2.044 0 0 0-.488-1.704c-.421-.491-.95-.733-1.588-.726h-2.282l1.584 1.142h.698a.917.917 0 0 1 .739.335.936.936 0 0 1 .225.773l-1.02 5.543a2.663 2.663 0 0 1-.926 1.602 2.59 2.59 0 0 1-1.72.63H6.708V9.34L9.171 3.71c.133-.303.323-.519.57-.647.188-.099.354-.095.497.01.472.349.708.819.708 1.41v.467l1.125.811V4.483c0-.98-.39-1.757-1.171-2.334-.517-.38-1.074-.415-1.673-.103-.482.252-.843.652-1.083 1.2L5.827 8.54H3.895c-.57 0-1.056.205-1.458.614a2.033 2.033 0 0 0-.604 1.48v5.437c0 .578.201 1.072.604 1.48.403.41.889.615 1.458.615h9.468c.918 0 1.731-.299 2.438-.895A3.774 3.774 0 0 0 17.114 15l1.023-5.553zm-14.242.235a.897.897 0 0 0-.663.278.924.924 0 0 0-.274.673v5.437c0 .263.091.487.274.673.183.186.404.28.663.28h1.688V9.681H3.895z" fill="currentColor"></path><path d="M10.946 7.568c0 .316.252.571.563.571h3.858l-1.584-1.142h-1.712V5.76l-1.125-.811v2.618z" fill="currentColor"></path></svg></div></div><div class="ds-icon-button" tabindex="0" style="--ds-icon-button-text-color: #CDD4DF; --ds-icon-button-size: 20px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M18.304 10.543v.004a2.214 2.214 0 0 1-.526 1.84c-.452.528-1.028.792-1.714.784h-3.827v2.345c0 1.034-.416 1.863-1.24 2.471-.28.207-.578.324-.893.343-.314.02-.632-.06-.953-.226-.519-.271-.905-.702-1.159-1.282l-2.273-5.193H3.895a2.136 2.136 0 0 1-1.576-.663 2.203 2.203 0 0 1-.652-1.6V3.93c0-.623.218-1.16.652-1.6.434-.441.963-.663 1.576-.663h9.468c.957 0 1.807.311 2.544.933a3.943 3.943 0 0 1 1.37 2.368L18.3 10.52v.002l.004.02zm-1.19-5.544a3.774 3.774 0 0 0-1.313-2.27 3.673 3.673 0 0 0-2.438-.894H3.895c-.57 0-1.055.205-1.458.614a2.033 2.033 0 0 0-.604 1.48v5.437c0 .578.201 1.072.604 1.48.402.41.888.615 1.458.615h1.932l2.317 5.292c.24.549.6.949 1.083 1.2.599.313 1.156.279 1.672-.102.782-.577 1.172-1.355 1.172-2.335v-2.513h3.994c.638.007 1.167-.235 1.588-.727.421-.491.584-1.06.488-1.704l-.004-.02L17.114 5zM9.819 16.787c.076.04.137.053.185.052a.233.233 0 0 0 .137-.05c.43-.316.64-.735.64-1.273v-3.084c0-.41.327-.74.729-.74h4.558a.752.752 0 0 0 .612-.277.766.766 0 0 0 .186-.635l-1.02-5.54a2.495 2.495 0 0 0-.869-1.502 2.426 2.426 0 0 0-1.613-.592H6.874v7.48l2.449 5.595m-2.615-5.56V2.978h6.655c.648 0 1.221.21 1.72.63.498.42.807.954.926 1.601l1.02 5.543a.936.936 0 0 1-.225.774.917.917 0 0 1-.739.335h-4.557a.567.567 0 0 0-.562.57v3.085c0 .592-.236 1.062-.708 1.41-.143.106-.309.11-.497.01-.247-.128-.437-.343-.57-.647l-2.463-5.628zM3.35 3.376a.754.754 0 0 0-.226.554v5.436c0 .218.074.4.226.554.152.154.33.23.545.23h1.522V3.146H3.895a.731.731 0 0 0-.545.23zm2.233-.398v7.34H3.895a.897.897 0 0 1-.663-.279.925.925 0 0 1-.274-.673V3.93c0-.263.091-.487.274-.673a.895.895 0 0 1 .663-.28h1.688zm4.235 13.809c-.208-.108-.375-.292-.495-.566l.495.566z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M15.801 2.73a3.774 3.774 0 0 1 1.313 2.269l1.023 5.554.004.019a2.044 2.044 0 0 1-.488 1.704c-.421.492-.95.734-1.588.727h-3.994v2.513c0 .98-.39 1.758-1.171 2.335-.517.38-1.074.415-1.673.102-.482-.251-.843-.651-1.083-1.2l-2.317-5.292H3.895c-.57 0-1.056-.205-1.458-.614a2.033 2.033 0 0 1-.604-1.48V3.93c0-.579.201-1.072.604-1.481.403-.41.889-.614 1.458-.614h9.468c.918 0 1.731.298 2.438.894zm-2.438.248c.648 0 1.221.21 1.72.63.498.42.807.954.926 1.601l1.02 5.543a.936.936 0 0 1-.225.774.917.917 0 0 1-.739.335h-4.557a.567.567 0 0 0-.562.57v3.085c0 .592-.236 1.062-.708 1.41-.143.106-.309.11-.497.01-.247-.128-.437-.343-.57-.647l-2.463-5.628V2.978h6.655zm-9.468 7.34a.897.897 0 0 1-.663-.279.925.925 0 0 1-.274-.673V3.93c0-.263.091-.487.274-.673a.895.895 0 0 1 .663-.28h1.688v7.341H3.895z" fill="currentColor"></path></svg></div></div></div><div style="flex: 1 1 0%;"></div></div></div></div><div class="_88681e8"><div class="_217e214"><svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5.856 17.121a.979.979 0 0 1-.327-.06.839.839 0 0 1-.283-.177.739.739 0 0 1-.187-.255.724.724 0 0 1-.07-.303l-.02-1.609a4.663 4.663 0 0 1-1.446-.455 4.252 4.252 0 0 1-.637-.401c-.199-.146-.385-.31-.553-.492a4.442 4.442 0 0 1-.45-.577 4.303 4.303 0 0 1-.327-.637 3.823 3.823 0 0 1-.206-.686 3.729 3.729 0 0 1-.064-.704V6.478c0-.261.025-.516.077-.771a4.43 4.43 0 0 1 .244-.747 4.062 4.062 0 0 1 .932-1.28c.2-.183.418-.347.65-.493.23-.145.482-.267.739-.364a4.21 4.21 0 0 1 .81-.225c.27-.054.553-.078.835-.078H8.55c.103 0 .2.018.29.054a.7.7 0 0 1 .411.376.667.667 0 0 1-.161.766.736.736 0 0 1-.25.151.764.764 0 0 1-.29.055H5.573c-.186 0-.366.012-.54.049-.18.03-.353.079-.52.145-.167.061-.328.14-.482.237-.148.091-.29.2-.418.316a2.897 2.897 0 0 0-.347.388c-.097.14-.187.286-.257.444a2.473 2.473 0 0 0-.206.977v4.287c0 .17.013.333.051.503a2.549 2.549 0 0 0 .772 1.33 2.721 2.721 0 0 0 .913.559c.167.066.347.115.527.152.18.03.36.048.546.048a.904.904 0 0 1 .61.23.848.848 0 0 1 .194.262.84.84 0 0 1 .07.303l.007.99 1.915-1.293a2.877 2.877 0 0 1 1.64-.492h2.372c.186 0 .366-.018.54-.048.18-.03.353-.08.52-.146.168-.067.329-.146.483-.237.148-.091.29-.2.418-.316.128-.121.244-.249.347-.388a2.8 2.8 0 0 0 .257-.444 2.47 2.47 0 0 0 .206-.977V8.585a.646.646 0 0 1 .225-.492.679.679 0 0 1 .244-.152.814.814 0 0 1 .585 0c.09.03.174.085.244.152a.657.657 0 0 1 .225.492V10.8c0 .261-.032.516-.083.771a4.192 4.192 0 0 1-.245.74c-.109.244-.244.468-.398.687a3.735 3.735 0 0 1-.534.6c-.2.183-.418.347-.65.493a4.134 4.134 0 0 1-.738.364 4.7 4.7 0 0 1-.81.225c-.27.054-.553.079-.836.079h-1.877c-.604 0-1.144.164-1.633.491l-2.54 1.713a.913.913 0 0 1-.514.157z" fill="currentColor"></path><path d="M15.866 4.125h-4.174c-.41 0-.741.313-.741.7 0 .387.332.7.741.7h4.174c.41 0 .742-.313.742-.7 0-.387-.332-.7-.742-.7z" fill="currentColor"></path><path d="M14.537 2.932c0-.396-.34-.717-.759-.717s-.758.32-.758.717v3.786c0 .396.34.717.758.717.42 0 .76-.321.76-.717V2.932z" fill="currentColor"></path></svg><span>开启新对话</span></div></div><div class="_871cbca"><div class="aaff8b8f"><div class="_77cefa5"><div class="dd442025 _42b6996"><div class="_24fad49"><textarea id="chat-input" class="_27c9245" placeholder="给 DeepSeek 发送消息 " rows="2"></textarea><div class="b13855df">
</div></div><div class="ec4f5d61"><div role="button" class="ds-button ds-button--primary ds-button--filled ds-button--rect ds-button--m _3172d9f" tabindex="0" style="--ds-button-color: rgba(77, 107, 254, 0.40); --button-text-color: #4CAEFF; --button-border-color: rgba(0, 122, 255, 0.15); --ds-button-hover-color: rgba(77, 107, 254, 0.2);"><div class="ds-button__icon"><span style="transition: transform 0.4s ease-out 0s; transform: rotate(0deg);"><div class="ds-icon" style="font-size: 19px; width: 19px; height: 19px; color: rgb(76, 174, 255);"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2.656 17.344c-1.016-1.015-1.15-2.75-.313-4.925.325-.825.73-1.617 1.205-2.365L3.582 10l-.033-.054c-.5-.799-.91-1.596-1.206-2.365-.836-2.175-.703-3.91.313-4.926.56-.56 1.364-.86 2.335-.86 1.425 0 3.168.636 4.957 1.756l.053.034.053-.034c1.79-1.12 3.532-1.757 4.957-1.757.972 0 1.776.3 2.335.86 1.014 1.015 1.148 2.752.312 4.926a13.892 13.892 0 0 1-1.206 2.365l-.034.054.034.053c.5.8.91 1.596 1.205 2.365.837 2.175.704 3.911-.311 4.926-.56.56-1.364.861-2.335.861-1.425 0-3.168-.637-4.957-1.757L10 16.415l-.053.033c-1.79 1.12-3.532 1.757-4.957 1.757-.972 0-1.776-.3-2.335-.86zm13.631-4.399c-.187-.488-.429-.988-.71-1.492l-.075-.132-.092.12a22.075 22.075 0 0 1-3.968 3.968l-.12.093.132.074c1.308.734 2.559 1.162 3.556 1.162.563 0 1.006-.138 1.298-.43.3-.3.436-.774.428-1.346-.008-.575-.159-1.264-.449-2.017zm-6.345 1.65l.058.042.058-.042a19.881 19.881 0 0 0 4.551-4.537l.043-.058-.043-.058a20.123 20.123 0 0 0-2.093-2.458 19.732 19.732 0 0 0-2.458-2.08L10 5.364l-.058.042A19.883 19.883 0 0 0 5.39 9.942L5.348 10l.042.059c.631.874 1.332 1.695 2.094 2.457a19.74 19.74 0 0 0 2.458 2.08zm6.366-10.902c-.293-.293-.736-.431-1.298-.431-.998 0-2.248.429-3.556 1.163l-.132.074.12.092a21.938 21.938 0 0 1 3.968 3.968l.092.12.074-.132c.282-.504.524-1.004.711-1.492.29-.753.442-1.442.45-2.017.007-.572-.129-1.045-.429-1.345zM3.712 7.055c.202.514.44 1.013.712 1.493l.074.13.092-.119a21.94 21.94 0 0 1 3.968-3.968l.12-.092-.132-.074C7.238 3.69 5.987 3.262 4.99 3.262c-.563 0-1.006.138-1.298.43-.3.301-.436.774-.428 1.346.007.575.159 1.264.448 2.017zm0 5.89c-.29.753-.44 1.442-.448 2.017-.008.572.127 1.045.428 1.345.293.293.736.431 1.298.431.997 0 2.247-.428 3.556-1.162l.131-.074-.12-.093a21.94 21.94 0 0 1-3.967-3.968l-.093-.12-.074.132a11.712 11.712 0 0 0-.71 1.492z" fill="currentColor" stroke="currentColor" stroke-width=".1"></path><path d="M10.706 11.704A1.843 1.843 0 0 1 8.155 10a1.845 1.845 0 1 1 2.551 1.704z" fill="currentColor" stroke="currentColor" stroke-width=".2"></path></svg></div></span></div><span class="ad0c98fd">深度思考 (R1)</span></div><div role="button" class="ds-button ds-button--primary ds-button--filled ds-button--rect ds-button--m _3172d9f" tabindex="0" style="--ds-button-color: rgba(77, 107, 254, 0.40); --button-text-color: #4CAEFF; --button-border-color: rgba(0, 122, 255, 0.15); --ds-button-hover-color: rgba(77, 107, 254, 0.2);"><div class="ds-button__icon"><span style="transition: transform 0.4s ease-out 0s; transform: rotate(0deg);"><div class="ds-icon" style="font-size: 17px; width: 17px; height: 17px; color: rgb(76, 174, 255);"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="10" cy="10" r="9" stroke="currentColor" stroke-width="1.8"></circle><path d="M10 1c1.657 0 3 4.03 3 9s-1.343 9-3 9M10 19c-1.657 0-3-4.03-3-9s1.343-9 3-9M1 10h18" stroke="currentColor" stroke-width="1.8"></path></svg></div></span></div><span class="ad0c98fd">联网搜索</span></div><div class="bf38813a"><div class="f02f0e25 cfba8f40"><div class="ds-icon" style="font-size: 23px; width: 23px; height: 23px;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14 20" fill="none"><path d="M7 20c-1.856-.002-3.635-.7-4.947-1.94C.74 16.819.003 15.137 0 13.383V4.828a4.536 4.536 0 0 1 .365-1.843 4.75 4.75 0 0 1 1.087-1.567A5.065 5.065 0 0 1 3.096.368a5.293 5.293 0 0 1 3.888 0c.616.244 1.174.6 1.643 1.05.469.45.839.982 1.088 1.567.25.586.373 1.212.364 1.843v8.555a2.837 2.837 0 0 1-.92 2.027A3.174 3.174 0 0 1 7 16.245c-.807 0-1.582-.3-2.158-.835a2.837 2.837 0 0 1-.92-2.027v-6.22a1.119 1.119 0 1 1 2.237 0v6.22a.777.777 0 0 0 .256.547.868.868 0 0 0 .585.224c.219 0 .429-.08.586-.224a.777.777 0 0 0 .256-.546V4.828A2.522 2.522 0 0 0 7.643 3.8a2.64 2.64 0 0 0-.604-.876 2.816 2.816 0 0 0-.915-.587 2.943 2.943 0 0 0-2.168 0 2.816 2.816 0 0 0-.916.587 2.64 2.64 0 0 0-.604.876 2.522 2.522 0 0 0-.198 1.028v8.555c0 1.194.501 2.339 1.394 3.183A4.906 4.906 0 0 0 7 17.885a4.906 4.906 0 0 0 3.367-1.319 4.382 4.382 0 0 0 1.395-3.183v-6.22a1.119 1.119 0 0 1 2.237 0v6.22c-.002 1.754-.74 3.436-2.052 4.677C10.635 19.3 8.856 19.998 7 20z" fill="currentColor"></path></svg></div></div><input type="file" multiple="" disabled="" accept=".epub,.mobi,.azw3,.pdf,.png,.jpg,.jpeg,.svg,.svgz,.bmp,.gif,.webp,.ico,.xbm,.dib,.pjp,.tif,.pjpeg,.avif,.apng,.tiff,.jfif,.txt,.md,.csv,.tsv,.html,.json,.log,.dot,.go,.h,.c,.cpp,.cxx,.cc,.cs,.java,.js,.css,.jsp,.php,.py,.py3,.asp,.yaml,.yml,.ini,.conf,.ts,.tsx,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.abap,.asc,.ash,.ampl,.mod,.g4,.apib,.apl,.dyalog,.asax,.ascx,.ashx,.asmx,.aspx,.axd,.dats,.hats,.sats,.as,.adb,.ada,.ads,.agda,.als,.apacheconf,.vhost,.cls,.applescript,.scpt,.arc,.ino,.asciidoc,.adoc,.aj,.asm,.a51,.inc,.nasm,.aug,.ahk,.ahkl,.au3,.awk,.auk,.gawk,.mawk,.nawk,.bat,.cmd,.befunge,.bison,.bb,.decls,.bmx,.bsv,.boo,.b,.bf,.brs,.bro,.cats,.idc,.w,.cake,.cshtml,.csx,.c++,.cp,.h++,.hh,.hpp,.hxx,.inl,.ipp,.tcc,.tpp,.c-objdump,.chs,.clp,.cmake,.in,.cob,.cbl,.ccp,.cobol,.cpy,.capnp,.mss,.ceylon,.chpl,.ch,.ck,.cirru,.clw,.icl,.dcl,.click,.clj,.boot,.cl2,.cljc,.cljs,.hl,.cljscm,.cljx,.hic,.coffee,._coffee,.cjsx,.cson,.iced,.cfm,.cfml,.cfc,.lisp,.asd,.cl,.l,.lsp,.ny,.podsl,.sexp,.cps,.coq,.v,.cppobjdump,.c++-objdump,.c++objdump,.cpp-objdump,.cxx-objdump,.creole,.cr,.feature,.cu,.cuh,.cy,.pyx,.pxd,.pxi,.d,.di,.d-objdump,.com,.dm,.zone,.arpa,.darcspatch,.dpatch,.dart,.diff,.patch,.dockerfile,.djs,.dylan,.dyl,.intr,.lid,.E,.ecl,.eclxml,.sch,.brd,.epj,.e,.ex,.exs,.elm,.el,.emacs,.desktop,.em,.emberscript,.erl,.es,.escript,.hrl,.xrl,.yrl,.fs,.fsi,.fsx,.fx,.flux,.f90,.f,.f03,.f08,.f77,.f95,.for,.fpp,.factor,.fy,.fancypack,.fan,.fth,.4th,.forth,.fr,.frt,.ftl,.g,.gco,.gcode,.gms,.gap,.gd,.gi,.tst,.s,.ms,.glsl,.fp,.frag,.frg,.fsh,.fshader,.geo,.geom,.glslv,.gshader,.shader,.vert,.vrx,.vsh,.vshader,.gml,.kid,.ebuild,.eclass,.po,.pot,.glf,.gp,.gnu,.gnuplot,.plot,.plt,.golo,.gs,.gst,.gsx,.vark,.grace,.gradle,.gf,.graphql,.gv,.man,.1in,.1m,.1x,.3in,.3m,.3qt,.3x,.me,.n,.rno,.roff,.groovy,.grt,.gtpl,.gvy,.gsp,.hcl,.tf,.hlsl,.fxh,.hlsli,.htm,.st,.xht,.xhtml,.mustache,.jinja,.eex,.erb,.deface,.phtml,.http,.haml,.handlebars,.hbs,.hb,.hs,.hsc,.hx,.hxsl,.hy,.pro,.dlm,.ipf,.cfg,.prefs,.properties,.irclog,.weechatlog,.idr,.lidr,.ni,.i7x,.iss,.io,.ik,.thy,.ijs,.flex,.jflex,.geojson,.lock,.topojson,.json5,.jsonld,.jq,.jsx,.jade,.j,._js,.bones,.es6,.jake,.jsb,.jscad,.jsfl,.jsm,.jss,.njs,.pac,.sjs,.ssjs,.sublime-build,.sublime-commands,.sublime-completions,.sublime-keymap,.sublime-macro,.sublime-menu,.sublime-mousemap,.sublime-project,.sublime-settings,.sublime-theme,.sublime-workspace,.sublime_metrics,.sublime_session,.xsjs,.xsjslib,.jl,.ipynb,.krl,.kicad_pcb,.kit,.kt,.ktm,.kts,.lfe,.ll,.lol,.lsl,.lslp,.lvproj,.lasso,.las,.lasso8,.lasso9,.ldml,.latte,.lean,.hlean,.less,.lex,.ly,.ily,.m,.ld,.lds,.liquid,.lagda,.litcoffee,.lhs,.ls,._ls,.xm,.x,.xi,.lgt,.logtalk,.lookml,.lua,.fcgi,.nse,.pd_lua,.rbxs,.wlua,.mumps,.m4,.mcr,.mtml,.muf,.mak,.mk,.mkfile,.mako,.mao,.markdown,.mkd,.mkdn,.mkdown,.ron,.mask,.mathematica,.cdf,.ma,.map,.mt,.nb,.nbp,.wl,.wlt,.matlab,.maxpat,.maxhelp,.maxproj,.mxt,.pat,.mediawiki,.wiki,.moo,.metal,.minid,.druby,.duby,.mir,.mirah,.mo,.mms,.mmk,.monkey,.moon,.myt,.ncl,.nl,.nsi,.nsh,.axs,.axi,.nlogo,.nginxconf,.nim,.nimrod,.ninja,.nit,.nix,.nu,.numpy,.numpyw,.numsc,.ml,.eliom,.eliomi,.ml4,.mli,.mll,.mly,.objdump,.mm,.sj,.omgrofl,.opa,.opal,.opencl,.p,.scad,.org,.ox,.oxh,.oxo,.oxygene,.oz,.pwn,.aw,.ctp,.php3,.php4,.php5,.php6,.php7,.php8,.phps,.phpt,.pls,.pck,.pkb,.pks,.plb,.plsql,.sql,.pov,.pan,.psc,.parrot,.pasm,.pir,.pas,.dfm,.dpr,.lpr,.pp,.pl,.al,.cgi,.perl,.ph,.plx,.pm,.pod,.psgi,.t,.6pl,.6pm,.nqp,.p6,.p6l,.p6m,.pl6,.pm6,.pkl,.pig,.pike,.pmod,.pogo,.pony,.ps,.eps,.ps1,.psd1,.psm1,.pde,.prolog,.yap,.spin,.proto,.pub,.pd,.pb,.pbi,.purs,.bzl,.gyp,.lmi,.pyde,.pyi,.pyp,.pyt,.pyw,.rpy,.tac,.wsgi,.xpy,.pytb,.qml,.qbs,.pri,.r,.rd,.rsx,.raml,.rdoc,.rbbas,.rbfrm,.rbmnu,.rbres,.rbtbar,.rbuistate,.rhtml,.rmd,.rkt,.rktd,.rktl,.scrbl,.rl,.raw,.reb,.r2,.r3,.rebol,.red,.reds,.cw,.rs,.rsh,.robot,.rg,.rb,.builder,.gemspec,.god,.irbrc,.jbuilder,.mspec,.pluginspec,.podspec,.rabl,.rake,.rbuild,.rbw,.rbx,.ru,.ruby,.thor,.watchr,.sas,.scss,.smt2,.smt,.sparql,.rq,.sqf,.hqf,.cql,.ddl,.prc,.tab,.udf,.viw,.db2,.ston,.sage,.sagews,.sls,.sass,.scala,.sbt,.sc,.scaml,.scm,.sld,.sps,.ss,.sci,.sce,.self,.sh,.bash,.bats,.command,.ksh,.tmux,.tool,.zsh,.sh-session,.shen,.sl,.slim,.smali,.tpl,.sp,.sma,.nut,.stan,.ML,.fun,.sig,.sml,.do,.ado,.doh,.ihlp,.mata,.matah,.sthlp,.styl,.scd,.swift,.sv,.svh,.vh,.toml,.txl,.tcl,.adp,.tm,.tcsh,.csh,.tex,.aux,.bbx,.bib,.cbx,.dtx,.ins,.lbx,.ltx,.mkii,.mkiv,.mkvi,.sty,.toc,.tea,.no,.textile,.thrift,.tu,.ttl,.twig,.upc,.anim,.asset,.mat,.meta,.prefab,.unity,.uno,.uc,.ur,.urs,.vcl,.vhdl,.vhd,.vhf,.vhi,.vho,.vhs,.vht,.vhw,.vala,.vapi,.veo,.vim,.vb,.bas,.frm,.frx,.vba,.vbhtml,.vbs,.volt,.vue,.owl,.webidl,.x10,.xc,.xml,.ant,.axml,.ccxml,.clixml,.cproject,.csl,.csproj,.ct,.dita,.ditamap,.ditaval,.config,.dotsettings,.filters,.fsproj,.fxml,.glade,.grxml,.iml,.ivy,.jelly,.jsproj,.kml,.launch,.mdpolicy,.mxml,.nproj,.nuspec,.odd,.osm,.plist,.props,.ps1xml,.psc1,.pt,.rdf,.rss,.scxml,.srdf,.storyboard,.stTheme,.sublime-snippet,.targets,.tmCommand,.tml,.tmLanguage,.tmPreferences,.tmSnippet,.tmTheme,.ui,.urdf,.ux,.vbproj,.vcxproj,.vssettings,.vxml,.wsdl,.wsf,.wxi,.wxl,.wxs,.x3d,.xacro,.xaml,.xib,.xlf,.xliff,.xmi,.dist,.xproj,.xsd,.xul,.zcml,.xsp-config,.metadata,.xpl,.xproc,.xquery,.xq,.xql,.xqm,.xqy,.xs,.xslt,.xsl,.xojo_code,.xojo_menu,.xojo_report,.xojo_script,.xojo_toolbar,.xojo_window,.xtend,.reek,.rviz,.sublime-syntax,.syntax,.yaml-tmlanguage,.yang,.y,.yacc,.yy,.zep,.zimpl,.zmpl,.zpl,.ec,.eh,.edn,.fish,.mu,.nc,.ooc,.rst,.rest,.wisp,.prg,.prw,.gitignore,.gitkeep,.gitmodules,.example,.avifs,.blp,.bufr,.bw,.cur,.dcx,.dds,.emf,.fit,.fits,.flc,.fli,.ftc,.ftu,.gbr,.grib,.h5,.hdf,.hif,.icb,.icns,.iim,.im,.j2c,.j2k,.jp2,.jpc,.jpe,.jpf,.jpx,.mpeg,.mpg,.msp,.pbm,.pcd,.pcx,.pfm,.pgm,.pnm,.ppm,.psd,.pxr,.qoi,.ras,.rgb,.rgba,.sgi,.tga,.vda,.vst,.wmf,.xpm" style="display: none;"><div role="button" aria-disabled="true" class="_7436101 bcc55ca1"><div class="_6f28693"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="14" height="16" viewBox="0 0 14 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M7 16c-.595 0-1.077-.462-1.077-1.032V1.032C5.923.462 6.405 0 7 0s1.077.462 1.077 1.032v13.936C8.077 15.538 7.595 16 7 16z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M.315 7.44a1.002 1.002 0 0 1 0-1.46L6.238.302a1.11 1.11 0 0 1 1.523 0c.421.403.421 1.057 0 1.46L1.838 7.44a1.11 1.11 0 0 1-1.523 0z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M13.685 7.44a1.11 1.11 0 0 1-1.523 0L6.238 1.762a1.002 1.002 0 0 1 0-1.46 1.11 1.11 0 0 1 1.523 0l5.924 5.678c.42.403.42 1.056 0 1.46z" fill="currentColor"></path></svg></div></div></div></div></div></div></div></div><div class="_0fcaa63">内容由 AI 生成，请仔细甄别</div></div></div></div></div></div></div></div></div></div></div><div class="ds-notification-container ds-theme" style="--ds-rgb-hover: 255 255 255 / 8%; font-size: var(--ds-font-size-m); line-height: var(--ds-line-height-m);"></div><iframe id="intercom-frame" style="position: absolute !important; opacity: 0 !important; width: 1px !important; height: 1px !important; top: 0 !important; left: 0 !important; border: none !important; display: block !important; z-index: -1 !important; pointer-events: none;" aria-hidden="true" tabindex="-1" title="Intercom" src="./dialog1_files/saved_resource.html"></iframe><div class="intercom-lightweight-app"><style id="intercom-lightweight-app-style" type="text/css">
  @keyframes intercom-lightweight-app-launcher {
    from {
      opacity: 0;
      transform: scale(0.5);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  @keyframes intercom-lightweight-app-gradient {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  @keyframes intercom-lightweight-app-messenger {
    0% {
      opacity: 0;
      transform: scale(0);
    }
    40% {
      opacity: 1;
    }
    100% {
      transform: scale(1);
    }
  }

  .intercom-lightweight-app {
    position: fixed;
    z-index: 2147483001;
    width: 0;
    height: 0;
    font-family: intercom-font, "Helvetica Neue", "Apple Color Emoji", Helvetica, Arial, sans-serif;
  }

  .intercom-lightweight-app-gradient {
    position: fixed;
    z-index: 2147483002;
    width: 500px;
    height: 500px;
    bottom: 0;
    right: 0;
    pointer-events: none;
    background: radial-gradient(
      ellipse at bottom right,
      rgba(29, 39, 54, 0.16) 0%,
      rgba(29, 39, 54, 0) 72%);
    animation: intercom-lightweight-app-gradient 200ms ease-out;
  }

  .intercom-lightweight-app-launcher {
    position: fixed;
    z-index: 2147483003;
    padding: 0 !important;
    margin: 0 !important;
    border: none;
    bottom: 20px;
    right: 20px;
    max-width: 48px;
    width: 48px;
    max-height: 48px;
    height: 48px;
    border-radius: 50%;
    background: #0f0f0f;
    cursor: pointer;
    box-shadow: 0 1px 6px 0 rgba(0, 0, 0, 0.06), 0 2px 32px 0 rgba(0, 0, 0, 0.16);
    transition: transform 167ms cubic-bezier(0.33, 0.00, 0.00, 1.00);
    box-sizing: content-box;
  }


  .intercom-lightweight-app-launcher:hover {
    transition: transform 250ms cubic-bezier(0.33, 0.00, 0.00, 1.00);
    transform: scale(1.1)
  }

  .intercom-lightweight-app-launcher:active {
    transform: scale(0.85);
    transition: transform 134ms cubic-bezier(0.45, 0, 0.2, 1);
  }


  .intercom-lightweight-app-launcher:focus {
    outline: none;

    
  }

  .intercom-lightweight-app-launcher-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    top: 0;
    left: 0;
    width: 48px;
    height: 48px;
    transition: transform 100ms linear, opacity 80ms linear;
  }

  .intercom-lightweight-app-launcher-icon-open {
    
        opacity: 1;
        transform: rotate(0deg) scale(1);
      
  }

  .intercom-lightweight-app-launcher-icon-open svg {
    width: 24px;
    height: 24px;
  }

  .intercom-lightweight-app-launcher-icon-open svg path {
    fill: rgb(255, 255, 255);
  }

  .intercom-lightweight-app-launcher-icon-self-serve {
    
        opacity: 1;
        transform: rotate(0deg) scale(1);
      
  }

  .intercom-lightweight-app-launcher-icon-self-serve svg {
    height: 44px;
  }

  .intercom-lightweight-app-launcher-icon-self-serve svg path {
    fill: rgb(255, 255, 255);
  }

  .intercom-lightweight-app-launcher-custom-icon-open {
    max-height: 24px;
    max-width: 24px;

    
        opacity: 1;
        transform: rotate(0deg) scale(1);
      
  }

  .intercom-lightweight-app-launcher-icon-minimize {
    
        opacity: 0;
        transform: rotate(-60deg) scale(0);
      
  }

  .intercom-lightweight-app-launcher-icon-minimize svg path {
    fill: rgb(255, 255, 255);
  }

  .intercom-lightweight-app-messenger {
    position: fixed;
    z-index: 2147483003;
    overflow: hidden;
    background-color: #ffffff;
    animation: intercom-lightweight-app-messenger 250ms cubic-bezier(0, 1, 1, 1);
    transform-origin: bottom right;

    
        width: 400px;
        height: calc(100% - 40px);
        max-height: 704px;
        min-height: 250px;
        right: 20px;
        bottom: 20px;
        box-shadow: 0 5px 40px rgba(0,0,0,0.16);
      

    border-radius: 16px;
  }

  .intercom-lightweight-app-messenger-header {
    height: 64px;
    border-bottom: none;
    background: #ffffff;
  }

  .intercom-lightweight-app-messenger-footer{
    position:absolute;
    bottom:0;
    width: 100%;
    height: 80px;
    background: #ffffff;
    font-size: 14px;
    line-height: 21px;
    border-top: 1px solid rgba(0, 0, 0, 0.05);
    box-shadow: 0px 0px 25px rgba(0, 0, 0, 0.05);
  }

  @media print {
    .intercom-lightweight-app {
      display: none;
    }
  }
</style></div></body></html>